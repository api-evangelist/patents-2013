---

title: Application based policy enforcement
abstract: One embodiment is directed to a system that comprises a network device, including at least a first port, which is configured to analyze information within one or more messages received during a session initiated by another network device. The system is configured to perform operations including determining a total number of sessions for the first port of the network device and determining whether the total number of sessions for the first port exceeds a threshold value. If the total number of sessions for the first port exceeds the threshold value, an application associated with the first port is classified as a peer-to-peer application. Thereafter, a policy may be enforced based on this classification.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09356964&OS=09356964&RS=09356964
owner: ARUBA NETWORKS, INC.
number: 09356964
owner_city: Sunnyvale
owner_country: US
publication_date: 20131030
---
This application claims the benefit of priority on U.S. Provisional Application Ser. No. 61 722 071 filed on Nov. 2 2012 the entire content of which is incorporated by reference herein.

Embodiments of the disclosure relate to the field of communications and in particular to a system network device and method directed to i analysis of information within a session ii utilization of at least a portion of the analyzed information to classify or determine the application associated with that session and or iii enforce policy for that particular application.

Over the last few years user based policy enforcement firewalls are being deployed to address deficiencies associated with external firewalls. Conventional policy enforcement firewalls are adapted to tightly control what a user is permitted to access over a network and provide separation between user classes. However such policy enforcement fails to address access control and optimization of network efficiency based on either the classification of an application being used during a session or the particular application itself.

Embodiments of the disclosure are directed to a system device and method for i analyzing information within one or more communication sessions hereinafter sessions and ii classifying an application associated with a particular session or determining the particular application associated with that session based on at least a portion of the analyzed information. Thereafter policies may be enforced on an application basis. These policies may be tailored to allow restrict or prohibit usage of the application based the user location of the user time of use role targeted destination or the like.

In general according to one embodiment of the invention a network device comprises logic that analyzes information within a header of one or more messages received during a session initiated by another network device e.g. a client device . From this information the network device is able to classify the application associated with that session or to identify that application by name. As a result the network device is able to formulate a session to application session application mapping from which one or more mappings with higher granularity may be formulated such as for example 

Herein certain terminology is used to describe features of the disclosure. For example the term network device generally represents electronics that support the receipt and or transmission of wireless communications including but not limited or restricted to a controller an access point AP a base station a data transfer device e.g. switch router bridge brouter etc. consumer electronics with wireless connectivity that may feature additional management functionality such as a television a set top box a digital video recorder DVR a video gaming console a projector cellular phone supporting wireless non cellular connectivity and or a television peripheral such as Apple TV or the like.

It is contemplated that the network device may include logic such as one or more of the following i processing circuitry ii one or more communication interfaces such as a radio e.g. component that handles the wireless data transmission reception and or a physical connector to support wired connectivity and or iii a non transitory computer readable storage media e.g. a programmable circuit a semiconductor memory such as a volatile memory such as random access memory RAM or non volatile memory such as read only memory power backed RAM flash memory phase change memory or the like a hard disk drive an optical disc drive etc. or any connector for receiving a portable memory device such as a Universal Serial Bus USB flash drive portable hard disk drive or the like.

Herein the term logic is generally defined as hardware and or software. For example as hardware logic may include processing circuitry e.g. a microcontroller any type of processor a programmable gate array an application specific integrated circuit etc. semiconductor memory or the like. As software logic may be one or more software modules such as executable code in the form of an executable application an application programming interface API a subroutine a function a procedure an object method implementation an applet a servlet a routine source code object code a shared library dynamic load library or one or more instructions. These software modules may be stored in any type of a suitable non transitory storage medium or transitory computer readable transmission media e.g. electrical optical acoustical or other form of propagated signals such as carrier waves infrared signals or digital signals .

An interconnect is generally defined as a communication pathway established over an information carrying medium. This information carrying medium may be a physical medium e.g. electrical wire optical fiber cable bus traces etc. a wireless medium e.g. air in combination with wireless signaling technology or a combination thereof. The data transferred over the interconnect may be in accordance with a variety of communication protocols including but not limited or restricted to those protocols in accordance with WIFi various IEEE 802.11 standards e.g. IEEE 802.11ac 802.11n etc. or the like.

The term message is a grouping of data which may be placed in the form of a packet a frame a stream e.g. a sequence of packets or frames or any other series of bits having a prescribed format.

Lastly the terms or and and or as used herein are to be interpreted as inclusive or meaning any one or any combination. Therefore X Y or Z or X Y and or Z mean any of the following X Y Z X and Y X and Z Y and Z X Y and Z. An exception to this definition will occur only when a combination of elements functions steps or acts are in some way inherently mutually exclusive.

Certain details are set forth below in order to provide a thorough understanding of various embodiments of the disclosure albeit the invention may be practiced through many embodiments other that those illustrated. Well known logic and operations are not set forth in detail in order to avoid unnecessarily obscuring this description.

Referring to an exemplary embodiment of a network supporting application based policy enforcement is shown. Herein network comprises a network device that is adapted to receive communications from other network devices e.g. client devices or STAs where N 1 via one or more intermediary network devices e.g. APs .

Herein network device comprises logic that is configured to identify applications assigned to specific client software ports through analysis of information within each session. In general according to one embodiment of the disclosure logic operates as a policy enforcement firewall PEF that is configured to access information namely a port number at an Internet Protocol IP address from a message within that session. If the total number of sessions for that particular port is greater than a certain threshold the application associated with that particular port is determined to be a peer to peer P2P application.

More specifically network device may be configured with logic that accesses information in a header of a message associated with that session namely a Source SRC port number at SRC IP address. The SRC port is uniquely assigned to an application. In the event that the number of different sessions from the same SRC port and SRC IP address exceed a certain threshold the application associated with that SRC port is determined to be a P2P application. Once the determination has been made P2P policies can be applied to data being transmitted or received from that port such as bandwidth constraints.

Furthermore network device may be configured with logic that is adapted to perform database building based on Domain Name System DNS traffic. According to one embodiment of the disclosure logic performs a Domain Name System DNS snoop on a DNS Response that is prompted by a DNS Request made during the session. Thereafter logic performs a mapping of a targeted destination e.g. a destination DEST IP address to a snooped DNS name. Next one or more applications e.g. cloud based applications are mapped to the DNS name through application of pre canned regular expressions on the DNS name. Hence the session is mapped to an application.

Referring now to an exemplary embodiment of network device operating in combination with cloud based service is shown. In accordance with one embodiment of the disclosure logic within network device comprises a processing circuitry a memory and or a communication interface that is adapted to communicate with other devices supporting wired and or wireless connectivity. These logic units are coupled together by an interconnect . As shown communication interface may comprise a wired port and or one or more radios tuners and or antenna s that support wireless communications.

According to one embodiment of the disclosure memory may be a type of non volatile memory that is adapted to store information obtained during a session e.g. session identifier SRC IP address SRC port number DEST IP address DEST port number protocol type user name device OS type role information for the user of transmitting network device such as guest or department identifier Service Set Identifier SSID used during session client location and or a hostname list . Memory may further store heuristics and policy information where the policy information applies access controls on network to different applications.

As shown in an exemplary embodiment of a first inventive aspect of the enhanced policy enforcement firewall of is shown. Herein the policy enforcement firewall may be adapted to conduct checks to minimize false incorrect classifications block . Thereafter if the checks are passed the information within multiple sessions is analyzed block . For instance the SRC port number SRC IP address DEST port number and DEST IP address may be obtained for each session. All sessions that identify a particular port e.g. SRC or DEST port number can be used to identify the total number of connections e.g. sessions for that particular port. If the total number of connections for that particular port exceeds a certain threshold then the application associated with that particular port is classified as a peer to peer P2P application blocks and .

Upon classifying the application policy is enforced based on at least the classification of the application block . Of course other factors besides classification may be used to influence policy enforcement decisions.

For example referring to when conducting an analysis from the client perspective i.e. analyzing sessions originating from a particular SRC port number and SRC IP address a particular SRC port and SRC IP address is selected block . Next a determination is made as to the number of sessions that identify a particular SRC port number SRC IP address block . Each session features a different DEST port number and DEST IP address. If the total number of sessions for that particular SRC port and SRC IP address combination exceeds a certain threshold block then the application associated with that particular SRC port is determined to be a P2P application block .

Otherwise the application is not classified as a P2P application and other mechanisms are applied to determine the classification for the application block . As an illustrative example for all sessions that are not P2P related we apply other methods of identifying an application like using predefined algorithms destination port range mapping to an application and or looking up IRNA ports.

Upon classifying the application as a P2P application or another classification policy is enforced based on at least that classification block . According to this illustrative embodiment for P2P applications for example one policy may be that bandwidth constraints are enforced on that application if the total number of P2P connections for all P2P applications utilized over a network exceeds a prescribed threshold. It is contemplated that the total number of P2P connections throughout a network may be determined based on the aggregate of sessions involving all classified P2P applications determined by the enhanced policy enforcement firewall.

For instance as an illustrative example six 6 applications A F are running on a network client device. Of these applications as described above application A for the particular SRC port and SRC IP address is a P2P application supporting five 5 sessions. Another application application C is a P2P application supporting ten 10 sessions. As part of policy enforcement the total number of P2P connections A C 15 is determined and compared to the prescribed threshold to determine if a policy is to be enforced on application A e.g. enforce prescribed bandwidth constraints impose a timeout for particular session after an amount of time has elapsed etc. .

It is contemplated that a few additional checks may be conducted to minimize false P2P detections. For instance if there are multiple sessions from a given SRC IP address using different SRC ports to the same DEST IP address DEST port combination all such SRC IP SRC port combinations are ignored. For example 

As another example if the SRC port is less than 1024 then the SRC IP SRC port combination may be ignored. Also if the DEST port maps to a well known application or a known algorithm then the SRC IP SRC port combination are ignored.

As shown in an exemplary embodiment of a second inventive aspect of the enhanced policy enforcement firewall of is shown. According to one embodiment of the disclosure a protocol for the establishment of multi parameter mapping such as session application mapping or a mapping involving such parameters is described.

Herein during a session and in response to a prior DNS Request message a DNS Response message is snooped block . According to one embodiment of the disclosure the DNS Response message may include one or more IP addresses operating as pointers to content stored at different locations. Upon conducting a snoop operation the IP address es are detected and stored in memory of the network device.

Next the IP address es in the DNS Response message are associated to the requested DNS name set forth in the DNS Request message block . Thereafter a regular expression is applied on the DNS name and the regular expression is mapped to an application such as a cloud based application for example through the use of a hostname list that includes a regular expression and its corresponding application name blocks and .

Referring now to an exemplary embodiment of a hostname list is shown. Herein it is shown that list is preloaded into memory of the network device and may be updated automatically by network device or by an administrator of the network. Each entry of list comprises a regular expression such as a pattern of alphanumeric characters and or symbols to denote a particular application and a name of the corresponding application . Hence access to a particular regular expression enables discovery of the corresponding application name.

Each regular expression and application name pair may be categorized within list based on application service type. For instance as shown list may comprise expression application pairs directed to video streaming e.g. YouTube CNN ABC BBC social media e.g. Facebook Twitter etc. productivity e.g. salesforce.com Google Docs Box etc. filesharing e.g. Yousendit Mediafire etc. and or advertising e.g. Doubleclick Adfusion etc. .

Referring back to upon completion of the mapping of the application to the requested DNS name the application may also be mapped to the session block as this information is learned from the snoop of the DNS Response message as well. Hence a session application mapping is created.

This mapping relationship can be extended to create a mapping between a greater number of parameters including but not limited or restricted to one or more of the following user location device role and or SSID. For instance by performing the following operations 1 4 below user and location may be uncovered to produce a session user location application mapping 

Referring to an exemplary embodiment of policy enforcement based on aggregated statistics derived from formulation of session user location application device role SSID mapping is shown. For instance upon detecting a new application block the network device is adapted with create real time application control list ACL for policy enforcement for this application block . Policy enforcement involves the alteration of usage patterns for a given application where such usage patterns may be based on aggregate network usage. According to one embodiment of the disclosure the application control list is updated whenever a user tries to use the given application.

Upon detecting a triggering event block policy is enforced block . This may involve allowing blocking or restricting access to network services for the given application adjusting access based on quality of service QoS levels and or logging usage on a per use or per role basis.

As an illustrative example the policy enforcement firewall may feature an application control list that determines if there are too many users with a certain role e.g. employees of the legal department having active social media sessions. Upon detecting that the number of employees within the legal department of company A exceeds a given threshold certain policies may be enforced. These policies may include prohibiting network access by social media applications identified on hostname list of or restricting access by social media applications only when the location of the user is within a certain coverage area e.g. within the cafeteria or another public group location.

Referring now to an exemplary embodiment of a Network Visibility dashboard is shown. Herein upon selection of activity button Firewall one or more summary reviews are provided. These summary reviews include are based on aggregated statistics maintained by the network device and include the following 

Referring now to an exemplary embodiment of an Application View dashboard is shown. Herein upon selecting the view all applications link of a listing of applications is provided. Each listing includes the application name size bytes number of packets sent user identifier destination WLAN over which application communicates device type and role . Furthermore aggregated sessions and usage breakdown may be provided.

Additional advantages and modifications will readily occur to those skilled in the art. Therefore the invention in its broader aspects is not limited to the specific details and representative embodiments shown and described herein. Accordingly various modifications may be made without departing from the spirit or scope of the general inventive concept as determined by the subsequently filed claims and their equivalents. The descriptions are thus to be regarded as illustrative instead of limiting.

