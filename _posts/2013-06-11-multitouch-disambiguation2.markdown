---

title: Multi-touch disambiguation
abstract: A capacitance sensing method may include performing a first scan of a plurality of sensor elements of a touch-sensing surface to detect a plurality of capacitance values indicating a presence of multiple contacts at the touch sensing surface. Based on the plurality of capacitance values, a plurality of coordinates may be calculated that indicate a plurality of possible contact locations for the multiple contacts. In response to detecting that the plurality of coordinates indicates the presence of the multiple contacts, a resolve scan of at least a first intersection of sensor elements may be performed, where the first intersection corresponds to at least one of the possible contact locations. Based on the resolve scan, at least one of the possible contact locations may be identified as an actual contact location of one of the multiple contacts.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09575602&OS=09575602&RS=09575602
owner: MONTEREY RESEARCH, LLC
number: 09575602
owner_city: Santa Clara
owner_country: US
publication_date: 20130611
---
This application is a continuation of U.S. application Ser. No. 12 684 791 filed Jan. 8 2010 now U.S. Pat. No. 8 462 135 issued Jun. 11 2013 which claims priority to U.S. Provisional Patent Application No. 61 145 457 filed Jan. 16 2009 and claims priority to U.S. Provisional Patent Application No. 61 143 199 filed Jan. 8 2009 all of which are incorporated by reference herein in their entirety.

This disclosure relates to the field of user interface devices and in particular to disambiguation of multiple touches at a touch sensing surface.

Computing devices such as notebook computers personal data assistants PDAs kiosks and mobile handsets have user interface devices which are also known as human interface devices HID . One user interface device that has become more common is a touch sensor pad also commonly referred to as a touchpad . A basic notebook computer touch sensor pad emulates the function of a personal computer PC mouse. A touch sensor pad is typically embedded into a PC notebook for built in portability. A touch sensor pad replicates mouse X Y movement by using two defined axes which contain a collection of sensor elements that detect the position of an object such as a finger. Mouse right left button clicks can be replicated by two mechanical buttons located in the vicinity of the touchpad or by tapping commands on the touch sensor pad itself. The touch sensor pad provides a user interface device for performing such functions as positioning a pointer or selecting an item on a display. These touch sensor pads may include for example sensor arrays having two dimensions for detecting movement in a plane. The sensor array may include a one dimensional sensor array detecting movement in one axis. The sensor array may also be two dimensional detecting movements in two axes.

Another user interface device that has become more common is a touch screen. Touch screens also known as touchscreens touch panels or touchscreen panels are transparent display overlays which are typically either pressure sensitive resistive or piezoelectric electrically sensitive capacitive acoustically sensitive surface acoustic wave SAW or photo sensitive infrared . The effect of such overlays allows a display to be used as an input device removing the keyboard and or the mouse as the primary input device for interacting with the display s content. Such displays can be attached to computers or as terminals to networks. There are a number of types of touch screen technologies such as optical imaging resistive surface acoustical wave capacitive infrared dispersive signal piezoelectric and strain gauge technologies. Touch screens have become familiar in retail settings on point of sale systems on ATMs on mobile handsets on kiosks on game consoles and on PDAs where a stylus is sometimes used to manipulate the graphical user interface GUI and to enter data. A user can touch a touch screen or a touch sensor pad to manipulate data. For example a user can apply a single touch by using a finger to press the surface of a touch screen to select an item from a menu.

The following description sets forth numerous specific details such as examples of specific systems components methods and so forth in order to provide a good understanding of several embodiments of the present invention. It will be apparent to one skilled in the art however that at least some embodiments of the present invention may be practiced without these specific details. In other instances well known components or methods are not described in detail or are presented in a simple block diagram format in order to avoid unnecessarily obscuring the present invention. Thus the specific details set forth are merely exemplary. Particular implementations may vary from these exemplary details and still be contemplated to be within the spirit and scope of the present invention.

One embodiment of a multi touch gesture trackpad or other device including a touch sensing surface operates by performing self capacitance measurements on each of the rows and columns in an array of touch sensing elements including row elements and column elements at the touch sensing surface. These measurements can be represented as a histogram of measured values for the row elements and a histogram of measured values for the column elements. For detecting a single contact at the touch sensing surface the peak of each histogram indicates the row and column location of the contact.

In one embodiment when multiple touches are applied to such a touch sensing surface the row and column histograms may have two or more peaks such that the system cannot distinguish the actual locations of the contacts at the touch sensing surface based on the histograms alone. For example two touches at a touch sensing surface that are not aligned in either the X or Y directions may result in two peaks for each of the row and column histograms indicating four possible contact locations. To determine which of the possible touch locations is a location of an actual contact the system may perform a disambiguation process.

The touch sensing system may perform a resolve scan as part of a disambiguation process. In one embodiment the resolve scan may include measurements of sensor elements corresponding to the histogram peaks. For example two touches at the touch sensing surface may result in four histogram peaks two row peaks and two column peaks and four possible touch locations. These four possible contact locations can be disambiguated to determine the locations of the original two actual contacts by performing a measurement of the sensor elements intersecting at least one of the possible contact locations to determine whether an actual contact is present at the measured possible contact location.

In cases where more than two actual contacts are applied to the touch sensing surface the number of possible contact locations also increases. For example three actual contacts may result in up to three peaks for each of the row and column histograms which correspond to nine possible contact locations. A resolve scan may be performed to determine whether an actual contact is present at each of these possible contact locations. In one embodiment deducing the locations of all the actual contacts does not require scanning all of the possible contact locations and may be accomplished with a resolve scan that includes only some of the possible contact locations.

In an alternative embodiment the resolve scan may include two or more measurements of a sensor element corresponding to one of the histogram peaks. The two measurements may be compared to determine whether the location of an actual contact is closer to a first end of the sensor element or a second end of the sensor element. For example where two possible contact locations are present at a sensor element the resolve scan may identify which of the two possible contacts is an actual contact by determining that the actual contact is closer to one end of the sensor element or another.

In one embodiment the sensor array includes sensor elements N where N is a positive integer that are disposed as a two dimensional matrix also referred to as an XY matrix . The sensor array is coupled to pins N of the processing device via an analog bus transporting multiple signals. In this embodiment each sensor element N is represented as a capacitor. The capacitance of each sensor in the sensor array is measured by a capacitance sensor in the processing device .

In one embodiment the capacitance sensor may include a relaxation oscillator or other means to convert a capacitance into a measured value. The capacitance sensor may also include a counter or timer to measure the oscillator output. The capacitance sensor may further include software components to convert the count value e.g. capacitance value into a sensor element detection decision also referred to as switch detection decision or relative magnitude. It should be noted that there are various known methods for measuring capacitance such as current versus voltage phase shift measurement resistor capacitor charge timing capacitive bridge divider charge transfer successive approximation sigma delta modulators charge accumulation circuits field effect mutual capacitance frequency shift or other capacitance measurement algorithms. It should be noted however instead of evaluating the raw counts relative to a threshold the capacitance sensor may be evaluating other measurements to determine the user interaction. For example in the capacitance sensor having a sigma delta modulator the capacitance sensor is evaluating the ratio of pulse widths of the output instead of the raw counts being over a certain threshold.

In one embodiment the processing device further includes processing logic . Operations of the processing logic may be implemented in firmware alternatively it may be implemented in hardware or software. The processing logic may receive signals from the capacitance sensor and determine the state of the sensor array such as whether an object e.g. a finger is detected on or in proximity to the sensor array e.g. determining the presence of the object where the object is detected on the sensor array tracking the motion of the object or other information related to an object detected at the touch sensor.

In another embodiment instead of performing the operations of the processing logic in the processing device the processing device may send the raw data or partially processed data to the host . The host as illustrated in may include decision logic that performs some or all of the operations of the processing logic . Operations of the decision logic may be implemented in firmware hardware software or a combination thereof. The host may include a high level Application Programming Interface API in applications that perform routines on the received data such as compensating for sensitivity differences other compensation algorithms baseline update routines start up and or initialization routines interpolation operations or scaling operations. The operations described with respect to the processing logic may be implemented in the decision logic the applications or in other hardware software and or firmware external to the processing device . In some other embodiments the processing device is the host .

In another embodiment the processing device may also include a non sensing actions block . This block may be used to process and or receive transmit data to and from the host . For example additional components may be implemented to operate with the processing device along with the sensor array e.g. keyboard keypad mouse trackball LEDs displays or other peripheral devices .

The processing device may reside on a common carrier substrate such as for example an integrated circuit IC die substrate or a multi chip module substrate. Alternatively the components of the processing device may be one or more separate integrated circuits and or discrete components. In one embodiment the processing device may be the Programmable System on a Chip PSoC processing device developed by Cypress Semiconductor Corporation San Jose Calif. Alternatively the processing device may be one or more other processing devices known by those of ordinary skill in the art such as a microprocessor or central processing unit a controller special purpose processor digital signal processor DSP an application specific integrated circuit ASIC a field programmable gate array FPGA or other programmable device. In an alternative embodiment for example the processing device may be a network processor having multiple processors including a core unit and multiple micro engines. Additionally the processing device may include any combination of general purpose processing device s and special purpose processing device s .

In one embodiment the electronic system is implemented in a device that includes the touch sensing surface as the user interface such as handheld electronics portable telephones cellular telephones notebook computers personal computers personal data assistants PDAs kiosks keyboards televisions remote controls monitors handheld multi media devices handheld video players gaming devices control panels of a household or industrial appliances or other computer peripheral or input devices. Alternatively the electronic system may be used in other types of devices. It should be noted that the components of electronic system may include all the components described above. Alternatively electronic system may include only some of the components described above or include additional components not listed herein.

Capacitance sensor includes multiplexer control multiplexers and clock generator signal generator demodulation circuit and analog to digital converter ADC . ADC is further coupled with touch coordinate converter . Touch coordinate converter outputs a signal to the processing logic .

The transmit and receive electrodes in the electrode matrix may be arranged so that each of the transmit electrodes overlap and cross each of the receive electrodes such as to form an intersection while maintaining galvanic isolation from each other. Thus each transmit electrode may be capacitively coupled with each of the receive electrodes. For example transmit electrode is capacitively coupled with receive electrode at the point where transmit electrode and receive electrode intersect.

Clock generator supplies a clock signal to signal generator which produces a TX signal to be supplied to the transmit electrodes of touch sensor . In one embodiment the signal generator includes a set of switches that operate according to the clock signal from clock generator . The switches may generate a TX signal by periodically connecting the output of signal generator to a first voltage and then to a second voltage wherein said first and second voltages are different.

The output of signal generator is connected with multiplexer which allows the TX signal to be applied to any of the M transmit electrodes of touch sensor . In one embodiment multiplexer control controls multiplexer so that the TX signal is applied to each transmit electrode in a controlled sequence. Multiplexer may also be used to ground float or connect an alternate signal to the other transmit electrodes to which the TX signal is not currently being applied.

Because of the capacitive coupling between the transmit and receive electrodes the TX signal applied to each transmit electrode induces a current within each of the receive electrodes. For instance when the TX signal is applied to transmit electrode through multiplexer the TX signal induces an RX signal on the receive electrodes in matrix . The RX signal on each of the receive electrodes can then be measured in sequence by using multiplexer to connect each of the N receive electrodes to demodulation circuit in sequence.

The capacitance associated with each intersection between a TX electrode and an RX electrode can be sensed by selecting every available combination of TX electrode and an RX electrode using multiplexers and . To improve performance multiplexer may also be segmented to allow more than one of the receive electrodes in matrix to be routed to additional demodulation circuits . In an optimized configuration wherein there is a 1 to 1 correspondence of instances of demodulation circuit with receive electrodes multiplexer may not be present in the system.

When an object such as a finger approaches the electrode matrix the object causes a decrease in the mutual capacitance between only some of the electrodes. For example if a finger is placed near the intersection of transmit electrode and receive electrode the presence of the finger will decrease the mutual capacitance between the two electrodes and . Thus the location of the finger on the touchpad can be determined by identifying the one or more receive electrodes having a decreased mutual capacitance in addition to identifying the transmit electrode to which the TX signal was applied at the time the decreased mutual capacitance was measured on the one or more receive electrodes.

By determining the mutual capacitances associated with each intersection of electrodes in the matrix the locations of one or more contacts may be determined. The determination may be sequential in parallel or may occur more frequently at commonly used electrodes.

In alternative embodiments other methods for detecting the presence of a finger or conductive object may be used where the finger or conductive object causes an increase in capacitance at one or more electrodes which may be arranged in a grid or other pattern. For example a finger placed near an electrode of a capacitive sensor may introduce an additional capacitance to ground that increases the total capacitance between the electrode and ground. The location of the finger can be determined from the locations of one or more electrodes at which an increased capacitance is detected.

The induced current waveform is rectified by demodulation circuit . The rectified current output by demodulation circuit can then be filtered and converted to a digital code by ADC .

The digital code is converted to touch coordinates indicating a position of an input on touch sensor array by touch coordinate converter . The touch coordinates are transmitted as an input signal to the processing logic . In one embodiment the input signal is received at an input to the processing logic . In one embodiment the input may be configured to receive capacitance measurements indicating a plurality of row coordinates and a plurality of column coordinates. Alternatively the input may be configured to receive row coordinates and column coordinates.

In one embodiment the sensor array can be configured to detect multiple touches. One technique for multi touch detection uses a two axis implementation one axis to support rows and another axis to support columns. Additional axes such as a diagonal axis implemented on the surface using additional layers can allow resolution of additional touches.

While illustrates a capacitance sensing circuit that measures mutual capacitance between sensor elements various circuit implementations for performing capacitance measurement may measure self capacitances of each electrode. illustrates a self capacitance circuit that uses a charge accumulation technique to measure the capacitance Cx . In an embodiment the capacitance Cx may represent the self capacitance of a sensor element similar to the sensor elements in the electrode matrix of sensor array .

A charge accumulation technique operates in the following manner initially the integration capacitor is reset by turning on the reset switch for some time. After reset the switches and start operation in two non overlapping phases. During a first duration of the switching cycle switch is closed while switch is open so that Cx is charged. During a second duration of the switching cycle switch is closed while switch is open so that the accumulated charge at Cx is transferred to C. The voltage on C starts increasing. The sensing capacitance is determined by the number of switching cycles used to cause the voltage of the integrator capacitor C to reach a threshold value. The voltage at C may be accessible from node which may be connected to a comparator or other measurement circuit

With such a charge accumulation technique the voltage on the integration capacitance rises exponentially with respect to time which can be measured by the cycle count . This relationship can be linearized for measurement methods where capacitance is calculated as a function of integration capacitor voltage after a predefined number of cycles. In one embodiment a self capacitance may be measured during a scan for each of a number of sensor elements in a sensor array having a similar layout as sensor array . Since the proximity or contact of an object such as a finger changes the self capacitance of a sensor element the self capacitances of the sensor elements may indicate the location of a contact and may further be used to calculate coordinates for the contact location.

One embodiment of an electronic touch sensing system such as electronic system may be connected to a sensor array such as sensor array illustrated in . The sensor array includes horizontal sensing elements and vertical sensing elements .

In one embodiment the touch sensing system scans the sensor array by taking sequential measurements of each sensing element in sequence. For example the scan may measure the capacitance at each of the sensing elements in sequential order and then measure the capacitance at each of the sensing elements in sequential order. Alternatively the scan may measure two or more of the sensing elements in parallel. In one embodiment the result of such a scan may be a histogram for the horizontal X and a histogram for the vertical Y axis.

The X axis histogram represents the capacitances measured at the vertical sensor elements . Since contacts at the touch sensing surface affect these measured capacitances the locations of such contacts along the X axis may be represented as peaks in the X axis histogram. For example if two contacts and are applied to the touch sensing surface the locations along the X axis of contact and contact are represented as peaks and respectively in histogram .

Similarly the Y axis histogram represents the capacitances measured at the horizontal sensor elements . Thus the locations of contacts and along the Y axis are represented as peaks and respectively in the Y axis histogram .

In one embodiment when only a single contact is applied to the touch sensing surface the system may determine the location of the single contact based on the X and Y histograms since the peak of each histogram indicates the row and column locations of the finger contact. However when multiple contacts are present the histograms may indicate a number of possible contact locations. For example when the actual contacts and are applied to the touch sensing surface the resulting peaks and indicate additional possible touch locations and .

For example whether the two contacts are at locations and or whether the two contacts are at locations and identical histograms may result. When additional actual contacts are added the number of possible contact locations also increases. For N actual contacts the resulting histograms may indicate up to Npossible contact locations.

In order to determine that the contacts and are the actual contact locations from among the possible contact locations and the system may perform an additional resolve scan. In one embodiment the system may perform a resolve scan of the horizontal or vertical sensor elements corresponding to one or more of the peaks such as peaks or detected during the initial scan.

In one embodiment of an electronic system that performs a resolve scan for detecting multiple touches the system begins by performing a standard scan of all row and column sensing elements sequentially or in parallel using a self capacitance measurement technique. The system performs a resolve scan measuring mutual capacitances when multiple possible contact locations are detected. In one embodiment if multiple peaks such as peaks and are detected in the X axis histogram and multiple peaks such as peaks and are detected in the Y axis histogram the system performs the resolve scan.

In one embodiment performing the resolve scan includes scanning a first sensing element corresponding to one of the coordinate locations indicated by a histogram peak along with a second and a third sensing element corresponding to two other coordinate locations indicated by a histogram peak. In one embodiment the coordinate locations of the second and third sensing elements are indicated by a different histogram than the coordinate location of the first sensing. For example with reference to the resolve scan may measure sensor element in conjunction with sensor element and measure sensor element with sensor element . In this case peaks and indicate the second and third sensor elements and respectively while the first sensor element is represented by peak .

The system thus conducts a first scan of sensor elements and and a second scan of sensor elements and . In one embodiment a count value measured from the first scan will be lower than a count value measured from the second scan because the actual contact is applied at sensor elements and while no contact is applied at the intersection of sensor elements and . Because the contact is applied near the intersection of elements and the mutual capacitance between these sensor elements and and thus the total capacitance is reduced. The system can then deduce that the actual contacts are located at locations and rather than at and .

In one embodiment this principle of operation may be applied to resolve the actual contact locations of three contacts with nine possible contact locations. For example the system may scan five row column pairs of sensor elements to resolve the three contact locations.

In one embodiment the count values measured from each of the resolve scans may be compared to each other to determine the location of the actual contact. Alternatively the resolve scan count values may be compared with the count values measured from the standard scan of all the sensor elements. The system can then determine the actual contact locations based on this comparison.

In one embodiment the system may perform a resolve scan including more or all of the possible contact locations for higher confidence in the disambiguation. In one embodiment the resolve scan may have different parameters than the standard scan of all the sensor elements. For example the resolve scan may be performed using a different scan time or waveform than the standard scan.

In one embodiment the sensor array may be a capacitive sensor having enhanced sensitivity to changes in mutual capacitance between sensor elements rather than to changes in self capacitance of each sensor element. In one embodiment more accurate resolve scan measurements may be obtained by calculating or measuring any capacitance compensation features such as IDAC settings and compensating for these capacitance compensation features.

In one embodiment for purposes of a resolve scan a histogram peak may indicate two or more sensor elements to be scanned for each axis. For example peak in the Y axis histogram may indicate sensor elements and to be scanned with sensor element indicated by peak . Thus several adjacent row or column sensor elements can be grouped together for the resolve scan since an object in contact with the touch sensing surface such as a finger is likely to couple into more than one of the sensor elements when the contact is applied to the surface.

One embodiment of an electronic system for detecting multiple contacts at a touch sensing surface identifies actual contact locations from the possible contact locations using a difference function. The difference function is used to determine which of a number of possible sets of contact locations represents the set of actual contact locations.

In one embodiment the magnitude of the difference function is a fraction of the magnitude of an ordinary self capacitance measurement. Thus for a system that is configured to sense capacitances on the order of C C multiple measurements of the difference function can be accumulated to generate a signal that is more readily detectable by the system. For example in the case where C 0 the system may acquire m 2 measurements of the difference function.

In one embodiment the standard scan of the touch sensing array is performed in self capacitance mode where the self capacitances of each sensor element are measured. For example for a standard scan in self capacitance mode a single ended measurement is performed on a single row or column while all other rows and columns are connected to ground.

In one embodiment the resolve scan differs from the standard scan in that during the resolve scan an opposing matrix element is allowed to float during the self capacitance measurement. For example a row is allowed to float during a column measurement or a column is allowed to float during a row measurement. In one embodiment the row and column sensor elements that are floated and measured correspond to histogram peaks such as peaks and which further correspond to the possible touch locations such as locations and . These are the sensor elements that are most affected by the actual contacts at the touch sensing surface.

One embodiment of an electronic system such as system may include a touch sensor array having n rows and n columns where all mutual capacitances Care equal and all parasitic row capacitances Care equal. Such an electronic system may include processing logic such as processing logic that is configured to detect multiple contacts at a touch sensing surface.

For example a user may place two fingers of the same hand to the touch sensing surface and the system may detect the locations of the two fingers. With reference to the fingers may contact the sensing surface at locations and resulting in peaks and in the X axis histogram and peaks and in the Y axis histogram .

In one embodiment prior to performing the disambiguation process including the resolve scan the system may assess the data from the histograms to eliminate special cases where the resolve scan is not needed. For example if two contacts exist that are aligned in the X or Y directions the resolve scan is not performed. In this case the two contacts result in only two possible contact locations because one of the histograms detects only one peak for both contacts. In response to detecting this case the system determines both of the possible contact locations to be actual contact locations.

In one embodiment the system may also halt the disambiguation process upon detecting an error. For example for two contacts if the number of detected possible contact locations does not equal four or the four possible contact locations do not form a rectangle the disambiguation process does not proceed and the system may return an error code. The system may similarly return error codes when more actual contacts do not result in the appropriate number of possible contact locations or if the detected locations of these possible contact locations are not properly aligned.

In one embodiment the resolve scan of the disambiguation process determines a value of the difference function for a pair of the possible contact locations. In one embodiment the pair of possible contact locations is aligned in either the X or Y directions. For example the resolve scan may determine a difference function value using the possible contact locations and which are aligned in the direction of the Y axis.

In one embodiment the processing logic performing the resolve scan may identify the sensor elements intersecting nearest a first of the possible contact locations. For example the processing logic may identify sensor elements and as forming the intersection nearest the possible contact location . The processing logic when performing the resolve scan may float one of these sensing elements while measuring a capacitance at the other of the sensing elements. For example sensor element may be floated while a capacitance at sensor element is measured. The resulting equivalent circuit is illustrated in .

In Cand Crepresent the parasitic capacitances for the sensor elements at column X and row Y respectively. For example Cand Cin represent the parasitic capacitances of the sensor element at row and sensor element at row . Cdenotes a mutual capacitance between a column sensor element and a row sensor element. In one embodiment all of the mutual capacitances Care assumed to be equal.

The combined mutual capacitances of the row sensor elements are represented in as a single capacitance having the value n 2 C while the combined mutual capacitances of the column sensor elements is represented as a single capacitance m 2 C.

The magnitude of the mutual capacitance Cbetween a given row sensor element and column sensor element is changed by the proximity of a finger or other conductive object near the intersection of the row sensor element and the column sensor element which may be detected as a contact. In the following equations C denotes the mutual capacitance resulting from such a contact. Note that in one embodiment the standard scanning measurement is designed to detect the value C C .

The Ccapacitances are provided a conductive path through each finger and by extension through the hand. Each Ccapacitance is assumed to be unique as its value is a function of both finger diameter and position. In one embodiment the Cvalues are on the order of approximately 100 fF while the capacitance Cbetween the human body and ground is approximately 140 pF.

As compared to the circuit of the mutual capacitance of between sensor elements and is C rather than Cbecause a finger contact is present at location . The mutual capacitance between sensor elements and is also affected by a finger but it is not shown as both of its associated sensor elements are shorted to ground.

In addition to measuring the capacitance at sensor element while floating the sensor element the system also measures the capacitance of sensor element while floating sensor element . illustrates an equivalent circuit for this measurement.

According to the circuit illustrated in the capacitance is measured at sensor element while sensor element is allowed to float and the remaining row and column sensor elements are grounded. The measurement proceeds in similar fashion as the measurement of the capacitance of sensor element while sensor element is allowed to float as described with reference to .

The two measurements and two possible sets of contact locations result in four possible circuits each having the topology of the equivalent circuit illustrated in .

In Table 1 Test 1 refers to the measurement of sensor element while sensor element is allowed to float. Test 2 refers to the measurement of sensor element while sensor element is allowed to float.

The equivalent capacitance of the circuit can be found by substituting capacitances with impedances Z 1 C and finding the equivalent impedance. The delta topology formed by capacitances C4 C5 and C6 can be simplified using the delta to star transformation. The simplified equivalent circuit is illustrated in .

Starting with the equation for C the following general relationships can be used to simplify the equation for the measurement C C C C C C C C C C C Equations 5 

The value of the difference function is determined by subtracting the results for Test 1 float element while measuring element and Test 2 float element while measuring element . The difference function is expressed as Equation 7 below Diff C Test 1 C Test 2 Equation 7 

Assuming that the row capacitances Care equal and ignoring the CCterms for simplicity the difference function can be solved as follows for the case where the actual contacts are at locations and 

The difference function can be solved as follows for the alternate case where the actual contacts are at locations and 

Since C C and Diff 0 Diff the locations of the actual contacts can be inferred by finding the sign of the difference function. In one embodiment the difference function can be maximized by maximizing Cand minimizing C. If Cis 0 then the difference function can be represented as 

In one embodiment the difference function may be maximized by accumulating the difference function across multiple samples to reduce noise and create a higher effective signal to noise ratio SNR . Empirically C is approximately equal to 0.9 C so the difference function can be approximated as follows 

In one embodiment the difference function may be maximized by performing Test 1 and Test 2 on the longest element in the array. In this case the system indirectly drives the sensor element having the least amount of mutual capacitance.

In one embodiment the resolve scan may be performed as differential self capacitance measurements. In this case the magnitude of the difference function is the same as for the single ended mode. However in one embodiment the differential measurement may be performed in half the time and may provide better power supply noise immunity.

The differential form of the difference function measurement is performed by measuring a pair of column sensor elements such as and simultaneously and measuring the output currents differentially.

The values of C C and Care related to the capacitances of as expressed in Equations 12 and Table 2 below 

In one embodiment both of the column sensor elements and are driven with the same signal during the differential measurement such that Ccan be ignored.

With reference to the difference function assuming actual contacts at locations and can be solved as follows in Equations 13 

The difference function assuming actual contacts at locations and can be solved as follows in Equations 14 

As with the case of the single ended measurement Diff 0 Diff and set of actual contact locations can be inferred by finding the sign of the difference function. In one embodiment the magnitude of the difference function is the same whether the differential or single ended mode is used. Thus in one embodiment multiple samples may be used to accumulate a difference function signal having a magnitude that is the same order as an ordinary self capacitance measurement. In one embodiment where C 0 m 2 measurements may be accumulated.

As shown in the Diff equation the greater the row parasitic capacitance C the less the resulting value. In one embodiment a greater number of repeated measurements is taken to compensate for a higher parasitic row capacitance.

In one embodiment the system performs the resolve scan on sensor elements other than the sensor elements most affected by the actual contacts at the touch sensing surface. For example the resolve scan may include taking measurements at row or column sensor elements adjacent to the sensor elements most influenced by the presence of the contacts.

In one embodiment the parasitic capacitances Cand Cmay not be exactly equal resulting in a more complex difference function than described above. The inequality of the parasitic capacitances may result in a shift or offset in the difference function which may be compensated using calibration.

In an alternative embodiment only one of the set of row sensor elements or column sensor elements has connections at both ends. For example the row sensor elements may have connections at both ends while the column sensor elements are connected at one end. Alternatively the column sensor elements may have connections at both ends while the column sensor elements are connected at one end.

In one embodiment the sensor array is manufactured from an Indium Tin Oxide ITO material. In one embodiment only some of the sensor elements in the sensor array have dual connections defining a limited area in which multiple touch resolution is available.

In one embodiment the response time represented by a time constant t and charging amplitude of the RC network is affected by the position of the actual contacts on the sensor element.

For example assuming that all resistances and all capacitances are equal such that R R . . . R R C C . . . C C Equations 15 

When an actual contact is present at position the difference t between a time constant tmeasurable from connection and a time constant tmeasurable from connection can be calculated according to Equations 16 as follows 

When an actual contact is present at position the time constant difference at can be calculated according to Equations 17 as follows 

This difference in t as shown in Equations 1.6 and Equations 17 demonstrates that the position of the contact along the sensor element can be determined by measuring the time constant from both sides of the RC network of circuit . Thus in one embodiment disambiguation may be performed using a resolve scan that measures the time constant from both ends of a sensor element affected by a contact. In one embodiment two or more possible contact locations are present at the scanned sensor element and the resolve scan identifies which of the possible contact locations is an actual contact location based on the contact position indicated by the time constants.

In one embodiment the resolve scan is performed by selecting a sensor element at which two or more possible contact locations are present. In one embodiment the system may select a sensor element that corresponds to a histogram peak of either the row histogram or the column histogram. The system may then scan the sensor element from both ends to determine the time constant difference. Based on the measured time constant difference the system can determine which of the possible contact locations is an actual contact location.

For example after performing a standard sequential scan of all the sensor elements the system may detect Y axis histogram peaks at and X axis histogram peaks at and resulting from contacts at locations and . The system performs a resolve scan to determine the locations of the actual contacts from the possible contact locations and .

If the system selects row sensor element on which to perform the resolve scan the system may measure the time constant from the left end of the element by connecting the right end to a high impedance then sensing a switched capacitor current at the left end of the element . Similarly the system may measure the time constant from the right end of the element by connecting the left end to a high impedance then sensing a switched capacitor current at the right end of the element . The left and right ends of the sensor element may correspond to connection and connection respectively of the equivalent circuit .

In one embodiment if the actual contact is closer to the sensing end the detected value of At is larger. Thus by comparing the At values measured from the left and right ends of element the system can determine that the actual contact is closer to the right end of sensor element . From this the system can further deduce that the other actual contact is at location since histogram peaks are also detected at sensor elements and .

In one embodiment the resolve scan process described above may be used when detecting a contact on a sensor array having an internal short. illustrates a sensor array having a short that connects sensor elements and . Short may be caused for example by a manufacturing defect.

When a standard scan is performed on the sensor array the resulting X axis histogram includes a peak and the resulting Y axis histogram includes peaks and . The peak is detected because of the short and indicates that a contact has been applied to sensor element even though the actual contact locations is on sensor element . The possible contact locations indicated by the histograms and are locations and .

In this case even if the sensor elements and are not connected at both ends the left ends of elements and can be treated as two ends of a single sensor element so that the actual contact location can be identified. Each of the left ends of elements and may be scanned to measure the time constant difference t.

In one embodiment the detected value of t is larger if the actual contact is closer to the sensing end. Thus based on peak and a comparison of the t values measured from the left ends of elements and the system can determine that the actual contact is closer to the left end of sensor element at location .

At block of process the system performs a standard scan to detect a plurality of possible touch locations. In one embodiment the plurality of possible contact locations may include row and column coordinates. For example with reference to the possible contact locations may be designated by coordinates represented by peaks and in the X axis histogram and the peaks and in the Y axis histogram. From block the process continues at block .

At block the system determines whether all the possible contacts are aligned. In one embodiment the possible contacts are aligned if either the X or Y axis histograms has one peak while the other histogram has more than one peak. If all the contacts are aligned the process continues at block . If not all of the contacts are aligned the process continues at block .

At block the system identifies at least a first sensor element corresponding to one of the row or column coordinates detected at block . In one embodiment the sensor element may be the sensor element that most influences a histogram peak. For example with reference to the system may identify row sensor element as corresponding to peak or may identify column sensor element corresponding to peak . From block the process continues at block .

At block the system responds to detecting the plurality of coordinates by performing a resolve scan including at least the first sensor element at the touch sensing surface. From block the process continues at block .

At block the system identifies at least one of the possible contact locations as an actual contact location. This identification is based on the standard scan performed at block and the resolve scan performed at block . In one embodiment the system may use information from the resolve scan to first identify one of the possible contacts as an actual contact then deduce the remainder of the actual contacts based on the standard scan coordinates. For example with reference to if the system determines that location is an actual contact the system can then deduce that the other actual contact is at location because of the presence of peaks and . In one embodiment the system may also eliminate the possibility of an actual contact at a particular location. For example the system may determine based on the resolve scan that an actual contact is not present at location or . This determination may also be used to eliminate the possibility that peaks and are caused by actual contacts at locations and . From block the process continues back to block according to one embodiment.

The process may thus repeat execution of blocks to continuously detect and resolve multiple touches over time.

From block of process the resolve scan process begins at block where the system performs a first measurement of a first sensor element in conjunction with a second sensor element. In one embodiment the system may measure a capacitance at the first and second sensor elements which may be represented as a count value. From block the process continues at block .

At block the system performs a second measurement of the first sensor element in conjunction with a third sensor element. In one embodiment the system may measure a capacitance at the first and third sensor elements which may be represented as a count value. From block the process continues at block .

At block the system determines whether a sufficient number of measurements of the sensor elements have been accumulated. In one embodiment if the resolve scan measurements are much smaller in magnitude than the standard scan signals the resolve scan measurements may be accumulated over several samples to generate a larger signal within a detection range of the system. If at block a sufficient number of measurements have been accumulated the process continues at block of process . If at block a sufficient number of measurements have not been accumulated the process continues back to block .

In one embodiment the resolve scan process thus repeats blocks to accumulate measurements until the magnitude of the resulting accumulated measurement is on the same order as a capacitance measurement of a standard scan.

From block of process the resolve scan process begins at block where the system performs a first scan of the first sensor element from block while floating a second sensor element corresponding to a second coordinate of the coordinates detected at block . For example with reference to the system may sense a capacitance of a first sensor element while floating a second sensor element . The first sensor element and the second sensor element correspond to peak and peak of respectively. In one embodiment the first sensor element intersects the second sensor element. For example sensor element intersects sensor element at location . From block the process continues at block .

At block the system performs a second scan of the first sensor element from block while floating a third sensor element corresponding to a third coordinate of the coordinates detected at block . For example with reference to the system may measure a capacitance at the first sensor element while floating a third sensor element . The first sensor element and the third sensor element correspond to peaks and respectively of . In one embodiment the third sensor element intersects the first sensor element as sensor element intersects sensor element at location in . In one embodiment the operations of blocks and may be combined into a differential measurement as described above with reference to . From block the process continues at block .

At block the system determines a difference between a measurement obtained from the first scan at block and a measurement obtained from the second scan at block . In one embodiment the difference may be determined using a difference function such as the difference function of Equation 7. From block the process continues at block of process . In one embodiment the difference determined at block is used at block to identify the actual contact location.

From block of process the resolve scan process begins at block . At block the system detects a first time constant at a first end of the first sensor element from block while a second end of the first sensor element is connected to a high impedance. For example with reference to the system may measure the first time constant at the left end of sensor element while the right end of sensor element is connected to a high impedance. From block the process continues at block .

At block the system detects a second time constant at the second end of the first sensor element while the first end of the first sensor element is connected to a high impedance. For example with reference to the system may detect the second capacitance at the right end of sensor element while the left end of sensor element is connected to a high impedance. From block the process continues at block .

At block the system determines a first distance between the actual contact location and a first end of the first sensor element and a second distance between the actual contact location and a second end of the first sensor element. In one embodiment the first and second distances may correspond to the time constant values determined at blocks and . From block the process continues at block .

At block the system compares the first distance and the second distance from block . From block the process continues to block of process . In one embodiment the result of the comparison performed at block is used at block to identify the actual contact location.

Various embodiments may thus perform the multiple touch detection process to detect the actual locations of contacts at a touch sensing surface. During the multiple touch detection process the various embodiments may perform a resolve scan similar to any of resolve scan processes or .

Embodiments of the present invention described herein include various operations. These operations may be performed by hardware components software firmware or a combination thereof. As used herein the terms coupled to or coupled with may mean coupled directly or indirectly through one or more intervening components. Any of the signals provided over various buses described herein may be time multiplexed with other signals and provided over one or more common buses. Additionally the interconnection between circuit components or blocks may be shown as buses or as single signal lines. Each of the buses may alternatively be one or more single signal lines and each of the single signal lines may alternatively be buses.

Certain embodiments may be implemented as a computer program product that may include instructions stored on a computer readable medium. These instructions may be used to program a general purpose or special purpose processor to perform the described operations. A computer readable medium includes any mechanism for storing or transmitting information in a form e.g. software processing application readable by a machine e.g. a computer . The computer readable storage medium may include but is not limited to magnetic storage medium e.g. floppy diskette optical storage medium e.g. CD ROM magneto optical storage medium read only memory ROM random access memory RAM erasable programmable memory e.g. EPROM and EEPROM flash memory or another type of medium suitable for storing electronic instructions. The computer readable transmission medium includes but is not limited to electrical optical acoustical or other form of propagated signal e.g. carrier waves infrared signals digital signals or the like or another type of medium suitable for transmitting electronic instructions.

Additionally some embodiments may be practiced in distributed computing environments where the computer readable medium is stored on and or executed by more than one computer system. In addition the information transferred between computer systems may either be pulled or pushed across the transmission medium connecting the computer systems.

Although the operations of the method s herein are shown and described in a particular order the order of the operations of each method may be altered so that certain operations may be performed in an inverse order or so that certain operation may be performed at least in part concurrently with other operations. In another embodiment instructions or sub operations of distinct operations may be in an intermittent and or alternating manner.

In the foregoing specification the invention has been described with reference to specific exemplary embodiments thereof. It will however be evident that various modifications and changes may be made thereto without departing from the broader spirit and scope of the invention as set forth in the appended claims. The specification and drawings are accordingly to be regarded in an illustrative sense rather than a restrictive sense.

