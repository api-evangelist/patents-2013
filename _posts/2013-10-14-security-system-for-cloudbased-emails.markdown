---

title: Security system for cloud-based emails
abstract: A cloud-based email system is accessed by way of a cloud access security system. The cloud access security system allows for encryption of incoming emails and outgoing emails stored in the cloud-based email system. The cloud access security system includes a protocol proxy for providing an interface between a client computer of a user and the cloud-based email system, an encryption module for indexing and encrypting emails, and an event listener for receiving email event notifications from the cloud-based email system and replacing emails with corresponding encrypted emails. The cloud access security system may receive encryption keys from a key manager hosted by a key server, which may be part of the cloud access security system or hosted on premise in the same private computer network as client computers employed by users.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09275242&OS=09275242&RS=09275242
owner: Trend Micro Incorporated
number: 09275242
owner_city: Tokyo
owner_country: JP
publication_date: 20131014
---
The present invention relates generally to computer security and more particularly but not exclusively to systems and methods for securing cloud based emails.

Cloud based email systems allow email users to send and receive emails without having to host and maintain their own email server. Examples of cloud based email systems include the Microsoft Office 365 email server and the Google Mail email server. A cloud based email system is in the cloud in that it is employed over a computer network such as the Internet. More particularly a user may communicate with the cloud based email system to send and receive emails over the Internet.

Although cloud based email systems provide numerous advantages over on premise self maintained email servers cloud based email systems are provided by a third party and thus raise security and privacy concerns. In particular potential users are concerned that emails stored in a cloud based email system are accessible to the cloud based email system provider and may be readily provided to other parties such as in response to a subpoena for example.

In one embodiment a cloud based email system is accessed by way of a cloud access security system. The cloud access security system allows for encryption of incoming emails and outgoing emails stored in the cloud based email system. The cloud access security system may include a protocol proxy for providing an interface between a client computer of a user and the cloud based email system an encryption module for indexing and encrypting emails and an event listener for receiving email event notifications from the cloud based email system and replacing emails with corresponding encrypted emails. The cloud access security system may receive encryption keys from a key manager hosted by a key server which may be part of the cloud access security system or hosted on premise in the same private computer network as client computers employed by users.

These and other features of the present invention will be readily apparent to persons of ordinary skill in the art upon reading the entirety of this disclosure which includes the accompanying drawings and claims.

In the present disclosure numerous specific details are provided such as examples of apparatus components and methods to provide a thorough understanding of embodiments of the invention. Persons of ordinary skill in the art will recognize however that the invention can be practiced without one or more of the specific details. In other instances well known details are not shown or described to avoid obscuring aspects of the invention.

Referring now to there is shown a schematic diagram of a computer that may be employed with embodiments of the present invention. The computer may be employed as a client computer or one of the computers of a cloud access security system for example. The computer may have fewer or more components to meet the needs of a particular application. The computer may include one or more processors . The computer may have one or more buses coupling its various components. The computer may include one or more user input devices e.g. keyboard mouse one or more data storage devices e.g. hard drive optical disk Universal Serial Bus memory a display monitor e.g. liquid crystal display flat panel monitor a computer network interface e.g. network adapter modem and a main memory e.g. random access memory . The computer network interface may be coupled to a computer network which in this example includes the Internet.

The computer is a particular machine as programmed with software modules . The software modules comprise computer readable program code stored non transitory in the main memory for execution by the processor . As an example the software modules may comprise protocol proxies a data indexer a cryptography component and an encryptor when the computer is employed as part of a cloud access security system.

The computer may be configured to perform its functions by executing the software modules . The software modules may be loaded from the data storage device to the main memory . An article of manufacture may be embodied as computer readable storage medium including instructions that when executed by a computer causes the computer to be operable to perform the functions of the software modules .

A client computer may comprise a computer employed by a user to access the cloud based email system . The client computer may comprise a desktop computer a laptop computer a smartphone or a mobile computing device e.g. a tablet for example. In the example of the client computers are part of a private computer network such as a computer network maintained and operated by an enterprise. In the example of the private computer network does not have an on premises email server. Instead the private computer network provides email services using the cloud based email system which is owned and operated by a third party i.e. not associated with the private computer network . In other embodiments the client computers are part of a public computer network.

The cloud access security system may comprise one or more computers that secure emails stored in the cloud based email system . In one embodiment the cloud access security system indexes unencrypted emails in an index replaces unencrypted emails stored in the cloud based email system with encrypted emails and provides the client computers an interface for accessing the cloud based email system . In one embodiment the cloud access security system receives all email communications between the cloud based email system and the client computers see arrow . The cloud access security system the cloud based email system and the client computers may communicate over the Internet.

In the example of the cloud access security system forwards and receives emails to and from client computers of the private computer network see arrow . In one embodiment the emails transferred between the client computers and the cloud access security system and emails transferred between the cloud based email system and other computers are unencrypted. However as will be more apparent below the cloud access security system simply provides another layer of encryption that is transparent to the cloud based email system the client computers and the other computers when the emails are encrypted by some other system. In this disclosure an email has not been encrypted by the cloud access security system unless specifically noted or referred to as an encrypted email e.g. encrypted outgoing email encrypted incoming email .

The cloud access security system may detect reception of an incoming email in the cloud based email system with the incoming email being sent by another computer e.g. an email server computer to a user of a client computer . The cloud access security system may retrieve the incoming email from the cloud based email system e.g. a copy in the inbox of the user s mailbox encrypt the incoming email to generate an encrypted incoming email and replace the incoming email with its corresponding encrypted incoming email in the cloud based email system . When the client computer requests to receive the incoming email the cloud access security system may retrieve the corresponding encrypted incoming email from the cloud based email system decrypt the encrypted incoming email back to the incoming email and provide the incoming email to the client computer .

The cloud access security system may receive a search request for particular emails from the client computer identify encrypted emails stored in the cloud based email system and responsive to the search request retrieve the identified encrypted emails from the cloud based email system decrypt the identified encrypted emails to decrypted emails and provide the decrypted emails to the client computer as search results responsive to the search request.

The cloud access security system may receive an outgoing email to be sent by the client computer to the other computer forward the outgoing email to the cloud based email system for forwarding to the other computer retrieve the outgoing email stored in the cloud based email system e.g. a copy in the sent folder of the user s mailbox encrypt the outgoing email to generate a corresponding encrypted outgoing email and replace the outgoing email stored in the cloud based email system with its corresponding encrypted outgoing email.

In the example of the cloud access security system communicates with the cloud based email system see arrow to forward and receive emails to receive email event notifications and to replace unencrypted emails stored in the cloud based email system with encrypted emails.

In one embodiment a protocol proxy comprises computer readable program code for monitoring and processing email communications between a client computer and the cloud based email system . In one embodiment all email communications between a client computer and the cloud based email system pass through and are thereby received by a protocol proxy . The particular protocol proxy that receives and processes email communications depend on the email communication protocol of the cloud based email system and the client computer . For example a protocol proxy may comprise a proxy for the Microsoft Outlook Web Access protocol the Microsoft Exchange ActiveSync protocol the Messaging Application Programming Interface MAPI protocol the Microsoft Exchange Web Services EWS protocol a protocol for accessing the Google Gmail email server etc. As a particular example a protocol proxy may comprise a proxy for the Microsoft Exchange ActiveSync protocol when the cloud based email system and the client computer communicates in accordance with the Microsoft Exchange ActiveSync protocol.

In one embodiment a protocol proxy processes email communications between the cloud based email system and the client computer to provide a seamless and transparent encryption service for emails stored in the cloud based email system . A protocol proxy receives email communications between the cloud based email system and the client computer and interprets the email communications in accordance with the email communication protocol employed. The protocol proxy may process the email communications to pass through outgoing emails i.e. emails sent by a user of the client computer to the cloud based email system for forwarding to recipients and to allow for decryption of encrypted emails stored in the cloud based email system and being accessed by the client computer such as encrypted incoming emails i.e. emails addressed to the user of the client computer and stored emails e.g. emails in sent folder inbox etc. being searched by the user of the client computer .

In one embodiment the encryption module comprises a data indexer and a cryptography component . The data indexer may comprise computer readable program code for indexing emails. The data indexer may create an index for individual mailboxes in the cloud based email system with the index comprising the searchable components of emails and identification of encrypted versions of the emails. The index may be consulted to identify encrypted emails that meet particular search criteria.

The data indexer may index an email for identification searching and location. In one embodiment the data indexer receives an email and indexes the email by storing the contents of the email that are typically searched by a user such as message body recipients sender attachments etc. The data indexer indexes emails in their unencrypted state i.e. emails that have not been encrypted by the cryptography component . The data indexer stores the searchable contents of the email in a compact format for relatively fast searching and low storage consumption such as by removing non essential data of the email e.g. spaces articles commonly used English or other language words etc. After the email has been encrypted by the cryptography component the data indexer also indexes the email by keeping track of the corresponding encrypted version of the email such as by mapping the encrypted and unencrypted versions of the email by their common message identifier ID . This allows for email search by consulting the index to identify the emails that meet search criteria and then identifying the corresponding encrypted emails stored in the cloud based email system for retrieval. As can be appreciated because emails stored in the cloud based email system have been encrypted by the cryptography component emails in the cloud based email system cannot be readily searched. The data indexer thus advantageously allows for searching of encrypted emails stored in the cloud based email system . The data indexer may be implemented using the open source Solr indexer for example.

In one embodiment the cryptography component comprises computer readable program code for encrypting emails and decrypting encrypted emails. The cryptography component or another component of the encryption module may mark emails it encrypted to identify them as having been encrypted by the encryption module . In one embodiment the cryptography component only encrypts the user portions of the email such as the message body and attachments and other portions of the email that does not adversely affect format compatibility with the cloud based email system. More specifically the cryptography component may preserve the formatting of the email to maintain compatibility with the cloud based email system . For example when the cloud based email system comprises the Microsoft Office 365 email server the cryptography component may encrypt the email s text message body subject field and attachment without encrypting the headers e.g. recipient and sender information and item formatting. The email subject field and message body may be encrypted using separate techniques to support group by subject functionality of some cloud based email systems. The cryptography component may encrypt an email into an encrypted email and decrypt the encrypted email back to the unencrypted email. The cryptography component may use different cryptography seeds for different emails of the same user for improved security such as to prevent frequency analysis attacks. In one embodiment the cryptography component employs the AES 256 Advanced Encryption Standard encryption algorithm to encrypt emails and decrypt encrypted emails. Other encryption algorithms may also be employed without detracting from the merits of the present invention.

In one embodiment encryption keys for encrypting emails and decrypting encrypted emails are received by the cryptography component from a key manager . The key manager may comprise a key server running on one or more computers. In one embodiment the key manager is part of the cloud access security system . In other embodiments for more control of access to the emails the key manager may be hosted on premise i.e. within the private computer network see that includes the client computer .

In one embodiment the event listener comprises computer readable program code for communicating with the cloud based email system . In one embodiment the event listener receives email event notifications from the cloud based email system and issues email processing requests to the cloud based email system . The event listener may register with the cloud based email system to receive email event notifications for particular mailboxes such as notifications when a mailbox receives an incoming email and sends an outgoing email. The event listener may communicate with the cloud based email system using a protocol recognized by the cloud based email system . For example the event listener may communicate with the cloud based email system in accordance with the Microsoft Exchange Web Services protocol when the cloud based email system comprises the Microsoft Office 365 email server.

In one embodiment the administration portal comprises computer readable program code for allowing an administrator such as Information Technology IT personnel to configure the cloud access security system . For example the administrator may log onto the cloud access security system by way of the portal to enter particulars for mailboxes that will be provided encryption service. As a particular example when the cloud based email system comprises the Microsoft Office 365 email server a user s mailbox will have a corresponding service account information that identifies the mailbox and provides access privileges e.g. replacement of emails in the mailbox to the mailbox. An administrator may log onto the administration portal to provide service account information for a user s mailbox to the event listener which uses the service account information to register with the cloud based email system to receive email event notifications to gain access privileges to the mailbox.

Referring first to there is shown a flow diagram that schematically illustrates processing of an incoming email for a mailbox in accordance with an embodiment of the present invention. In the example of the incoming email is received in the cloud based email system see arrow with the incoming email being addressed to a user having a corresponding mailbox in the cloud based email system . Accordingly the incoming email is received in the mailbox of the user. The incoming email may be found in the inbox of the mailbox for example.

In the following examples the event listener has registered with the cloud based email system to receive notifications whenever a new incoming email is received in the mailbox . Accordingly as shown in the cloud based email system notifies the event listener when the incoming email is first received in the mailbox see arrow . The cloud based email system may also send a separate notification to the client computer of the user see arrow informing the user that there is a new incoming email in his mailbox . The notification for the user is received by the protocol proxy which forwards the notification to the client computer of the user.

In response to receiving the notification that a new incoming email has been received in the mailbox the event listener retrieves the incoming email from the cloud based email system see arrow . For example the event listener may request the cloud based email system to receive a copy of the incoming email or individual contents of the incoming email such as message body subject etc. from the inbox of the mailbox . The event listener receives the incoming email from the cloud based email system and forwards the incoming email to the encryption module . There the data indexer receives and indexes the incoming email see arrow in its unencrypted state i.e. not encrypted by the cryptography component . The data indexer indexes the incoming email in its unencrypted typically clear text state to allow for subsequent searching.

Continuing in the encryption module requests and receives an encryption key from the key manager see arrow . The event listener receives the incoming email from the event listener encrypts the incoming email using the encryption key received from the key manager and provides the resulting encrypted incoming email to the event listener see arrow . Upon receiving the encrypted incoming email the event listener replaces a copy of the incoming email stored in the mailbox e.g. in the inbox of the user with the encrypted incoming email see arrow . For example the event listener may delete the incoming email stored in the mailbox and replace that deleted incoming email with the corresponding encrypted incoming email. As can be appreciated the deletion and replacement of the incoming email may be performed in the same step. Accordingly the mailbox now only has an encrypted version of the incoming email. This advantageously protects against unauthorized viewing of the incoming email as stored in the cloud based email system .

In response to receiving the notification of arrival of the incoming email the user of the client computer may decide to retrieve the incoming email. For example the client computer may request the cloud based email system to provide the incoming email to the client computer see arrow . The protocol proxy receives the request for the incoming email identifies the request as a request for the incoming email and forwards the request to the cloud based email system see arrow . In response to receiving the request the cloud based email system retrieves the now encrypted incoming email and forwards the encrypted incoming email to the client computer see arrow . The protocol proxy receives the encrypted incoming email detects that the encrypted incoming email is in a format encrypted by the encryption module e.g. by checking for a mark placed by the encryption module on emails it encrypted and accordingly proceeds to facilitate decryption of the encrypted incoming email see arrow . For example in response to detecting that the incoming email is in a format encrypted by the encryption module the protocol proxy may forward the encrypted incoming email to the cryptography component . The cryptography component decrypts the encrypted incoming email back to the incoming email using an associated encryption key received from the key manager . The cryptography component returns the incoming email which has been decrypted to the protocol proxy see arrow . The protocol proxy provides the incoming email which is typically in clear text now that it has been decrypted to the client computer see arrow .

As can be appreciated incoming emails are encrypted as stored in the mailbox of the user. The encrypted incoming emails are decrypted before they are provided to the client computer . The encryption and decryption processes are performed in seamless transparent fashion to minimize disruption to the user experience of working with the cloud based email system . It is to be noted that a race condition may occur when the client computer receives the incoming email before the cloud access security system replaces the incoming email with its corresponding encrypted email. However there is a very short window of time when this can occur and only the user s client computer will receive the incoming email during that time.

In the example of the client computer sends out an outgoing email see arrow . The protocol proxy receives the outgoing email. In response to detecting that the email is outgoing the protocol proxy forwards the outgoing email to the cloud based email system see arrow . The protocol proxy may pass through the outgoing email without modification. The cloud based email system receives the outgoing email and forwards the outgoing email to its destination see arrow . The cloud based email system stores a copy of the outgoing email in the sent folder of the mailbox .

Having registered with the cloud based email system to receive email event notifications the event listener receives a notification from the cloud based email system that an outgoing email has been sent by the owner of the mailbox i.e. the user of the client computer see arrow . In response to receiving the notification the event listener retrieves the outgoing email from the cloud based email system see arrow . For example the event listener may request the cloud based email system to receive a copy of the outgoing email from the sent folder of the mailbox . The event listener receives the outgoing email from the cloud based email system and forwards the outgoing email to the encryption module . There the data indexer receives and indexes the outgoing email see arrow . The data indexer indexes the outgoing email in its unencrypted typically clear text state to allow for subsequent searching.

Continuing in the cryptography component requests and receives an encryption key from the key manager see arrow . The event listener receives the outgoing email from the event listener encrypts the outgoing email using the encryption key received from the key manager and provides the resulting encrypted outgoing email to the event listener see arrow . Upon receiving the encrypted outgoing email the event listener replaces a copy of the outgoing email stored in the mailbox e.g. in the sent folder of the mailbox with the encrypted outgoing email see arrow . For example the event listener may delete the outgoing email stored in the mailbox and replace that deleted outgoing email with the corresponding encrypted outgoing email. Accordingly the mailbox now only has an encrypted version of the outgoing email thereby protecting the outgoing email as stored in the cloud based email system . The user may obtain and read the outgoing email in its unencrypted form by requesting for the outgoing email and the cloud access security system receiving the corresponding encrypted outgoing email decrypting the encrypted outgoing email back to the outgoing email and providing the outgoing email to the client computer in a similar manner performed for encrypted incoming emails see arrows .

In the example of the user of the client computer is searching for particular emails that were previously received or sent by the user. Accordingly the user may send an email search query to the cloud based email system using his client computer see arrow . The email search query may include search criteria specified by the user such as keywords e.g. particular texts in the message body or subject field and or parameters e.g. sent by or received from a particular email address . The protocol proxy receives the email search query from the client computer determines from the email search query that the user is searching for emails and sends a request to the data indexer to identify emails in the mailbox that meet the search criteria see arrow . The data indexer searches its index for encrypted emails in the mailbox that meet the search criteria. The data indexer identifies to the protocol proxy the encrypted emails that meet the search criteria see arrow . The protocol proxy makes a request to the cloud based email system for the identified encrypted emails and receives the identified encrypted emails from the cloud based email system see arrow . Thereafter as shown in the protocol proxy forwards the encrypted emails to the cryptography component see arrow which decrypts the encrypted emails using associated encryption keys provided by the key manager see arrow . The cryptography component provides the resulting i.e. decrypted emails to the protocol proxy see arrow . The protocol proxy thereafter provides the emails to the client computer see arrow .

In the example of the cloud access security system performs an email related action to secure emails in the cloud access security system step . The email related action may involve encryption of an email and storage of the resulting encrypted email in the cloud based email system or retrieval of an encrypted email from the cloud based email system for example.

When the email related action involves encryption of an email and storage of the resulting encrypted email in the cloud based email system the cloud access security system receives the email from the cloud based email system step to step . This is the case when the cloud based email system receives an incoming email for the user or sends an outgoing email for the user for example. As a particular example the cloud access security system may request the cloud access security system for an incoming email or an outgoing email in response to receiving an email event notification. The cloud access security system may receive an encryption key from the key manager step and encrypt the email using the encryption key step . The cloud access security system replaces the email in the cloud based email system with a corresponding encrypted email step .

When the email related action involves retrieval of an encrypted email from the cloud based email system the cloud access security system identifies the encrypted email to be retrieved step to step . For example the email related action may involve providing an encrypted incoming email to the client computer of the user. As another example the email related action may involve providing the client computer encrypted incoming and or encrypted outgoing emails that are responsive to a search request. The cloud access security system receives the encrypted email from the cloud based email system step receives from the key manager an associated encryption key for decrypting the encrypted email step decrypts the encrypted email step and provides the resulting email to the client computer step .

Systems and methods for security emails in cloud based email systems have been disclosed. While specific embodiments of the present invention have been provided it is to be understood that these embodiments are for illustration purposes and not limiting. Many additional embodiments will be apparent to persons of ordinary skill in the art reading this disclosure.

