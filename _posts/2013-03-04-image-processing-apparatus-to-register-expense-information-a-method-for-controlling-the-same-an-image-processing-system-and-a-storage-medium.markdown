---

title: Image processing apparatus to register expense information, a method for controlling the same, an image processing system, and a storage medium
abstract: A user has manually registered expenses generated due to use of an MFP, which causes a problem of burdensome registration work. An image processing apparatus for registering expense information in an expense management apparatus, includes a requesting unit configured to request authentication of a user to the expense management apparatus, an acquisition unit configured to acquire pieces of matter information of the user authenticated by the expense management apparatus, a selection unit configured to select one of the pieces of matter information acquired by the acquisition unit, a job execution unit configured to execute a job using hardware resources included in the image processing apparatus, and a registration unit configured to register expense information based on the job executed by the job execution unit as expense information of the matter information selected by the selection unit in the expense management apparatus.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08941855&OS=08941855&RS=08941855
owner: Canon Kabushiki Kaisha
number: 08941855
owner_city: Tokyo
owner_country: JP
publication_date: 20130304
---
The present disclosure relates to a system for registering expense information in a management apparatus based on operations in an image processing apparatus.

Recently digital multifunction peripherals MFPs having hardware resources such as a scanner or a printer are installed in offices or other facilities to be used for daily office work including processing such as copying printing and facsimile transmission.

In the offices or other facilities where such MFPs are installed expenses for using a MFP such as a printing expense for copying an expense based on time of occupying the MFP for the copying and labor costs of a user who has carried out the copying may sometimes be charged to a client.

For example in a law firm expenses generated because a lawyer has used the MFP for a certain legal matter may be charged to a client who is a request source of the matter. As a system for charging such expenses to the client who is a request source of the matter there is known a system that enables a lawyer in charge to manage the expenses by inputting expense information to a computer and charge the expenses to the client at the end of the matter.

Japanese Patent Application Laid Open No. 2011 59254 discusses an image forming apparatus for tallying and outputting when a user logs in the image forming apparatus and carries out a copying operation the number of copies for each work planning department work or engineering department work of the user.

Conventionally however the expenses generated by using MFPs have been registered in the computer manually by a person in charge of the work at the company or at the office. As a result the registration operation of the expense information has been very burdensome for the person in charge.

Japanese Patent Application Laid Open No. 2011 59254 discusses the image forming apparatus for tallying the number of copies for each work of the user who logs in the apparatus. However the image forming apparatus discussed in Japanese Patent Application Laid Open No. 2011 59254 only prints the tallied number of copies in a paper medium or other medium while not executing any processing such as registering in an expense management apparatus.

The present disclosure is directed to a mechanism that enables information of expenses generated by using an MFP in an expense management apparatus to be registered.

According to an aspect disclosed herein an image processing apparatus for registering expense information in an expense management apparatus includes a requesting unit configured to request authentication of a user to the expense management apparatus an acquisition unit configured to acquire pieces of matter information of the user authenticated by the expense management apparatus a selection unit configured to select one of the pieces of matter information acquired by the acquisition unit a job execution unit configured to execute a job using hardware resources included in the image processing apparatus and a registration unit configured to register expense information based on the job executed by the job execution unit as expense information of the matter information selected by the selection unit in the expense management apparatus.

According to the present disclosure expense information generated by using an image processing apparatus by a user can be registered in an expense management apparatus.

Further features and aspects of the present invention will become apparent from the following detailed description of exemplary embodiments with reference to the attached drawings.

Various exemplary embodiments features and aspects of the disclosure will be described in detail below with reference to the drawings.

Referring to a configuration of an expense management system according to a first exemplary embodiment will be described.

The expense management system which is a network system constructed by a group of apparatuses illustrated in includes a client PC a digital multifunction peripheral MFP that is an example of an image processing apparatus and an expense management apparatus . The client PC and the MFP are connected to a local area network constructed on an office basis such as an X office or a Y office.

The local area network constructed by such an office unit is further connected to the Internet and the apparatus client PC or MFP in the local area network communicates with the expense management apparatus via the Internet. Actually relay devices such as a proxy server a router and a switching hub are present between the client PC and the MFP . However does not illustrate the relay devices.

While not illustrated in a firewall is present between the expense management apparatus and the Internet. By this firewall packets from the Internet to the expense management apparatus are filtered or vice versa. Specifically a packet transmitted from the Internet to the device in the local area network is discarded by the firewall.

The MFP has a copy function a print function and a facsimile function a detailed configuration of which will be described below. A plurality of MFPs and a plurality of client PCs are all identical for convenience.

The expense management apparatus is a server for providing cloud services through the Internet. In the present exemplary embodiment the expense management apparatus manages based on for example a matter of a request source handled at work of a law firm information of expenses for each matter. In the present exemplary embodiment the matter represents one case to be processed in association with the expense information. For example at the law firm a case unique to one lawsuit one contract or one work is managed as a matter.

In the present exemplary embodiment the expense management apparatus also manages when a certain expense is generated by copying printing or facsimile transmission at the MFP to be charged to a client information of the expense.

The expenses mean for example a printing expense for copying an expense based on time of occupying the MFP for the copying and labor costs of a person in charge who has carried out the copying.

The expense management apparatus further manages electronic data acquired by scanning a paper medium at the MFP .

Thus the expense management apparatus provides services for managing the expense information and the other data as cloud services and can provide services in response to requests from all networks through the Internet.

However the network system described above is only an example. For example the expense management apparatus can be installed in the local area network of each office.

The client PC in which various applications are installed can instruct printing to the MFP via for example a printer driver. Further the client PC in which a web browser is installed can access the expense management apparatus to register the expense information.

Referring to the hardware configuration of the apparatuses constituting the expense management system according to the present exemplary embodiment will be described.

A central processing unit CPU is a processor for controlling the entire MFP . A random access memory RAM is a system work memory for enabling the CU to operate and also serves as an image memory for temporarily storing image data. According to instructions from the CPU the MFP can communicate with the client PC and the expense management apparatus via a network interface .

For example the MFP receives print data from the client PC logs in the expense management apparatus or transmits receives data of registration of expense information information of expenses for work carried out by a person in charge at a law firm for a certain matter .

The RAM functions as a main memory or a work area of the CPU . The RAM stores setting information of the MFP or an operation log when each processing is executed. A read only memory ROM is a boot ROM for storing a boot program of the system. A hard disk drive HDD stores system software an application and image data.

Programs for executing processes of flowcharts of and described below are stored in the HDD or the ROM . Each step of the flowcharts is executed by the CPU . However a processor other than the CPU may execute each step of the flowcharts or the CPU and the other processor may cooperate with each other to execute the processes of the flowcharts.

An operation unit interface controls displaying on a display a key input on the display and a hard key input and outputs the image data to an operation unit to be displayed thereon. The operation unit interface also transmits information input by a user of the system to the CPU .

The network interface is connected to the network to input output information. A modulator demodulator MODEM is connected to the public line to input output the information. A static RAM SRAM is a nonvolatile recording medium operable at a high speed.

A real time clock RTC executes processing of continuously counting current time even when power for the control unit is not ON. In the present exemplary embodiment the RTC is used when time concerning a job log or an operation log described below is stored in a storage device. These devices are arranged on a system bus .

An image bus interface I F is a bus bridge that connects the system bus to an image bus for transferring the image data at a high speed and converts a data structure. The image bus includes a Peripheral Component Interconnect PCI bus or Institute of Electrical and Electronics Engineers IEEE 1394. The following devices are arranged on the image bus . A raster image processor RIP unit rasterizes page description language PDL data to a bitmap image.

A device I F connects the scanner or the printer to the control unit and converts the image data between a synchronous system and an asynchronous system. A scanner image processing unit corrects processes and edits input image data. A printer image processing unit executes printer correction and resolution conversion for print output image data. An encryption processing unit encrypts input data including the image data. A decryption processing unit decrypts the encrypted data.

The expense management apparatus includes a CPU a RAM a ROM an input output interface a network interface card NIC and a bus .

The CPU executes an operating system OS a general application and a program loaded to a program ROM of the ROM and controls devices connected to the bus as a whole. The ROM further stores an operating system program as a control program of the CPU and various data. The RAM functions as a main memory or a work area.

The input output interface controls displaying on the display or a key input on the display. The NIC is connected to the network to execute communication control processing with the other device client PC or MFP similarly connected to the network .

The hardware configuration of the apparatuses illustrated in has been described. The hardware configuration of the client PC has been described referring to . Actually however the client PC includes in addition to those described above a display a keyboard and a mouse that function as user interfaces.

More specifically programs to are stored in the ROM included in the expense management apparatus and executed by the CPU similarly included in the expense management apparatus . Programs to are stored in the ROM or the HDD included in the MFP and executed by the CPU included in the MFP . A program is stored in the ROM included in the client PC and executed by the CPU included in the client PC .

The client PC issues printing instruction of application data created by a document application installed in the client PC to the MFP via the printer driver .

The printer driver which has a function of instructing reservation printing instructs reservation printing to the MFP . The reservation printing function is for storing PDL data or bitmap image rasterized from PDL data output from the client PC or the like and prints its print data according to a user s operation at the operation unit of the MFP .

The MFP carries out a copy job for executing copy processing a print job for the printing data received from the client PC and a facsimile transmission job for transmitting the image data via the MODEM .

While not illustrated in the MFP that has a network function can carry out a job for executing electronic mail transmission Internet facsimile transmission and file transmission. Execution of the jobs is controlled as a whole by the main control program .

First the case of copying will be described. The main control program instructs the user interface UI application to display a copy screen on the operation unit . The UI application instructs the main control program to carry out the copy job based on a user s input made via the operation unit .

The main control program which has received the execution instruction of the copy job from the UI application instructs the copy application to carry out the copy job.

The copy application which has received the execution instruction of the copy job controls the hardware resources such as the scanner or the printer to carry out the copy job. Specifically the scanner image processing unit corrects processes or edits the image data input from the scanner and the printer image processing unit corrects the image data or converts its resolution. Then by instructing the printer to print the image the image is output to a printing medium such as a sheet of paper.

Next the case of printing will be described. First the main control program receives a reservation printing instruction received from the client PC via the network . The main control program which has received the reservation printing instruction transfers PDL data included in the reservation printing instruction to the print application .

The print application stores print data of the reservation printing in the RAM or the HDD for a fixed period of time. Then when receiving printing start instruction of the reservation printing from the user via the operation unit the UI application instructs the main control program to carry out the print job for printing the print data based on a user s input from the operation unit .

The main control program which has received the execution instruction of the print job from the UI application instructs the print application to print the data. The print application acquires the data stored in the RAM or the like based on an identifier of the printing target data included in the print processing instruction and instructs the printer to print the image of the printing target data on a printing medium such as a sheet of paper.

Next the case of facsimile transmission will be described. First the main control program instructs the UI application to display a facsimile transmission screen on the operation unit .

The UI application instructs the main control program to carry out the facsimile transmission job based on a user s input. The main control program which has received the facsimile transmission execution from the UI application instructs the facsimile application to transmit facsimile data.

The facsimile application which has received the facsimile transmission instruction carries out the facsimile transmission job. Specifically the facsimile application processes the image data generated by optically reading a document via the scanner and faxes the image data as facsimile data via the MODEM and the public line according to the facsimile transmission instruction.

After an end of the execution of each of the copy job the print job and the facsimile transmission job the log management application writes a job log in the HDD . Data stored as the job log is log data of one job for example start time of job execution end time of the job execution or setting contents of other jobs.

The job log is written when each application copy application in the case of copying and facsimile application in the case of facsimile transmission instructs writing to the log management application .

The log management application which has received the writing instruction of the job log stores the received job log in the HDD . The stored job log is acquired from the HDD by the log management application when the log acquisition instruction is received from the main control program or the authentication management application .

The authentication management application manages setting information or a right right to use of using the function of the MFP for each user of the MFP and determines presence of a right to use for each user. In addition the authentication management application instructs processing of requesting user authentication to the expense management apparatus authentication processing or processing of registering expense information expense information registration processing to the expense management apparatus cooperation application .

When the user operates the MFP instructs activation of MFP first the authentication management application instructs the UI application to display an authentication screen. Accordingly a log in screen illustrated in is displayed on the operation unit and an authentication operation is carried out via the log in screen.

The UI application instructs authentication to the authentication management application based on a user s operation on the log in screen. The authentication management application collates ID and a password identification information of user included in the authentication instruction with authentication information stored in the ROM of the MFP . Then the authentication management application determines authentication OK or NG and presence of a right to use of each function of the MFP .

To cooperate with the expense management apparatus a log in request is made to the expense management apparatus cooperation application based on the ID and the password identification information of user included in the authentication instruction. The expense management apparatus cooperation application that has received the log in request creates log in request information and transmits the log in request to the external cooperation application of the expense management apparatus via the network .

The expense management apparatus cooperation application exchanges data with the expense management apparatus via the network . For example the expense management apparatus cooperation application requests logging in or registers expense information by using the external cooperation application of the expense management apparatus .

The expense management apparatus manages the expense information. The expense information is managed in association with a matter.

The main control program controls the expense management apparatus . For the input from the user or other devices the UI application or the external cooperation application requests processing to the main control program .

The UI application executes processing in response to a request made from a web browser of the client PC or the like via the network and returns hypertext markup language HTML data to be displayed on the web browser of the client PC . Communication is carried out by using protocol such as hypertext transfer protocol HTTP .

An authentication management application authenticates a user in response to a log in request from outside and manages setting information of the user and controls an access right to each function for each user. The log in request is issued from the MFP or the like via the network . The setting information of the user is stored in the RAM in the expense management apparatus . When receiving the log in request the authentication management application reads data from the RAM and collates the data with an ID and a password identification information of user included in the log in request to authenticate the user.

An expense information management application receives instruction from the UI application or the external cooperation application to execute processing such as registration deletion or changing of expense information. In the present exemplary embodiment the expense information means information about expenses for work carried out by the person in charge at the law firm for a certain matter. A piece of expense information includes items of Type bill status Date Matter User Billing Code Units rate and Total Amount.

The item of Type indicates a charging method. For example when the item of Type is Time it indicates charging based on time. When the item of Type is Expense it indicates charging based on the number of prints.

The item of bill status has a value such as Billable or Do Not Bill indicating whether charging has been carried out. The item of Matter has identification information to identify a lawsuit or a case at for example a law firm. The item of User indicates a person in charge of a matter.

In the present exemplary embodiment for example when expense information is registered by using an MFP a value of a user who has logged in the MFP is written in this item. The item of Billing Code indicates an operation to be charged. The item of Units indicates time of expense generation when the item of Type is Time and the number of prints or the number of print pages when the item of Type is Expense. The item of rate indicates an amount of money per unit. The item of Total Amount has a value acquired as a result of multiplying a value of the Unit item with a value of the rate item.

The external cooperation application provides an interface used by for example the client PC to issue a request to the expense management apparatus . For example the external cooperation application provides an interface for receiving a log in request a registration request of expense information an acquisition request of user data or a matter or a creation request of a matter to the expense management apparatus .

The external cooperation application notifies the main control program of various requests that have been received. The main control program communicates with the authentication management application the expense information management application and the matter management application according to types of the requests to execute processing for the requests.

The matter management application manages matters. Specifically the matter management application displays a screen for registering a matter by the UI application of the expense management apparatus that has detected a user s matter creation request and creates matter information.

For example information about a client of a request source of a law firm information about a person in charge of the matter or information about expenses for work for the matter is associated with the matter information. The expense management apparatus stores information managed by the matter management application in the RAM of the expense management apparatus and refers to the information when necessary.

Next referring to a series of processing steps from an operation start of the MFP to log out processing will be described. illustrates a processing sequence between the MFP and the expense management apparatus .

First at the MFP the user starts an operation by using the display or the hard key of the operation unit to carry out processing such as copying. At that time when the MFP is in a power saving state in a certain button is pressed. In the MFP detects a button input and displays the log in screen illustrated in . When the MFP is not in the power saving state the log in screen illustrated in has already been displayed.

Further a log in button for starting authentication processing according to an input content of the log in screen and a switching button for switching integrated circuit IC card authentication and authentication by a key input via the operation unit are displayed.

In the present exemplary embodiment one of the normal log in and the expense management apparatus log in can be selected as a log in type on the log in screen illustrated in . In the present exemplary embodiment the normal log in means logging in to the MFP while the expense management apparatus log in means logging in to the expense management apparatus .

When the normal log in is selected as in the case of the conventional MFP the function of the MFP can be used without creating any expense information. On the other hand if the expense management apparatus log in is selected expense information regarding a matter is automatically created when the MFP is used.

The processing sequence illustrated in will be described on the assumption that the expense management apparatus log in has been selected on the log in screen illustrated in .

To carry out authentication by a key input via the operation unit in the user inputs the ID and the password. In the user presses a log in button.

When the pressing of the log in button is detected in the state where the normal log in is selected on the log in screen illustrated in the authentication management application of the MFP carries out authentication processing. On the other hand when the pressing of the log in button is detected in the state where the expense management apparatus log in is selected on the log in screen illustrated in in the MFP transmits a log in request including the ID and the password to the expense management apparatus .

The data transfer at this time is carried out via the network and Simple Object Access Protocol SOAP or Representational State Transfer REST is used as a protocol. The data transfer operations between the MFP and the expense management apparatus are all carried out by the aforementioned method and thus further description will be omitted.

In after receiving the log in request from the MFP the expense management apparatus acquires the ID and the password included in the log in request and executes authentication processing. When the authentication is successful an authentication token and an authentication result are returned to the MFP. In the communication thereafter consistency of the authentication token is verified to check whether the authentication has correctly been carried out. In the authentication result is returned to the MFP .

Then in the MFP transmits an acquisition request of a matter list to the expense management apparatus .

The Status indicates a state of the matter. In the case of Active the matter is not ended in other words an active state. In the case of Closed work for the matter has been ended. The Last Updated indicates a last changing date of information about the matter. The information is updated when a file or expense information corresponding to the matter is registered.

In the expense management apparatus makes an inquiry about a list of matters where a log in user is a person in charge and a status is active to the matter management application . In the expense management apparatus returns the information to the MFP . Concerning the list of matters transmitted for the acquisition request of the matter list by the expense management apparatus all the matters can be returned without being filtered or only the matters of a designated date and after by using the last updated can be returned.

In the MFP creates a list of matters acquired from the expense management apparatus . In the MFP displays the list of matters matter selection screen on the operation unit . Then the MFP receives matter selection from the user. When all the matters are acquired without filtering on the expense management apparatus a list of filtered matters is created by the MFP and then the matter selection screen is displayed.

In the user selects a desired matter on the matter selection screen and presses the OK button. In after detecting the pressing of the OK button the MFP stores the matter selected from the list of matters and displays a main screen illustrated in . The stored matter is kept stored until log out processing described below is carried out. Jobs executed by the MFP after the matter selection are all treated as jobs associated with the matter.

In the present exemplary embodiment the MFP has functions of copying scanning printing and faxing. For example when the copy function is called up a copy screen illustrated in is displayed.

In the user executes various setting operations via the screen of each function and presses a processing execution button. Then in the MFP executes jobs concerning each function.

In the MFP executes the jobs. In the MFP creates expense information to be registered in the expense management apparatus based on a job log or an operation log of the executed jobs. Then in the MFP requests the expense management apparatus to register the expense information. In the expense management apparatus that has received the expense information registration request registers the expense information based on the content of the received expense information. In the expense management apparatus returns a successfully registered status to the MFP .

Then in the user presses a log out button not illustrated on the operation unit . In the MFP executes log out processing. The log out processing is carried out by the authentication management application . Specifically processing for deleting the list of matters including selected matter acquired from the expense management apparatus or processing for deleting the created expense information is executed.

The series of processes from the start of operating the MFP to the log out processing has been described.

Next referring to the authentication processing carried out at the MFP will be described. This processing corresponds to the processing of the MFP illustrated as the authentication processing portion in .

First in step S after detecting a user s operation the UI application displays the log in screen illustrated in on the operation unit . Specifically in step S when detecting user s pressing of the log in button on the log in screen the UI application notifies the authentication management application of this.

In step S the authentication management application checks a selection state of the log in type. There are two log in types normal log in for using the function of the MFP without registering any expense information and expense management apparatus log in for registering information of expenses expense information generated by using the MFP in the expense management apparatus .

When the normal log in is selected NO in step S in step S the MFP executes authentication processing by using authentication information stored in the ROM . Specifically in step S the authentication management application verifies whether authentication information coincident with a combination of an ID and a password acquired via the log in screen is present in the authentication information of the ROM . When coincidence with the combination of the ID and the password is determined YES in step S in step S the CPU of the MFP stores current time measured by the RTC as an operation log of log in time in the RAM .

The authentication management application stores the current time as an operation log in the RAM at a certain operation timing. For example the timing is when the user starts an operation at the MFP to display the log in screen when the user logs in the MFP or the expense management apparatus when an operation start of each function is detected or when the user logs out from the MFP or the expense management apparatus .

An ID is an identifier for uniquely indicating each record of the operation log. In an event type a value indicating at what timing the operation log has been stored is stored. In an occurrence time occurrence time of a relevant event is stored.

Then in step S the main control program requests displaying of the main screen to the UI application and displays the main screen illustrated in on the operation unit . When no coincidence with the combination of the ID and the password is determined NO in step S the processing returns to the log in screen to prompt inputting again.

When the selection state of the log in type is the expense management apparatus log in YES in step S in step S the authentication management application instructs the expense management cooperation application to transmit the ID and the password acquired from the log in screen as a log in request to the expense management apparatus .

The expense management cooperation application that has received the instruction transmits the log in request including the ID and the password to the expense management apparatus . At that time a protocol represented by SOAP or REST is used. However other methods can be used. Authentication data is transferred by using a method represented by BASIC authentication or Digest Authentication.

In step S after a log in response has been returned as an authentication result from the expense management apparatus to the MFP the authentication management application checks the authentication result. When the authentication result is a value indicating an authentication success YES in step S the authentication management application stores an authentication token included in the authentication result and processing from step S is continued. When the authentication result is a value indicating an authentication failure NO in step S in step S the processing returns to the log in screen to prompt inputting again.

In step S when the authentication is successful the authentication management application causes the expense management apparatus to transmit a matter list acquisition request. Then in step S the authentication management application creates a list of matters to be displayed by using the matter list acquired from the expense management apparatus .

The list of matters to be created can be all the matters acquired from the expense management apparatus or filtered by the Person In Charge the Status or the Last Updated .

After the creation of the list of matters in step S the authentication management application requests displaying of the matter selection screen to the UI application . In step S the UI application that has received the request displays the matter selection screen illustrated in on the operation unit . The list of matters created in step S is a list to be displayed on the matter selection screen. In the list Matter Names are enumerated.

For the list of matters an interface capable of changing a filtering method using the person in charge or the status can be displayed on the matter selection screen. In this case in step S when the filtering method is changed a list of matters is created again.

The order of displaying is basically the order of acquisition. The data can be sorted by last updated or sorted based on its information by storing a last reference date on the expense management apparatus side.

In step S the authentication management application that has detected the pressing of the OK button stores a Matter Name selected from the list of matters.

Then in step S the authentication management application stores current time counted by the RTC as a log in operation log in the RAM . Then in step S the UI application displays the main screen illustrated in on the operation unit and ends the processing illustrated in .

Important steps are storage of an operation log performed in steps S and S and storage of a job log performed in step S . These logs are used in expense information registration processing carried out after execution of each function. The execution processing of each function is similar between the normal log in and the expense management apparatus log in. However operation log storage or the like may be executed only in the case of the expense management apparatus log in.

The processing of the flowchart of is started from the displayed state of the main screen illustrated in on the operation unit of the MFP. The main control program calls up the copy application when it detects pressing of the execution button of the copy function on the main screen.

First in step S the copy application stores the time when copy application is called up as copy processing start time start time in an operation log illustrated in . Then in step S a copy screen illustrated in is displayed on the operation unit .

The user executes on the copy screen setting concerning copying such as the number of copies copy magnification a sheet size a density or a sheet type. In step S the copy application changes the copy setting according to a user s input from the operation unit and updates the copy screen to the set content.

In step S the copy application detects an input indicating a copying start. In step S the copy application stores time of detecting the input of the copying start as a log of Job Execution Start Time in the HDD .

In step S the MFP executes a copy job. In the present exemplary embodiment the copy job indicates processing from a start of document scanning to an end of outputting of an image to a medium such as paper.

In step S after ending the copy job the copy application instructs the log management application to store contents of the processing as a job log. The log management application which has received the instruction from the copy application stores a job log indicating ending of the execution of the job log in the HDD .

The job log includes items such as a job ID a Job Type a Job Execution Start Time a Job Execution End Time a Status an Execution User a Number Of Pages a Number Of Sheets and a Detailed Setting .

The job ID is an identifier for uniquely indentifying a job. The Job Type is a type of an executed function. Types are for example copying scanning printing and facsimile transmission. The Job Execution Start Time is the time of starting execution of a job.

The job execution end time indicates the end time of the execution of the job end time . The Status indicates a state of the job. Specifically a value of is stored as completed when the execution of the job is normally ended and as failed when the execution is a failure for a certain reason. The Execution User stores the log in user.

In the Number Of Pages the number of pages of copied sheets is stored. When two copies of three pages are stored it makes six pages. When two sides are copied two pages are printed on one sheet.

In the Number Of Sheets the number of output sheets is stored. When two copies of three pages are one sided copied it makes six pages. When two sides are copied it makes four because one copy uses two.

In the Detailed Setting color setting one sided or two sided setting and magnification setting are stored. Each item is stored in a format to facilitate subsequent acquisition of each setting value for example to achieve setting name setting value . These items are collected as one in the detailed setting. However each item can be independently stored.

In step S after ending the storage processing of the job log the copy application transmits a job end notification to the main control program or the authentication management application .

In the present exemplary embodiment the copy function is described as an example. The processing is similar to that of the functions other than the copying such as scanning printing facsimile transmission. In such a case processing of a screen display portion a setting portion and a function execution portion is based on each function. Storage of an operation log is basically carried out at the start time and the execution instruction time of each function and storage of a job log is carried out at the end time of each processing.

When an error such as paper jamming during copying occurs an error flag indicating error generation and error releasing can be stored.

The processing illustrated in corresponds to that of the MFP described in a broken line of the expense information registration illustrated in . In the flowchart of the processing is started by receiving a job end notification from each application when the execution of the job is ended.

First in step S the authentication management application receives a job end notification from the copy application the print application or the facsimile application . The job end notification includes a job type indicating which of the functions copying printing and facsimile transmission in the present exemplary embodiment of the MFP has been used for notification and a job ID for uniquely identifying a job.

The authentication management application which has received the job end notification requests the log management application to acquire an operation log. In step S the log management application acquires the operation log and returns it to the authentication management application . Further in step S the authentication management application acquires a job log coincident with the job ID included in the job end notification received in step S and sets it as a job log of an expense information creation target.

Then in step S the authentication management application reads and acquires an expense information creation table for registering expense information in the expense management apparatus from the RAM or the HDD . The expense information creation table has been stored beforehand in the RAM or the HDD of the MFP by the authentication management application based on a user s input. The expense information creation table is input by the user via a screen illustrated in described below.

In the item of the Job Type a value indicating a type of a job Copy Print or Fax for registering expense information is stored. In the case of Copy the expense information is registered when copying is executed. In the case of Fax the expense information is registered when facsimile transmission is executed. In the present exemplary embodiment a charging method varied based on used functions can be employed.

In the item of the Charging Method a value indicating what charging is based on is stored. In the present exemplary embodiment there are Time and Expense. In the case of Time expense information is created by using elapsed time. In the case of Expense expense information is created by using the number of printed pages or the number of sheets. In the case of Time what basis is used for the start timing and the end timing is set. In the case of Expense which of the number of pages and the number of sheets is used for counting is set as a counting method.

In the item of the Start Timing a value indicating processing timing for starting measurement of the elapsed time when a charging method is Time is stored. For the Start Timing in addition to a copy processing start time of detecting execution of coy job various values such as the time of displaying the copy screen and the time of logging in can be set.

In the item of the End Timing a value indicating processing timing for ending measurement of time when a charging method is Time is stored.

Values usable for the start timing and the end timing are the times stored in the job log illustrated in or the operation log illustrated in . For example when a copy processing start is set in the Start Timing the copy processing start time stored in the operation log is set as start timing.

When a copy end time is set in the End Timing the job execution end time of the job log is set as the end timing. A value of end time start time is elapsed time.

On the other hand when a charging method is Expense values of the start timing and the end timing are null and instead a value is set in the Counting Method .

In the Counting Method a value indicating an item used when the charging method is Expense is stored. A value that can be employed is the number of pages or the number of sheets. When the charging method is Time a value of the counting method is null.

In the item of the Bill Status a setting value as to whether to charge is stored. There are three types Billable Do Not Bill and No Charge.

In the item of the Date a value used as a date of executing an operation to be charged is stored. The same value as that of the start timing or the end timing can be used.

In the item of the Billing Code a value indicating an operation to be charged is stored. A type of the Billing Code is selected from those acquired from the expense management apparatus . The authentication management application sets a Billing Code corresponding to a function of the MFP based on a user s input.

In the item of the Rate an amount of money to be charged per unit is stored. When the charging method is Time for example an amount of money per minute is set. When the charging method is Expense for example an amount of money per page or sheet is set.

In the item of the Condition a condition of applying its record is stored. When there is no condition when the item is empty all operations of coincident types are targets of registering expense information. In this case a conditional expression for example data is registered when a color mode is color can be written. Accordingly in a case of color output an amount of money per page can be set high or an amount of money per unit time can be changed according to a facsimile transmission reception line.

In a case of setting where a plurality of data is registered by the same job type or the same charging method priority is set among conditions and only those high in priority are registered. Alternatively a plurality of the conditions can be registered.

In step S after acquiring the expense information creation table a first record is extracted from the expense information creation table to be set as a reference record.

Then in step S the MFP determines whether the value of the reference record acquired in step S is present. When not present NO in step S the processing is ended without registering any expense information in the expense management apparatus . On the other hand when the value of the reference record is present in the expense information creation table YES in step S the processing proceeds to step S to create expense information to be registered in the expense management apparatus .

When the Job Type of the expense information creation table coincides with the job type of the job end notification received in step S the MFP determines that expense information to be registered in the expense management apparatus is created YES in step S and the processing proceeds to step S. When the Job Type does not coincide with the job type of the job end notification NO in step S in step S the MFP extracts without executing registration processing based on the reference record a next record from the expense information creation table and the record is set as a new reference record.

The expense information includes Type Billing Status Date Matter User Billing Code Units and Rate and these values are set by using values of the operation log the job log and the expense information creation table.

In step S in the Type of the expense information the value of the Charging Method of the reference record is directly set.

Then in step S the MFP checks which of Time and Expense the Type of the reference record is. In the case of Time in step S the MFP first acquires values of the Start Timing and the End Timing of the reference record. For the value of the start timing acquired in this case as described above a value such as a copy job start time a copy screen display time or a log in time is set. For the value of the end timing a value such as a copy job end time or a log out time is set.

Then the MFP refers to the operation log and the job log acquired in steps S and S to determine times corresponding to the values of the Start Timing and the End Timing acquired in step S as the counting start time and the counting end time. In step S the MFP calculates a time period acquired by subtracting the counting start time from the counting end time as an elapsed time. Then in step S the value calculated in step S is set in the item of the Units of the expense information to be registered in the expense management apparatus .

In other words when the item of the Type of the reference record is Time values calculated in steps S to S are set in the items of the Units.

On the other hand when the Type of the reference record is Expense in step S a value of the Counting Method of the reference record is acquired. In the value of the Counting Method as described above at least one of the values of the number of pages and the number of sheets is set. The authentication management application determines to count the expense information by the number of pages or the number of sheets according to this value.

Then in step S the MFP refers to the job log acquired in step S to acquire a value corresponding to the value of the Counting Method and sets the value in the item of the Units of the expense information. In other words when the Counting Method indicates the number of pages the number of pages of the job log of the job for which the job end notification has been received is directly set in the value of the Units of the expense information.

Then in step S the MFP acquires a value of the Bill Status of the reference record and sets the acquired value in the value of the item of the bill status of the expense information.

Then the MFP acquires a value of the Date of the reference record and refers to the job log or the operation log corresponding to the value and sets time. In the job log or the operation log not only information about date but also information about hour and minute are recorded. In this case however in step S only the information about the date is extracted and set in the item of the Date of the expense information.

In step S in the item of the Matter of the expense information the Matter Name selected by the user on the matter selection screen illustrated in and managed by the authentication management application is set.

In step S in the item of the User of the expense information the name of the log in user stored in the authentication management application is set.

In step S a value of the Billing Code of the reference record is acquired. In step S the value is set in the Billing Code of the expense information.

In step S a value of the Rate of the reference record is acquired. In step S the value is set in the Rate of the expense information.

Then in step S the authentication management application transmits the expense information generated through steps S to S to the expense management apparatus via the expense management apparatus cooperation application . The expense information is transmitted via the network interface and the network using protocol such as SOAP or REST.

Then the next record is extracted and set as a new reference record. The processing of steps S to S is carried out for all the records of the expense information creation table.

The series of processes from the start of the operation at the MFP to the registration of the expense information in the expense management apparatus has been described. According to the present exemplary embodiment the expense information to be registered in the expense management apparatus can be automatically generated by the MFP . This enables easy management of expenses printing fees for copying fees based on occupation time of MFP during copying and labor costs of person in charge of copying at law firm generated due to the operation of the MFP .

The expense information to be registered in the expense management apparatus is created according to the expense information creation table illustrated in . Thus the expense information can be created base on an operation policy in an environment of managing expenses.

Further according to the present exemplary embodiment since the expense information varied based on the function copying printing and facsimile transmission of the MFP is created more meticulous expense information can be created.

The screen illustrated in is displayed by accessing a predetermined uniform resource locator URL of the MFP from a web browser of an external terminal such as the client PC or a mobile terminal not illustrated . This URL is for adding editing records in the expense information table and described in a form of http host name or Internet Protocol IP address of MFP data path file name .

A web server not illustrated of the MFP that has received an access from the external terminal client PC or the like requests the authentication management application to generate data. The authentication management application that has received the request generates HTML data and transmits it to the client PC . As a result the screen illustrated in is displayed on the display of the client PC . A screen similar to that illustrated in can be displayed on the operation unit of the MFP .

As illustrated in items making pairs with the contents stored in the expense information creation table illustrated in are displayed on the display of the client PC . Data input by selecting or editing a value by the user is transmitted to the web server in the MFP . The authentication management application that has received the data changes the contents of the expense information creation table.

The screen illustrated in is displayed by accessing a predetermined URL of the expense management apparatus from the web browser of the client PC or the mobile terminal not illustrated . This URL is for displaying the list of expense information and described in a form of http host name or IP address of expense management apparatus data path file name .

The expense management apparatus that has received the request of accessing the URL for displaying the list of expense information HTTP request message transmits the received request to the main control program . The main control program requests data of the expense information managed by the expense information management application and converts the acquired data of the expense information into HTML data and returns it to the request source. The web browser at the request source analyzes the HTML data and displays a screen of a web page illustrated in .

Next the expense information registration processing will be described using an example of a real value.

For example a creation method of expense information when a log in user as User selects a Matter A executes copying at the MFP generates the operation log illustrated in and the job log illustrated in and uses the registration setting table illustrated in will be described.

First the authentication management application checks whether a job type coincident with a job type for which a job end notification has been received is present in the expense information creation table. Since the type of the job end notification is copy a type where the Job Type of the expense information creation table is Copy is searched for. Then records of a first row and a second row match each other. By using information of the records each item of the expense information is set. First the first row of the expense information creation table is used.

In Type of the expense information time is designated to set a Charging Method of the expense information creation table.

In the Bill Status of the expense information Billable is designated to set the Bill Status of the expense information creation table.

In an item of Date of the expense information date of processing written in the expense information creation table is set. Specifically only a time date portion of a copy processing start in the operation log is designated. Accordingly 2012 1 1 that is a date portion of 2012 1 1 10 00 is designated.

In the Matter of the expense information Matter A is designated to set a Matter Name stored during the authentication in step S.

In the Billing Code of the expense information Copy is designated to set the Billing Code of the expense information creation table.

In the Units of the expense information time indicating generation of expenses is designated when the Type item is Time and the number of printed sheets or the number of pages is designated when the Type item is Expense.

In this example in the Units of the expense information a value acquired by subtracting the copy processing start time from the log end time is set. Accordingly 5.0 acquired by subtracting 2012 1 1 10 00 00 from 2012 1 1 10 05 00 is designated. When the operation log includes information indicating an error generated during copying the time period acquired by subtracting the error generation time from the error releasing time can be set in the Units.

In the Rate of the expense information 1 is designated to set the Rate of the expense information creation table.

Then the second expense information is generated by using information of the second row of the expense information creation table. Since the charging method is Expense the method is similar to that of the first row except use of the number of pages of the job log in the Units and thus description thereof is omitted.

The configuration where the expense information creation table is stored in the MFP has been described. However a configuration where the expense management apparatus stores the expense information creation table and in step S the expense information creation table is acquired from the expense management apparatus can be employed.

The first exemplary embodiment has been described. The first exemplary embodiment employs the configuration where one of the normal log in and the expense management apparatus log in is selected as the Login Type on the log in screen illustrated in . When the expense management apparatus log in is selected as the Login Type the MFP can be used after logging in the expense management apparatus . In other words a signal sign ON mechanism can be used. This provides an advantage in that authentication does not need to be carried out repeatedly.

The first exemplary embodiment has been directed to the configuration where the logging in processing is carried out on the screen illustrated in . The first exemplary embodiment is advantageous in that there is no need to carry out any authentication operation at the MFP when authentication is successful at the expense management apparatus . However to carry out operations for a plurality of Matters the processing must first log out from the MFP and then must be repeated from authentication.

On the other hand a second exemplary embodiment employs a configuration where authentication is carried out at the MFP and then to register expense information authentication and matter selection are carried out at an expense management apparatus when a separately installed expense information registration function is called up.

The hardware configuration and the software configuration are similar to those of the first exemplary embodiment. Thus detailed description thereof will be omitted.

Referring to a series of processes from an operation start of the MFP to expense registration in the expense management apparatus according to the second exemplary embodiment will be described.

First to carry out processing such as copying a user starts an operation by using a display and a hard key of an operation unit of the MFP . At this time in the user presses a certain button when the MFP is in a power saving state. Then in the MFP detects an input to display a log in screen. When the MFP is not in the power saving state the log in screen has already been displayed.

In the user inputs an ID and a password on the log in screen. In the user presses a log in button indicating a start of the authentication processing. In after detecting the pressing of the log in button the MFP collates the ID and the password acquired from the log in screen with authentication information stored in a RAM in the MFP and executes authentication.

In if the authentication has been successful a main screen is displayed. The authentication processing performed in is for logging in only to the MFP . Thus at this time no log in request is issued to an expense management apparatus.

Then in the user presses an expense information registration button. The MFP detects the pressing of the expense information registration button . In the MFP displays an expense information registration main screen.

In the user presses a button of a function to be executed on the expense information registration main screen illustrated in . As illustrated in the button of the function is a Copy button a Scan button a Print button or a Fax button. When one of these buttons is pressed a corresponding application is activated to set an executable state of a predetermined function.

In the MFP which has detected the pressing of the button of each function displays the log in screen for inputting an ID and a password to log in the expense management apparatus . The displayed log in screen is as illustrated in . However there is a difference in that the log in screen displayed in is for logging in the expense management apparatus while the log in screen displayed in is for logging in the MFP .

The second exemplary embodiment has a feature that when one of the Copy button the Scan button the Print button and the Fax button is pressed on the screen illustrated in the log in screen for logging in the expense management apparatus is displayed.

In the user inputs an ID and a password of the expense management apparatus . In the user presses a log in button indicating a start of authentication processing.

In the MFP transmits a log in request including the ID and the password to the expense management apparatus . After transmitting the log in request in in the expense management apparatus acquires the ID and the password included in the log in request and carries out authentication processing. When the authentication is successful an authentication token and an authentication result are returned to the MFP .

Then in the MFP transmits an acquisition request of a matter list to the expense management apparatus .

After receiving the acquisition request in in the expense management apparatus makes an inquiry about a list of matters where the user authenticated in is a person in charge and status is active to a matter management application . Then in the expense management apparatus returns the list of matters acquired as a result of the inquiry to the MFP .

Concerning the list of matters returned by the expense management apparatus in response to the acquisition request of the matter list all the matters can be returned without filtering or only matters of a date designated by using Last Updated and after can be returned.

In the MFP displays the matter list acquired from the expense management apparatus as a matter selection screen on the operation unit . When all the matters are acquired without filtering on the expense management apparatus side the MFP creates a list of filtered matters and then the matter selection screen is displayed. After the matter selection screen has been displayed in a matter selected by the user on the matter selection screen is received and stored in the RAM .

In the first exemplary embodiment the matter stored in the RAM is deleted after the execution of the log out processing. On the other hand in the second exemplary embodiment the matter is deleted after the pressing of the function button and can be rewritten with another matter.

Specifically for example it is supposed that the user presses the Copy button on the expense registration main screen illustrated in to carry out a copy job. Then returning to the expense registration main screen illustrated in the user presses the Print button. At this time according to the second exemplary embodiment in the matter selection screen is displayed allowing the matters to be changed.

A matter A can be selected when the copy job is executed and a matter B can be selected when the print job is selected. As a result different from the first exemplary embodiment advantageously the matters can be changed without executing log out processing first.

In on the screen illustrated in the screen for logging in the expense management apparatus is displayed for each selection of the function button on the expense registration main screen. However the expense management apparatus log in screen can be displayed only when the button is first pressed on the expense registration main screen illustrated in and thereafter the expense management apparatus log in screen can be displayed.

Processing of steps to is similar to that of steps S to S illustrated in and thus description thereof will be omitted.

The processing illustrated in corresponds to that of the MFP described in a broken line of the authentication processing illustrated in .

In the flowchart of neither the processing of step S of the flowchart of the authentication processing of the MFP according to the first exemplary embodiment selection Login Type nor the processing of steps S to S is carried out. In other words step S illustrated in corresponds to step S illustrated in .

Step S illustrated in corresponds to step S illustrated in . Step S illustrated in corresponds to step S illustrated in . Step S illustrated in corresponds to step S illustrated in . Step S illustrated in corresponds to step S illustrated in . Step S illustrated in corresponds to step S illustrated in .

The processing illustrated in corresponds to processing executed by the MFP in cooperation with the expense management apparatus server described in the broken line illustrated in .

The processing illustrated in is started from a displaying state of the main screen illustrated in by the MFP . In step S the authentication management application detects pressing of the expense information registration button on the main screen. In step S the authentication management application displays the expense information registration main screen illustrated in .

In step S on the expense information registration main screen the authentication management application of the MFP that has detected the pressing of a start button of each function checks whether logging in has been executed to the expense management apparatus . Determination is made by storing a flag indicating that authentication has been executed in the processing of step S and referring to the flag.

When it is determined that the authentication of the expense management apparatus has been completed YES in step S authentication processing is skipped. When not completed NO in step S in step S the authentication management application displays the log in screen to the expense management apparatus illustrated in .

The log in screen may always be displayed without executing authentication end determination of step S.

In step S on the log in screen of the expense management apparatus the MFP detects pressing of a button indicating a start of logging in. Then in step S the authentication management application transmits a log in request to the expense management apparatus via an expense management apparatus cooperation application .

The log in request includes an ID and a password acquired from the log in screen. In step S the authentication management application that has received a reply to the log in request to the expense management apparatus determines whether authentication has been successful based on information included in return data to the log in request.

In step S when it is determined that the authentication has been successful YES in step S a flag indicating the successful authentication is stored.

Processing of steps S to S in the case of the successful authentication is similar to that of steps S to S illustrated in and thus description thereof will be omitted.

The copy execution processing flow of MFP is similar to that illustrated in in the second exemplary embodiment and thus detailed contents will not be described.

The copy execution processing flow of MFP according to the second exemplary embodiment corresponds to the processing of the MFP described in the broken line of the execution function illustrated in .

The expense information registration processing flow of MFP in the second exemplary embodiment is similar to that illustrated in . This processing corresponds to the processing of the MFP described in the broken line of the expense information registration illustrated in .

The second exemplary embodiment has been described above. The second exemplary embodiment is advantageous in that when an operation is carried out for a plurality of different matters there is no need to start over from authentication processing by first logging out from the MFP .

Embodiments of the present disclosure can also be realized by a computer of a system or apparatus that reads out and executes computer executable instructions recorded on a storage medium e.g. non transitory computer readable storage medium to perform the functions of one or more of the above described embodiment s of the present disclosure and by a method performed by the computer of the system or apparatus by for example reading out and executing the computer executable instructions from the storage medium to perform the functions of one or more of the above described embodiment s . The computer may comprise one or more of a central processing unit CPU micro processing unit MPU or other circuitry and may include a network of separate computers or separate computer processors. The computer executable instructions may be provided to the computer for example from a network or the storage medium. The storage medium may include for example one or more of a hard disk a random access memory RAM a read only memory ROM a storage of distributed computing systems an optical disk such as a compact disc CD digital versatile disc DVD or Blu ray Disc BD a flash memory device a memory card and the like.

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all modifications equivalent structures and functions.

This application claims priority from Japanese Patent Application No. 2012 058654 filed Mar. 15 2012 which is hereby incorporated by reference herein in its entirety.

