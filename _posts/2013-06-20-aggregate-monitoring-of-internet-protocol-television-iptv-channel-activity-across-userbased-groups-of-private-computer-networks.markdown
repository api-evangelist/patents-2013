---

title: Aggregate monitoring of internet protocol television (IPTV) channel activity across user-based groups of private computer networks
abstract: A system for aggregate monitoring Internet Protocol television (IPTV) channel activity across user-based groups of private computer networks includes monitoring servers for monitoring private networks. Each private network has a monitoring server operable to receive multicast stream information from at least one switch on the private network, the multicast stream information indicating which ports of the at least one switch are joined to one or more multicast streams. A central server stores information associating users with a group of one or more of the private networks. The central server receives a request from a remote device via the WAN, determines the group of private networks associated with the requesting user, automatically generates a set of IPTV channel activity statistics according to only the statuses collected for each private network in the group associated with the requesting user, and sends the set of statistics to the remote device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09306798&OS=09306798&RS=09306798
owner: Guest Tek Interactive Entertainment Ltd.
number: 09306798
owner_city: Calgary
owner_country: CA
publication_date: 20130620
---
This application is a continuation of U.S. patent application Ser. No. 13 308 993 filed Dec. 1 2011 which claims the benefit of U.S. Provisional Application No. 61 425 876 filed Dec. 22 2010 and Canadian Patent Application No. 2 724 251 filed Dec. 22 2010. The disclosures of all of these applications are incorporated herein by reference.

The invention pertains generally to monitoring private computer networks. More specifically the invention relates to generating aggregate Internet Protocol television IPTV statistics across user based groups of private networks.

In order to keep up with ever increasing guest demands it is common practice in the hospitality industry to outsource technology requirements such as hotel high speed internet access HSIA and digital entertainment systems to an external vendor. Hoteliers benefit from reduced costs and installation times by purchasing a guaranteed turn key solution and are able to focus on their core business rather than wasting resources designing and supporting an in house entertainment system. External vendors profit from developing a robust customizable and feature extensive design and then selling it to multiple hotel properties.

A typical entertainment system involves a private local area network LAN installed within a hotel and separated from the public Internet using a gateway device. To provide adequate security the gateway generally includes firewall functionality and ensures only authorized guests of the hotel are allowed to access the Internet. The system may further provide other features including guest billing and bandwidth control and the private LAN may be combined with entertainment devices in the hotel such as in room set top boxes STBs to provide video on demand VOD and other capabilities to guests. In this way the vendor may provide the hotel with a fully featured network and entertainment system. Although the vendor may essentially be selling the same system to different hotels the onscreen look and feel and various features may be customized to allow hotels to differentiate themselves from competitors.

Because guest satisfaction may be negatively affected by poor in room HSIA and entertainment system performance it is desirable that the system provide feedback to the customer hotel regarding usage statistics and status information. This feedback may be helpful to the hotel when considering whether to upgrade the system. For example the hotel may wish to know what percentage of its Internet bandwidth pipe was utilized at peak times or how many VOD movies were ordered by guests at different times of the day. Likewise the hotel may also wish to know if there were any recent problems automatically detected by the system. To provide the hotel with feedback of the installed network different vendor systems currently include reporting tools such as daily email reports for summary statistics and or web based console access for real time statistics. In this way administrators of each hotel may monitor the status of the installed system.

One problem with the current state of the art is it is cumbersome for owners or administrators of multiple hotel properties to monitor the network statistics of all the properties under their supervision. For example a particular group of hotels may all be owned and administered under a single entity such as a common owner or chain headquarters. Because each hotel s system has a separate reporting tool that only concerns itself with monitoring devices on its own private network it is difficult to quickly observe the overall status of the entire group of properties as a whole. Also comparing individual statistics of devices of different hotel private networks is manually intensive as the desired data from each property must be collected and organized by an operator.

According to a configuration of the invention there is disclosed a system for aggregate monitoring of Internet Protocol television IPTV channel activity across user based groups of private computer networks. The system includes a plurality of monitoring servers installed on a respective plurality of private networks. Each private network includes at least one monitoring server operable to receive multicast stream information from at least one switch on the private network. The multicast stream information indicating which ports of the at least one switch are joined to one or more multicast streams. The system further includes a central server coupled to each of the monitoring servers for receiving the multicast stream information from the plurality of monitoring servers via a wide area network WAN . The central server includes a storage device storing information pertaining to a plurality of users the information respectively associating each of the users with a group of one or more of the private networks. The central server is configured to receive a request from a remote device via the WAN the request indicating a requesting user that issued the request and determine the group of private networks associated with the requesting user according to the information stored in the storage device. The central server is further configured to automatically generate a set of IPTV channel activity statistics according to the multicast stream information for only the group of the private networks associated with the requesting user and send the set of IPTV channel activity statistics to the remote device via the WAN in response to the request.

According to another configuration of the invention there is disclosed a method of aggregate monitoring of Internet Protocol television IPTV channel activity across user based groups of private computer networks. The method includes providing a plurality of monitoring servers installed on a respective plurality of private networks utilizing at least one monitoring server on each private network for receiving multicast stream information from at least one switch on the private network wherein the multicast stream information indicates which ports of the at least one switch are joined to one or more multicast streams and receiving by a central server the multicast stream information from the plurality of monitoring servers via a wide area network WAN . The method further includes storing information pertaining to a plurality of users the information respectively associating each of the users with a group of one or more of the private networks receiving a request at the central server from a remote device via the WAN the request indicating a requesting user that issued the request and determining the group of private networks associated with the requesting user according to the information stored in the storage device. The method further includes automatically generating a set of IPTV channel activity statistics according to the multicast stream information for only the group of the private networks associated with the requesting user and sending the set of IPTV channel activity statistics by the central server to the remote device via the WAN in response to the request.

These and other embodiments and advantages of the embodiments of the present invention will become apparent from the following detailed description taken in conjunction with the accompanying drawings illustrating by way of example principles of the invention.

To illustrate one beneficial application of the invention in this configuration each private network is located at a different hospitality property such as a hotel and each hotel may have contracted an external vendor to install and possibly support its private network . The private network at each hotel may provide guests and hotel staff with various high tech features including wired and wireless high speed Internet access HSIA in room video on demand VOD property management system PMS billing integration television TV based spa bookings television based room service ordering etc.

In this configuration a central status server is provided by the external vendor in order to store status records related to each of the hospitality properties that have purchased a private network from the external vendor. The central status server is coupled to the Internet to provide web based access of aggregate statistics based on user groups which may respectively associate each of a plurality of users with a group of one or more of the private networks . Providing users with different sets of statistics based on user based groups of hotel properties may be useful for example to allow a particular user who is an administrator or owner of a chain of multiple hotels to view web based aggregate statistics of the chain of hotels from any remote device coupled to the Internet .

In the following description the situation where the private networks are associated with hotels will be continued to provide an understanding of this beneficial application of the invention however the invention is also applicable to monitoring private networks in other applications and locations and it is a not a requirement of the invention that the private networks be located at hotels.

Referring to a gateway separates each private network from a wide area network WAN formed by for example Internet Service Provider ISP network and the Internet . Each ISP network may be controlled by a respective ISP network operations center NOC . The central status server is coupled to each of the gateways via the WAN and includes storage for storing information pertaining to a plurality of user groups and a plurality of status records . In one configuration each status record corresponds to one of the private networks and stores data recording changes of statuses over time for devices associated with the private network . In a preferred configuration to facilitate searching and storage efficiency the status records are stored as database records within a database stored at the central storage however in different configurations the status records may be stored in different ways such as each status record being stored as a file based status log for example.

As shown the devices monitored by the monitoring server may include any of the devices installed on the private network such as switches set top boxes STBs guest computing devices wireless access points APs and servers for example video on demand VOD server and property management system PMS server . These devices may be physically located anywhere within the hotel such as guest rooms the hotel lobby or server rooms. Additionally devices not directly connected to the private network but nonetheless associated with the private network may also be monitored such as the Internet pipe connection and ISP router . Any desired status aspects of any devices associated with the private network may be monitored.

Polling techniques by the monitoring server may be utilized to collect status information such as when the monitoring server polls each of the switches using simple network management protocol SNMP to determine which ports P P of each switch are currently in active use. Because the monitoring server in this example is included on the private network the monitoring server may directly poll the private addresses utilized by the devices on the private network . An advantage of this configuration is no holes in a firewall e.g. implemented by gateway protecting private network need be opened to allow an external SNMP manager to poll the devices installed on the private network . In other words by including the monitoring server on the private network the gateway may be configured to block network connection requests originating from the Internet which increases the security of the private network .

Another advantage of this configuration is there is no requirement to maintain a virtual private network VPN or other secure tunnel connecting an external SNMP manager to the devices installed on each of the private networks which further increases security of each private network while also allowing the allocation of private addresses assigned to the devices installed on each private network to be independent of the other private networks . By including a monitoring server on each private network each private network can utilize private IP addresses of devices without regard to the private IP addresses assigned to devices being monitored on other private networks. Unlike a VPN based monitoring solution in this configuration of the invention there is no need for an HSIA vendor to prevent conflicts between IP addresses assigned to devices being monitored across different hotels LANs. This is particularly beneficial when each private network is essentially a copy of the HSIA vendor s design. Hotel LANs may reuse the same private IP addresses for installed devices while still allowing aggregate statistics to be generated for devices monitored across any group of the hotel LANs by the central server .

In another example the monitoring server may collect status information by receiving updates from devices associated with the private network such as when the VOD server sends a message to the monitoring server indicating the number of movies that have been ordered by guests in a recent time period. Different types of devices and statuses of said devices may be monitored in similar ways and as changes are detected the recorded status data is updated accordingly. Again when the monitoring server is included on the private network communication between the devices installed on the private network and the monitoring server only needs to use private IP addresses of the private network . Alternatively the monitoring server may be located off the private network . As firewalls are often preconfigured to allow outgoing connection requests from the private network toward the Internet an offsite monitoring server may be able to receive updates from devices installed on the private network without requiring any additional rules be configured in a firewall protecting the private network .

Step may also be modified in other configurations such that some or all of the monitoring servers transfer their recorded status data to the central server when the central server makes a specific request. For example to avoid becoming overloaded when the monitoring servers at a plurality of hotels send reports at substantially the same time the central server may instead periodically poll the monitoring server at each private network via the WAN and download a newer portion of the data indicating the changes recorded at the monitoring server since a previous time the central server successfully polled the monitoring server .

Continuing the flowchart shown in in this example the central status server performs the following steps 

The bandwidth availability column indicates how many properties are at each percentage for both receive bandwidth availability and transmit bandwidth availability. For example a particular hotel private LAN may be coupled to an ISP network by a connection having a maximum of 6 Mbps receive bandwidth capacity and the same for transmit bandwidth capacity. In the event that at least eighty one percent of that capacity is available for reception of information from the WAN that property will be included in the number on the 100 81 row in the Receive column of column . If the property has 20 utilization of receive bandwidth then it would be listed in the 80 61 row and so on. Similarly the numbers of properties that have private LANs meeting the various percentages for transmit bandwidth are also listed in column .

Core network availability column indicates the number of properties that are at each percentage in terms of core network availability. In this example core network availability corresponds to the switches and possibly a digital subscriber line access multiplexer DSLAM for private networks having such equipment. The percentage of properly functioning switches and DSLAM units with respect to the total number of switches and DSLAM units associated with each private network determines on which row the property will be counted. It should also be noted that the total number of properties indicated in column does not add up to thirty i.e. the total number of private networks in the first user group because five private networks in this example do not have any managed switches or DSLAM equipment to monitor. This may be the case when a particular private network includes only unmanaged hubs and does not use DSL for example.

The wireless network availability column indicates how many properties are at each percentage in terms of availability of the wireless APs and the digital subscriber line DSL column indicates the number of properties at each percentage in terms of digital modem availability. Again the sum of all properties in these columns may not sum to the total number of properties in the first user group when not all private networks in the group include wireless APs or have DSL modems.

Although in the examples of to the various aggregate statistics are presented as being related to hospitality properties the statuses of each property are actually collected by the monitoring servers from devices associated with the private networks . The property name may be utilized to help the requesting user correlate the various private networks to their corresponding properties . In other configurations the statistics of UI screens may be presented using other names to identify the private networks rather than property name for example private network ID numbers corporation names department names faculty numbers etc.

Step may be modified so that instead of or in addition to alarm messages the central server may perform other actions when an alarm condition is met for a particular group . For example if the alarm condition involves exceeding a receive bandwidth threshold the action may involve issuing a command to the appropriate ISP NOC to dynamically increase the bandwidth of connection . Likewise when the receive bandwidth utilization is lower than a threshold the central server may send a command to the ISP NOC to dynamically lower the bandwidth of connection for example. Dynamically raising and lowering the bandwidth of connection may be beneficial to help hotels or owners of hotels save costs during certain times of day based on load for example.

Specifically in this example the plurality of central servers includes a first central server e.g. located at Calgary a second central server e.g. located at San Jose and a third central server e.g. located at Washington D.C. . Three central servers are chosen in this example in order to monitor devices installed on private LANs at hotels throughout North America however the invention is not limited to only three central servers or to distributing the central servers throughout North America. Other numbers of central servers and associated locations may be employed in other configurations according to application specific design requirements.

In this example each hotel LAN is served by a local domain name service DNS server included either on the hotel LAN as illustrated in or off the hotel LAN such as provided by an Internet Service Provider ISP that provides the hotel s Internet connection. The DNS servers are configured with the IP address of each of the central servers for example each DNS server is configured with a plurality public IP addresses on the Internet that correspond to the plurality of central servers . The central servers are also associated with a common URL such as central server.example.com for example.

To determine a nearest central server the DNS servers are configured to periodically send a message such as a ping request to the IP address of each of the central servers . By measuring the time it takes each central server to reply to the message the DNS servers may thereby determine the nearest central server as the one having the quickest response time. The central server nearest a particular hotel may change over time because nearest is defined in this example as having the quickest message response time i.e. the quickest communication path which may change over time due to network congestion. Additionally the central sever determined to be nearest a particular hotel LAN may change due to central server availability server and network load severed network links etc. Each DNS server periodically associates the IP address of the central server having the quickest response time with the common URL utilized by the central servers .

In order to send communications related to collected status information of a particular hotel LAN to the nearest central server a monitoring server of the particular hotel LAN first performs a DNS lookup on the common URL utilized by the central servers e.g. central server.example.com in this example to resolve the IP address of the nearest central server . The DNS server serving the particular hotel LAN returns the IP address having the quickest message response time e.g. quickest ping response time which corresponds to the nearest central server .

A plurality of monitoring servers may all send communications related to the collected statuses to a same selected one of the central servers . For example as illustrated in one or more monitoring servers that have quick communication with the first central server send communications related to the collected statuses to the IP address of the first central server . Similarly one or more monitoring servers that have quick communication with the second central server send communications related to the collected status to the IP address of the second central server and one or more monitoring servers that have quick communication with the third central server send communications related to the collected statuses to the IP address of the third central server . The monitoring servers may cache the IP address of the selected central server for a predetermined time period and then re query the local DNS server in order to accommodate changes to the selected central server . Additionally in another configuration the above described DNS server functionality to determine the selected e.g. nearest central server may be included within one or more monitoring servers rather than utilizing an external DNS server .

Because the system includes a plurality of central servers each receiving communication related to collected statuses for a number of monitoring servers the system is capable of being scaled to monitor devices installed on a large number private networks e.g. hotel LANs in this example while avoiding the problems associated with operating system limits on the number of open network connections e.g. TCP connections that may be made on a single server. Server load and network traffic is also distributed over the plurality of central servers and the system is efficient because each monitoring server communicates with the nearest central server having the fastest network communications path i.e. as measured by recent message response times .

In another configuration the system evenly shares server load across the central servers by configuring the DNS servers to rotate through the IP addresses of the various central servers rather than always returning the IP address of the central server that has the quickest message response times. The DNS servers may still be configured to ping the IP address of each central server however in this configuration each DNS server then cycles e.g. in a round robin order through the IP addresses of the central servers that replied to the ping in order to select one of the central servers . In this way load and network traffic will tend to be evenly spread across the central servers that are currently available while automatically ignoring any central servers that become unavailable for whatever reason. Again in another configuration the above described DNS server functionality to cycle through the IP addresses of the currently available central servers may be included within one or more monitoring servers rather than utilizing an external DNS server .

In an advantageous application of the system a hospitality HSIA vendor may monitor thousands or even tens of thousands of separate hotel LANs each having thousands of installed devices of different types such as STBs switches servers access points etc. Each of the vendor s customers may also utilize the system to request and automatically receive statistics generated according to only the hotel LANs for which the customer is authorized i.e. for only the hotel LANs that are associated with the requesting customer . By deploying a plurality of central servers each only needs to accept a fraction of the communication related to collected status information of the entire collection of hotel LANs . Additionally should one of the central servers become unavailable i.e. server failure scheduled maintenance natural disaster or other downtime the DNS servers automatically stop resolving the common URL used by the central servers to the public IP address of the unavailable central server because the unavailable central server will not reply to message requests e.g. ping requests . In this way the system is also robust in that it automatically takes into account and recovers from the unavailability of any of the central servers .

In an example configuration of the second and third central servers maintain VPN connections with the first central server and may therefore access and store status records and user information in storage device . In another example configuration including the dot dash lines of the information stored in the first storage device such as user groups and status records is automatically replicated and stored locally at each of the central servers i.e. in storage device and storage device . A VPN connection may also be maintained between the second and third central servers to allow the information in the storage devices to be replicated without involvement of the first central server . As all central servers include a storage device storing substantially the same information this configuration of system beneficially does not include a single point of failure that would prevent the system from interacting with requesting users or with the monitoring servers .

A user such as a manager of a chain of hotels may employ a remote device at any location on the Internet to send a request to any selected central server for example the nearest central server determined using the same DNS technique as explained above . The request indicates the requesting user that issued the request such by including a username password or other identification information. The central server receives the request from the remote device via the WAN and determines the group of hotel LANs associated with the requesting user according to the information stored in the storage device accessed either directly or over one of VPNs . The central server then automatically generates a set of statistics according to only the statuses collected for each private network in the group associated with the requesting user and sends the set of statistics to the remote device via the Internet in response to the request.

The SNMP trap forwarder receives SNMP traps on the standard SNMP trap port i.e. well known port and forwards them according to applicable destination s specified in the OID destination table . This allows more than one device or service to receive and react to a single trap that may originate from devices on the private network that include SNMP agents such as switch and satellite QAM appliance in this example.

Column Trap OID Indicates trap OIDs of interest that may be received from one or more originating SNMP agents .

Column Event description Indicates an English description of the event that caused the trap. This field may be useful to help human administrators quickly understand the significance of each particular trap OID.

Column Applicable destination s Identifies the applicable destinations to which the trap should be forwarded. As shown some traps are applicable to one or more ports A B on the monitoring server which in this example correspond to first trap listener on port A and the second trap listener on port B. Ports A and B in this description are shorthand for design specific port numbers for example each of the trap listeners may be bound to unused port numbers of monitoring server . Some traps may also be applicable to one or more external destinations such as identified by URLs IP addresses and or ports designations for example.

Continuing the explanation of assuming the SNMP agent of switch sends a trap to port of the monitoring server indicating that Ethernet port has been unplugged the trap forwarder queries OID destination table to thereby determine that this trap OID has applicable destinations in column being Port A and Port B . The trap forwarder forwards the trap to both of the specified ports A B thereby allowing the first and second trap listeners to respectively pass the same trap to the monitoring service and the other service .

According to the received trap the monitoring service may update the recorded status data indicating the change in Ethernet port status of the switch . Monitoring service may then send a report indicating this change to the central server via the Internet . The report may be sent immediately or at a future time as determined by the monitoring service or the central server . Sending the report to the central server is beneficial to allow the central server to generate statistics related to the number of active switch ports across a group of hotel LANs including the private network .

Additionally because the trap forwarder also forwarded the trap to port B utilized by the second trap listener another service may also take appropriate action according to the trap. In this way a monitoring server and or monitoring service may be added to an existing hotel LAN or existing server on hotel LAN and begin receiving and monitoring traps while still allowing any devices and or other services that were already receiving and reacting to the traps to continue to do so. For example when the other service is the hotel s HSIA service a trap indicating that a guest has unplugged the Ethernet cable from a particular switch may cause the HSIA service to reset the switch to default security levels on the affected port. This is beneficial to allow the HSIA service to remove additional security privileges that may have been associated with the port of the switch as a result of an IEEE 802.1X authentication performed by user laptop when it was originally plugged in to that port. The trap forwarder included in the monitoring server allows other services to continue to receive traps that form a part of the statuses collected by the monitoring service .

The monitoring service in this configuration also tracks the statuses of devices installed on the private network by scanning the connection tracking table which may be maintained by an operating system kernel of the monitoring server . By integrating the gateway NAT proxy firewall services s and the monitoring service on a same server the monitoring service may beneficially access the connection tracking table . The gateway NAT proxy firewall services s track information related to connections between the Internet and the hotel LAN in the connection tracking table and this information may be exposed by the kernel of the operating system and accessed by the monitoring service . For example a TCP connection may be listed in the connection tracking table as follows 

The monitoring service may perform a reverse IP lookup to determine what company or domain is tied to the destination IP address which according to this example data results in the following 

Therefore the monitoring service and or central server may automatically determine that at the time the sample data was collected from the connection tracking table the user of exemplary device having source IP address 172.20.8.83 was checking their email through Hotmail and accessing it through a web browser because the connection was made on port . The monitoring service may automatically sample this connection data in the connection tracking table over time and thereby observe the number of packets and bytes increment as the user device sends receives data from the Hotmail server.

The monitoring service may monitor other statistics related to Internet activity of the devices on the private network from the connection tracking table . For example by tracking all the various connections a summary of connections for the private network may be determined by the monitoring service such as 

A connection is not necessarily the same as a user because it depends on the application that the user is using. For example if a guest is torrenting the nature of how torrents work will involve the user s device opening multiple connections to multiple hosts. The monitoring service may correlate connections to individual users or guest rooms or zones in a hotel by cross referencing address information in the connection tracking table with other services running on the monitoring server such as the HSIA service. For example during a hotel s HSIA login procedure a guest may need to authenticate their laptop from a particular hotel room and the HSIA service may store a record that the IP address of the laptop is associated with the particular hotel room from which it was authenticated.

In an example configuration the monitoring service periodically scans the connection tracking table to thereby monitor and collect statuses of the various devices on the private network that are utilizing the Internet. The collected status information includes how many devices are utilizing the hotel s Internet connection what type of web services are being utilized e.g. HTTP SSH VPNs etc how much data is being sent and received per device user room the number of devices per individual user and the Internet destinations that are being accessed.

Recorded status data is thereafter sent by the monitoring service to the central server for use in generating statistics across various groups of hotel private networks. The central server groups the data in a user friendly way in order to present summarized user specific views of the data in response to requests made by requesting users. This involves the central server automatically generating a set of statistics according to status information collected from the connection tracking table on the monitoring server s for each private network in the group associated with a particular requesting user and then sending the set of statistics to a remote device utilized by the particular requesting user.

In this example when a satellite QAM appliance on the hotel s LAN detects a fault with a particular channel the QAM appliance sends a single SNMP trap message to port of the monitoring server . The trap forwarder receives the trap and forwards the trap to port A on the monitoring server because only port A is listed as an applicable destination in column of the OID destination table for this trap OID.

The trap listener on port A then passes the trap to monitoring service which notes the status change for the specified satellite channel in recorded status data . The monitoring service sends a report to the central server and the report includes data showing that the specified satellite channel experienced a receive fault at that particular hotel LAN . A similar process may also occur at other hotels and the central server receives similar reports from the monitoring servers included on the other hotel s LANs .

As shown in twenty five SNMP traps reporting a receive fault with Channel 7 have been received by the central server in the last ten minutes across the requesting user s group of twenty five hotel LANs which corresponds to one fault per hotel LAN in this example. The central server may thereby determine that the fault is affecting the whole group of properties associated with the requesting user and issue a notice to that effect. This is beneficial to allow a hotel chain administrator to quickly observe that there is a problem affecting devices across all hotel properties in the chain and to take corrective action. An automatic alert may also be configured to detect this condition and send a message to a user specified destination when the condition is detected such as described above with respect to .

Rows and may be determined according to the dport values of connections in the various connection tracking tables for the hotel LANs in the requesting user s group of hotel LANs . For example row shows the percentage of total users i.e. hotel guests and the percentage of the hotel LANs in the requesting user s group that have least one user currently browsing Internet websites. This may be determined according to the number of connections having dport set to port in the various connection tracking tables and the number of logged in HSIA users across the requesting user s group of hotel LANs . Similarly row shows the hotel user and hotel LAN percentages for VPN activity which may be determined by looking for connections having dport set to well known VPN port numbers such as port point to point tunneling protocol PPTP port Internet security association and key management protocol ISAKMP port layer 2 tunneling protocol L2TP port OpenVPN etc. Finally row shows the hotel user and hotel LAN percentages for bit torrent activity which may be determined by looking for connections having dport set to well known bit torrent ports such as for example.

Rows and may be determined by the central server performing reverse IP lookups i.e. whois searches on destination address dst values of connections in the various connection tracking tables for the hotel LANs in the requesting user s group. Row may also be determined by tracking all the IP addresses used by the well known e mail providers and row may also be determined by tracking all the IP addresses used by the well known video streaming providers.

Row separates the various hotel users across the requesting user s group of hotel LANs into bandwidth levels and then indicates how many hotel users at each bandwidth level are using greater than 90 of their allocated bandwidth. In one configuration each monitoring server periodically scans the connection tracking table to determine the number of bytes sent on each connection and then correlates the source destination IP addresses with particular hotel users and their registered bandwidth allocations i.e. as selected or purchased during a hotel HSIA sign on process . Again this information is recorded by each monitoring server and passed to the central server which may then generate a corresponding set of statistics showing the bandwidth usage by hotel guests across the requesting user s group of hotel LANs .

Row shows user and hotel LAN percentages representing multiple devices that were logged in under a single user which may correspond to a single guest registered in a hotel room for example . This information may be gathered at each hotel by the monitoring service polling an HSIA service e.g. other service in or may be determined by scanning connection tracking table and cross referencing the various IPs with their registered hotel user s according to other services such as a HSIA login server. Again this information is recorded by each monitoring server and passed to the central server which may then generate a corresponding set of statics showing the aggregate statistics across a group of hotel LANs .

In one configuration the recorded status data utilized to generate UI screen is obtained by the monitoring server on each hotel LAN polling the various STBs in the guest rooms in order to determine what channels they are currently viewing. In another configuration the STBs may send information to the monitoring server as guests tune to and tune away from specific IPTV channels. In both cases the monitoring server then passes this information to the central server for use in generating statistics for user based groups of hotel LANs.

As standard STBs may not necessarily include functionality to support monitoring IPTV usage in another configuration the monitoring service polls various switches on the hotel LAN to determine which ports on each switch and therefore which STBs and or guest rooms are joined to which IP multicast streams. This technique is also beneficial when IPTV is streamed to user devices brought by guests at the hotel as these user devices will not be capable of sending reports to the hotel s monitoring server .

Taking the block diagram shown in as an example the monitoring server may utilize SNMP to poll each of the intermediate distribution frame IDF switches on the hotel s private LAN . Only the IDF switches need to be polled in this example because these are the switches that have ports connected to STBs and or user devices in the guest rooms . Other switches on the LAN such as the core switch need not be polled as no ports of the core switch are directly connected to equipment such as STBs in the guest rooms .

Column Switch ID Stores an identifier of each managed IDF switch being the private IP address of the switch on the private LAN in this example.

Column Multicast channel Indicates each of the possible multicast group IP addresses available in the hotel. In this example each multicast group corresponds to an administratively scoped local multicast addresses e.g. in the form 239.XXX.XXX.XXX corresponding to a single TV channel which may be transmitted by a server e.g. video server functionality included in VOD server installed in the hotel. In another configuration each multicast group may correspond to a globally scoped Internet wide multicast address e.g. in the form 224 238.XXX.XXX.XXX corresponding to a single TV channel as transmitted by a video server located elsewhere on the Internet .

Column Port s Stores each port that is connected to at least one host that has joined the multicast channel specified in column . In this example the hosts are either STBs and or user devices however in general a host may refer to any device that is capable of joining a multicast channel in order to watch streamed IPTV.

To collect and or update the recorded status data shown in the monitoring server in this configuration queries each IDF switch to determine which if any ports are connected to a host that is joined for each IPTV multicast group available on the hotel LAN . For example assuming there are IPTV channels available to guests in the hotel the monitoring server queries the first IDF switch to determine which ports are associated with the multicast group for TV channel 1 . In this example no ports of the first IDF switch are associated with the multicast group for TV channel 1 and the first row of the recorded status data is updated to show a in column meaning no ports associated with multicast channel . Next the monitoring server queries the first IDF switch to determine which ports are associated with the multicast group for TV channel 2 . In this example three ports i.e. 3 5 and 2 in are associated with TV channel 2 which means that at least one device connected to each of these ports is viewing the channel. In a typical hotel installation each port will be connected to a single STB or user device in a specific guest room . The monitoring server continues the same procedure to query the first IDF switch to find out which ports are associated with each of the remaining multicast groups. The monitoring server then repeats the process for each of the remaining IDF switches on the private LAN . In an alternate configuration the monitoring server may send SNMP queries to cycle through each port on each IDF switch to determine which multicast channels are currently associated with each port. Using either configuration a hotel s monitoring server can take a snapshot of current IPTV channel usage by guests at the hotel. The process may be repeated by the monitoring server at a designated interval to monitor for IPTV usage changes over time. If supported by the switch manufacture an SNMP trap may be configured at the switch to notify the monitoring server when a port is either newly associated with or newly dissociated with a particular multicast channel. This is beneficial to reduce load and network usage from unnecessary polling.

The monitoring server at each private LAN repeatedly passes the recorded status data to the central server which may then generate an updated set of statics showing the aggregate statistics across a group of hotel LANs such as the UI screen shown in . In this way an administrator of a chain of hotels may view statistics showing the percentage of hotel guests across a chain of hotels watching a particular channel and the percentage of hotels belonging to the chain having at least one user watching the particular channel. Other fields such as average time spent on each channel may also be tracked in other configurations.

In another configuration rather than the IDF switches the monitoring server may instead query the core switch to determine which ports are transmitting a particular multicast channel or to determine which multicast channel s are being transmitting on each particular port. Although the count of how many users are watching a particular IPTV channel is unavailable with this method the monitoring server may continue to determine whether a particular IPTV channel is currently being viewed by at least one guest at the hotel which may be sufficient in some applications. This configuration is also advantageous when only the core switch is managed and therefore the monitoring server is unable to query the IDF switches or where there are no IDF switches and or when the hotel LAN makes significant usage of wireless Aps .

One advantage of the present invention with respect to the hospitality market is that an external system provider may sell substantially the same private network design to different properties while giving multi property owners and administrators custom access to aggregate statistics including multiple private networks . The aggregate monitoring is scaleable and no provisions or advance planning are required to allow a plurality of independent private networks to be later monitored as a group. For example as an owner switches over additional hotels to the external vendor s design the group of private networks associated with the owner is adjusted to include the private networks for the new hotel properties. In this way the aggregate statistics automatically include the new properties and any alarms or other actions previously configured now automatically apply to the new hotels without requiring additional configuration on the part of the owner. Comparing individual statistics of devices on different private networks is also greatly simplified because the owner may utilize a single web interface to choose any number of aspects of the various properties to compare.

In the above description the term private network includes computer networks that use private IP address space as set by RFC 1918 and RFC 4193 which are each incorporated herein by reference. These addresses are not globally assigned or allocated to any specific organization. IP packets addressed to a private IP address are not transmitted onto the public Internet and these address ranges may be utilized without approval from a regional Internet registry RIR . As shown in and private networks may be coupled to the Internet using a network address translator NAT gateway . A proxy server not shown could also be used for this purpose. One advantage that may be obtained by including at least one monitoring server on each private network is the private networks need not be integrated with each other in any way. For example the private IP address sub ranges and even specific private IP addresses of devices utilized on each separate private network may be exactly the same while still being monitored in an aggregate fashion. No consideration need be made by either the external vendor or the hotels about whether the various private networks are compatible with each other such as may be required if trying to create a virtual private network VPN to join or tunnel between different private networks . Each monitoring server may be configured to send reports to a same public IP address or universal resource locator URL corresponding to the central server . Including a monitoring server on each private network also reduces the load on the central server because the central status server only needs to receive record status data from each monitoring server rather than all the individual devices that need to be monitored on all the private networks .

The invention may be beneficially employed to allow different users such as a service provider and the service provider s customers to monitor aggregate statistics generated according to statuses of devices collected for user based groups of private networks. The service provider may deploy and monitor any number of independent private networks while also allowing each particular customer to access a set of statistics generated by a central server according to the group of private networks that are under that particular customer s control. By limiting the statistics generated by the central server to only the private networks in the group of private networks associated with the requesting user that issued the request both the service provider and the customers may benefit from the aggregate monitoring performed by the system and confidentially is ensured between different customers. By including a monitoring server on each private network for collecting statuses of devices installed on the network there are no VPNs required to integrate between different private networks and no advanced planning is required to ensure that devices on one private network do not conflict with devices on other private networks.

In summary a system for aggregate monitoring of private computer networks includes a plurality of monitoring servers for monitoring a plurality of private networks. Each private network has at least one monitoring server configured for monitoring the private network by collecting statuses of devices associated with the private network. A central server is coupled to each of the monitoring servers via a wide area network WAN and stores information pertaining to a plurality of users. The information associates each of the users with a group of one or more of the private networks. The central server may receive a request from a remote device via the WAN determine the group of private networks associated with the requesting user automatically generate a set of statistics according to only the statuses collected for each private network in the group associated with the requesting user and send the set of statistics to the remote device.

Although the invention has been described in connection with a preferred embodiment it should be understood that various modifications additions and alterations may be made to the invention by one skilled in the art without departing from the spirit and scope of the invention as defined in the appended claims. For example although the description of the invention has been described as being utilized at a plurality of hotel properties the present invention is equally applicable to other hospitality related locations and services such as hotels motels resorts hospitals apartment townhouse complexes restaurants retirement centres cruise ships busses airlines shopping centers passenger trains etc. Similarly the present invention is also useful for monitoring private networks outside the hospitality industry such as monitoring private corporate networks. As such the words guest staff administrator manager customer vendor user and the like in the above description are meant to help the reader with an understanding of the invention in one example context only. In actual practice their meanings should be expanded to encompass other users and situations including where one or more refer to the same person or entity. It is also not necessary that a single external vendor manage all the private networks instead each private network and the central status server may be managed by one or more different entities. A monitoring server may also be added to any existing private network to include statuses of devices associated with that private network in the aggregate statistics generated by the central status server.

One or more processors not shown may operate pursuant to instructions stored on a machine readable storage medium to provide the functions as described for each of the monitoring and central servers. The functions of the monitoring server s and the central server s may also be combined integrated separated and or duplicated to support various applications. Also a function described herein as being performed at a particular device may be performed at one or more other devices instead of and or in addition to the function performed at the particular device.

In addition to a dedicated physical computing device the word server may also mean a service daemon on a single computer virtual computer or shared physical computer or computers for example. The words periodically repeatedly and intermittently are used in an interchangeable manner. The various separate configurations elements modules features and steps of the invention described above may be integrated or combined into single units. Similarly functions of single units may be separated into multiple units. Unless otherwise specified features described may be implemented in hardware or software according to different designs. All combinations and permutations of the above described features configurations and examples may be utilized in conjunction with the invention.

