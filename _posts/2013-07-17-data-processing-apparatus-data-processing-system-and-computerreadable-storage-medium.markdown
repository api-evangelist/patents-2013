---

title: Data processing apparatus, data processing system, and computer-readable storage medium
abstract: A data processing apparatus includes an assignment database. The assignment database includes a user-information registration unit configured to collect pieces of user information about users authorized to operate a plurality of information processing apparatuses, and register each piece of user information and an identifier assigned to the corresponding user in association with each other; an output destination association table in which each piece of user information is associated with a printing apparatus that is to be an output destination; and an output-destination determining unit configured to determine the output destination of the output data by referring to the user-information registration unit and the output destination association table.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09013743&OS=09013743&RS=09013743
owner: Ricoh Company, Limited
number: 09013743
owner_city: Tokyo
owner_country: JP
publication_date: 20130717
---
The present application claims priority to and incorporates by reference the entire contents of Japanese Patent Application No. 2012 164576 filed in Japan on Jul. 25 2012 and Japanese Patent Application No. 2013 122240 filed in Japan on Jun. 10 2013.

The present invention relates to a data processing apparatus a data processing system and a computer readable storage medium.

Some conventionally known automatic print destination assignment systems automatically determine an output destination printer according to a predetermined rule and perform printing. To cause the system to operate as such what is required of a user is only to select one virtual printer driver via an application and perform printing rather than selecting an output destination. Examples of such a system is disclosed in Japanese Laid Open Patent Application No. 2010 157208 No. 2011 002881 and No. 2011 008582.

To introduce an automatic print destination assignment system to a multi vendor environment where printers having different print functions are coresident it is necessary to avoid an undesirable situation that print settings accepted from a user cannot be enforced onto a determined output destination printer. In this regard conventional automatic print destination assignment systems have adapted to a multi vendor environment by providing a print setting user interface UI that accepts only print settings relating to basic function common among all vendors function corresponding to public member of a DEVMODE structure . However this scheme requires to forgo utilizing function specific and inherent to each vendor function corresponding to private member of the DEVMODE structure and therefore considerably impairs usability.

Therefore there is a need to provide a data processing apparatus a data processing system and a computer readable storage medium that allow in assignment of a print destination in a multi vendor environment setting not only print settings relating to basic function common among all vendors but also print settings relating to function specific and inherent to each vender.

It is an object of the present invention to at least partially solve the problems in the conventional technology.

According to an embodiment there is provided a data processing apparatus connected over a network to a plurality of information processing apparatuses and a plurality of printing apparatuses to create output data in response to a print request from any one of the information processing apparatuses and then to transmit the output data to an automatically determined output destination. The data processing apparatus includes an assignment database configured to determine the output destination of the output data and a first print processing unit including a displaying unit the first print processing unit being configured to set print settings based on an input entered via a print setting screen and determine the output destination in accordance with determination made by the assignment database. The assignment database includes a user information registration unit configured to collect pieces of user information about users authorized to operate the information processing apparatuses and register each piece of user information and an identifier assigned to the corresponding user in association with each other an output destination association table in which each piece of user information is associated with a printing apparatus that is to be an output destination and an output destination determining unit configured to determine the output destination of the output data by referring to the user information registration unit and the output destination association table. The display unit is configured to notify the output destination determining unit of the identifier contained in a request for displaying the print setting screen. The output destination determining unit is configured to determine the output destination by referring to the user information registration unit and the output destination association table based on a piece of user information associated with the notified identifier. The displaying unit is configured to acquire print setting data from a second print processing unit and display the print setting screen by using the print setting data the second print processing unit being configured to control the printing apparatus determined by the output destination determining unit.

According to another embodiment there is provided a non transitory computer readable storage medium with an executable program stored thereon and executed by a computer connected over a network to a plurality of information processing apparatuses and a plurality of printing apparatuses to create output data in response to a print request from any one of the information processing apparatuses and then to transmit the output data to an automatically determined output destination. The program instructs the computer to perform setting by a first print processing unit including a displaying unit print settings based on an input entered via a print setting screen and determining by the first print processing unit the output destination of the output data in accordance with determination made by an assignment database. The assignment database includes a user information registration unit configured to collect pieces of user information about users authorized to operate the information processing apparatuses and register each piece of user information and an identifier assigned to the corresponding user in association with each other an output destination association table in which each piece of user information is associated with a printing apparatus that is to be an output destination and an output destination determining unit configured to determine the output destination of the output data by referring to the user information registration unit and the output destination association table. The display unit is configured to notify the output destination determining unit of the identifier contained in a request for displaying the print setting screen. The output destination determining unit is configured to determine the output destination by referring to the user information registration unit and the output destination association table based on a piece of user information associated with the notified identifier. The displaying unit is configured to acquire print setting data from a second print processing unit and display the print setting screen by using the print setting data the second print processing unit being configured to control the printing apparatus determined by the output destination determining unit.

According to still another embodiment there is provided a data processing system that includes one or more information processing apparatuses one or more printing apparatuses and a data processing apparatus. The information processing apparatuses the printing apparatuses and the data processing apparatus are connected over a network. Each of the data processing apparatuses includes a virtual UI unit configured to create an image containing items for setting advanced print settings the advanced print settings being print settings that depend on any one of the printing apparatuses that is an output destination a print setting storing unit configured to store the advanced print settings received by the virtual UI unit via the image a creating unit configured to receive image data and create a print job a remote driver configured to convert the image data contained in the print job into data that is receivable by the printing apparatus and output the converted data as output data and an advanced print setting changing unit configured to change the output data according to the advanced print settings in a case where the advanced print settings to be applied to the output data are stored in the print setting storing unit when the output data is output from the remote driver.

The above and other objects features advantages and technical and industrial significance of this invention will be better understood by reading the following detailed description of presently preferred embodiments of the invention when considered in connection with the accompanying drawings.

Embodiments of the present invention are described below however the present invention is not limited to the embodiments described below. In the drawings to be referred to in the following description identical elements are denoted by like reference numerals and repeated descriptions are omitted as appropriate.

The network print system may employ any one of a client server environment and a thin client environment in the first embodiment. When the client server environment is employed each of the clients on which an application program is installed issues a print request relating to a processing result of the application to the data processing apparatus .

On the other hand when the thin client environment is employed application is not installed onto the clients but installed onto the data processing apparatus . In this case the client issues a service request to the data processing apparatus in accordance with an appropriate remote connection protocol such as a remote desktop protocol RDP and issues a print request relating to a result of execution of the application installed onto the data processing apparatus .

The data processing apparatus of the first embodiment creates output data in a raw form hereinafter referred to as raw data or output data from print data relating to the print request received from the client . The data processing apparatus also automatically determines the remote printer that is to be an output destination by a procedure which will be described later and transmits the created raw data to the determined output destination.

The network print system of the first embodiment has been outlined above. A specific configuration of the data processing apparatus of the first embodiment is described below with reference to .

The data processing unit includes a virtual printer driver a job storing unit for storing therein a print job as a spool file an image processing unit and an assignment database .

The virtual printer driver which may be referred to as a first print processing unit includes a virtual print managing unit a print setting information extraction unit a virtual renderer a virtual UI unit and a print setting storing unit . The assignment database includes an output destination determining unit a user information registration unit and an output destination association table .

A basic configuration of the data processing apparatus of the first embodiment has been outlined above. Processes to be executed by the functional units of the data processing unit when a user instructs to print a file output as a result of execution of the application are described below step by step.

First the user logs in to the data processing apparatus by operating the client . As a result a session is established between the client and the data processing apparatus . At this time an operating system OS installed onto the data processing apparatus temporarily assigns an identifier that is unique in the data processing apparatus to the user involved in the established session. Such an identifier is a known identifier referred to as a user identifier UID a session ID or the like. The OS holds the identifier temporarily assigned to the login user and login user s properties hereinafter user information associated with each other while the session is maintained. Hereinafter this identifier is referred to as UID .

In the first embodiment the user information held by the OS is the login user s properties acquirable by the OS at logging in of the user. Examples of the user information include a user name account name of the login user a name of a group to which the login user belongs a name of a domain or an organization in which the login user participates in Active Directory or the like and a computer name an IP address a MAC address and the like of the client operated by the login user.

The user information registration unit of the assignment database is continuously monitoring user information of the login user held by the OS. The user information registration unit collects predetermined at least one item from the user information and registers the item in a user information table.

The user information collected by the user information registration unit is used later in determination of an output destination. An administrator can set the item user information for use in determination of the output destination as desired. The user information registration unit collects and registers the item set by the administrator.

The user logged in to the data processing apparatus issues a service request to the application by operating the client . The application executes a predetermined process in response to the service request from the client and outputs a result of the execution as a file.

Subsequently the user calls a print setting UI which may be referred to as a print setting screen hereinafter referred to as print dialog from the application by operating the client to give an instruction to print the file of the result of execution of the application . The application issues a print dialog display request to the virtual UI unit which may be referred to as a display unit in response to the call from the user. In response to the display request the virtual UI unit called by the virtual print managing unit provides the print dialog by the following procedure.

The virtual UI unit first makes inquiry for a dispatch destination by notifying the assignment database of the UID of the request source contained in the print dialog display request.

The assignment database searches through the user information table using the UID notified from the virtual UI unit as a search key. If the UID notified from the virtual UI unit is 00213 the output destination determining unit acquires user name Saitoh that is associated with the UID 00213 .

The output destination determining unit then searches through the output destination association table using the user information Saitoh acquired from the user information table as a search key.

As a result of the search through the output destination association table using the user name Saitoh as the search key the output destination determining unit determines the remote printer associated with the user name Saitoh as an output destination and returns printer information of the remote printer and the UID 00213 to the virtual UI unit .

The virtual UI unit holds the printer information that is returned from the assignment database and associated with the UID 00213 in a temporary storage. The virtual UI unit acquires a printer driver name Printer Driver a contained in the printer information dynamically acquires a DEVMODE structure which is a data structure for print settings from a remote driver associated with the printer driver name and sets the DEVMODE structure to the print setting storing unit .

Subsequently the virtual UI unit provides a print dialog by utilizing the DEVMODE structure acquired from the remote driver . This DEVMODE structure contains function specific to the remote driver function corresponding to private member . Therefore a print dialog configured to allow setting the function e.g. embedded pattern printing specific to the remote driver is displayed on a screen of the application utilized by the user Saitoh .

When in response thereto a desired print function is selected via the print dialog where the user Saitoh is displayed and a print execution button is clicked a print instruction event is generated. In response to the print instruction event the application creates image data relating to the execution result file by calling an application programming interface API such as a graphical device interface DGI .

In response to the print instruction event the virtual UI unit sets print settings by utilizing the DEVMODE structure acquired from the remote driver set to the print setting storing unit and sets settings in which the remote driver is the output destination. More specifically the virtual UI unit stores the printer information of the output destination the remote driver which has been held in the temporary storage in the print setting storing unit in which the printer information is associated with the print settings. Hereinafter the print settings and the printer information of the output destination stored in the print setting storing unit is collectively referred to as print setting information.

The virtual print managing unit creates a print job by reading out the print setting information associated with the image data created by the application from the print setting storing unit and stores the print job in the job storing unit .

Upon completion of storing the print job the virtual print managing unit calls the virtual renderer and the print setting information extraction unit . The virtual renderer reserves a workspace workspaces to as a spool space that is independent on a per print job basis extracts the image data from the print job stored in the job storing unit and moves the image data to the corresponding workspace . The print setting information extraction unit extracts the print setting information from the print job and moves the print setting information to the corresponding workspace .

In addition the virtual print managing unit creates a dispatch processing unit dispatch processing units to including a print instruction unit as a private instance on a per print job basis.

The print instruction unit causes the image processing unit implemented as an image processing module to acquire the image data in the corresponding workspace and perform image processing according to the print settings contained in the print setting information in the workspace . The image processing as used herein includes not only image processing related to page allocation imposition and the like but also image processing related to the specific function e.g. embedded pattern printing .

When the image processing performed on the image data is completed the print instruction unit issues a print instruction to print the image processed image data in the workspace to the remote driver Printer Driver a that controls the remote printer Printer A which is the output destination in accordance with the printer information of the output destination contained in the print setting information .

Upon receiving the print instruction from the print instruction unit the remote driver Printer Driver a converts the image processed image data in the workspace to raw data output data and transmits the raw data output data to a remote printer Printer A . Thereafter upon receipt of a notification of completion of printing from the output destination the instance of the dispatch processing unit which is created on the per job basis ends.

As described above in the network print system of the first embodiment at a point in time when a user issues a request for displaying a print setting UI i.e. before a print job is created an output destination printer is automatically determined based on user s properties acquirable by the OS at logging in of the user. Determining the output destination printer at the point in time when the request for displaying the print setting UI is issued makes it possible to dynamically acquire a necessary DEVMODE structure from a remote driver of the output destination printer and cause the DEVMODE structure to be reflected in the print setting UI. Therefore the user can set for the automatically determined output destination printer not only print settings relating to basic function common among all vendors but also print settings relating to function specific and inherent to the output destination printer.

The network print system of a second embodiment is described below. The network print system of the second embodiment does not automatically determine an output destination printer based on user s properties but determines an output destination printer based on contents of print data relating to a print request. The contents can be a character string contained in the print data or the like. The network print system of the second embodiment has a similar structure to that of the first embodiment see and repeated description is omitted.

The network print system may employ any one of a client server environment and a thin client environment in the second embodiment. Description about a case where the client server environment is employed is the same as that of the first embodiment and repeated description is omitted. Similarly description about a case where the thin client environment is employed is the same as that of the first embodiment and repeated description is omitted.

The data processing apparatus of the second embodiment creates output data raw data in a raw form from print data relating to a print request received from the client . The data processing apparatus also determines the remote printer that is to be an output destination according to contents of the print data by a procedure which will be described later. The data processing apparatus outputs the output data to the remote printer that is to be the output destination. Moreover function stapling punching or the like specific to the remote driver which may be referred to as a second print processing unit and set by a user is applied by an advanced print setting changing unit of the data processing apparatus by changing the output data.

The network print system of the second embodiment has been outlined above. A specific configuration of the data processing apparatus of the second embodiment is described below with reference to .

The data processing unit includes the virtual printer driver the job storing unit for storing therein a print job as a spool file an output data storing unit and the advanced print setting changing unit .

The virtual printer driver includes the virtual print managing unit which may be referred to as a creating unit the print setting information extraction unit the virtual renderer the virtual UI unit and the print setting storing unit .

A basic configuration of the data processing apparatus of the second embodiment has been outlined above. Processes to be executed by the functional units of the data processing unit when a user instructs to print a file output as a result of execution of the application are described below step by step.

First the user logs in to the data processing apparatus by operating the client . As a result a session is established between the client and the data processing apparatus . At this time the operating system OS installed onto the data processing apparatus temporarily assigns an identifier that is unique in the data processing apparatus to the user involved in the established session. Such an identifier is a known identifier referred to as a user identifier UID a session ID or the like. The OS holds the temporarily assigned identifier and login user s properties hereinafter user information associated with the each other while the session is maintained.

In the second embodiment the user information held by the OS is the login user s properties acquirable by the OS at logging in of the user. Examples of the user s properties include a user name account name of the login user and a name of a group to which the login user belongs a name of a domain or an organization in which the login user participates in Active Directory or the like and a computer name an IP address a MAC address and the like of the client operated by the login user.

The user logged in to the data processing apparatus then issues a service request to the application by operating the client . The application executes a predetermined process in response to the service request from the client and outputs a result of the execution as a file.

Subsequently the user calls a print setting UI hereinafter referred to as print dialog from the application by operating the client to give an instruction to print the file which is the result of execution of the application . The application issues a print dialog display request to the virtual UI unit in response to the call from the user. Upon receiving the display request the virtual print managing unit of the virtual printer driver calls the virtual UI unit . The virtual UI unit creates a print dialog an image for print settings and provides the created print dialog to the application .

The print dialog includes print settings relating to the basic function common among remote drivers to and print settings relating to functions specific to the respective remote drivers to . Examples of the specific function include a stapling function and a punching function.

In the network print system of the second embodiment the remote driver to be used or more specifically which one of the remote drivers to is to be used is not determined yet at a stage where a user sets print settings. Accordingly the virtual UI unit cannot identify function specific to the remote driver that is usable when displaying the print dialog instead the virtual UI unit displays print setting items of the specific functions such as stapling and punching on the print dialog.

The application then receives desired print function settings and push down of the print execution button via the print dialog provided by the virtual UI unit . When the print execution button is pushed down by a user a print instruction event including the print settings set by the user is generated. A print designation event has an identifier ID for unique identification of the print designation event. In response to the print instruction event the application creates the image data relating to the execution result file by calling an API such as a graphical device interface DGI . The image data is uniquely identifiable by the identifier of the print designation event. The application transmits the image data to the virtual print managing unit .

In response to the print instruction event the virtual UI unit sets the DEVMODE structure function corresponding to a public member of the print setting storing unit according to the print settings hereinafter basic print settings relating to the basic function common among the remote drivers to . The virtual UI unit also stores the print settings hereinafter advanced print settings relating to the functions specific to the respective remote drivers to in the print setting storing unit . The virtual UI unit stores the basic print settings and the advanced print settings associated with the identifier of the print designation event in the print setting storing unit .

Upon receiving the image data from the application the virtual print managing unit reads out the basic print settings of the image data from the print setting storing unit . More specifically the virtual print managing unit reads out the basic print settings of the image data from the print setting storing unit by utilizing the identifier of the print designation event associated with the image data .

The virtual print managing unit then creates a print job containing the image data and the basic print settings. The print job has an identifier ID for unique identification of the print job. The second embodiment is described on an assumption that the identifier of the print job is the same as the identifier of the print designation event. The virtual print managing unit stores the print job in the job storing unit .

The virtual print managing unit then calls the virtual renderer and the print setting information extraction unit . The virtual renderer extracts the image data from the print job. The virtual renderer transmits the extracted image data to the output destination determining unit of the assignment database . Upon receiving the image data the output destination determining unit determines an output destination printer the remote driver based on a character string contained in the image data and an output destination association table .

Description is made by way of an example case where the output destination determining unit finds that the image data contains aaa as a result of search through the image data . In this case the output destination determining unit determines the remote printer of which printer information is identified by the printer name Printer a the printer driver name Printer Driver a and an output port name XXXXXX as the output destination remote printer .

The output destination determining unit transmits the printer information of the remote printer determined as the output destination to the virtual renderer .

The virtual renderer receives the printer information from the output destination determining unit . The virtual renderer then reserves the workspace as a spool space that is independent on a per print job basis. The print setting information extraction unit extracts the print setting information from the print job and moves the print setting information to the corresponding workspace . The virtual renderer moves the image data extracted from the print job in the job storing unit to the workspace corresponding to the print job. The virtual renderer also adds the printer information received from the output destination determining unit to the print setting information in the workspace .

Moreover the virtual print managing unit creates the dispatch processing unit including the print instruction unit as a private instance on a per print job basis.

The print instruction unit causes the image processing unit implemented as an image processing module to acquire the image data in the workspace . The image processing unit performs image processing according to the print settings contained in the print setting information in the workspace . The image processing as used herein includes image processing related to page allocation imposition and the like.

When the image processing on the image data performed by the image processing unit is completed the print instruction unit refers to the printer information of the output destination contained in the print setting information . Description below is made specifically by way of an example case where the printer name in the printer information is Printer A . In this case the print instruction unit issues a print instruction to print the image processed image data in the workspace to the remote driver Printer Driver a that controls the remote printer Printer A which is the output destination.

Upon receiving the print instruction from the print instruction unit the remote driver Printer Driver a converts the image processed image data in the workspace to data receivable by the remote printer . The remote driver Printer Driver a transmits the converted data as output data raw data to a printer port .

The printer port receives the output data output from the remote driver . The printer port stores the output data in the output data storing unit .

Upon detecting that the output data is stored in the output data storing unit the advanced print setting changing unit reads out the output data from the output data storing unit . The advanced print setting changing unit changes settings of the output data according to the advanced print settings in the print setting storing unit . The advanced print setting changing unit outputs the changed output data to the remote printer . Operation of the advanced print setting changing unit will be described in detail later.

Upon receipt of a notification of completion of printing from the output destination remote printer the instance of the dispatch processing unit which is created on the per job basis ends.

The advanced print setting changing unit then determines whether or not advanced print settings are stored in the print setting storing unit Step S . More specifically the advanced print setting changing unit determines whether or not advanced print settings to be applied to the output data are stored in the print setting storing unit by using an identifier which is the same as the identifier of the print designation event in the second embodiment of the print job contained in the output data as a search key.

When the advanced print settings are stored Yes in Step S the advanced print setting changing unit reads out the advanced print settings from the print setting storing unit Step S . The advanced print setting changing unit then changes the output data according to the read out advanced print settings Step S . More specifically the advanced print setting changing unit changes the output data by directly editing description related to the advanced print settings contained in the output data raw data . The advanced print setting changing unit then outputs the output data changed in Step S to the remote printer Step S .

When the advanced print settings are not stored No in Step S the advanced print setting changing unit outputs the output data which is unchanged to the remote printer Step S .

As described above in the network print system of the second embodiment the virtual UI unit creates an image print dialog that contains items for setting the advanced print settings which are print settings that depend on a model of the output destination remote printer . Moreover the print setting storing unit stores the advanced print settings received by the virtual UI unit via the print dialog. When output data is output from the remote driver of the output destination remote printer in a situation where advanced print settings to be applied to the output data are stored in the print setting storing unit the advanced print setting changing unit changes the output data according to the advanced print settings.

Accordingly the network print system of the second embodiment allows in assignment of a print destination in a multi vendor environment setting not only print settings relating to the basic function common among all vendors but also print settings relating to the function specific and inherent to each vender. Moreover the network print system of the second embodiment allows even when a destination printer is not automatically determined at logging in of a user setting print settings relating to the function specific and inherent to each vender.

Finally a hardware configuration of the data processing apparatus of the first and second embodiments is described below. is a diagram illustrating the hardware configuration of the data processing apparatus of the first and second embodiments. The data processing apparatus of the first and second embodiments includes a control device a main storage device an auxiliary storage device a display device an input device and a communication device . The control device the main storage device the auxiliary storage device the display device the input device and the communication device are connected to one another via a bus .

The control device executes program instructions read out from the auxiliary storage device onto the main storage device . The main storage device is a memory such as a read only memory ROM or a random access memory RAM . The auxiliary storage device is a hard disk drive for example. The display device is a screen on which a state of the data processing apparatus and the like are displayed. The input device is an interface for inputting information to the data processing apparatus . The communication device is an interface for connection to a network.

Program instructions to be executed by the data processing apparatus of the first and second embodiments have a module configuration that includes functional blocks of the data processing apparatus described above. From the viewpoint of actual hardware the control device reads out the program instructions from the storage medium and executes the program instructions thereby loading modules into the main storage device . Accordingly the modules are generated on the main storage device . Alternatively some or all of the functional blocks of the data processing apparatus may be implemented in hardware such as an integrated circuit IC rather than in the program instructions.

The above functions of the first and second embodiments can be implemented by apparatus executable program instructions written in an object oriented programming language such as C C C or Java registered trademark . The program instructions of the first and second embodiments can be distributed as being stored in a machine readable storage medium such as a compact disk read only memory CD ROM a magneto optical disk MO a digital versatile disc DVD a flexible disk an electrically erasable programmable read only memory EEPROM or an erasable programmable read only memory EPROM and transmitted over a network in a form usable by other apparatus.

Embodiments of the present invention have been described above however the present invention is not limited to the embodiments described above. For instance the application execution unit illustrated in may be installed on a terminal server other than the clients and the data processing apparatus . In this case a network boundary is defined by the dotted line indicated in and the data processing apparatus is implemented as a printer server. Further alternatively the functional units described above included in the data processing unit illustrated in may be distributed across the network in appropriate units. In this case the present invention may preferably be embodied as a network based data processing system. The appended claims are to be construed as encompassing all modifications and alternative constructions that may occur to one skilled in the art without departing from the scope of the present invention.

As described above according to an aspect of an embodiment there are provided a data processing apparatus a data processing system and a computer readable storage medium that allow in assignment of a print destination in a multi vendor environment setting not only print settings relating to basic function common among all vendors but also print settings relating to function specific and inherent to each vender.

Although the invention has been described with respect to specific embodiments for a complete and clear disclosure the appended claims are not to be thus limited but are to be construed as embodying all modifications and alternative constructions that may occur to one skilled in the art that fairly fall within the basic teaching herein set forth.

