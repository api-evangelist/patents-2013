---

title: Time-reversal of variance-encoded light (TROVE)
abstract: A method and apparatus for irradiating a scattering medium with increased resolution. The method includes transmitting EM radiation from an Electromagnetic (EM) radiation source to a target inside a scattering medium, wherein the target encodes the EM radiation with a variance structure to form encoded EM radiation; measuring, in a detector, transmitted EM radiation comprising at least a portion of the encoded EM radiation transmitted through and exiting the scattering medium; decoding the transmitted EM radiation, comprising EM fields, in a computer, comprising selecting one or more of the EM fields having the variance structure; and irradiating the scattering medium with time reversed EM radiation from a spatial light modulator (SLM), the time reversed EM radiation generated from time reversing the EM fields having the variance structure, thereby forming a focus of the time reversed EM radiation in the scattering medium with the increased resolution.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09354166&OS=09354166&RS=09354166
owner: California Institute of Technology
number: 09354166
owner_city: Pasadena
owner_country: US
publication_date: 20131101
---
This application claims the benefit under 35 U.S.C. Section 119 e of the following commonly assigned application 

U.S. Provisional Patent Application Ser. No. 61 721 325 filed on Nov. 1 2012 by Benjamin Judkewitz Ying Min Wang Roarke Horstmeyer and Changhuei Yang entitled TIME REVERSAL OF VARIANCE ENCODED LIGHT which application is incorporated by reference herein.

This application is related to the following commonly assigned patent applications which applications are incorporated by reference herein 

U.S. Utility patent application Ser. No. 13 851 901 filed on Mar. 27 2013 by Ying Min Wang Benjamin Judkewitz Charles A. DiMarzio and Changhuei Yang entitled DEEP TISSUE FLUORESCENCE IMAGING USING DIGITALLY TIME REVERSED ULTRASOUND ENCODED LIGHT which application claims the benefit under 35 U.S.C. Section 119 e of U.S. Provisional Patent Application Ser. No. 61 616 347 filed on Mar. 27 2012 by Ying Min Wang Benjamin Judkewitz Charles A. DiMarzio and Changhuei Yang entitled DEEP TISSUE FLUORESCENCE IMAGING USING DIGITALLY TIME REVERSED ULTRASOUND ENCODED LIGHT 

U.S. Utility patent application Ser. No. 12 886 320 filed on Sep. 20 2010 by Zahid Yagoob Emily McDowell and Changhuei Yang entitled OPTICAL PHASE PROCESSING IN A SCATTERING MEDIUM which application is a divisional of U.S. Utility patent application Ser. No. 11 868 394 filed on Oct. 5 2007 by Zahid Yagoob Emily McDowell and Changhuei Yang entitled TURBIDITY ELIMINATION USING OPTICAL PHASE CONJUGATION AND ITS APPLICATIONS which application claims priority under 35 U.S.C. 119 e to commonly assigned U.S. Provisional Patent Application Ser. No. 60 850 356 filed on Oct. 6 2006 by Zahid Yagoob Emily McDowell and Changhuei Yang entitled TURBIDITY ELIMINATION USING OPTICAL PHASE CONJUGATION AND ITS APPLICATIONS 

U.S. patent application Ser. No. 12 943 857 filed on Nov. 10 2010 by Changhuei Yang and Meng Cui entitled TURBIDITY SUPPRESSION BY OPTICAL PHASE CONJUGATION USING A SPATIAL LIGHT MODULATOR which application claims the benefit under 35 U.S.C. 119 e of the following commonly assigned U.S. provisional patent applications which are incorporated by reference herein 

a. Provisional Application Ser. No. 61 259 975 filed on Nov. 10 2009 by Changhuei Yang and Meng Cui entitled APPROACHES FOR BUILDING COMPACT FLUORESCENCE MICROSCOPES 

b. Provisional Application Ser. No. 61 260 316 filed on Nov. 11 2009 by Changhuei Yang and Meng Cui entitled APPLICATIONS OF TURBIDITY SUPPRESSION BY OPTICAL PHASE CONJUGATION 

c. Provisional Patent Application Ser. No. 61 376 202 filed on Aug. 23 2010 by Meng Cui and Changhuei Yang entitled OPTICAL PHASE CONJUGATION 4PI MICROSCOPE and

d. Provisional Application Ser. No. 61 355 328 filed on Jun. 16 2010 by Meng Cui Ying Min Wang and Changhuei Yang entitled ACOUSTIC ASSISTED PHASE CONJUGATE OPTICAL TOMOGRAPHY 

U.S. Utility application Ser. No. 12 943 841 filed on Nov. 10 2010 by Meng Cui Ying Min Wang Changhuei Yang and Charles DiMarzio entitled ACOUSTIC ASSISTED PHASE CONJUGATE OPTICAL TOMOGRAPHY which application claims priority under 35 U.S.C. 119 e to commonly assigned U.S. Provisional Application Ser. No. 61 355 328 filed on Jun. 16 2010 by Meng Cui Ying Min Wang and Changhuei Yang entitled ACOUSTIC ASSISTED PHASE CONJUGATE OPTICAL TOMOGRAPHY U.S. Provisional Application Ser. No. 61 259 975 filed on Nov. 10 2009 by Changhuei Yang and Meng Cui entitled APPROACHES FOR BUILDING COMPACT FLUORESCENCE MICROSCOPES U.S. Provisional Application Ser. No. 61 260 316 filed on Nov. 11 2009 by Changhuei Yang and Meng Cui entitled APPLICATIONS OF TURBIDITY SUPPRESSION BY OPTICAL PHASE CONJUGATION and U.S. Provisional Patent Application Ser. No. 61 376 202 filed on Aug. 23 2010 by Meng Cui and Changhuei Yang entitled OPTICAL PHASE CONJUGATION 4PI MICROSCOPE and

U.S. Utility application Ser. No. 13 157 194 filed on Jun. 9 2011 by Meng Cui Ying Min Wang and Changhuei Yang entitled ITERATIVE TIME REVERSAL ENHANCED TRANSMISSION SOLVING APPROACH which application claims the benefit under 35 U.S.C. 119 e of Provisional Application Ser. No. 61 355 326 filed on Jun. 16 2010 by Meng Cui Ying Min Wang and Changhuei Yang entitled ITERATIVE TIME REVERSAL ENHANCED TRANSMISSION SOLVING APPROACH .

The invention was made with government support under OD007307 awarded by the National Institutes of Health. The government has certain rights in the invention.

 Note This application references a number of different publications as indicated throughout the specification by one or more reference numbers in brackets x . A list of these different publications ordered according to these reference numbers can be found below in the section entitled References. Each of these publications is incorporated by reference herein. 

Scattering of light by inhomogeneous media poses a fundamental challenge to numerous applications in astronomy biomedical imaging and colloidal optics. For a long time scattered light has been viewed as a source of noise. Many advanced imaging approaches have been developed to filter it out relying solely on the ballistic light component. However this strategy is futile in strong scatterers such as optical diffusers paint or thick layers of biological tissue which do not transmit a ballistic component. Focusing beyond the ballistic regime has therefore long been considered impossible.

Recent developments in the field of wavefront shaping have changed this view 1 demonstrating that scattered light can be utilized for optical focusing beyond the ballistic regime. As light travels across a strong scatterer the wavefront leaving the sample is seemingly randomized. But in fact there is a linear mapping between the optical modes in the input wavefront and the optical modes in the output wavefront which can be fully described by a scattering transmission matrix. These linear deterministic and time symmetric properties of scattering 2 have been harnessed for focusing and image transfer across complex samples by iterative wavefront optimization 3 8 time reversal 9 10 or directly measuring and inverting the transmission matrix 11 13 .

Despite these significant advances in our understanding of wavefront control across scatterers the methods outlined above require direct access to both sides of the scatterer i.e. the input plane and the target plane . These approaches are therefore not directly applicable when the goal is to focus between scatterers or deep inside a scatterer. In such cases wavefront optimization requires the assistance of beacons or so called guide stars in the target plane. Guide stars have successfully been implemented using second harmonic 14 or fluorescent 15 particles but optical focusing inside scattering samples is limited to the vicinity of these stationary particles. An alternative approach termed time reversal of ultrasound encoded light TRUE 16 20 shows much promise for non invasive imaging by taking advantage of virtual acousto optic beacons. In this approach an ultrasound focus frequency shifts the scattered optical wavefront within a scattering sample thus creating a source of frequency shifted light. Scattered frequency shifted light emanating from this source is recorded outside the tissue and time reversed by optical phase conjugation to converge back onto the location of the ultrasound focus. Despite its ability to focus inside scattering samples at unprecedented depths the resolution of TRUE imaging is fundamentally limited by the size of the ultrasound beacon which is at least an order of magnitude larger tens of micrometers at best than the optical speckle size micrometer scale .

Here the present invention proposes a way to break this resolution barrier imposed by the size of the beacon by time reversal of variance encoded light TROVE . TROVE takes advantage of the spatially unique variance imposed by the acoustic field to encode the spatial location of individual optical speckles within the ultrasound focus. Upon optical time reversal of computationally decoded modes one or more embodiments achieve focusing at the scale of single optical speckles with diffuse light.

Focusing of light in the diffusive regime inside scatterers has long been considered impossible. Recently this limitation has been overcome with time reversal of ultrasound encoded light TRUE but the resolution of this approach is fundamentally limited by the large number of optical modes within the ultrasound focus. Here one or more embodiments of the present invention introduce a new approach time reversal of variance encoded light TROVE which demixes these spatial modes by variance encoding to break the resolution barrier imposed by the ultrasound. By encoding individual spatial modes inside the scattering sample with unique variances we effectively uncouple the system resolution from the size of the ultrasound focus. This enables us to demonstrate optical focusing and imaging with diffuse light at unprecedented speckle scale lateral resolution of 5 m. For example one or more embodiments of the invention achieves speckle scale focusing in the diffusive regime with TROVE.

For example one or more embodiments of the invention disclose a method of irradiating a scattering medium with increased resolution comprising transmitting EM radiation from an Electromagnetic EM radiation source to a target inside a scattering medium wherein the target encodes the EM radiation with a variance structure to form encoded EM radiation measuring in a detector transmitted EM radiation comprising at least a portion of the encoded EM radiation transmitted through and exiting the scattering medium decoding the transmitted EM radiation comprising EM fields in a computer comprising selecting one or more of the EM fields having the variance structure and irradiating the scattering medium with time reversed EM radiation from a spatial light modulator SLM the time reversed EM radiation generated from time reversing the EM fields having the variance structure thereby forming a focus of the time reversed EM radiation in the scattering medium with the increased resolution.

The detector and SLM can be in a Digital Optical Phase Conjugation DOPC device and the scattering medium can include at least a portion that does not transmit a ballistic component of the EM radiation or wherein the scattering medium scatters the EM radiation in a diffusive regime.

The method can further comprise forming the EM radiation comprising a plurality of EM fields transmitting signals from a signal generator to form the target comprising a plurality of spatially shifted and spatially overlapping signals wherein each of the EM fields is encoded by each of the spatially shifted and spatially overlapping signals to form the encoded EM radiation comprising a plurality of encoded fields and the transmitted EM radiation comprising a plurality of transmitted encoded fields forming a plurality of matrices each representing a plurality of the transmitted encoded fields wherein the transmitted encoded fields encoded by each of the spatially shifted and overlapping signals are represented in a different matrix calculating a sum of the matrices and one or more differences of one or more pairs of the matrices the decoding comprising finding a field vector v having higher variance for the sum and a smaller variance for the differences and finding the complex conjugate of the field vector v wherein the time reversed EM radiation comprises time reversed fields generated from the complex conjugate.

The decoding can further comprise calculating one or more variances or characteristics of variances of the transmitted EM radiation. For example the decoding can comprise maximizing the Rayleigh Quotient of the matrices or solving an eigenvector equation comprising the Rayleigh Quotient and the vector is a principal eigenvector of the Rayleigh Quotient.

The method can further comprise forming four of the spatially shifted and overlapping signals and four of the matrices C C C and C wherein eig .

The method can further comprise randomizing the EM radiation to form the plurality of random EM fields.

The signals can be ultrasound foci that encode the EM fields to form the encoded EM fields comprising frequency shifted EM fields.

Each of the EM fields can produce different realizations r of the frequency shifted EM fields each realization r can be represented as a row of the matrices and each row can comprise one of the encoded fields measured for one of the realizations.

The method can comprise measuring the frequency shifted EM fields via digital phase shifting holography.

The method can further comprise digitally scanning the time reversed focus by weighing the fields in the matrices with prefactors that virtually and spatially move the intersection point of the signals.

The method can further comprise detecting on a detector output radiation based on an interaction between the time reversed EM radiation and the scattering medium to produce a detected signal and subtracting a background from the detected signal in a computer to obtain an output that at least approximates an interaction between a complete time reversed field of all of the modulated EM radiation and the target.

One or more embodiments further disclose an apparatus for irradiating a target in a scattering medium and a computer readable storage medium encoded with computer program instructions which when accessed by a computer cause the computer to load the program instructions to a memory therein creating a special purpose data structure causing the computer to operate as a specially programmed computer executing a method of decoding transmitted EM radiation.

In the following description of the preferred embodiment reference is made to the accompanying drawings which form a part hereof and in which is shown by way of illustration a specific embodiment in which the invention may be practiced. It is to be understood that other embodiments may be utilized and structural changes may be made without departing from the scope of the present invention.

To better understand the resolution limitation of TRUE imaging and how we can overcome this limitation by variance encoding we can conceptually divide any scattering medium into two sections one through which the input light passes before reaching the ultrasound focus and a second through which the ultrasound shifted light passes on the way out of the medium. We can make this division without loss of generality for different illumination and recording geometries.

Next b propagates through the second section of the scattering medium mathematically described by the scattering matrix T before leaving the tissue as the output field c b T. In other words c can be described as a linear superposition of many optical transmission modes or rows in T and the weights of this superposition are given by b . This output field c is detected measured and subsequently time reversed phase conjugated . The time reversed wavefront is played back through the second section of the scatterer resulting in a wavefront that is an approximation to the conjugate of the field b at the ultrasound focal plane the recovery of the multi modal focus at the location of the ultrasound plus background as discussed in 3 19 . Thus the limited resolution of TRUE is a result of the fact that all optical modes passing through the ultrasound focus are collectively detected and time reversed.

In contrast to previous methods for focusing across scatterers 3 7 9 12 we do not have experimental access to b because it is hidden within the sample. All we know about this wavefront is that that it consists of a mixture of many modes that spatially span over a Gaussian shaped envelope g imposed by the ultrasound focus at a controllable location. To achieve micrometer scale optical focusing we would instead have to isolate a single mode corresponding to an individual row in T. One or more embodiments of the present invention achieve this and overcome the problem of the low resolution of the ultrasound focus forcing us to record mixtures of many optical modes at the output plane.

The TROVE approach illustrated in addresses this challenge by uniquely encoding the spatial location of the frequency shifted optical speckles with a variance structure imposed by spatially shifted ultrasound foci. Here we explain the important conceptual and experimental modifications to the conventional TRUE approach that enable TROVE. First although we cannot measure or predict the speckle field b without access to the ultrasound plane we know that its envelope follows the shape of the ultrasound focus. Thus over many possible realizations of b the expected variance at each spatial location in the ultrasound plane will follow the square of the envelope. To implement random realizations of b we add a rotating diffuser disk to the beam path leading to the sample. As the diffuser is rotated each new diffuser position will result in a different realization of the input wavefront multiple randomizations from the diffuser disk DD and thus different frequency shifted wavefronts b and c at the ultrasound plane and the output plane respectively. We can represent each realization r of b b and c as rows of the matrices B B and C respectively . The field recorded outside the sample at each diffuser position or for each realization r each row in C will be a different linear combination of transmission modes rows in T originating from individual optical modes within the ultrasound focus .

While the weights of this linear combination given by b are not known we know that their variance over the different random realizations will follow the square of the ultrasound focus g . This effectively encodes the spatial location of an optical mode within the ultrasound focus by its variance.

Since the Gaussian shaped ultrasound focus is symmetric more than one location in the ultrasound plane more than one column in b will experience the same level of variance. To resolve this ambiguity we move the ultrasound focus between two positions 1 and 2 resulting in slightly shifted foci gand g whose flanks overlap as shown in . It is important to note that the data for both foci is recorded for the same diffuser position such that B B Gand C B Tfor the first ultrasound focus location and B B Gand C B Tfor the second. By taking the sum and the difference of B and B we get B and B . As illustrated in the amplitude of B across realizations is zero at the intersection of gand g because the underlying speckle patterns B for both data sets Band Bare the same. As a result the variance of B is zero along the column of this intersection. The spatial mode b at this intersection thereby becomes uniquely encoded as a mode of zero variance in the difference of the data sets B and of high variance in the sum B . Since the variance structure of optical modes is preserved as they are transmitted through scatterers see Supplementary Information 24 e.g. under the heading Derivation of a computationally efficient decoding algorithm pages 4 8 we can also find this mode in the data set recorded at the output plane by searching for a vector v along which the variance of Cis minimal and the variance of Cis high. Mathematically we define the vector v as the one that maximizes the ratio between these two variances this ratio is also known as the Rayleigh Quotient . A detailed description of our variance decoding procedure to find v can be found in the Supplementary Information 24 under the heading Derivation of a computationally efficient decoding algorithm pages 4 8. The resultant vector v is equivalent to the field which would result from the transmission of a single optical mode b at the location of the intersection of gand gthrough the scatterer represented by T i.e. v b T . By using a digital spatial light modulator SLM to display the complex conjugate of v and letting it propagate back through the scatterer we expect to obtain a high resolution phase conjugate focus at the location of the intersection of the shifted foci gand g.

Although we assumed and measured that the ultrasound foci are Gaussian shaped it is worth noting that the validity and performance of the TROVE method does not hinge upon the exact shape of the ultrasound focus as long as shifted foci intersect such that difference of the data sets B presents a sharp null point.

As a first confirmation of our ability to encode and decode individual spatial transmission modes we implemented the TROVE framework in a numerical simulation see . As shown in we generated complex normal random matrices B and Tand chose two overlapping 1 D Gaussian functions gand g representing the shifted ultrasound foci that convert B into B and B respectively see section 7 for details . We then calculated the matrices Cand Cthat would have been measured outside the scatterer in a real experiment. With the decoding strategy outlined above using only C C we calculated the vector v that maximized the ratio of variances along Cand C. When this vector was time reversed multiplied by T in the simulation we were able to achieve a tight speckle sized focus at the intersection of the two functions gand g see . Comparatively when we simulated the TRUE framework by time reversing one row of either the Cor the Cmatrix we found that the resultant field consisted of a multimode focus the size of the much larger Gaussian shaped ultrasound gor g as shown in

A straightforward way to shift the TROVE focus or access other optical modes at different positions would be to move the location of the ultrasound foci. This would entail repeating the entire TROVE measurement to assemble a new set of matrices Cand C. However the TROVE strategy allows access to multiple optical modes within the ultrasound focus without the need for further acquisition of data matrices. We note that the location of the TROVE focus is entirely determined by the point at which the shifted ultrasound foci intersect see above . Thus by numerically weighing the matrices Cand Cwith respect to each other during post processing we can virtually move the point of intersection and thus the TROVE focus to any location along the common axis of the shifted ultrasound foci dotted shifted focus in .

The previous sections demonstrated the working principles of the TROVE technique in a two dimensional conceptual framework with one dimensional scanning. To confirm this approach experimentally and to extend its utility to two dimensional scanning we first sought to measure and characterize the frequency shifted field B at the ultrasound focus. We do so by constructing a sample consisting of an agarose filled glass cuvette with a strong diffuser on the side of the input light such that no detectable ballistic component reaches the ultrasound plane . In the absence of a second scatterer we imaged the frequency shifted wavefront at the ultrasound plane via digital phase shifting holography see Methods section . Also shown are ultrasound transducer and camera for imaging the scattered light.

To unambiguously encode and shift the TROVE focus in two dimensions we slightly modified the strategy described in the previous section instead of using two overlapping ultrasound foci we used four overlapping ultrasound foci g g g g arranged in a square grid. shows the representative complex maps of the frequency shifted fields b . shows the complex sum of the four shifted fields b and the pairwise difference between the diagonal fields b and b respectively. By moving the diffuser and repeating the measurement for 1000 random presentations of the input wavefront we obtained an average amplitude map of the frequency shifted optical field. As shown in the average amplitude along the difference for each pair of the two diagonally arranged foci B and B yielded a null zone which was absent in the average intensity map of B . This null zone in the average of speckle images is also apparent in their variance across realizations. As can be seen in the ratio between the variance along B divided by the sum of variances along Band Bhad a peak at the intersection of the four Gaussians uniquely defining that point. Drawing from the intuition established in our simulations we can effectively shift this intersection in two dimensions by scaling the relative weights between B and B and between B and B and recalculating the above ratio.

While these results confirm that we indeed get a null point at the ultrasound plane we need to keep in mind that our ultimate goal is to accomplish focusing through scattering media. Consequently we would not have access to speckle data at the ultrasound plane. Instead of analyzing data matrices at the ultrasound plane we would only be able to record and analyze the matrices at the output plane. However thanks to the preservation of variance across scatterers as discussed above we can still find the desired mode by looking for a vector v along which the variance of the measured data C C and C C is minimal and the variance of the sum C C C C is maximal. The adapted mathematical expression for finding the vector v can be found in the methods section.

Without any wavefront manipulation we observed that light was highly diffused and failed to form a focus within the sample . Using the TRUE focusing approach and digitally phase conjugating an unprocessed phase map from a single realization we observed a focus with a full width half maximum FWHM of 31.2 m on the same order of magnitude as the size of the ultrasound focus 30 m . When implementing the TROVE framework we achieved a focus having a size or FWHM of 5.2 m which is close to the optical speckle size in our sample 5 m FWHM of the intensity autocorrelation . Thus the TROVE method yielded a six fold improvement over the TRUE focusing approach. A direct consequence of the reduction of optical modes in the TROVE focus as compared to the TRUE focus was an increase in the peak signal intensity of the time reversed focus as discussed in 19 . We observed in our experiments that the peak signal intensity with TROVE increased by a factor of 20 as compared to TRUE.

We demonstrate the TROVE focusing and two dimensional scanning strategy established above by scanning the TROVE focus in two dimensions over a 1 m diameter fluorescent bead placed in a cuvette flanked by strong diffusers. We confirmed that due to scattering the bead could not be imaged via conventional epifluorescence . To acquire a TROVE image we used a photomultiplier tube placed outside the sample to collect the backscattered fluorescence signal excited by the scanned TROVE foci. From the TROVE image acquired we obtained the point spread functions having FWHM of 5.7 m and 5.4 m in the x and y direction respectively . As compared to TRUE focusing 19 shown in we again find a resolution improvement of over six fold.

We further demonstrate this resolution improvement by scanning two 1 m diameter fluorescent beads placed 15 m apart . Due to the limited resolution of the TRUE technique the TRUE image does not resolve the individual beads . In comparison the two beads are well resolved with TROVE imaging see showing TROVE images and of beads .

In this work we presented a new method time reversal of variance encoded light TROVE to focus light at unprecedented speckle scale resolution in the diffusive regime. We demonstrated an optical setup that encoded frequency shifted speckles originating from an ultrasound guide star with a unique variance structure as well as a decoding algorithm that enabled the measurement and subsequent time reversal of individual optical transmission modes between highly diffusive scatterers. We characterized the lateral point spread function of an embodiment of the system to be 5.4 m by 5.7 m micrometers a six fold improvement compared to previous methods 19 20 . Beyond just resolution improvement TROVE provides a means to computationally access different optical modes within the ultrasound focus enabling control of optical wavefronts within a scattering sample at speckle scale resolution. We demonstrated this ability to access different optical modes from a single dataset by two dimensional scanning and imaging of fluorescent features.

In essence the TROVE method uncouples the resolution of the system from the size of the ultrasound guide star. The resolution of the system is instead fundamentally determined by the size of the optical speckles at the ultrasound plane. Due to the low numerical aperture of illumination in our experiments the size of the optical speckles was 5 m full width at half maximum FWHM . The size of the speckles could be made smaller with different illumination configurations to yield higher resolution. However this would require a corresponding increase in the number of wavefront measurements required resulting in longer acquisition times.

This is an important trade off because TROVE is based on optical time reversal and is thus crucially reliant on the mechanical stability of the sample. Therefore the duration of wavefront measurements and decoding computations should be shorter than the decorrelation time of the sample. In our demonstration the time required for the measurement of a data set that enabled us to access a 30 m by 30 m field of view was 2 hours. Although current hardware speeds restrict the applicability of our method to mechanically stable samples we anticipate that this requirement can be significantly relaxed with the advent of faster cameras spatial light modulators 21 and wavefront scramblers such as random lasers 22 .

With these improvements on the horizon one or more embodiments of our method paves the way for micrometer scale optical focusing imaging and image transfer inside a wide range of highly diffusive media.

All data shown was acquired using a custom built setup that was based on our previously described work on fluorescence TRUE imaging 19 as shown in . illustrates a 2.7 W 532 nm Q switched laser PLS Navigator SpectraPhysics USA pulsed at 20 kHz with a pulse width of 7 ns and a coherence length of 7 mm was used as a light source. After passing an optical isolator OI and a fixed attenuator it was split into a reference beam and a sample beam using a beam splitter BS. The sample beam was attenuated by a neutral density filter wheel ND spatially filtered by a single mode optical fibre SF Nufern 460HP 20 cm length collimated to a 0.8 mm waist beam using collimating lens CL and directed onto an optical diffuser disk on a rotation mount RDD. The diffuse light exiting the disk was relayed to the surface of our sample S with an irradiance of 

Inside the sample S a fraction of the light was frequency shifted by an ultrasound transducer UST element size 6.35 mm focal length 6 mm V3330 Olympus NDT Olympus USA operated at 50 MHz. To achieve maximal resolution along the axis of ultrasound propagation the transducer UST was driven with short pulses 50 MHz 100 V peak to peak carrier oscillation with a Gaussian pulse envelope of 13 ns FWHM triggered by the laser Q switch signal at a fixed delay such that the ultrasound pulses coincided with the laser pulses at the same location forming an ultrasound focus confined in three dimensions. To translate the ultrasound focus the transducer UST was mounted on a three axis computer controlled micromanipulator Sutter Instruments USA . After passing through the sample the scattered beam was recombined with the horizontally polarized reference beam which had also been frequency shifted by an acousto optic modulator AOM AFM 502 A1 IntraAction USA . After passing a horizontally aligned polarizer and another beamsplitter BS the combined beams reached the surface of a phase only SLM vis PLUTO Holoeye Germany carefully aligned 1 1 pixel to pixel match to the image plane of a high dynamic range sCMOS camera pco.edge PCO AG Germany .

The time reversed beam was obtained by reflecting the blank reference beam off the SLM displaying the computed phase conjugate map see also 19 . To directly visualize the time reversed focus the fluorescence emission from the quantum dot sheet was imaged with a 4 magnification onto a digital camera OC fitted with a longpass filter BLP02 561R Semrock USA through the clear window between the diffusers Stingray F145 AVT USA .

This direct access was not utilized in subsequent experiments where fluorescent beads were imaged. For the TROVE imaging experiments the emitted fluorescence that passed back through the scatterer was reflected off a dichroic mirror DBS FF541 SDi01 Semrock USA and detected by a single channel PMT H7827 002 Hamamatsu Japan fitted with a bandpass filter IF FF01 572 28 Semrock USA . Because of the comparatively low contrast in the TRUE imaging experiments a camera OC Stingray F145 AVT USA was used to collect the fluorescence emitted through the clear window between the diffusers. It is important to note that the camera was not used to resolve the bead but just as a single pixel detector to collect the fluorescence emitted. In TROVE and TRUE scanning experiments we suppressed the fluorescence excited by the time reversal background with adaptive background subtraction described in 19 .

We recorded the frequency shifted field at the SLM plane and the frequency shifted field at the ultrasound plane with digital phase shifting holography 23 . The carrier oscillation driving the Ultrasound US transducer UST was shifted by 0 2 and 3 2 phase delay relative to the oscillation driving the reference beam AOM and a frame was acquired for each phase delay. This 4 frame cycle was repeated 10 times and frames recorded at the same phase delay were averaged resulting in four intensity maps that were used to reconstruct the complex field according to E I I i I I . To obtain phase maps for each of the four overlapping ultrasound focus locations required for TROVE we translated the ultrasound focus laterally using the micromanipulator by 26 m and vertically by adjusting the delay of the ultrasound pulses by 20 nanoseconds ns versus the laser pulses.

To find a vector for phase conjugation back to a single mode we looked for a vector v with high variance along the sum C C shorthand C and low variance along the difference C. We achieved this by maximizing the ratio of variances Q v C C v v C C v . Since Q is a generalized Rayleigh Quotient it can be maximized by v eig C C C C where eig denotes a function returning the principal eigenvector. Because the size of C is 1000 0.5M in our experiments number of realizations by number of pixels on the detector a direct calculation of this eigenvector would involve a 0.5M by 0.5M matrix and would be computationally impractical. In the Supplementary Information 24 under the heading Derivation of a computationally efficient decoding algorithm pages 4 8 we derive an alternative approximation of v that is computationally efficient because it only involves 1000 1000 matrices eig . To extend this framework to 2 D scanning having collected four matrices C corresponding to the four foci arranged in a grid we define the modified Rayleigh Quotient as and maximize it as above. To digitally scan the time reversed focus in space we addressed different optical modes at the ultrasound focal plane by weighing the datasets Cwith prefactors that virtually moved the intersection point of the Gaussian foci.

Simulations of TRUE and TROVE focusing were implemented using custom routines written in MATLAB The Mathworks . We followed the framework outlined in the Principles section and divided our simulations into three modules First we generated the complex random matrices B 1000 repetitions by 200 pixels at ultrasound plane and T 200 pixels at ultrasound plane by 1000 pixels at the detection plane the size of Twas chosen to be as large as the memory of our computer would permit . To simulate speckle autocorrelation we convolved Bwith a speckle autocorrelation function a Gaussian of FWHM 5 . We then chose Gaussian functions representing gthe ultrasound foci FWHM 50 21 shifted by 2 and calculated the matrices C B G T. Second we performed the same analysis on C which we also performed on experimentally measured data to obtain the vector v maximizing the Rayleigh quotient see above . Third we simulated time reversal of this vector by multiplying its complex conjugate by T. Finally the time reversed focus was moved by computationally shifting the intersection point between the two Gaussian foci. This is achieved by changing the scalar k in the equation C C kC. The intersection between gand k gcould be shifted predictably according to k 2e where gand gare Gaussian functions whose means are separated by 2 and x is the shift of the intersection point .

The open top quartz glass cuvette with four polished sides Starna Cells CA was filled with 2 wt wt agarose gel Invitrogen USA . The glass cuvette was flanked on two sides with highly diffusing films 3M that did not transmit a detectable ballistic component measured with a detection threshold of less than 10of the transmitted power see 19 for setup .

The quantum dot sheet used to directly visualize the time reversed foci was made with Qtracker 655 Non targeted quantum dots Invitrogen diluted in agarose such that the final concentration of quantum dots was 0.4 M.

The 1 m diameter fluorescent beads FluoSphere Orange fluorescent used for point spread function characterization and imaging demonstration were obtained from Invitrogen USA.

Block represents forming the Electromagnetic EM radiation e.g. light comprising a plurality of EM fields. The forming can comprise randomizing the EM radiation e.g. to form a plurality of random EM fields e.g. at least 1000 different random EM fields .

Block represents transmitting signals from a signal generator source of signals e.g. source of ultrasound to form a target or guide star inside a scattering medium. The target can comprise a plurality of spatially shifted and spatially overlapping signals.

The signals can be ultrasound foci that encode the EM fields to form the encoded EM fields comprising frequency shifted EM fields. The step can further comprise shaping the ultrasound foci to produce the variance structure.

Block represents transmitting the EM radiation from an EM radiation source to a target inside a scattering medium thereby encoding modulating the EM radiation at the target. The target can encode the EM radiation with a variance structure to form modulated encoded EM radiation. Each of the EM fields can be encoded by each of the spatially shifted and spatially overlapping signals to form the encoded EM radiation comprising a plurality of encoded fields and the transmitted EM radiation comprising a plurality of transmitted encoded fields.

The encoding can encode spatial transmission modes of the EM radiation at the target with a signal and a variance.

The scattering medium e.g. animal human or plant tissue can include at least a portion that does not transmit a ballistic component of the EM radiation or wherein the scattering medium scatters the EM radiation in a diffusive regime.

Block represents measuring in a detector system or detector transmitted EM radiation comprising at least a portion of the encoded EM radiation comprising encoded fields transmitted through and exiting the scattering medium. The measuring can include measuring at least a portion of the encoded fields that have exited the scattering medium as transmitted encoded fields. The measuring can comprise measuring the transmitted EM fields comprising frequency shifted EM fields via digital phase shifting holography e.g. using the method illustrated in Blocks of 26 .

Block represents decoding the transmitted EM radiation comprising EM fields in a computer comprising selecting one or more of the EM fields having the variance structure e.g. using a decoding algorithm e.g. as illustrated in . The step can comprise measuring or observing the variance structure in the encoded transmitted EM radiation exiting the scattering medium.

The step can comprise decoding output spatial modes of the transmitted EM radiation having the variance structure.

The decoding can comprise calculating one or more variances or characteristics of variances of the transmitted EM radiation. The step can comprise searching observing a sign signature effect figure or merit of the variance structure in the transmitted EM radiation to decode the transmitted EM radiation.

Block represents constructing EM fields. The step can comprise time reversing optical phase conjugation of the EM fields having the variance structure. The step can comprise time reversing the output spatial modes having the variance structure.

Block represents irradiating the scattering medium with time reversed EM radiation e.g. from a spatial light modulator and or formed using the method of generated from time reversing the EM fields output spatial modes having the variance structure thereby forming a focus defined by the target of the time reversed EM radiation in the scattering medium with the increased resolution. The EM radiation can form speckle at the target and the variance structure can be such that a size of the focus is at most limited by the speckle. The variance structure can be such that a spatial extent of the focus is at most 10 micrometers.

Block represents detecting on a detector output radiation based on an interaction between the time reversed EM radiation and the scattering medium target e.g. fluorescence to produce a detected signal.

Block represents subtracting a background from the detected signal in a computer to obtain an output that at least approximates an interaction between a complete time reversed field of all of the modulated EM radiation and the target e.g. using the methods of 26 .

Block represents digitally scanning the time reversed focus by weighing the fields in the matrices with prefactors that virtually and spatially move the intersection point of the signals.

Block represents forming a plurality of matrices or arrays each representing a plurality of the transmitted encoded fields measured and received from the detector e.g. sCMOS wherein the transmitted encoded fields encoded by each of the spatially shifted and overlapping signals are represented in a different matrix. For example there can be four matrices C C C and C for each of four spatially shifted and overlapping signals.

Each of the EM fields can produce different realizations r of the frequency shifted EM fields each realization r can be represented as a row of the matrices and each row can comprise one of the encoded fields measured for one of the realizations.

Block represents finding searching for calculating the one or more transmitted encoded fields e.g. represented by one or more vectors v in the matrices having the variance structure see 24 at pages 4 8 .

The step can comprise calculating a sum of the matrices and one or more differences of one or more pairs of the matrices and finding one or more vector fields v having higher variance for the sum of the matrices and a smaller variance for the differences of the matrices. The step can comprise finding a vector v representing a mode of zero variance in the differences.

The step can comprise finding a vector v which maximizes the Rayleigh Quotient Q of the matrices. The step can comprise solving an eigenvector equation comprising the Rayleigh Quotient and the vector v wherein the vector v is a principal eigenvector of the Rayleigh Quotient.

The step can comprise solving an eigensystem equation comprising the matrices and an eigenvector v associated with the maximum eigenvalue of the general eigensystem. With four matrices C C C and C the eigensystem equation can be 1 wherein eig 2 where eig represents a principal eigenvector identification operator.

The eigensystem equation 2 can comprise m r matrices where n is the number of pixels of speckle data pixels on the detector sCMOS and r is the number of realizations. The eigensystem equation 2 can be computationally evaluated more quickly and with greater ease by applying approximations see 24 at pages 4 8 such as those set forth below which lead to finding a solution based on two r r Gram matrices.

The above approximations lead to a finding a vector for two dimensional 2D scanning v C CC CC eig CC CC CC CC CC .

One or more embodiments select a scattering medium number of realizations r shape envelope of the signal producing the variance structure e.g. Gaussian and a focus size e.g. delta function wherein one or more of the above approximations hold true.

Block represents finding the complex conjugate of the vector field s v e.g. using the method illustrated in Block or Block of 26 .

Block represents outputting the complex conjugate field s e.g. to a spatial light modulator SLM wherein the time reversed EM radiation comprises time reversed fields generated from the complex conjugate.

The UST can transmit ultrasound waves that define the target inside the scattering medium the EM radiation can comprise spatial modes wherein the target modulates variance of the spatial modes transmitted to the target with a variance structure to form the modulated EM radiation. The DOPC can measure find the output spatial modes of transmitted EM radiation comprising the modulated EM radiation that has exited the scattering medium having the variance structure and construct a time reversed EM field comprising the output spatial modes having the variance structure. The SLM can irradiate the scattering medium with an EM field comprising time reversed fields of the output spatial modes having the variance structure thereby forming a focus of the EM field defined by the target and

The apparatus can further comprise a translatable sample holder supporting the scattering medium and or moving the scattering medium and one or more computers e.g. in communication controlling e.g. timing output of the UST and PLS.

The computers can include microprocessors or microcontrollers or chips. For example the CMOS detector and SLM could be driven with an Arduino microcontroller hooked up to a source of flash memory. Another example is a Raspberry Pi with additional flash memory for example .

In one embodiment the computer operates by the general purpose processor A performing instructions defined by the computer program under control of an operating system . The computer program and or the operating system may be stored in the memory and may interface with the user and or other devices to accept input and commands and based on such input and commands and the instructions defined by the computer program and operating system to provide output and results.

Output results may be presented on the display or provided to another device for presentation or further processing or action. In one embodiment the display comprises a liquid crystal display LCD having a plurality of separately addressable liquid crystals. Alternatively the display may comprise a light emitting diode LED display having clusters of red green and blue diodes driven together to form full color pixels. Each liquid crystal or pixel of the display changes to an opaque or translucent state to form a part of the image on the display in response to the data or information generated by the processor from the application of the instructions of the computer program and or operating system to the input and commands. The image may be provided through a graphical user interface GUI module . Although the GUI module is depicted as a separate module the instructions performing the GUI functions can be resident or distributed in the operating system the computer program or implemented with special purpose memory and processors.

In one or more embodiments the display is integrated with into the computer and comprises a multi touch device having a touch sensing surface e.g. track pod or touch screen with the ability to recognize the presence of two or more points of contact with the surface. Examples of multi touch devices include mobile devices or smartphones e.g. iPhone Nexus S Droid devices etc. tablet computers e.g. iPad HP Touchpad portable handheld game music video player console devices e.g. iPod Touch MP3 players Nintendo 3DS PlayStation Portable etc. touch tables and walls e.g. where an image is projected through acrylic and or glass and the image is then backlit with LEDs .

Some or all of the operations performed by the computer according to the computer program instructions may be implemented in a special purpose processor B. In this embodiment the some or all of the computer program instructions may be implemented via firmware instructions stored in a read only memory ROM a programmable read only memory PROM or flash memory within the special purpose processor B or in memory . The special purpose processor B may also be hardwired through circuit design to perform some or all of the operations to implement the present invention. Further the special purpose processor B may be a hybrid processor which includes dedicated circuitry for performing a subset of functions and other circuits for performing more general functions such as responding to computer program instructions. In one embodiment the special purpose processor B is an application specific integrated circuit ASIC .

The computer may also implement a compiler that allows an application or computer program written in a programming language such as COBOL Pascal C FORTRAN or other language to be translated into processor readable code. Alternatively the compiler may be an interpreter that executes instructions source code directly translates source code into an intermediate representation that is executed or that executes stored precompiled code. Such source code may be written in a variety of programming languages such as Java Perl Basic etc. After completion the application or computer program accesses and manipulates data accepted from I O devices and stored in the memory of the computer using the relationships and logic that were generated using the compiler .

The computer also optionally comprises an external communication device such as a modem satellite link Ethernet card or other device for accepting input from and providing output to other computers .

In one embodiment instructions implementing the operating system the computer program and the compiler are tangibly embodied in a non transient computer readable medium e.g. data storage device which could include one or more fixed or removable data storage devices such as a zip drive floppy disc drive hard drive CD ROM drive tape drive etc. Further the operating system and the computer program are comprised of computer program instructions which when accessed read and executed by the computer cause the computer to perform the steps necessary to implement and or use the present invention or to load the program of instructions into a memory thus creating a special purpose data structure causing the computer to operate as a specially programmed computer executing the method steps described herein. Computer program and or operating instructions may also be tangibly embodied in memory and or DOPC thereby making a computer program product or article of manufacture according to the invention. As such the terms article of manufacture program storage device and computer program product as used herein are intended to encompass a computer program accessible from any computer readable device or media.

Of course those skilled in the art will recognize that any combination of the above components or any number of different components peripherals and other devices may be used with the computer .

The processors or may execute a decoding program using the variance structure defined by the UST to decode the transmitted EM radiation received in the DOPC . Processors or may perform the processing functions of Blocks Blocks and or . For example the processors or may solve the eigenvector equation comprising the Rayleigh Quotient and find the vector that is a principal eigenvector of the Rayleigh Quotient or any other algorithms described in this specification using program . Computer can be used as the computer s in .

A network such as the Internet connects clients to server computers . Network may utilize ethernet coaxial cable wireless communications radio frequency RF etc. to connect and provide the communication between clients and servers . Clients may execute a client application or web browser and communicate with server computers executing web servers . Such a web browser is typically a program such as MICROSOFT INTERNET EXPLORER MOZILLA FIREFOX OPERA APPLE SAFARI etc. Further the software executing on clients may be downloaded from server computer to client computers and installed as a plug in or ACTIVEX control of a web browser. Accordingly clients may utilize ACTIVEX components component object model COM or distributed COM DCOM components to provide a user interface on a display of client . The web server is typically a program such as MICROSOFT S INTERNET INFORMATION SERVER .

Web server may host an Active Server Page ASP or Internet Server Application Programming Interface ISAPI application which may be executing scripts. The scripts invoke objects that execute business logic referred to as business objects . The business objects then manipulate data in database through a database management system DBMS . Alternatively database may be part of or connected directly to client instead of communicating obtaining the information from database across network . When a developer encapsulates the business functionality into objects the system may be referred to as a component object model COM system. Accordingly the scripts executing on web server and or application invoke COM objects that implement the business logic. Further server may utilize MICROSOFT S Transaction Server MTS to access required data stored in database via an interface such as ADO Active Data Objects OLE DB Object Linking and Embedding DataBase or ODBC Open DataBase Connectivity .

Generally these components all comprise logic and or data that is embodied in or retrievable from device medium signal or carrier e.g. a data storage device a data communications device a remote computer or device coupled to the computer via a network or via another data communications device etc. Moreover this logic and or data when read executed and or interpreted results in the steps necessary to implement and or use the present invention being performed.

Although the terms user computer client computer and or server computer are referred to herein it is understood that such computers and may be interchangeable and may further include thin client devices with limited or full processing capabilities portable devices such as cell phones notebook computers pocket computers multi touch devices and or any other devices with suitable processing communication and input output capability.

Of course those skilled in the art will recognize that any combination of the above components or any number of different components peripherals and other devices may be used with computers and .

The algorithms of processing in and or processing in computers can be performed in whole or in part on one or more computers e.g. in a client server relationship as illustrated in .

Embodiments of the invention are implemented as a software application on a client or server computer . Further as described above the client or server computer may comprise a thin client device or a portable device that has a multi touch based display.

Thus illustrate a computer readable storage medium encoded with computer program instructions which when accessed by a computer cause the computer to load the program instructions to a memory therein creating a special purpose data structure causing the computer to operate as a specially programmed computer executing a method of decoding transmitted EM radiation comprising a receiving in the specially programmed computer the transmitted EM radiation comprising a portion of encoded EM radiation transmitted through and exiting the scattering medium and exiting the scattering medium wherein a target inside the scattering medium encodes EM radiation transmitted to the target with a variance structure to form the encoded EM radiation b decoding the transmitted EM radiation comprising EM fields in the computer comprising selecting one or more of the EM fields having the variance structure and c outputting the EM fields having the variance structure wherein the outputted EM fields are time reversed to generate time reversed EM radiation irradiating the scattering medium thereby forming a focus of the time reversed EM radiation in the scattering medium with increased resolution.

This concludes the description of the preferred embodiment of the present invention. The foregoing description of one or more embodiments of the invention has been presented for the purposes of illustration and description. It is not intended to be exhaustive or to limit the invention to the precise form disclosed. Many modifications and variations are possible in light of the above teaching. It is intended that the scope of the invention be limited not by this detailed description but rather by the claims appended hereto.

