---

title: Selective label switched path re-routing
abstract: In one example, a method includes establishing a plurality of label switched paths (LSPs) having a common transit network device other than an ingress network device or an egress network device of any of the plurality of LSPs, and, by the transit network device along the plurality of LSPs, detecting a congestion condition on a link along the plurality of LSPs and coupled to the transit network device. The method also includes, responsive to detecting the congestion condition, and by the transit network device, selecting a subset of the plurality of LSPs to evict from the link, wherein the subset comprises less than all of the plurality of LSPs, and updating a forwarding plane of the transit network device to reroute network traffic received for the selected subset of the plurality of the LSPs for forwarding to a next hop on a bypass LSP that avoids the link.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09253097&OS=09253097&RS=09253097
owner: Juniper Networks, Inc.
number: 09253097
owner_city: Sunnyvale
owner_country: US
publication_date: 20130930
---
This application is a continuation in part of U.S. patent application Ser. No. 13 730 770 entitled SELECTIVE NOTIFICATION FOR LABEL SWITCHED PATH RE ROUTING filed Dec. 28 2012 the entire contents of which are incorporated by reference herein.

The disclosure relates to packet based computer networks and more particularly to forwarding packets within computer networks.

Routing devices within a network often referred to as routers maintain routing information that describe available routes through the network. Upon receiving an incoming packet the routers examine information within the packet and forward the packet in accordance with the routing information. In order to maintain an accurate representation of the network routers exchange routing information in accordance with one or more defined routing protocols such as the Border Gateway Protocol BGP .

Multi protocol Label Switching MPLS is a mechanism used to engineer traffic patterns within Internet Protocol IP networks. By using MPLS a source device can request a path through a network i.e. a Label Switched Path LSP . An LSP defines a distinct path through the network to carry MPLS packets from the source device to a destination device. A short label associated with a particular LSP is affixed to packets that travel through the network via the LSP. Routers along the path cooperatively perform MPLS operations to forward the MPLS packets along the established path. LSPs may be used for a variety of traffic engineering purposes including bandwidth management and quality of service QoS . A packet may be a formatted set of data.

A variety of protocols exist for establishing LSPs. For example one such protocol is the label distribution protocol LDP . Another type of protocol is a resource reservation protocol such as the Resource Reservation Protocol with Traffic Engineering extensions RSVP TE . RSVP TE uses constraint information such as bandwidth availability to compute paths and establish LSPs along the paths within a network. RSVP TE may use bandwidth availability information accumulated by a link state interior routing protocol such as the Intermediate System Intermediate System ISIS protocol or the Open Shortest Path First OSPF protocol.

Head end routers of an LSP are commonly known as ingress routers while routers at the tail end of the LSP are commonly known as egress routers. Ingress and egress routers as well as intermediate routers along the LSP that support MPLS are referred to generally as label switching routers LSRs . A set of packets to be forwarded along the LSP is referred to as a forwarding equivalence class FEC . A plurality of FECs may exist for each LSP although there may in some examples be only one active LSP for any given FEC. Typically a FEC definition includes the IP address of the destination of the LSP e.g. an IP address assigned to the egress router of the LSP. In general each router along the LSP maintains a context that associates a FEC with an incoming label and an outgoing label. The ingress label edge router LER uses routing information propagated from the egress LER to determine the LSP to assign labels for the LSP and to affix a label to each packet of the FEC. The LSRs use MPLS protocols to receive MPLS label mappings from downstream LSRs and to advertise MPLS label mappings to upstream LSRs. When an LSR receives an MPLS packet from an upstream router the LSR performs a lookup in the context and swaps the MPLS label according to the information in its forwarding table based on the lookup and forwards the packet to the appropriate downstream LSR or LER. The egress LER removes the label from the packet and forwards the packet to its destination in accordance with non label based packet forwarding techniques.

In some computer networks MPLS traffic may be routed through an aggregate link which refers to a logical link representing two or more physical links. Logically these aggregate links appear as a single interface to the network devices. For example a bundled link may be a logical construct that represents a way to map information about certain physical resources that interconnect label switching routers with information that is used by constrained Shortest Path First SPF for the purpose of path computation and by MPLS signaling. The aggregate links may also be referred to as bundled links or aggregated bundles. Example aggregate links include aggregated Ethernet links and aggregated SONET links which may be configured and maintained using a link aggregation control protocol LACP . Additional details of link bundling in MPLS TE can be found in K. Kompella Link Bundling in MPLS TE Network Working Group RFC 4201 October 2005 the entire contents of which are incorporated by reference herein.

Generally link aggregation may improve bandwidth in comparison to that of a single link while also providing connection redundancy. That is aggregation of links into logical bundles may result in an available bandwidth of all of the bundled links combined. Managing the forwarding of MPLS traffic over bundled links may be problematic in some situations.

In general this disclosure describes techniques for re routing MPLS traffic for label switched paths LSPs that traverse a one or more shared resources. The techniques may be applied for example by a transit network device along multiple LSPs to selectively notify ingress network devices of the LSPs to prompt one or more of the ingress network devices to re route a subset of the LSPs. The techniques of this disclosure enable a transit router to selectively evict Traffic Engineering LSPs that traverse a shared resource causing some of the ingress network devices to reroute some of the LSPs while leaving other LSPs in place to continue forwarding network traffic along the shared resource.

As one example the shared resource may be a bundled link used by the transit network device to forward traffic for multiple LSPs to a downstream network device. For example multiple ingress network devices may establish several Traffic Engineering TE LSPs that traverse the transit network device and the bundled link. In some cases the bundled link may become oversubscribed. That is an amount of bandwidth reserved by LSPs on the bundled link may exceed the amount of bandwidth allowed to be reserved on the bundled link selected for transport of MPLS traffic that exceeds the available bandwidth of the bundled link. In some cases the bundled link may become congested. For example if a component link or physical interface associated with the bundled link fails this reduces the overall capacity and available bandwidth on the bundled link.

In accordance with the techniques of this disclosure the transit router is configured to treat the link congestion as a link failure for a subset of the LSPs traversing the bundled link. Upon detecting the reduced bandwidth or congestion on the bundled link the transit router along the path of the TE LSPs can use the techniques of this disclosure to select a subset of the LSPs to evict. The transit router can shift the traffic for the selected subset of LSPs to a bypass LSP in order to fix the temporary congestion. This may be referred to herein as soft FRR fast reroute . The transit router can also send a notification to the appropriate ingress routers to trigger the ingress router s to compute a new path for the subset of the LSPs to avoid the affected node or link even if the IGP has not yet updated the bandwidth information. In this manner the transit router can use MPLS fast reroute techniques not only to address failure of a component link of a bundled link but also to address congestion of a component link of the bundled link.

In some examples the transit router may send one or more Path Error messages to the selected ingress router s to inform the ingress routers to re route the appropriate LSPs. In one example aspect the Path Error message may inform the ingress routers that the bundled link has been over subscribed or congested. In this way the transmit router may avoid reroute of all the LSPs traffic engineered to traverse a common aggregate link.

In one example a method includes establishing a plurality of label switched paths LSPs having a common transit network device other than an ingress network device or an egress network device of any of the plurality of LSPs and by the transit network device along the plurality of LSPs detecting a congestion condition on a link along the plurality of LSPs and coupled to the transit network device. The method also includes responsive to detecting the congestion condition and by the transit network device selecting a subset of the plurality of LSPs to evict from the link wherein the subset comprises less than all of the plurality of LSPs and updating a forwarding plane of the transit network device to reroute network traffic received for the selected subset of the plurality of the LSPs for forwarding to a next hop on a bypass LSP that avoids the link.

In some examples after the subset of LSPs has been moved to the bypass LSP the ingress network device is notified and recomputes paths for these LSPs that had been rerouted. The new paths are computed so that they avoid the link that triggered the reroute operation.

In another example aspect a network device includes a hardware based processor a Resource Reservation Protocol with Traffic Engineering extensions RSVP TE module executing on the hardware based processor wherein the RSVP TE module establishes a plurality of label switched paths LSPs having the network device as a common transit network device other than an ingress network device or an egress network device of any of the plurality of LSPs and a congestion detection module that detects a congestion condition on a link along the plurality of LSPs and coupled to the transit network device. Responsive to detecting the congestion condition and the RSVP TE module selects a subset of the plurality of LSPs to evict from the link wherein the subset comprises less than all of the plurality of LSPs and the congestion detection module updates a forwarding plane of the transit network device to reroute network traffic received for the selected subset of the plurality of the LSPs for forwarding to a next hop on a bypass LSP that avoids the link.

In a further example aspect a computer readable storage medium includes instructions for causing a programmable processor to establish a plurality of label switched paths LSPs having a common transit network device other than an ingress network device or an egress network device of any of the plurality of LSPs detect a congestion condition on a link along the plurality of LSPs and coupled to the transit network device responsive to detecting the congestion condition select a subset of the plurality of LSPs to evict from the link wherein the subset comprises less than all of the plurality of LSPs and update a forwarding plane of the transit network device to reroute network traffic received for the selected subset of the plurality of the LSPs for forwarding to a next hop on a bypass LSP that avoids the link.

The techniques of this disclosure may provide one or more advantages. One example is for avoiding prolonged traffic loss that might otherwise occur when a link enters into a congested state as can be the case when one of the member links in a bundle fails . In such a case there may be traffic loss across all the LSPs crossing the congested link. The congestion may continue until the LSPs are moved away from this link. In extreme cases if the ingress node is not notified of the congestion this situation can continue indefinitely. As another example the techniques of this disclosure can increase network utilization and avoid bandwidth wastage by preventing a situation in which each ingress network device reroutes each of the LSPs leaving the bundled link underutilized. The techniques of this disclosure can therefore improve the usefulness of bundled links by mitigating a potential risk of deploying aggregated Ethernet or aggregated SONET links in a network.

The techniques of this disclosure can be used by network devices irrespective of whether they are configured to use LSP preemption. The ingress and transit routers do not need to be configured with LSP preemption. The techniques of this disclosure will work even if all the transit LSPs under consideration either have the same or no priorities configured. Preemption can be used as a tool by some network devices to ensure that high priority LSPs can always be routed through relatively favorable paths. The techniques of this disclosure can also provide a useful tool in situations where preemption is configured on the LSPs but there are multiple LSPs having equal priority. That is the techniques can provide a mechanism for choosing between multiple LSPs having equal preemption priority and evicting less than all of the multiple LSPs having equal priority. In this manner the techniques of this disclosure are complementary to the preemption approach. In addition the techniques of this disclosure can also be used where LSP preemption is not in use. Further details of preemption are described in J. de Oliveira Label Switched Path LSP Preemption Policies for MPLS Traffic Engineering Network Working Group RFC 4829 April 2007 the entire contents of which are incorporated by reference herein.

The techniques of this disclosure allow the transit router to inform the respective ingress routers of an oversubscription or congestion condition so that the ingress routers can act to reroute the LSPs if so desired in response to the notification. This allows the ingress router to reroute the LSP in a make before break manner. In addition the techniques of this disclosure provide more choices to an administrator for managing network bandwidth and present a plurality of options for how the LSPs are selected to be evicted. In addition the techniques of this disclosure can apply not just to the case where congestion is caused by a member link failure but also to the case where there is congestion for any reason at all e.g. some LSP is sending too much traffic .

The details of one or more examples are set forth in the accompanying drawings and the description below. Other features objects and advantages will be apparent from the description and drawings and from the claims.

In some examples network may be a service provider network. For example network may represent one or more networks owned and operated by a service provider which is commonly a private entity that offer one or more services for consumption by subscriber networks. In this context network is typically a layer three L3 packet switched network that provides L3 connectivity between a public network and one or more subscriber networks not shown . Often this L3 connectivity provided by a service provider network is marketed as a data service or Internet service and subscribers may subscribe to this data service. Network may represent a L3 packet switched network that provides data voice television and any other type of service for purchase by subscribers and subsequent consumption by subscriber networks.

While not shown in the example of network system may include additional service provider networks subscriber networks and other types of networks such as access networks private networks or any other type of network commonly employed to deliver one or more services such as data service Internet Protocol Television IPTV service voice over Internet Protocol VoIP service video telephony service or any other type of service to subscriber networks.

In the example of router A is a transit router along the path of two label switched paths LSPs A and B LSPs . That is as a transit router router A is an intermediate router along LSPs and is neither an ingress router nor an egress router of the LSPs. In this example PE router A is the ingress router of LSP A and PE router B is the egress router of LSP A. PE router C is the ingress router of LSP B and PE router D is the egress router of LSP B. Both of LSPs A and B run through transit router A bundled link and transit router B. Bundled link is one example of a shared resource that is shared by router A. In some examples the shared resource may be a single link or a network device for example.

PE routers and routers represent any network device that routes or otherwise forwards traffic through network . Typically routers represent a L3 packet switching device that operates at L3 to exchange routing information using a routing protocol such as an Interior Gateway Protocol IGP describing a current topology of network . Routers then process this routing information selecting paths through its representation of the topology of network to reach all available destinations to generate forwarding information. In other words routers reduce these paths to so called next hops which identify which of its interfaces traffic destined for a particular destination is to be forwarded where the forwarding information includes this list of next hops. Routers then install this forwarding information in a forwarding plane of the router whereupon the forwarding plane forwards received traffic in accordance with the forwarding information.

In the example of bundled link is a bundled link comprised of component links A B component links . Although illustrated with two component links in other examples bundled link may include more than two component links. As examples bundled link may be an aggregated Ethernet link and aggregated SONET link or other aggregated bundled link.

In some examples network administrators may use traffic engineering in network to guarantee characteristics such as bandwidths of the LSPs . To do this routers may track and advertise in the IGP route advertisements the available bandwidth on each link. Routers can then compute traffic engineered paths through network taking into account the available bandwidth and when LSPs A and B are established routers adjust an amount of available bandwidth tracked for bundled link .

Routers exchange RSVP TE messages to reserve bandwidth and confirm the reservation. For example router A receives RSVP TE PATH messages from PE routers A and C for setting up LSPs A and B respectively. In response router A forwards the RSVP TE PATH messages to router B and also sends RSVP TE RESV messages back to the ingress routers confirming the reservation of the requested bandwidth. In this way a total bandwidth provided by aggregate link may be utilized by routers when signaling and provisioning LSPs A B.

In some cases bundled link may become oversubscribed and or congested. For example a bundled link may become oversubscribed when bandwidth reserved for use by LSPs A B for transport of MPLS traffic through aggregated link exceeds the bandwidth currently available from the aggregated link. For example an oversubscription condition can occur on a link when the combined demand of all RSVP sessions exceeds a physical capacity of the link e.g. for example because one of the member links in a bundled link failed .

In some situations bundledlink may become congested. For example traffic on the LSPs may not be kept within the bandwidth limits signaled such as because ingress routers PE A C may not use policing. In some examples link capacity changes dynamically for example due to degradation of a radio link or microwave link e.g. due to weather conditions or failure of a component link in an aggregate. In other examples extra unaccounted for traffic is put on bundled link . For example another network device may redirect traffic on to a bypass LSP not shown that traverses bundled link but for which the bypass LSP does not have any bandwidth reservation. When one of these events happens bundled link may become overloaded and traffic loss may occur affecting LSPs transiting bundled link . Although described for purposes of example in the context of bundled links the techniques of this disclosure are not limited to bundled links. Rather the techniques may be applied generally to individual links that may become congested for any of a variety of reasons including those reasons mentioned above.

Router A may be configured with a value that specifies a percentage of an interface or link s bandwidth i.e. physical capacity of a link that is allowed to be used for reservations. This percentage can be 100 for example or more or less than 100 . An allowed bandwidth of greater than 100 would mean that it is permitted to reserve bandwidth amounts greater than a physical capacity of a link e.g. when the timing of traffic is spread out throughout the day and likely to actually exceed the capacity at any given time . In this case an oversubscription condition would occur on the link when the combined demand of all RSVP sessions exceeds the configured amount of allowed bandwidth even though that amount of configured bandwidth may exceed the physical capacity of the link.

In one example component links A and B may each have a bandwidth capacity of ten Gigabits per second Gbps giving bundled link a bandwidth capacity of twenty Gigabits per second. Assume LSP A requires five Gigabits per second and LSP B requires twelve Gigabits per second. If component link A fails router A detects an oversubscription congestion condition on bundled link because without the capacity of component link A the overall configured amount of allowed bandwidth for bundled link is suddenly reduced compared to the bandwidth reserved for use by LSPs A B. For example router A may use LACP for detecting the component link failure. As another example router A can use a connectivity fault detection protocol session on each component link to detect when failure of the component link occurs. The connectivity fault detection protocol may be for example Bidirectional Forwarding Protocol BFD Ping and the like. Router A may detect that the amount of reserved bandwidth on bundled link in this example seventeen Gbps exceeds the new amount of available bandwidth after the failure ten Gbps . Unless and until at least one of LSPs is rerouted LSPs may observe traffic loss.

Router A detects the change in available bandwidth on an interface associated with bundled link . In accordance with the techniques of this disclosure in response to detecting an oversubscription or congestion condition on the bundled link router A selects for eviction one or more LSPs that run through the bundled link . Router A can be configured to use various methods of selecting which LSPs to evict and several examples are described below. In one example router A determines that evicting LSP B and leaving LSP A untouched will meet the new bandwidth constraint of bundled link .

Transit router A may have previously signaled bypass LSP as a backup path for protecting bundled link . Transit router A is the point of local repair PLR for bypass LSP . Bypass LSP is an LSP or tunnel that provides link protection for bundled link between router A and router B such that if bundled link should fail router A can tunnel network traffic from an existing LSP through bypass LSP . Router A may establish bypass LSP in accordance with MPLS fast reroute techniques as described in P. Pan Fast Reroute Extensions to RSVP TE for LSP Tunnels Network Working Group RFC 4090 May 2005 the entire contents of which are incorporated by reference herein.

For example as the point of local repair PLR and ingress of bypass LSP router B may establish bypass LSP to protect one or more other existing LSPs such as LSPs that traverse at least router A and router B and do not traverse router C. In some examples router A may establish bypass LSP upon request by an ingress router of one of these protected LSPs . For example router A may receive an RSVP TE PATH request from ingress PE router A that includes a fast reroute object in which a local protection desired flag or other fast reroute flag is set. After router A establishes bypass LSP router A maintains forwarding information in a data plane of router A that allows router A to send traffic through bypass LSP if bundled link fails.

Responsive to detecting the oversubscription congestion condition on the bundled link router A may perform a soft reroute action to reroute the traffic for just the selected LSP B onto a previously established bypass LSP . For example router A may update its stored forwarding state to change the primary next hop for LSP B such as by setting a next hop for bypass LSP as the primary next hop for traffic received for LSP B. In some examples router A may delete the previous primary next hop that went over bundled link based on the congestion. In other examples router A may not delete the previous primary next hop for LSP B but may just assign a weight to the next hop such that it is considerably de preferred.

When performing the soft reroute action router A does not change the forwarding state for LSP A over bundled link and does not reroute the traffic received on LSP A to the bypass LSP . In this manner router A can selectively reroute a subset of the LSPs less than all of the LSPs from the bundled link onto a bypass LSP to address the detected oversubscription congestion condition.

Router A also sends a notification to PE router C the ingress router of LSP B. For example the notification may be a Path Error message such as an RSVP TE PathErr message. PathErr messages are routed hop by hop using the path state established when a Path message is routed through the network from the ingress to egress. PathErr messages do not modify the state of any node through which the pass they are only reported to the ingress of the TE LSP. Further information regarding PathErr messages can be found in J P. Vasseur Node Behavior upon Originating and Receiving Resource Reservation Protocol RSVP Path Error Messages RFC 5711 January 2010 the entire contents of which are incorporated by reference herein.

In this example router A does not however evict LSP A or send a notification to PE router A the ingress router of LSP A. Instead router A makes no change to LSP A and does not notify PE router A of the detected oversubscription. Router A allows traffic to continue to be forwarded along LSP A over bundled link . In this manner transit router A selects a subset of the LSPs to which to be evicted and sends notifications for only the selected LSPs. In some examples LSP A and LSP B may be configured with equal preemption priority levels and the techniques of this disclosure allow for selecting fewer than all of the LSPs having equal preemption priority. Alternatively the techniques of this disclosure can also be used when preemption is not configured on the ingress and or transit routers for the LSPs.

As one example when LSP B is evicted ingress PE router C receives the Path Error message from transit router A and selects a new path that avoids bundled link . For example PE router C may send an RSVP TE PathTear message to router A to tear down LSP B and may then re signal LSP B over the path from PE router C to router C to router B to PE router D by sending a new RSVP TE Resv message along this path. In this manner router A can use MPLS fast reroute techniques to address congestion of a component link of bundled link . Network capacity planning will have allocated enough bandwidth on the bypass LSP so there would be no traffic loss on LSP B.

Transit router A sends a corresponding PathErr messages for a given RVSP signaling session and therefore for a given LSP so the example of only evicts LSP B. Thus even if ingress router C had other LSPs established through router A and bundled link ingress router C would not necessarily reroute those other LSPs to avoid bundled link upon receiving the PathErr message.

Transit router A may use various techniques to notify the appropriate ingress router s of the recommended eviction. The ingress PE routers A C may be configured to allow LSP preemption on LSPs A B. For example the ingress PE routers A C of the LSPs A B may when signaling to establish the LSPs explicitly signal the desire for the LSPs to benefit from a soft preemption mechanism and thus not to be hard preempted if the soft preemption mechanism is available . For example the transit router can send the same PathErr message as used when soft preemption is configured such as a Path Error Reroute Request Soft Preemption error value as described in M. Meyer MPLS TE Soft Preemption IETF RFC 5712 January 2010 the entire contents of which are incorporated by reference herein. This may include setting a Soft Preemption Desired bit in the Session Attribute Flags of the RSVP signaling messages. Transit router A can determine whether preemption is configured for the LSPs based for example on the LSP signaling by the ingress router.

As another example transit router A may inform the ingress router s of the LSPs to be evicted of the recommended eviction by sending a Path Error message having a newly defined error code such as a code indicating link oversubscription detected as the reason for the Error message. The transit router A can notify the ingress routers of the recommended eviction independent of whether preemption is configured on the ingress routers.

In this way the techniques of this disclosure allow the transit router A to inform the respective ingress routers of an oversubscription condition detected on bundled link so that the ingress routers can act to reroute the LSPs if so desired in response to the notification. This allows the ingress router to reroute the LSP in a make before break manner. Unlike conventional preemption methods no action is taken by the transit router in terms of sending ResvTear message or tearing down LSP sessions. In addition as described in further detail below the techniques of this disclosure provide more choices to an administrator for managing network bandwidth and present a plurality of options for how the LSPs are selected to be evicted.

Routing component primarily provides an operating environment for control plane protocols . For example one or more IGP routing protocols such as Intermediate System to Intermediate System ISIS routing protocol A or the Open Shortest Path First OSPF routing protocol B maintain routing information to reflect the current topology of a network and other network entities to which router is connected. In particular IGPs update routing information to accurately reflect the topology of the network and other entities. Router may include other example routing protocols such as Border Gateway Protocol BGP .

Routing component generates and programs forwarding component with forwarding information that associates network destinations with specific next hops and corresponding interfaces ports of IFCs in accordance with routing information . Routing component may generate forwarding information in the form of a radix tree having leaf nodes that represent destinations within the network for example.

Based on forwarding information forwarding component forwards packets received from inbound links A N to outbound links A N that correspond to next hops associated with destinations of the packets. U.S. Pat. No. 7 184 437 provides details on an exemplary embodiment of a router that utilizes a radix tree for route resolution. The entire contents of U.S. Pat. No. 7 184 437 are incorporated herein by reference.

In one example forwarding component is a rich and dynamic shared forwarding plane optionally distributed over a multi chassis router. Moreover forwarding component may be provided by dedicated forwarding integrated circuits normally associated with high end routing components of a network router. Further details of one example embodiment of router can be found in U.S. Pat. No. 8 339 959 issued Dec. 25 2012 entitled STREAMLINED PACKET FORWARDING USING DYNAMIC FILTERS FOR ROUTING AND SECURITY IN A SHARED FORWARDING PLANE the entire contents of which are incorporated herein by reference.

As shown in protocols executing within routing component includes one or more MPLS protocols for establishing a LSP which may be accumulated by IGPs . For example RSVP TE may generate and maintain a traffic engineering database including bandwidth reservations for paths associated with MPLS LSPs. Constrained Shortest Path First CSPF process computes a shortest path or paths for an MPLS LSP based on specified constraints and bandwidth availability information associated with the links within the network. IGPs may in turn advertise the calculated bandwidth availability information in traffic engineering database TED to other peer routers. As another example constrained Label Distribution Protocol CR LDP may send and receive label mapping messages for establishing a LSP.

In addition routing component includes a link aggregation control protocol LACP module that operates to bundle one or more of interfaces associated with links into a bundled link and treat the bundled link as a single logical interface in terms of forwarding. While shown as implementing LACP control unit may implement or otherwise provide an execution environment for any other type of bundled link protocol capable of establishing bundled links of logical and or physical interfaces. LACP module generally provides the abstraction to maintain bundled link .

When operating as a transit router such as router A router receives RSVP TE PATH messages from PE routers A and C for setting up LSPs A and B respectively. In response RSVP TE module of router forwards the RSVP TE PATH messages to router B and also sends RSVP TE RESV messages back to the ingress routers confirming the reservation of the requested bandwidth. RSVP TE module may also inform IGPs which in turn can update TED with current available bandwidth information. IGPs may also forward the updated current available bandwidth information to other IGP peers. In some cases IGPs may not perform an IGP update for small changes in bandwidth and router may be configured with a threshold bandwidth amount that IGPs use to determine when to perform an IGP update. RSVP TE module may also store MPLS labels to forwarding information for LSPs A and B.

Subsequent to LSPs A and B being established router as the transit router may in some examples detect an oversubscription condition on a bundled link such as bundled link . For example connectivity fault detection module may run a session on each component link of the bundled link and can detect when one of the component links fails. In some examples connectivity fault detection module may inform congestion detection module of a component link failure and congestion detection module will determine whether this results in congestion. In some examples the bundled link is managed by the kernel of router and the routing protocol daemon RPD and or RSVP TE module is informed by the kernel if there is any change. RSVP TE module will react depending on its configuration. In some examples LACP module may be used to detect the component link failure and can inform RSVP TE module .

In the example of a one hop session IGP at a transit router adjacent to the failed link then a Periodic Packet Management Daemon PPMD not shown of routing component may delegate connectivity fault detection functionality to a forwarding component monitor module e.g. pfemon . Otherwise routing component will do fault detection such as with LACP module . Example techniques for connectivity fault detection in a multi chassis routing system are described in U.S. Pat. No. 7 720 061 filed Aug. 18 2006 entitled Distributed Solution for Managing Periodic Communications in a Multi Chassis Routing System the entire contents of which are incorporated by reference herein.

In some examples congestion detection module detects congestion on an aggregated bundle such as bundled link . In some examples congestion detection module can request RSVP TE usage statistics from forwarding component detect congestion by comparing the received statistics to configured threshold usage amounts. In some examples congestion detection module may monitor link usage such as in terms of number of bytes per second and compare the link usage to a configured threshold. Congestion detection module may continuously or periodically check the usage. In some examples congestion detection module can look at the signaled bandwidth and determine whether the signaled bandwidth exceeds a threshold amount for bundled link . The threshold amount of bandwidth may in some examples be based on percent of utilization of a reserved bandwidth of the link. Congestion detection module may determine that the reserved amount of bandwidth exceeds the configured percentage of the bundled link interface s bandwidth allowed to be used for reservations. In some examples congestion detection module may detect a congestion condition in response to detecting any level of congestion however small alternatively congestion detection module may detect a congestion condition only when the level of congestion exceeds some preconfigured threshold level of congestion e.g. a percentage or absolute value .

In some examples connectivity fault detection module and congestion detection module may cooperate to detect an oversubscription condition and or congestion condition. Responsive to detecting an oversubscription condition and or congestion condition congestion detection module informs RSVP module in the control plane of router of the detected condition.

Although illustrated for purposes of example as being positioned in the forwarding component e.g. in the forwarding plane of router congestion detection module could alternatively be located in the control plane of router such as within routing component . In the case of congestion detection module being located in the control plane congestion detection module may poll the forwarding component for statistics and information and compare the data received from forwarding component to configured congestion thresholds. In one example congestion detection module may comprise a software application programming interface API in the control plane of router that notifies notify the control plane of the status of aspects of forwarding component such as next hop utilization statistics and forwarding component responds by providing the requested statistics. In this case congestion detection module would perform the bookkeeping accounting of bandwidth in the control plane.

In response to RSVP TE module being informed of an oversubscription congestion condition such as by congestion detection module selective eviction module SK module examines the set of LSPs that are associated with the bundled link interface and selects one or more of the LSPs to evict to bring the reserved amount of bandwidth within the configured percentage of bandwidth allowed to be used for reservations. Selective eviction module can use any of a plurality of different options of selecting one or more of the LSPs to evict each option specifying a different algorithm to be used by the transit network device for selecting a set of the plurality of LSPs to evict from the link.

The LSPs being evicted may be point to point P2P LSPs or may be point to multipoint P2MP LSPs for example. There may be a situation where two different branches of the same P2MP traverse a common link which becomes congested. In this situation even if only one of the branch LSPs would need to be evicted to satisfy the bandwidth requirements RSVP TE module may still evict both of the branch LSPs of the same P2MP LSP. For example in some cases the two branches may be associated with different sessions in the control plane but a single session in the forwarding plane. RSVP TE module evicts the LSPs on a per session basis so RSVP TE module may need to evict both branch LSPs if they are associated with a single session in the forwarding plane for example. In other examples RSVP TE module may evict only one of the branch LSPs of the same P2MP LSP if able.

In some examples the LSP may be a bi directional LSP which is composed of two individual LSPs that traverse the same path in opposite directions. In some examples if SE module selects one LSP of a bidirectional LSP for eviction and RSVP TE module reroutes the LSP onto a bypass tunnel RSVP TE module may also re route the other LSP of the bidirectional LSP so that it still travels the same path e.g. through the bypass tunnel or a different tunnel along the same path as the other LSP in the bidirectional LSP.

After selecting one or more LSPs along bundled link for eviction to address the congestion condition selective eviction module of router A may update forwarding information to set a next hop to router C along bypass LSP as the primary next hop such as by changing weights associated with the next hops in the forwarding information. In some examples router A may also then delete the next hop along bundled link from the forwarding state.

Router also includes management interface by which an administrator ADMIN script or network management system can configure router . In some examples an administrator may manually configure the bandwidth utilization and congestion thresholds to router via management interface . In some examples management interface may be presented locally or may be used for receiving information by way of an Application Programming Interface API from a Software Defined Network SDN controller or Path Computation Element PCE for example.

Management interface may provide user interface or other interface that presents a plurality of options for selecting an LSP for eviction and receives an indication of a selection of one or more of the presented options. In some examples the management interface may present as options two or more of the algorithms specified below in Examples One through Six. In some aspects management interface may present the options in a simple form such as optimize bandwidth usage on link minimize number of LSPs displaced minimize number of large bandwidth LSPs displaced select randomly or other options from which a selection can be made. Management interface may receive an indication of a selected one of the plurality of options e.g. as selected by an administrator or network management system and may inform selective eviction module of RSVP TE of the selected option. Subsequently in response to being informed of an over subscription congestion condition on a link selection eviction module can apply the algorithm specified by the selected one of the plurality of options to generate a list of candidate LSPs and to select which LSP s to evict from the link.

In some examples selective eviction module may select the LSP to move to bypass LSP using the following default heuristics if nothing else is configured by an administrator Hold priority Worst hold priority LSP is moved first. Prefer LSPs for which bandwidth protection is available that is LSPs for which a bypass LSP exists and ideally for which reserved bandwidth for the bypass exists so as not to move the problem around. Ingress router indication of switch away. For example the ingress router can set a flag in LSP ATTRIBUTES object to notify other routers while setting up an LSP.

In the above examples various tie breaker methods may be used if the LSPs have equal priorities. For example if all transit LSPs are equal in terms of reserved bandwidth priorities and other attributes the transit router may consider the actual usage statistics of the transit LSPs and will select LSPs for eviction according to lowest usage first policy. If statistics collection is not allowed in a transit router then the default mechanism may be to choose LSPs randomly.

Selective eviction module can use various features of LSPs to determine which to select for eviction. For example RSVP TE module of router may store information regarding LSP priorities and or information regarding which LSPs were signaled with link protection requested. RSVP TE module may also store information regarding whether LSPs have been signaled with a switch away flag. The switch away flag is an LSP attribute object in RSVP TE PATH message that indicates that it is acceptable for a transit router to switch LSP traffic to a bypass LSP responsive to detecting a condition such as congestion. Other characteristics such as LSP hold priority in an RSVP session object may be used for choosing an LSP for eviction from among multiple LSPs. Hold priority is traditionally used to indicate which LSPs have priority to stay in case some RSVPs are to be preempted. Further information on LSP priorities are described in D. Awduche RSVP TE Extensions to RSVP for LSP Tunnels Network Working Group RFC 3209 December 2001 the entire contents of which being incorporated by reference herein.

In some examples selective eviction module may be configured to include as one of the selection criteria the criterion of whether preemption is configured on the LSPs. In some examples if preemption is configured on an LSP selective eviction module may ignore the preemption and apply the techniques of this disclosure to select the LSP for eviction. As another option in some examples if preemption is configured on an LSP selective eviction module may not ignore the preemption may apply the preemption and not select the LSP for eviction according to the usual criteria it applies.

RSVP TE module can store the above information based on RSVP TE PATH requests received from ingress routers for example. Selective eviction module can use these features of LSPs as a basis for determining which LSPs to select for eviction in response to detecting a congestion condition on a bundled link . In some examples selective eviction module may be configured to choose one or more LSPs having the lowest hold priority to be moved to bypass LSP . In some examples selective eviction module may be configured to choose one or more LSPs having link protection enabled to be moved to bypass LSP . In some examples selective eviction module may be configured to choose one or more LSPs having switch away flag enabled to be moved to bypass LSP . The particular order of criteria and which should be included may be user configurable on router .

In some example algorithms selective eviction module may consider for possible eviction only those bandwidths that have non zero reserve bandwidth letting through all those LSPs with bandwidths that have zero bandwidth reserved.

A first example algorithm for selecting which LSPs to evict is designed to minimize the bandwidth wastage in the network. Specifically the goal in this algorithm is to use the bundled link as efficiently as possible. Assume there are N Traffic Engineering LSPs sharing the link. The optimization can be written as 

where Lis a coefficient that is either 0 or 1 Sindicates bandwidth with which LSP i is signaled from the corresponding ingress and where B is the amount of aggregate reservable bandwidth computed after a component link of the aggregate link fails and reduces available bandwidth. When Lis 1 this means that LSP i is allowed to stay on the link and is not selected for eviction and when Lis 0 this means that LSP i is not allowed to stay on the link and is selected for eviction. That is selective eviction module can select one or more LSPs to evict such that a sum of the reserved bandwidth of those of the plurality of LSPs that were not selected to evict from the link is maximized and wherein the maximized sum is less than or equal to an amount of reservable bandwidth of the link. The transit router will inform the corresponding ingress routers of the LSPs selected for eviction by sending a notification. All the LSPs for which L 0 are supposed to be evicted. For example suppose L 0.1 and L 0.2. The algorithm then approximates these values by truncating them such that L 0 and L 0 and solves the sum. In this example only LSPs with S 0 are candidates for eviction.

A second example algorithm for selecting which LSPs to evict is designed to minimize the number of Traffic Engineering LSPs to be re routed. The optimization can be written as 

where Lis a coefficient that is either 0 or 1 and where Sindicates bandwidth with which LSP i is signaled from the corresponding ingress and where B is the amount of aggregate reservable bandwidth computed after a component link of the aggregate link fails and reduces available bandwidth. Similar to the Example One when Lis 1 this means that LSP i is allowed to stay on the link and is not selected for eviction and when Lis 0 this means that LSP i is not allowed to stay on the link and is selected for eviction. That is selective eviction module can select one or more LSPs to evict so as to minimize a number of LSPs in the subset of the plurality of LSPs to evict from the link wherein the sum of the reserved bandwidth for each of the plurality of LSPs that were not selected is less than or equal to an amount of reservable bandwidth of the link. The transit router will inform the corresponding ingress routers of the LSPs selected for eviction by sending a notification. All the LSPs for which L 0 are supposed to be evicted. In this example only LSPs with S 0 are candidates for eviction.

Various greedy approaches can also be offered. A greedy approach does not have the computational cost of solving an optimization problem. Computation cost could be issue for a transit route which has limited processing power and memory. Moreover a transit router has to keep track of a large number of LSPs.

In this greedy approach selective eviction module of RSVP TE at the transit router will sort all the Traffic Engineering LSPs on the link at issue in a decreasing order of reserved bandwidths. Selective eviction module will keep in place on the link all the largest bandwidth LSPs whose aggregate reserved bandwidth B. That is selective eviction module can determine a set of the LSPs which of the LSPs have the largest bandwidth and for which the sum of the bandwidth of the set of the LSPs is less than or equal to an amount of reservable bandwidth of the link and select the subset as those LSPs of the plurality of LSPs that are not members of the determined set. For the remaining LSPs router will send notifications informing their respective ingress routers of the need to reroute to avoid the link. The motivation behind this approach is that since it might be difficult to re route large bandwidth LSPs it is better to displace smaller bandwidth LSPs.

In this greedy approach selective eviction module of RSVP TE at the transit router will sort all the Traffic Engineering LSPs in an increasing order of reserved bandwidths. Selective eviction module will keep in place on the link all the smallest bandwidth LSPs whose aggregate reserved bandwidth B. That is selective eviction module will determine a set of the LSPs which of the LSPs have the smallest bandwidth and for which the sum of the bandwidth of the set of the LSPs is less than or equal to an amount of reservable bandwidth of the link and select the subset as those LSPs of the plurality of LSPs that are not members of the determined set. For the remaining LSPs router will send notifications informing their respective ingress routers of the need to reroute to avoid the link. The motivation behind this approach is that since re routing causes network churn it is better to cause displacement of fewer LSPs.

In another example the LSPs to be evicted can be selected randomly such that the sum of the reserved bandwidth for each of the plurality of LSPs that were not selected is less than or equal to an amount of reservable bandwidth of the link. In one example of this greedy approach selective eviction module of RSVP TE at the transit router will not displace an existing Traffic Engineering LSP with

In another approach RSVP at the transit router might in one option simply displace all the existing Traffic Engineering LSPs from the link and inform all the affected ingress routers. For example the techniques of this disclosure may provide a graceful mechanism for the transit router to automatically inform all routers to move all of the LSPs away from a link or node.

After selecting one or more LSPs for eviction and reroute onto bypass LSP selective eviction module reroutes traffic for the selected LSPs onto the bypass LSP . For example selective eviction module may update the forwarding plane by changing the weighting of the next hop associated with bypass LSP to promote this next hop to the primary next hop. Selective eviction module may also remove the primary next hop from the forwarding plane optionally after a waiting period. Examples of updating forwarding state for fast reroute are described in U.S. Pat. No. 8 077 726 entitled FAST REROUTE FOR MULTIPLE LABEL SWITCHED PATHS SHARING A SINGLE INTERFACE issued Dec. 13 2011 the entire contents of which are incorporated by reference herein.

Selective eviction module causes RSVP TE to generate a notification to be sent to the ingress routers of each of the LSPs selected by any of the above example methods. For example the notification may be an RSVP TE Path Error message. For example the Path Error message may be a standard PathErr message used for LSP soft preemption a PathTear message for tearing down the LSP by hard preemption or a newly defined Path Error message for indicating an oversubscription condition on the bundled link. In some examples the Path Error message may specify the bundled link that is oversubscribed or may specify the interface associated with the bundled link . Router then outputs the Path Error message to the respective ingress routers.

After sending the notification in the case of soft preemption being configured in some examples RSVP TE module may wait a time period and if RSVP TE module does not receive a PathTear message from the ingress router to reroute the LSP so as to avoid the bundled link RSVP TE module of router will then itself send a PathTear message to tear down the LSP from the bundled link and remove the LSP from stored state. In the case of hard preemption RSVP TE module may immediately tear down the LSP state without waiting. Further information on soft preemption and hard preemption can be found in L. Berger PathErr Message Triggered MPLS and GMPLS LSP Reroutes IETF RFC 5710 January 2010 the entire contents of which are incorporated by reference herein. In some examples congestion detection module may continue to monitor the congestion of the link and upon determining that the congestion condition subsides congestion detection module may inform RSVP TE module to reroute the LSP from the bypass LSP back to the original path.

In another example router may operate as an ingress router head end of a TE LSP. For example router may receive a notification sent by a downstream transit router of an LSP of which router is the ingress. For example the notification may be a Path Error message with a new error code that indicates an oversubscription condition on a bundled link at the transit router. RSVP TE module of router may be configured to correctly interpret the new Path Error message having the error code and can reroute the LSP indicated by the Path Error message to avoid the oversubscribed bundled link. For example in response to receiving the Path Error message RSVP TE module can send a Path Tear message for the LSP to be rerouted and can remove stored state from forwarding information and TED and CSPF computes a new path through network that avoids the bundled link. RSVP TE module sends a new RSVP Path message along the computed path that avoids the link.

In some examples the transit network device may present a management interface such as management interface which may be for example an Application Programming Interface API from a Software Defined Network SDN controller or Path Computation Element PCE or a locally presented interface accessed by an administrator. The management interface of the transit router can present a plurality of options for selecting an LSP for eviction and receives an indication of a selection of one or more of the presented options .

The ingress network device and the transit network device signaling messages to establish a TE LSP . For example PE router C and transit router A exchange RSVP TE signaling messages to establish a TE LSP such as LSP B. At the time the LSP is established there may be multiple LSPs with multiple ingress network devices and when established the sum of the bandwidth of all of the LSPs on the link is within the allowed amount of reserved bandwidth of the link. The link may be a bundled link in some examples. Subsequent to the LSP being established the transit network device detects a link oversubscription condition or a congestion condition on a link of the LSP . The oversubscription congestion condition may occur due to a component link of the bundled link having failed for example or due to other issues in the network.

Responsive to detecting the oversubscription congestion condition the transit network device selects for eviction one or more LSPs that run through the bundled link experiencing the condition. For example selective eviction module of transit router A may use one of the example algorithms described above for selecting LSP s to evict from bundled link . In one example router A selects LSP B for eviction from the oversubscribed congested bundled link. The transit network device updates the forwarding information in its forwarding plane to re route the traffic received for the selected LSP s onto one or more bypass LSPs . For example selective eviction module of router A may update forwarding information to set a next hop to router C along bypass LSP as the primary next hop such as by changing weights associated with the next hops in the forwarding information. In some examples router A may also then delete the next hop along bundled link from the forwarding state.

The transit network device also sends a notification message to the ingress router to trigger rerouting of the LSP . Various examples of notification messages are described above. For example the notification may be a Path Error message such as an RSVP TE PathErr message. For example router A can send a Path Error message to PE router C the ingress router of LSP B to trigger rerouting of LSP B to avoid the link . In some examples the Path Error message may identify the particular LSP B to be rerouted. For example the Path Error message may identify the session ID of the session associated with the LSP B. For example the Path Error message may include a session header from the original PATH message received which may specify the tunnel ID router ID of the originating router and other information for example.

Ingress PE router C receives the Path Error message from transit router A and in response RSVP TE module of ingress PE router C examines the Path Error message. The behavior at nodes receiving RSVP PathErr messages is described in JP. Vasseur Node Behavior upon Originating and Receiving Resource Reservation Protocol RSVP Path Error Messages RFC 5711 January 2010 the entire contents of which are incorporated by reference herein. In the example of a new error code that specifies an oversubscription condition RSVP TE module of ingress PE router C may determine that the Path Error message requires RSVP TE module to reroute the LSP to avoid the oversubscribed link. In response RSVP TE module reroutes the LSP to a different path . For example RSVP TE module invokes CSPF to select a new path that avoids bundled link . PE router C may send an RSVP TE PathTear message to router A to tear down LSP B and may then re signal LSP B over the path from PE router C to router C to router B to PE router D by sending a new RSVP TE Resv message along this path.

The techniques described in this disclosure may be implemented at least in part in hardware software firmware or any combination thereof. For example various aspects of the described techniques may be implemented within one or more processors including one or more microprocessors digital signal processors DSPs application specific integrated circuits ASICs field programmable gate arrays FPGAs or any other equivalent integrated or discrete logic circuitry as well as any combinations of such components. The term processor or processing circuitry may generally refer to any of the foregoing logic circuitry alone or in combination with other logic circuitry or any other equivalent circuitry. A control unit comprising hardware may also perform one or more of the techniques of this disclosure.

Such hardware software and firmware may be implemented within the same device or within separate devices to support the various operations and functions described in this disclosure. In addition any of the described units modules or components may be implemented together or separately as discrete but interoperable logic devices. Depiction of different features as modules or units is intended to highlight different functional aspects and does not necessarily imply that such modules or units must be realized by separate hardware or software components. Rather functionality associated with one or more modules or units may be performed by separate hardware or software components or integrated within common or separate hardware or software components.

The techniques described in this disclosure may also be embodied or encoded in a computer readable medium such as a computer readable storage medium containing instructions. Instructions embedded or encoded in a computer readable medium may cause a programmable processor or other processor to perform the method e.g. when the instructions are executed. Computer readable media may include non transitory computer readable storage media and transient communication media. Computer readable storage media which is tangible and non transitory may include random access memory RAM read only memory ROM programmable read only memory PROM erasable programmable read only memory EPROM electronically erasable programmable read only memory EEPROM flash memory a hard disk a CD ROM a floppy disk a cassette magnetic media optical media or other computer readable storage media. It should be understood that the term computer readable storage media refers to physical storage media and not signals carrier waves or other transient media.

Various aspects of this disclosure have been described. These and other aspects are within the scope of the following claims.

