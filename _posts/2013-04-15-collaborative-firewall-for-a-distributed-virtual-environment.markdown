---

title: Collaborative firewall for a distributed virtual environment
abstract: A virtual environment firewall receives a message having a request from a virtual environment entity intended for a virtual environment controller. The virtual environment firewall determines whether the request complies with one or more governance rules of the virtual environment controller. If the request does not comply with the one or more governance rules, the virtual environment firewall processes the message to prevent the request from being processed by the virtual environment controller.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09503426&OS=09503426&RS=09503426
owner: Qurio Holdings, Inc.
number: 09503426
owner_city: Peterborough
owner_country: US
publication_date: 20130415
---
This patent application is a continuation of co pending U.S. patent application Ser. No. 12 644 219 filed on Dec. 22 2009 entitled COLLABORATIVE FIREWALL FOR A DISTRIBUTED VIRTUAL ENVIRONMENT which claims the benefit of U.S. Provisional Patent Application No. 61 141 721 filed on Dec. 31 2008 entitled COLLABORATIVE FIREWALL FOR A DISTRIBUTED VIRTUAL ENVIRONMENT the disclosures of each of which are hereby incorporated herein by reference in their entirety.

The present invention relates to virtual environments and in particular to a firewall for a distributed virtual environment.

Virtual environments are widely used for training gaming and other purposes. Such virtual environments usually feature a computer generated landscape that may represent an actual or imaginary location in a past present or future time. Users can create computer generated virtual objects referred to as avatar virtual objects and control the avatars in the landscape through client software that runs on a computing device. Avatars can typically roam the landscape and interact with other users avatars and with other computer generated virtual objects. Typically a virtual environment is generated and implemented by a single entity and any computing devices that participate in the virtual environment are either owned or controlled by the entity that implements the virtual environment or execute proprietary software provided by the entity. Due to the control inherent in proprietary software the ability for a third party to compromise or hack such a virtual environment is limited.

There is increasing interest in distributed virtual environments where different regions of a virtual environment are implemented on different computing devices or hosts. Disparate entities might generate and own different regions within such a virtual environment. In order for such a virtual environment to effectively operate architectural information must be made available regarding how hosts communicate with each other and how client software communicates with hosts. Moreover for many such virtual environments there must be a set of rules governing behavior of the host and client computing devices. One disadvantage of making such architectural information generally available is that it eases the development by third parties of compromising software that does not abide by the rules of the virtual environment. Conventional firewall software focuses on viruses and network attacks and would be unable to detect errant behavior associated with a virtual environment. Thus there is a need for an application layer virtual environment firewall that protects the virtual environment from virtual entities such as hosts clients and virtual objects that either intentionally or unintentionally do not abide by the rules of the virtual environment.

The present invention provides a rule based application layer virtual environment firewall that determines whether a request from a virtual environment entity complies with one or more governance rules. If the request does comply with the one or more governance rules the request can be passed to a virtual environment controller for processing. If the request does not comply with the one or more governance rules the virtual environment firewall prevents the request from being processed by the virtual environment controller. The virtual environment firewall can load or otherwise obtain access to a plurality of rules that govern respective behaviors in a region of the virtual environment. Each of the plurality of rules can identify criteria indicating the requests to which the plurality of rules should be applied. For example a rule verifying that an avatar attempting to transfer into the region is not a banned avatar may only be associated with an avatar transfer request. The virtual environment firewall can apply each rule to each request matching the rule criterion. For each rule that is applied it may be determined that the request complies with the governance rule and that no action is necessary. Alternately it may be determined that the request does not comply with the governance rule and the virtual environment firewall may prevent the request from being processed by the virtual environment controller.

According to one embodiment of the invention an avatar may initiate an avatar transfer request to a virtual environment controller as the avatar attempts to transfer from a first region of the virtual environment to a second region of the virtual environment. The virtual environment firewall associated with the second region may receive the avatar transfer request and determine that a rule associated with avatar transfer requests exists. The virtual environment firewall may apply the rule and determine that the avatar making the avatar transfer request is on a list of banned avatars. The avatar may be identified on the list based on previous errant behavior by the avatar in the second region or through an authenticated configuration or notification message received from another virtual environment firewall. The virtual environment firewall may prevent the avatar transfer request from being processed by the virtual environment controller. According to one embodiment of the present invention if a request does not comply with a governance rule in addition to preventing the request from being processed by the virtual environment controller a virtual environment entity can be presented into the virtual environment to reinforce the governance rule. For example in the example of a banned avatar requesting a transfer to a virtual environment region the virtual environment firewall or the virtual environment controller may generate and present a virtual environment object between the avatar and a border of the second region to prevent the avatar from entering the second region.

According to one embodiment of the present invention the virtual environment firewall in a first region of the virtual environment can collaborate with a virtual environment firewall in a second region of the virtual environment. The virtual environment firewall in the first region may receive a configuration message from the virtual environment firewall in the second region requesting that a new rule governing behavior in the first region be created or that an existing rule be modified. The virtual environment firewall in the first region authenticates the configuration message by verifying that the sender of the configuration message has the appropriate credentials. Authentication can include private and public key verification. If the configuration message is verified the configuration message can be applied and an owner of the first region can be notified of the configuration change. If the configuration message is not verified the virtual environment firewall in the first region may generate a new rule rejecting messages sent by the virtual environment firewall in the second region. Alternately the virtual environment firewall in the first region may receive a notification message from the virtual environment firewall in the second region. If the notification message is verified the virtual environment firewall in the first region may forward the notification to one or more virtual entities in the first region or to an owner of the first region.

Those skilled in the art will appreciate the scope of the present invention and realize additional aspects thereof after reading the following detailed description of the preferred embodiments in association with the accompanying drawing figures.

The embodiments set forth below represent the necessary information to enable those skilled in the art to practice the invention and illustrate the best mode of practicing the invention. Upon reading the following description in light of the accompanying drawing figures those skilled in the art will understand the concepts of the invention and will recognize applications of these concepts not particularly addressed herein. It should be understood that these concepts and applications fall within the scope of the disclosure and the accompanying claims.

Referring now to a block diagram illustrating a relationship between hosts and regions in a virtual environment is shown according to one embodiment of the present invention. A virtual environment can be a two or three dimensional computer simulated environment. The virtual environment typically comprises a rendering of a real or an imaginary landscape upon which virtual objects can roam and interact. The virtual environment may have multiple regions such as regions A and B. For the sake of brevity the regions A and B may be referred to herein singularly as the region or collectively as the regions where the discussion is not limited to a specific region A or B. It should be understood that the invention described herein is not limited to a particular number of regions and that the regions A and B are used herein merely for illustrative purposes.

The regions A and B are hosted by hosts A and B respectively. The hosts A and B can comprise any processing device capable of hosting a region as described herein and can comprise for example a general purpose computer executing a commercially available operating system such as Microsoft Windows or Linux. If the particular processing device has sufficient capabilities a single processing device may host more than one region . For the sake of brevity the hosts A and B may be referred to herein singularly as the host or collectively as the hosts where the discussion is not limited to a specific host A or B. The hosts A and B have myriad responsibilities relating to the respective regions A and B including monitoring activity in the regions A and B handling message traffic generated by virtual objects roaming the regions A and B coordinating the transfer of virtual objects from one region to the other region and the like. The hosts A and B can communicate with each other and with client devices that control virtual object avatars not shown via conventional data communication technologies such as wired or wireless communication technologies and can use any public or proprietary packet transport protocols such as Transmission Control Protocol Internet Protocol TCP IP or Internetwork Packet Exchange Sequenced Packet Exchange IPX SPX .

Virtual objects typically have an associated virtual object template that defines attributes relating to the respective virtual object . The virtual object template can define attributes such as size color location and if the respective virtual object is a dynamic virtual object the virtual object template can define behavioral attributes. For example with respect to the butterfly virtual object C the virtual object template may include information about flying eating and standing and how the butterfly virtual object C should respond to certain events. The virtual object template may also include 3D graphics model information so that a 3D engine not shown can render the virtual object appropriately. Each instance of a virtual object template is for a separate virtual object with its own set of attributes.

Virtual objects also typically have an associated area of interest AOI that defines the area or volume within which the respective virtual object can perceive events occurring in the virtual environment . A virtual object can have different AOIs for different perceptions. For example an AOI for sounds may be different than an AOI for sights. However for brevity and illustration purposes virtual objects will be discussed herein as having a single AOI for all perceptions. An AOI is used to determine which messages are relevant to a particular virtual object. Virtual objects also have an associated aura that defines the area or volume within which an action of the respective virtual object can be perceived. For example the owl virtual object H may define an aura such that the butterfly virtual object C can hear the owl hoot but the avatar A cannot hear the owl hoot. The AOI and aura of a respective virtual object need not be coextensive.

The virtual environment is primarily message driven. Activities by a virtual object result in message generation and communication to a respective host or client as appropriate. For example if the avatar A is moved two steps from its current location the associated client software informs the host B of this movement. The host B in turn informs any other virtual objects in the region B that should be aware of the movement of the avatar A via messages. AOIs of virtual objects may be used to determine which virtual objects need to be aware of such movement. Likewise if the owl virtual object H flies over the avatar A the host B informs the client software associated with the avatar A of this movement. Message communication between the hosts A and B may be necessary. For example if the avatar A crosses the border into the region A the host B and the host A may engage in message communication to transfer information associated with the avatar A from the host B to the host A.

Although many conventional virtual environments are generated and controlled by a single entity using proprietary technology according to one embodiment of the present invention the hosts A and B are not controlled by the same entity and the respective regions A and B are created relatively independently of one another by separate entities. However to ensure a coherent and consistent virtual environment in which virtual objects can move from one region to another region the hosts A and B comply with certain communication and architectural specifications that ensure compatibility between the hosts A and B and any appropriate client software. Such distributed virtual environments are becoming increasingly popular. Unfortunately a negative consequence of publishing or otherwise making available technical details about the implementation of the virtual environment is the increased likelihood that an entity will utilize such information to cause harm in one way or another to the virtual environment . For example an entity may choose to develop a computer controlled virtual object that floods other virtual objects with chat messages ultimately causing the respective host associated with the region to become overloaded with messages and fail. Alternatively an entity may attempt to change an attribute of a respective avatar so the avatar has an advantage over other avatars .

The present invention is an application layer virtual environment firewall that protects the virtual environment by receiving messages that have a request determining if the request complies with one or more governance rules and if not processing the message to prevent the request from being processed by a virtual environment controller. The phrase application layer means the virtual environment firewall is application layer aware and capable of processing messages containing requests that relate to activities in the virtual environment above and beyond transport information identified in a header of the message such as source destination addresses. The governance rules are in addition to the conventional rules used by a virtual environment controller to provide a virtual environment region. For example a virtual environment controller imposes a variety of rules that dictate mechanics in a virtual environment such as preventing avatars from walking through other virtual objects preventing automobiles from driving on water preventing fish from flying and the like. Governance rules as used herein apply to requests that may be inappropriate or otherwise unsuitable for the virtual environment. In contrast to a proprietary virtual environment where a single entity controls communications and requests between virtual entities a need for governance rules becomes particularly important in the context of a distributed virtual environment where a virtual environment controller has no reason to trust that a request received from a virtual entity is a reasonable or compliant request. The phrase virtual entity will be used to refer to any entity in the virtual environment that is capable of making requests including for example the hosts A and B the virtual objects A H the avatars and the like.

The virtual environment firewall of the present invention analyzes certain message traffic that has requests and ensures that the requests comply with rules that govern a behavior in the virtual environment before such requests are processed by a virtual environment controller responsible for providing and otherwise managing the respective virtual environment region. Requests suitable for processing by the virtual environment firewall can comprise any message directed toward a virtual environment module such as the respective virtual environment controller or virtual environment firewall. Requests may comprise for example virtual object transfer requests virtual object attribute modification requests communication requests requests for information from other virtual environment controllers requests to modify information maintained by the virtual environment controller and the like. Requests are typically sent in the virtual environment in the form of a message which may include one or more requests and may include routing information status indicators and the like in addition to the request.

Preferably each host has a respective virtual environment firewall that protects the respective region . For example for the purposes of illustration assume that the butterfly virtual object C has been identified by the virtual environment firewall associated with the region B as a malicious virtual object. As the butterfly virtual object C attempts to cross the border into the region B a virtual object transfer request is received by the virtual environment firewall. The virtual environment firewall can apply a rule that is associated with virtual object transfer requests and the rule determines that the butterfly virtual object C is on a list of banned virtual objects. The virtual environment firewall can process the virtual object transfer request to prevent the virtual environment controller from processing the request thereby keeping the butterfly virtual object C from entering the region B. The virtual environment firewall can also collaborate with other virtual environment firewalls and for example may send a notification to the virtual environment firewall associated with the region A notifying the virtual environment firewall of the host A that the butterfly virtual object C is known to be a malicious virtual object.

According to one embodiment of the invention in addition to preventing a request from being processed by the virtual environment controller the virtual environment firewall or the virtual environment controller can also alter the virtual environment to visually or otherwise represent to the virtual entity issuing the request that the request is not being processed. For example upon determining that the butterfly virtual object C is a banned virtual object the virtual environment firewall associated with the region B can generate an owl virtual object H and place the owl virtual object H proximate to the butterfly virtual object C such that the butterfly virtual object C will be eaten if it chooses to enter the region B. Alternately the virtual environment firewall can pass the message to the virtual environment controller and indicate to the virtual environment controller that the request violates a governance rule. The virtual environment controller can receive the message determine that the request should not be processed and introduce the owl virtual object H proximate to the butterfly virtual object C such that the butterfly virtual object C will be eaten if it chooses to enter the region B.

As another example of a governance rule assume that a virtual object such as the avatar A has an AOI defined by a circle A. The avatar A generates and sends a message having an AOI request requesting a much larger AOI defined by a circle B. The virtual environment firewall receives the messages and applies a rule associated with AOI requests that governs the size of AOIs in the region B. The rule determines that the requested AOI defined by the circle B exceeds the permitted size of an AOI and processes the message to prevent the virtual environment controller from processing the request. According to one embodiment of the invention although the original request is not processed a request may be modified such that it complies with a governance rule and the modified rule may be processed by the virtual environment controller. For example in the preceding example the virtual environment firewall can alter the request such that the requested AOI is of a maximum size allowed under the governance rules. The virtual environment firewall can then pass the modified request to the virtual environment controller for processing.

The virtual environment firewall is illustrated in as being separate from the virtual environment controller and can comprise a separate module executing on a host that also executes the virtual environment controller or can comprise a separate apparatus that communicates with the virtual environment controller over a network. Alternately the virtual environment firewall can comprise a module within the virtual environment controller . The virtual environment firewall preferably operates in conjunction with the messaging module . The messaging module receives messages that originate from virtual environment entities that are external to the virtual environment controller and passes the messages to the appropriate module within the virtual environment controller . The messaging module is also responsible for sending messages that the messaging module receives from modules within the virtual environment controller to virtual environment entities external to the virtual environment controller . The messaging module can provide messages to the virtual environment firewall . The virtual environment firewall upon receiving a message determines whether the message includes a request that matches criteria specified by one or more respective rules. If so the virtual environment firewall applies the rules to the request and if the request does not comply with the rule the virtual environment firewall processes the message to prevent the request from being processed by the virtual environment controller .

The messaging module provides a means by which the virtual environment controller communicates with clients connected to the host B and other virtual environment controllers in the distributed virtual environment . In a preferred embodiment the messaging module automatically sends each message it receives from virtual environment entities external to the virtual environment controller to the virtual environment firewall . Alternatively the messaging module may expose an application programming interface API that allows other modules including the virtual environment firewall to register a callback by the messaging module for each request that matches a criterion identified by a rule. The messaging module preferably allows the virtual environment firewall full access to the request including the ability to cancel the request and modify or replace the request.

The virtual environment controller can also include a virtual object monitor module that is responsible for monitoring aspects of the respective region B. For example the virtual environment firewall can direct the virtual object monitor module to monitor a health state attribute of a virtual object written by an unknown author. The virtual object monitor module can determine if such virtual object refuses to reduce its health or enter a dead state according to rules of the virtual environment . In response to such determination the virtual environment firewall can update a rule associated with virtual object transfer requests and identify the virtual object as a banned virtual object.

The virtual environment controller can also include a virtual environment model that represents the state of virtual objects in the region B. The virtual environment model can be persisted in a central or distributed database and or maintained in a memory associated with the virtual environment controller .

A virtual object artificial intelligence module is responsible for simulating the artificial intelligence associated with dynamic virtual objects such as the virtual objects C and H . The virtual object artificial intelligence module can interact with the virtual environment firewall to monitor conditions that represent virtual object simulation anomalies such as a large backlog of messages to process too much processing time or an excess or lack of messages. The virtual environment firewall can also interact with the virtual object artificial intelligence module to impose artificial intelligence control rules governing the execution of the virtual object. For example the virtual environment firewall may allow a lion virtual object to enter into the region B. The virtual environment firewall may provide artificial intelligence rules to the virtual object artificial intelligence module that the lion virtual object has a speed slightly faster than the average speed of virtual object prey that the lion virtual object hunts.

A virtual object template database stores virtual object templates used by the virtual environment controller to operate the region B. The virtual object template database may include a complete or partial listing of templates available in the entire virtual environment . Such templates may be obtained from a central server such as a virtual world authority or from other virtual environment controllers in the distributed virtual environment . An interest manager module is used by other modules in the virtual environment to register AOIs and auras. The interest manager module works in conjunction with the virtual environment firewall to ensure that virtual objects register AOIs and auras that are within the rules of the virtual environment .

If it is determined that the request matches one or more criteria the first such rule can be applied to the request step . For any particular rule the application of the rule may result in any of several different outcomes. For example if the rule determines that the request complies with the rule the rule may allow the request to proceed without changes. However if the request does not comply with the governance rule the virtual environment firewall may prevent the message from being processed by the virtual environment controller . Alternatively the virtual environment firewall may modify the request to comply with the governance rule or may substitute a new request that complies with the governance rule. Once the rule is applied to the request it is determined whether or not to proceed to the next rule if any step . If the rule determines that the virtual environment controller should not process the request then the processing is finished and the messaging module can be apprised that the virtual environment controller should not process the request step . If however the rule allows the request to proceed without any changes then the process returns to step where it is determined whether additional rules should be applied to the request.

The rule shown in includes a name block identifying the respective governance rule. A description block can provide a textual based description describing the behavior that is governed by the rule . An initialization function block can contain the initialization code as described in greater detail below to execute upon initial loading of the rule . A message criteria block can define the types of requests for which this respective rule would be applied. A code block contains the executable code that implements the rule governing the respective behavior. Upon initial loading of this particular rule the initialization function startup is executed and a list of known banned avatars is extracted from a database. This list is refreshed from the database every ten minutes so that the list remains relatively current. The rule has a criterion that indicates the rule should be applied to requests of type VirtualObjectTransferAnnouncement which is a type of request in the virtual environment that is sent when a virtual object desires to transfer into the respective region . Upon receipt of such a request the rule determines whether the virtual object associated with the request is on the list of banned avatars. If so the rule rejects the request otherwise the rule allows the request to be processed by the virtual environment controller .

Governance rules can include the ability to modify a virtual object in order to make the virtual object suitable for a respective region . For example if an owner of a region desires to protect a certain class of virtual objects in the region such as wildlife virtual objects from external predator virtual objects the owner can create a governance rule to favor wildlife virtual objects over predator virtual objects. For example a governance rule can be created that tests a virtual object template to determine if the virtual object is classified as a predator. If the virtual object is classified as a predator the governance rule communicates to the interest manager module that the respective predator virtual object s AOI is decreased by ten percent and its aura is increased by ten percent. Such modifications would result in the predator virtual object s aura being broadcast ten percent further thereby enabling wildlife virtual objects to perceive the predator virtual object sooner. A reduction of the predator virtual object s AOI would reduce the predator virtual object s perception of events by ten percent thereby reducing the predator virtual object s ability to perceive actions and events associated with prey virtual objects.

The governance rules can also include replacements or substitutions for a virtual object in order to make the virtual object suitable for the region . For example if an owner of a region does not want weapons in the region the owner may create a governance rule that determines when a virtual object is carrying a weapon virtual object and temporarily replaces the weapon virtual object with a NERF bat virtual object. Such modifications or replacements may be applicable for the entire region or for only a portion of the region . For example weapons may only be prohibited within a trade zone of the region . The governance rule creates a temporary license for the original weapon virtual object that only allows the weapon virtual object to exist outside of the trade zone and creates a temporary license for a NERF bat virtual object that is enabled when the virtual object enters the trade zone. Thus governance rules can be applied to individual virtual objects that together compose a composite virtual object.

A governance rule can also register a callback with other virtual environment modules to detect situations in which it may be desirable to update or modify a governance rule. For example a callback function may be registered with the virtual object artificial intelligence module such that the governance rule is invoked when the virtual object artificial intelligence module determines that a virtual object is behaving abnormally for example when the virtual object artificial intelligence module detects a virtual object that has a large backlog of messages to process and appears to be ignoring such messages. The virtual environment firewall may upon learning of this behavior add a governance rule that prevents the virtual object from transferring to the region in the future.

Governance rules can have associated notifications described within the governance rule. These notifications can include notifying an owner of a region of behavior violations or notifying users with respective avatars in a respective region of problems occurring in the region .

According to one embodiment of the present invention the virtual environment firewall in one region can collaborate with virtual environment firewalls in other regions . The virtual environment firewall may also collaborate with a third party entity such as a virtual world authority that may provide value added services for the virtual environment firewall . Such collaboration can help the virtual environment firewall learn of problems occurring in other regions and preemptively adapt to such problems. For example a virtual environment firewall can receive a notification from another virtual environment firewall that identifies a malicious virtual object. The virtual environment firewall can incorporate the virtual object information provided in the notification into a new governance rule that prevents the transfer of the malicious virtual object and can generate another governance rule that prevents the propagation of any messages within the respective region associated with the malicious virtual object.

Preferably virtual environment firewalls authenticate notifications received from other virtual environment firewalls . Such authentications can include a digital signature proving the authenticity of the virtual environment firewall . Alternately the virtual environment firewall may be configurable to specifically identify from which hosts in the distributed virtual environment the virtual environment firewall will accept notifications. The virtual environment firewall may subscribe to the respective host or listen to a well known multicast channel on which virtual environment firewalls broadcast notifications. Collaboration between virtual environment firewalls can also include sharing rule sets. For example a single entity may own several hosts operating in different respective regions and may have configured each respective virtual environment firewall to synchronize their governance rule sets.

According to one embodiment of the present invention messages communicated between virtual environment firewalls can include configuration messages and notification messages. A configuration message from an authenticated source includes a configuration change that the receiving virtual environment firewall is being requested to apply. A notification message indicates a situation or problem that another virtual environment firewall or a third party has announced. Preferably virtual environment firewall messages are digitally signed to prove authenticity. Moreover each virtual environment controller may be provided a public key and a private key by a virtual world authority. The public key can be hosted by the virtual world authority or hosted in a distributed data structure such as a distributed hash table DHT .

If the message type is not a configuration message then it is a notification type message. An importance of the notification message may be calculated step . The importance may be a factor of a type or severity of the problem a virtual environment distance from the problem or a number of independent verifications of the same problem or similar problems. The importance calculation can be defined in a configuration file to allow for an owner of a region to tailor a formula for that respective region . The importance calculation score can be compared to an importance threshold to determine whether the problem is significant or trivial step . The importance threshold may be configurable. If the calculated importance is below the importance threshold the processing for that message ends and the process starts back at step . If the calculated importance is greater than the importance threshold then an action may be performed step . Such actions may include a notification mechanism as described with respect to the configuration message.

Those skilled in the art will recognize improvements and modifications to the preferred embodiments of the present invention. All such improvements and modifications are considered within the scope of the concepts disclosed herein and the claims that follow.

