---

title: Battery management system
abstract: A method includes determining a need to perform a learn cycle on a battery in a processing module of an information handling system, detecting a learn cycle in progress on another battery in another processing module of the information handling system, and postponing the learn cycle on the battery in response to detecting the learn cycle on the other battery.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09304563&OS=09304563&RS=09304563
owner: Dell Products, LP
number: 09304563
owner_city: Round Rock
owner_country: US
publication_date: 20130329
---
The present disclosure generally relates to information handling systems and more particularly relates to battery management systems for information handling systems.

As the value and use of information continues to increase individuals and businesses seek additional ways to process and store information. One option is an information handling system. An information handling system generally processes compiles stores and or communicates information or data for business personal or other purposes. Because technology and information handling needs and requirements may vary between different applications information handling systems may also vary regarding what information is handled how the information is handled how much information is processed stored or communicated and how quickly and efficiently the information may be processed stored or communicated. The variations in information handling systems allow for information handling systems to be general or configured for a specific user or specific use such as financial transaction processing airline reservations enterprise data storage or global communications. In addition information handling systems may include a variety of hardware and software components that may be configured to process store and communicate information and may include one or more computer systems networking systems and data storage systems.

Information handling systems may contain battery modules providing temporary backup power in the event the primary power source for the information handling system is interrupted. Some battery types used in battery modules require a learn cycle or recondition cycle to be performed periodically. The learn cycle discharges and then charges the batteries in a module measuring the change in voltage and the amount of charge in order to build a battery discharge curve. This operation allows the information handling system to better estimate the capacity of the battery module. The chemistry of the battery in a module may have a largely flat voltage vs. charge curve with the slope of the curve changing rapidly only at low charge levels. This characteristic of the battery may require the battery cells within a module to be discharged to a very low level in order to obtain acceptable measurement accuracy.

The following description in combination with the Figures is provided to assist in understanding the teachings disclosed herein. The description is focused on specific implementations and embodiments of the teachings and is provided to assist in describing the teachings. This focus should not be interpreted as a limitation on the scope or applicability of the teachings. However other teachings may be utilized in this application as well as in other applications and with several different types of architectures such as distributed computing architectures client or server architectures or middleware server architectures and associated components.

Processor module includes baseboard management controller BMC and battery module . Processor module is similarly configured with BMC and battery module . Information handling system may be configured to include additional devices for example storage devices and network interfaces in order to perform various information handling functions. Processor module and processor module may be configured with additional modules for example with CPU complexes and I O modules to perform various functions within information handling system . In an embodiment processor module and processor module comprise more than one field replaceable unit. BMC and BMC may be connected to network directly using circuitry within the baseboard management controllers or indirectly using other interface devices not shown such as NIC s or LAN on motherboard LOM devices. BMC and BMC communicate through network with an external system not shown . The external system may be a laptop computer a virtual machine an FPGA or other external computing device or system A system external to information handling system communicating with BMC and BMC may be referred to herein as a system management controller or as a service processor. In an embodiment BMC and BMC communicate with each other using network . Examples of information communicated on network include commands command responses and status information. Communication link is connected to BMC and to BMC . In an embodiment communication link is provided by a mid plane not shown within information handling system . In an embodiment communication link is provided by a cable. Communication link is operable to allow BMC and BMC to exchange status information.

In an embodiment network is an inter baseboard management controller communication link among baseboard management controllers within information handling system . An inter baseboard management controller link may be a direct connection between BMC and BMC . In an embodiment the inter baseboard management controller link is implemented with an inter integrated circuit communication interface such as I2C.

Battery module and battery module are operable to provide power to processor module and to processor module respectively in the event that the main power source for information handling system is interrupted. Battery modules and each comprise battery cells power regulation circuitry charging circuitry and control circuitry. The control circuitry is operable to communicate with other modules on processor modules and . In the embodiment illustrated in battery modules and are coupled to BMC and to BMC respectively. In an embodiment communication between battery modules and and BMCs and takes place over an I2C communication network. The control circuitry in battery module and battery module is further operable to provide information about the battery module to other modules including the capacity remaining in the battery and information identifying the particular battery module installed for example a module serial number. The control circuitry is further operable to receive and perform commands including a command to perform a learn cycle on the battery within the battery module and a command to report a status of a learn cycle. The status of a learn cycle may include an indication that a learn cycle is in progress.

BMC and BMC are operable to perform management functions for processor module and for processor module respectively. In an embodiment these functions include reporting sensor values to a system management controller logging events and receiving commands from the system management controller to perform actions within a processor module. Example sensor values that may be reported include battery voltage temperature and cooling fan speed. Events that may be logged include for example loss of power to a processor module. Commands that may be received by a baseboard management controller include resetting or cycling power on a processor module and initiating a learn cycle on a battery module. In an embodiment a baseboard management controller initiates a learn cycle on a battery module by sending a command to initiate a learn cycle to control circuitry in the battery module. In response to receiving the command the control circuitry performs the learn cycle. BMC and BMC are further operable to determine the current date and time. The current date and time may be used to provide a time stamp for log entries to determine a need to perform a management function or for other purposes. In an embodiment a real time clock is maintained within a baseboard management controller and may be accessed to determine the current date and time. In alternate embodiments the current date and time are obtained by a baseboard management controller from another module within the processor module or the current date and time are obtained from a system management controller. BMC and BMC are further operable to store information related to performance of management functions including but not limited to a desired time at which a function should be performed and identification information for individual modules within their respective processor modules.

BMC is operable to determine a need to initiate a learn cycle on a battery within battery module . In an embodiment the need to initiate a learn cycle may be based on the elapsed time since a previous learn cycle was completed. When a learn cycle is successfully completed on a battery BMC may compute a predetermined date and time for the next learn cycle by adding a time interval to the completion date and time of the learn cycle. The predetermined date and time for the next learn cycle may be stored within BMC . BMC may periodically compare the current date and time with the predetermined date and time determining a need to initiate a learn cycle when the current date and time is later than the predetermined date and time. In an embodiment BMC may store the completion date and time of a learn cycle and periodically compare the stored completion date and time with the current date and time in order to determine if the time interval has elapsed. In an embodiment BMC and BMC may use different time intervals to determine a need to initiate a learn cycle.

In an embodiment BMC is operable to determine the need to initiate a learn cycle on a battery in battery module based on identifying that battery module is not the battery module on which a previous learn cycle was initiated. BMC retrieves from memory a stored serial number of a battery module on which a learn cycle was previously initiated. BMC retrieves the serial number from battery module and compares the stored serial number with the serial number of battery module . Based on the comparison BMC may determine that the stored information about a next learn time for a battery module is invalid. BMC may then select and store another learn time for battery module . BMC may then be operable to proceed as described above comparing the current date and time with the stored learn time and determining a need to initiate a learn cycle when the current date and time is later than the stored learn time.

In an embodiment BMC is operable to determine a need to initiate a learn cycle on a battery in battery module in response to receiving a command from a system management controller.

BMC is further operable to detect that a learn cycle is in progress on a battery in battery module in processor module . In an embodiment BMC detects that the learn cycle on battery module is in progress by detecting an indication provided by BMC . BMC may provide the indication based on a sensor value based on information provided by an application programming interface API or based on information stored with BMC for example an internal variable or a log entry indicating that BMC instructed battery module to perform a learn cycle. BMC may provide the indication based on accessing status information within battery module for example by reading status information from battery module over an I2C bus. In an embodiment BMC may provide the indication by storing a value into a memory accessible to both BMC and BMC . In an embodiment BMC may provide the indication to BMC on communication link . The indication may be provided by BMC in response to receiving a request on communication link from BMC for status information about battery module . In an embodiment the indication may be sent by BMC to BMC on communication link in response to a learn cycle beginning in battery module .

BMC is further operable to postpone the learn cycle on battery module for which a need has been determined in response to receiving the indication that a learn cycle is in progress on battery module . In particular embodiments the length of the postponement interval may be a predetermined length of time or a user supplied length of time. In an embodiment the postponement interval ends in response to a user command. After the postponement interval ends BMC may repeat determining the need to initiate a learn cycle. In response to determining a need to initiate a learn cycle on battery module and to detecting that a learn cycle is no longer in progress on battery module BMC initiates the learn cycle on battery module . In an embodiment an indication sent by BMC and received by BMC indicating that the learn cycle on battery module is complete may terminate the postponement and BMC may initiate a learn cycle on battery module without again determining a need to initiate the learn cycle.

In an embodiment BMC is further configured to provide an indication to BMC indicating that a learn cycle on battery module is complete. The indication may be provided in response to the learn cycle completing successfully. The indication may be provided by storing a value into a memory accessible to both BMC and BMC . In an embodiment BMC may provide the indication to BMC on communication link . The indication may be provided by BMC in response to receiving a request on communication link from BMC for status information.

The previous discussion applies when the roles of BMC and BMC are reversed with BMC operable to determine a need to initiate a learn cycle on battery module detect that a learn cycle is in progress on Battery Module and postpone the learn cycle on battery module . In an embodiment the relationships between processor module and processor module and their associated BMC s and battery modules may be symmetric. In an embodiment processor module may be designated as a master processor module and processor module may be designated as a slave processor module. The master processor module may be operable to initiate all transactions on or otherwise control access to communication link . The master and slave processor modules may be configured to use different intervals between learn cycles or to use different time intervals to postpone a learn cycle. For purposes of illustration two processor modules are shown in . Those skilled in the art will appreciate that more than two processor modules may be used with the present disclosure. For example three processor modules may be configured as one master processor module and two slave processor modules.

In an embodiment a baseboard management controller may determine a need to initiate a learn cycle based on detecting that the battery module of a processor module has been changed. A battery module installed in a processor module may provide its serial number or other identifying information at the request of the processor module s baseboard management controller. The baseboard management controller may compare the serial number retrieved from the battery module with a serial number previously retrieved and stored by the baseboard management controller. When the serial numbers are different the baseboard management controller may determine that the installed battery module is new and select a learn time for the battery module. The baseboard management controller may store the selected date and time and periodically compare the selected date and time with the current date and time. When the current date and time is later than the selected date and time the baseboard management controller may determine a need to initiate a learn cycle on the battery module.

In an embodiment a baseboard management controller determines a need to initiate a learn cycle on a battery in a battery module based on receiving a command from a system management controller.

Step may also be performed in an embodiment by a CPU of a processor module. A CPU may be coupled to interface circuitry allowing the CPU to communicate with a battery module in the processor module. The CPU may perform any or all of the actions of step as described for a baseboard management controller.

The method illustrated in flow diagram continues with step detecting that a learn cycle is in progress in a second storage processor. This step may be performed by a baseboard management controller in a first storage processor in communication with a second baseboard management controller in a second storage processor. In an embodiment the second baseboard management controller communicates with a battery module in the second storage processor detects that a learn cycle is in progress and reports that the learn cycle is in progress in response to an inquiry message from the first baseboard management controller. The inquiry and response messages may be sent on a communication network. In an embodiment the communication network may allow baseboard management controllers to communicate directly. In an embodiment the communication network may allow communication through other devices for example through a system management controller or chassis management controller. In other embodiments the second baseboard management controller stores status information about a learn cycle on a battery in the second storage processor in a memory accessible to both the first baseboard management controller and the second baseboard management controller.

In an embodiment step is performed by a CPU on a storage processor. The CPU is coupled to interface circuitry allowing the CPU to communicate with battery modules and network interfaces. The CPU performs the functions illustrated above as performed by a baseboard management controller. The CPU in the storage processor sends a message through a network interface to a second CPU in a second storage processor requesting the status of a battery learn cycle in the second storage processor. The second CPU replies with status information about a learn cycle allowing the CPU in the storage processor to determine that a learn cycle is in progress in the second storage processor.

The method illustrated in flow diagram continues with step postponing the learn cycle on the first battery. In response to detecting a learn cycle in progress in a second storage processor a baseboard management controller may elect to initiate the learn cycle on the battery at a later time. In an alternative embodiment to that shown in the method postpones the learn cycle by a predetermined time interval and proceed directly to step . For example a time interval greater than the duration of a battery learn cycle may be predetermined and added to the current date and time to determine a revised date and time at which to initiate the learn cycle on the first battery. The revised date and time is periodically compared with the current date and time and when the current date and time is later than the revised date and time the learn cycle is initiated on the first battery.

Returning to the method of flow diagram in step the learn cycle in the second storage processor detected as being in progress in step is detected as completed. Detecting completion of the learn cycle in the second storage processor may be accomplished by any means used to detect that the learn cycle was in progress is step . These means include baseboard management controllers or CPU s communicating by sending and receiving messages on a communication network exchanging status information on a communication link or setting values in a memory accessible to both storage processors. The means used to detect completion of the learn cycle may be different than the means used to detect the learn cycle in progress.

In step the learn cycle on the first battery is initiated. The baseboard management controller sends a command to the first battery module to perform a learn cycle on the first battery. In an embodiment step may be preceded by a second determination of a need to initiate a learn cycle on the first battery. During the postponement of step changes may have occurred that remove the need for the learn cycle. For example the first battery may have been replaced during the postponement interval and the new battery may not require an immediate learn cycle.

In an embodiment steps and are performed by a CPU on a storage processor the CPU being coupled to appropriate interface circuitry to communicate with battery modules and network interfaces.

In an embodiment step is followed by an additional step indicating to other storage processor modules that the learn cycle has completed.

Storage device is further configured with CMC a chassis management controller. CMC may perform management functions for a chassis containing storage processors and . CMC is coupled to and may communicate with BMC and BMC using communication network . CMC may in an embodiment process messages sent between BMC and BMC . Processing may include storing messages forwarding messages storing information contained in messages and providing stored information in response to messages. Information from messages may be stored in memory . In an embodiment a message sent by BMC or BMC may include a command to write an indication into memory or a command to read an indication from memory .

BMC BMC and CMC may be coupled to network . Network is coupled to a system management controller external to storage device . The system management controller sends messages to and receive messages from BMC BMC and CMC using network . The messages may contain commands responses to commands and status information.

Storage processor is operable to determine a need for a battery learn cycle on a battery in battery module . In various embodiments the determination may be based on the elapsed time since a previous learn cycle on battery module the time elapsed since battery module was installed or a command from a system controller.

Storage processor is further operable to receive an indication that a learn cycle is in progress on battery module in storage processor . In an embodiment storage processor may receive the indication through network interface . In an embodiment storage processor may receive the indication from a system management controller. In an embodiment storage processor may receive the indication through communication network . The indication received through communication network may be transmitted by a module coupled to communication network for example by storage processor or by CMC . The indication may be received in response to an inquiry message or memory read message sent on communication network by storage processor .

Storage processor is further operable to delay the battery learn cycle on battery module in response to receiving an indication that a learn cycle is in progress on battery module . In an embodiment the battery learn cycle on battery module may be delayed until the battery learn cycle on battery module is complete. Storage processor may determine that the battery learn cycle on battery module is complete by receiving a message through network interface through communication network or through network .

In an embodiment BMC may be operable to perform actions including determining a need to perform a learn cycle receiving an indication that a second learn cycle is in progress and delaying the learn cycle. BMC may receive the indication that a second learn cycle is in progress from CMC . CMC may receive the indication from BMC on storage controller .

In an embodiment a program stored in DDR executing on CPU may be operable to perform actions including determining a need to perform a learn cycle receiving an indication that a second learn cycle is in progress and delaying the learn cycle. CPU may receive the indication that a second learn cycle is in progress from storage processor through PCH ICH . PCH ICH may receive the indication from storage processor through network interface or from network through BMC .

In an embodiment the indication that a second learn cycle is in progress on battery module may be provided by CPU executing a program stored in DDR . illustrates an embodiment in which CPU communicates with battery module through PCH ICH and BMC . In other embodiments CPU may be coupled to battery module directly or through other modules not shown . CPU may provide the indication to storage module through network interface through communication network or through another communication channel provided by storage device .

Chipset is connected to and supports processor allowing the processor to execute machine executable code. In a particular embodiment information handling system includes one or more additional processors and chipset supports the multiple processors allowing for simultaneous processing by each of the processors and permitting the exchange of information among the processors and the other elements of the information handling system. Chipset can be connected to processor via a unique channel or via a bus that shares information among the processor the chipset and other elements of information handling system .

Memory is connected to chipset . Memory and chipset can be connected via a unique channel or via a bus that shares information among the chipset the memory and other elements of information handling system . In another embodiment not illustrated processor is connected to memory via a unique channel. In another embodiment not illustrated information handling system includes separate memory dedicated to each of the one or more additional processors. A non limiting example of memory includes static random access memory SRAM dynamic random access memory DRAM non volatile random access memory NVRAM read only memory ROM flash memory another type of memory or any combination thereof.

Graphics interface is connected to chipset . Graphics interface and chipset can be connected via a unique channel or via a bus that shares information among the chipset the graphics interface and other elements of information handling system . Graphics interface is connected to a video display . Other graphics interfaces not illustrated can also be used in addition to graphics interface as needed or desired. Video display includes one or more types of video displays such as a flat panel display another type of display device or any combination thereof.

I O interface is connected to chipset . I O interface and chipset can be connected via a unique channel or via a bus that shares information among the chipset the I O interface and other elements of information handling system . Other I O interfaces not illustrated can also be used in addition to I O interface as needed or desired. I O interface is connected via an I O interface to one or more add on resources . Add on resource is connected to a storage system and can also include another data storage system a graphics interface a network interface card NIC a sound video processing card another suitable add on resource or any combination thereof. I O interface is also connected via I O interface to one or more platform fuses and to a security resource . Platform fuses function to set or modify the functionality of information handling system in hardware. Security resource provides a secure cryptographic functionality and includes secure storage of cryptographic keys. A non limiting example of security resource includes a Unified Security Hub USH a Trusted Platform Module TPM a General Purpose Encryption GPE engine another security resource or a combination thereof.

Disk controller is connected to chipset . Disk controller and chipset can be connected via a unique channel or via a bus that shares information among the chipset the disk controller and other elements of information handling system . Other disk controllers not illustrated can also be used in addition to disk controller as needed or desired. Disk controller includes a disk interface . Disk controller is connected to one or more disk drives via disk interface . Such disk drives include a hard disk drive HDD and an optical disk drive ODD and can include one or more disk drive as needed or desired. ODD can include a Read Write Compact Disk R W CD a Read Write Digital Video Disk R W DVD a Read Write mini Digital Video Disk R W mini DVD another type of optical disk drive or any combination thereof. Additionally disk controller is connected to disk emulator . Disk emulator permits a solid state drive to be coupled to information handling system via an external interface . External interface can include industry standard busses such as USB or IEEE 1394 Firewire or proprietary busses or any combination thereof. Alternatively solid state drive can be disposed within information handling system .

Network interface device is connected to I O interface . Network interface and I O interface can be coupled via a unique channel or via a bus that shares information among the I O interface the network interface and other elements of information handling system . Other network interfaces not illustrated can also be used in addition to network interface as needed or desired. Network interface can be a network interface card NIC disposed within information handling system on a main circuit board such as a baseboard a motherboard or any combination thereof integrated onto another component such as chipset in another suitable location or any combination thereof. Network interface includes a network channel that provide interfaces between information handling system and other devices not illustrated that are external to information handling system . Network interface can also include additional network channels not illustrated .

Information handling system includes one or more application programs and Basic Input Output System and Firmware BIOS FW code . BIOS FW code functions to initialize information handling system on power up to launch an operating system and to manage input and output interactions between the operating system and the other elements of information handling system . In a particular embodiment application programs and BIOS FW code reside in memory and include machine executable code that is executed by processor to perform various functions of information handling system . In another embodiment not illustrated application programs and BIOS FW code reside in another storage medium of information handling system . For example application programs and BIOS FW code can reside in HDD in a ROM not illustrated associated with information handling system in an option ROM not illustrated associated with various devices of information handling system in storage system in a storage system not illustrated associated with network channel in another storage medium of information handling system or a combination thereof. Application programs and BIOS FW code can each be implemented as single programs or as separate programs carrying out the various features as described herein.

In the embodiments described herein an information handling system includes any instrumentality or aggregate of instrumentalities operable to compute classify process transmit receive retrieve originate switch store display manifest detect record reproduce handle or use any form of information intelligence or data for business scientific control entertainment or other purposes. For example an information handling system can be a personal computer a consumer electronic device a network server or storage device a switch router wireless router or other network communication device a network connected device cellular telephone tablet device etc. or any other suitable device and can vary in size shape performance price and functionality. The information handling system can include memory volatile e.g. random access memory etc. nonvolatile read only memory flash memory etc. or any combination thereof one or more processing resources such as a central processing unit CPU a graphics processing unit GPU hardware or software control logic or any combination thereof. Additional components of the information handling system can include one or more storage devices one or more communications ports for communicating with external devices as well as various input and output I O devices such as a keyboard a mouse a video graphic display or any combination thereof. The information handling system can also include one or more buses operable to transmit communications between the various hardware components. Portions of an information handling system may themselves be considered information handling systems.

When referred to as a device a module or the like the embodiments described herein can be configured as hardware. For example a portion of an information handling system device may be hardware such as for example an integrated circuit such as an Application Specific Integrated Circuit ASIC a Field Programmable Gate Array FPGA a structured ASIC or a device embedded on a larger chip a card such as a Peripheral Component Interface PCI card a PCI express card a Personal Computer Memory Card International Association PCMCIA card or other such expansion card or a system such as a motherboard a system on a chip SoC or a stand alone device . The device or module can include software including firmware embedded at a device such as a Pentium class or PowerPC brand processor or other such device or software capable of operating a relevant environment of the information handling system. The device or module can also include a combination of the foregoing examples of hardware or software. Note that an information handling system can include an integrated circuit or a board level product having portions thereof that can also be any combination of hardware and software.

Devices modules resources or programs that are in communication with one another need not be in continuous communication with each other unless expressly specified otherwise. In addition devices modules resources or programs that are in communication with one another can communicate directly or indirectly through one or more intermediaries.

Although only a few exemplary embodiments have been described in detail herein those skilled in the art will readily appreciate that many modifications are possible in the exemplary embodiments without materially departing from the novel teachings and advantages of the embodiments of the present disclosure. Accordingly all such modifications are intended to be included within the scope of the embodiments of the present disclosure as defined in the following claims. In the claims means plus function clauses are intended to cover the structures described herein as performing the recited function and not only structural equivalents but also equivalent structures.

