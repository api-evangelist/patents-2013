---

title: Indoor location-finding using magnetic field anomalies
abstract: Techniques for indoor location-finding are described herein. Inside buildings, anomalies in the Earth's magnetic field may be caused by the buildings' structures. These anomalies tend to be location specific and temporally stable. Accordingly, a database or map may be constructed of field strength measurements, and made available to clients, either online (e.g., through cloud services) or offline. As a user carrying a portable device walks within a building, magnetic field measurements may be made. The measurements may be configured in as vectors and compared to the database. A specific location may be indicated by anomaly information seen in both the vector(s) and database. Optionally, techniques may be combined with a particle filter that may be operated step-by-step as the user moves within the building. In another option, fusion with Wi-Fi signals may be performed, such as with a two-pass bidirectional particle filtering.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09326103&OS=09326103&RS=09326103
owner: Microsoft Technology Licensing, LLC
number: 09326103
owner_city: Redmond
owner_country: US
publication_date: 20130712
---
Indoor location finding is more difficult than outdoor location finding in part because outdoor location finding may rely on the highly accurate global positioning system GPS . Indoor location finding frequently relies on radio techniques including utilization of Wi Fi and or cellular phone signals. However Wi Fi signals are highly fluctuating and severely affected by the physical layout of the internal environment and therefore do not provide precision location information. Similarly due to the large coverage area of cellular base stations the margin of error in cellular signal triangulation techniques may be larger than the entire building and therefore may not provide the desired accuracy.

Techniques for indoor location finding are described herein. Such techniques are invaluable for example in guiding people within malls office buildings airports and parking garages. Inside buildings anomalies in the Earth s magnetic field may be caused by the building s structure. The indoor geomagnetic field including anomalies tends to be location specific and temporally stable. Accordingly a map database or data structure may be constructed using the field strength measurements. For example a map may be configured in grayscale or other gradient to represent varying degrees of magnetic field strength within various locations in an indoor floor plan. The map or database may be made available to clients such as users of cell phones or other portable devices within a building. The database or map may be downloaded and available offline to a client device. Alternatively or additionally the database or map may be available online e.g. through cloud services to users.

To determine a user s location within a building a cell phone or other portable device may make magnetic field measurements at a plurality of locations. The measurements may be configured as one or more vectors and compared to the map or database. In one example a specific location of the user may be indicated by the user s position with respect to magnetic field anomaly information described in the map or database.

To create the map or database a user carrying a cell phone may walk along a pre planned survey path from a starting point to an ending point. The phone may record data from both a magnetometer and an inertial measurement unit IMU . A trace of the user s estimated actual path may be compared to the intended path and magnetic field strength measurements may be positioned within the map or database. In one example a map may be configured in grayscale a color scale gradient or other data storage means to show magnetic field strength. The map or database may then be made available to mobile devices within the building in an online and or offline manner.

The example cloud services may include a processing unit which may include one or more processors and one or more memory devices . The memory may include instructions for one or more applications programs procedures and or software routines that provide various services to the client. The functional divisions are arbitrary and are provided for illustration only. Thus other arrangements of the cloud service s functionality could be configured. In the example shown the cloud services include a location inference engine online maps and a database construction procedure . provides greater example detail of cloud services.

The example mobile client may include a processing unit and one or more sensors . The mobile devices may include cellular phones tablets laptop computers or other mobile computing devices. Examples of sensors include a magnetometer gyroscope accelerometer or other sensor device etc. The processing unit may include one or more processors or application specific integrated circuits ASICs and one or more memory devices . The memory devices may include instructions for one or more applications programs procedures and or software routines that perform various functions. As noted with respect to the cloud services the functional divisions of applications subroutines and or procedures on the mobile client are arbitrary. Accordingly the example provided is for illustration only and other arrangements of the mobile client functionality could be configured. In the example shown a location inference engine is configured to receive one or more inputs and to estimate or determine a location of the mobile client . Offline maps may be used particularly in the event that online maps are not available. Additionally one or more applications subroutines and or procedures may be provided. provides greater example detail of a mobile client.

The location inference engine is configured to determine and or assist in a determination of a location of the mobile client. Location inference engines based on the same or similar technology may be located in both the cloud services and the mobile client . The location inference engine located in cloud services may be adapted for an online mode i.e. the client is online . In one example the location inference engine may resolve a location of the mobile client by matching received magnetic signals against the online maps . Additionally an augmented particle filter and location finding technology fusion module may be used to assist in the location finding.

The augmented particle filter may implement a particle motion model such as that discussed with respect to to perform aspects of location finding. In one example the particle motion model may utilize particle filtering in a tracking based approach to location finding. In one example the augmented particle filter may execute a step by step process. That is as the mobile client moves under the step by step walking process of an actual user the augmented particle filter provides updated information. These and other techniques will be discussed with respect to .

The location inference engine may opportunistically receive available signals in addition to magnetic field strength information. To benefit from these available signals the location finding technology fusion application or procedure may combine two or more location finding technologies in a synergistic manner. In one example location technology fusion application may fuse Wi Fi location finding technology with magnetic field based location finding technology. The Wi Fi signals may be readily available and may provide information not found in magnetic field strength measurements. Information from such received signals may be combined and or fused with or analyzed in parallel with other information obtained by operation of a magnetic field based localization process.

By using the augmented particle filter the location finding technology fusion application and or other techniques or applications the location inference engine operates within cloud services to determine a location of a mobile client .

The online maps may be made available over networks e.g. the Internet to one or more mobile clients . The online maps may include one or more maps and or databases configured to store information helpful to the location finding techniques used by the location inference engine . Example online maps include a floor plan a magnetic map and or a radio map . The floor plan may describe one or more indoor facilities such as shopping malls parking garages hospitals university buildings airports and or any other structure that may be difficult for users to navigate e.g. such as by walking elevators escalators moving sidewalks and the like . The floor plan may be configured as an image database data structure or any other information format or according to any desired techniques.

A magnetic map may be configured to store information about magnetic fields such as field strength and or direction e.g. north . The magnetic information may be associated with locations within indoor structures such as those represented by the floor plans . The magnetic map may be configured as a grayscale image or color scale image gradient or other information containing data structure based at least in part on the floor plan . Alternatively the magnetic map may be configured as a database data structure or any other information format such by using vectors or scalar values or according to any desired techniques or technologies.

A radio map may be configured to store information about radio signals such as Wi Fi signals cellular signals near field communications signals and other radio frequency RF signals. The radio map may associate the radio information with locations within indoor structures such as those represented by the floor plans . Alternatively the radio map may be configured as a database data structure or any other information format such by using a list of two element tuples consisting of the identifier of a Wi Fi access point AP and the corresponding measurement of received signal strength or according to any desired techniques or technologies.

The map or database construction subsystem is configured to provide information and or solutions to location finding and database construction through efficient compliant walking based site surveying techniques and or methods. In the example shown the map or database construction subsystem is configured using three modules including a survey plan creator a user trace estimator and a turn matching tool .

The survey plan creator may utilize one or more mobile devices in a process of creation of maps databases and or acquisition of data usable with location finding techniques. A survey plan may be created using a venue map e.g. a floor plan that covers all paths of interest within the venue building or complex. The survey plan may be created or generated manually or in an automated manner. Automated survey plan creation may be performed by following rules such as a right hand or a left hand wall follower rule. The actual survey plan may depend largely on the floor plan and also on detail and particulars of the floor plan such as hallway widths room dimensions etc. For example a path may be defined in the middle of narrow pathways whereas for wider corridors or open spaces additional survey paths may be added that are parallel or otherwise separated. The survey plan creator may be configured to create such a plan in a standardized or custom manner based on the floor plan or other input.

The user trace estimator may utilize techniques including motion detection and dead reckoning to determine a location of a mobile client during the database constructing process. The turn matching tool may utilize techniques including inertial sensing and data processing to distinguish real turns from candidate turns e.g. data indicating a possible turn of a mobile device in motion with a walking user. Example techniques to implement the survey plan creator the user trace estimator and the turn matching tool may be understood from and associated discussion.

A step detection procedure is configured to detect individual steps of a surveyor such as during a walk through all or part of a venue or along a survey path. The use of individual steps helps to define points at which data taken from the gyroscope accelerometer magnetometer and or Wi Fi or other RF receiver may be recorded.

The step model may be configured to assist in map and or database construction. The step model provides a compliant walking i.e. step based data collection method. According to one example of the step model a surveyor walks through all or part of a venue or according to a pre planned survey path. The path may be walked from the starting point to the end point with the phone in fixed position relative to the surveyor s body e.g. in a pocket . The step model records inertial measurement unit IMU output data including acceleration magnetometer and gyroscope readings. The IMU data may be used to determine a position of the surveyor along the survey path. In one example the user trace actual path of the user as the user walks the survey path is estimated and matched against the pre planned path at fixed locations associated with each step. Having established locations associated with steps footfalls and collected magnetic signals at those locations data for other locations may be interpolated from data associated with neighboring step positions. Additionally this location data may be combined with data describing magnetic fields and data describing Wi Fi and or other radio frequency RF signals obtained as the user walks the survey path.

The turning angle estimation module identifies turns made by the surveyor walking through all or part of a venue e.g. according to a pre planned survey path . Turn estimation may be made by summing a plurality of angle changes. One example implementation of turn angle estimation is presented in and associated discussion.

A data log receives data from the personal step model and a magnetometer and Wi Fi or other RF signal receiver . Accordingly the data log may contain data which relates location e.g. location within a floor plan to magnetic field data and or RF radio data etc. The data log may be used to create the offline maps such as by operation of the database construction application or procedure of .

A location inference engine may be configured similarly to the online location inference engine of the cloud services . In operation the location inference engine may utilize online maps or offline maps to determine a location of the mobile client .

A query location interface may allow communication with the location inference engine of the client device and or communication with the location inference engine in the cloud services and or communication with applications that desire to retrieve the current location.

For a given venue map e.g. the floor plan of a survey plan may be created that covers all paths or portions of the venue that are of interest. The survey plan can be generated manually or by application of prescribed rules such as the right hand or left hand wall follower rule. The floor plan may result in some adaptation. For example if a path is within a narrow pathway a single survey path may be sufficient. In contrast in an extra wide corridor or within open spaces additional survey paths may be added to provide adequate coverage.

An actual location of a trace followed by a surveyor may be estimated using input from IMU sensors. The estimation may be performed using step detection step length estimation and an estimation of step heading and or direction. In one example instead of estimating the heading direction from the magnetometer a gyroscope may be used. Because the mobile client device may be held in any orientation and or attitude sensor readings may be converted from device s body frame to its north east down NED frame which is close to the local World Coordinate System. A conversion matrix may be obtained by estimating gravitational force in device s body frame by taking average acceleration over the past several steps. Since a turn of the mobile device will be along the horizontal plane i.e. the surveyor is walking on a floor of uniform elevation that is perpendicular to the gravity an estimation may be made of the turning angle by integrating the Z axial rotation in the NED frame of the mobile device. Accordingly a negative or positive turning angle indicates a direction change towards the left or right respectively regardless to the device s actual attitude.

In one example trace matching may be used to match a trace e.g. data indicating actual movement of a surveyor to aspects of a survey plan and or venue map. Trace matching may include candidate turn detection which may be performed in part by recognizing an actual turn decision such as by operation of techniques in dynamic programming. In one example a running detection window empirically set to 7 steps may be set to a walking trace of a surveyor. In the example a candidate turn may be identified if the sum of angle changes within the detection window exceeds a threshold. The threshold may be set as indicated by circumstances but in one example may be about 30 degrees. A real turn may be extracted from data indicating multiple candidate turns. Additionally several consecutive turns may be merged into a single turn and a local search may be performed so that additional steps belonging to the same turn are included. Such inclusion ensures the integrity of the turn and improves the detection accuracy of the turning angle. The turning point may be set at a step having the sharpest angle change of the turns within the detection window.

In one example dynamic programming may be used to match traces indicating actual movement of a surveyor to corresponding paths in a survey plan. Such matching provides an understanding of where actual measurements e.g. magnetic strength measurements were taken in relation to the floor plan of the venue. In the example an estimated user trace may be matched to its corresponding pre planned path by matching the turns in the two paths. Because turns are salient features a comparison may be made between two lists of turns one ground turn list G for ground obtained from the pre planned survey paths and one candidate turn list C for candidate that represent measured turns e.g. measured by IMU sensors .

Referring to the ground and candidate turns can be described by and respectively wherein P P Pand Pare the start and end points and other terms represent turns.

In one example the task of turn matching is essentially to optimally match the two sequences G and C. The start and end points are directly matched and the overall length of the estimated trace is scaled to have the same length as the pre planned path. When matching intermediate turns there are two major sources of errors in walking trace estimation one is walking distance error arisen from miss detection of steps or error in step length estimation and the other is the angle detection error due to instantaneous error such as hand shake sensor drift and imperfect walking e.g. irregular step size . To consider both error sources the following penalty function may be used for matching the jturn in C to the iturn in G where D L i L j L i is the relative distance difference for the ipath segment and A i j g c gis the relative angle difference. Here L and represents the length of a segment and the angle of a turn.

For a given penalty function the sequence matching problem can be effectively handled using dynamic programming. In an example algorithm would generate the following optimal matching results 

After fixing positions of the turns the location of intermediate steps may be calculated. In one example the calculated locations may be proportional and according to an estimated step length and the overall distance between two bounding turns. Data may then be interpolated from the locations of the two bounding steps proportional to their time differences. The final map and or database may be constructed by extrapolating the magnetic field strength on the survey path in one or more directions until reaching the walls indicated by the floor plan. For wide corridors multiple parallel survey paths may exist. In these cases magnetic field strength data at intermediate locations between two survey paths are interpolated according to their distances to each bounding path. For crossroads and turning areas the average of interpolated strengths from different survey paths may be used. A two dimensional view of resulting map for an office building may show a plurality of local specific disturbances of the indoor magnetic field.

In one example a map may be stored as a grayscale bitmap color scale gradient or other data structure with the magnetic field strength indicated by an 8 bit or other value integer for the position specified by its X and Y coordinates. To conserve storage space all areas that are not surveyed may be treated as transparent area. This ensures more compact storage and faster transmission time when downloading the map from the cloud service. In one example the relative size of resulting map to the actual floor plan is roughly the same as the portion of pathway area to the overall floor area.

The location inference engine s resolve the location of the mobile client device . Similarly configured location inference engines may be present in both the cloud services i.e. location inference engine and the mobile client i.e. location inference engine . In one example the location inference engines use observed magnetic signals and associated anomalies. The location inference engines may also use IMU data which may be processed using particle filtering techniques. The location inference engines may also utilize RF signals e.g. Wi Fi signals opportunistically received by the mobile device .

The location inference engines are configured to resolve issues including distinguishing magnetic signals different spatial sampling density due to different walking speeds by which the mobile client is moved device diversity and usage diversity and possible lack of externally sensed absolute heading directions.

In one example the ability to distinguish geomagnetic signals may be improved by increasing the size of an area over which measurements are made. Thus by utilizing multiple temporal observations a high dimensional vector signal may be created. The path of a user walking may increase spatial coverage of the vector signal. In a particular example if a user carried device observes three consecutive samples with magnitude 47 48 49 there may be only two possible locations in a map or database with similar observations. Accordingly multiple geomagnetic observations over time enhance the ability to distinguish location.

A longer trace over which a user walked while taking magnetic and optionally inertial measurements that is converted into a vector will result in greater ability to discern location using geomagnetism. However matching excessively long vectors against the samples in the database may lead to intractable complexity. This may be true in part because a user may walk using different step sizes and directional headings and may stop from time to time. Such variations may result in geometrically or exponentially growing complexity. A step model may be used to create vectors from samples that incorporate considerations that reduce complexity. A first technique that may be utilized to reduce complexity is to limit vector comparison to vectors that cover similar spatial distances. Thus an estimate of the spatial coverage of user step vectors may be used. Such information is readily available from IMU based tracking. A second technique that may be utilized to reduce complexity is to associate samples within a same step pattern with a same direction of motion. Such association is consistent with the combination of such measurements into a single vector. A third technique that may be utilized to reduce complexity is to avoid discontinuities in a user s walking gait e.g. full steps may be utilized since it is unlikely the user will stop walking in mid step.

Walking based temporal observations may lead to a spatial sampling density diversity problem. In one example different numbers of samples may result for the same spatial coverage due to possibly different walking speeds and different temporal sampling frequencies. In an example sampling environment faster walking may yield shorter traces and fewer signal samples whereas slower walking may yield long traces with more samples. Thus different spatial sampling density may result from walks covering the same path. Accordingly vectors over the same spatial coverage may have different dimensionality. Different sampling frequencies may further complicate the walking based temporal observations and sensor measurements. Nevertheless different spatial sampling densities may result in similarly appearing patterns. Therefore in one example a dynamic time warping DTW algorithm may be used to measure similarity between two sequences that may vary in time and or speed.

To address issues of device diversity and usage diversity a simple mean removal technique may be used. In this technique both the signal vector and the candidate vector have their mean removed before applying DTW. Such removal is warranted despite different measured values of the same magnetic field because the shape of resulting magnetic signal sequences may be similar for the same path. Therefore the shape of the local magnetic field may be utilized instead of absolute values of the field.

Thus to match a magnetic signal vector collected in one step a candidate vector may be configured from neighboring samples in the database such that the vectors cover the same spatial distance as the length of that step. The mean of both vectors may be removed and DTW applied to calculate vector similarity.

Tracking based approaches to location finding may utilize particle filtering techniques or other signal processing techniques. Example implementations of particle filtering techniques may include definition of particle motion models. Within such a model particles are driven or moved uniformly with external sensed absolute directions which may be very noisy due to indoor magnetic field anomalies. Movement of the particles updates a state in the model. In one example a user may walk in a straight line within an underground parking garage e.g. with a phone sensing magnetic field strength in the user s pocket . In the example the magnetic field data will be noisy whereas gyroscopic data can reliably capture relative walking directions. Techniques that fuse magnetic and gyroscopic data e.g. gyroscopic data obtained through a motion application programming interface API may be used within an example inertial tracking system. Such a fusion may lead to better directional accuracy but significant noise may remain in the data. In another example techniques may utilize particle filtering but without resolving the heading direction from a possibly disturbed magnetic field. Such techniques may utilize a gyroscope without a compass. Based on an assumption that a user is very likely to follow the main direction of the path and is very likely to continue walking in a consistent direction rather than making random turnarounds the techniques may utilize a map constrained position aware inertial based MPI particle motion model to move the particles.

Step based vectors magnetic vector matching and the particle motion model may be combined into an augmented particle filter that may execute on a step by step basis i.e. as a user walks with a mobile device having magnetic field sensors . The state of a particle includes its current location right arrow over p x y and also the heading direction right arrow over u . The observations may be obtained from a mobile client and include walking step information e.g. step length and relative direction change and the magnetic fingerprint vector elements collected during the step.

With input from a new step a particle may be updated as follows for newborn particles for re sampling particles and where P right arrow over u is a probabilistic selection function that instantiates the direction of a newborn particle according to its position and right arrow over u is to account for possible relative direction errors that is also assumed to follow a Gaussian distribution with zero mean and variance set to ten degrees in one implementation. The term l is the estimated step length and accounts for the possible error of step length estimation and assumed to obey a Gaussian distribution with zero mean and variance set to 2l in one implementation. The weight of a particle is set to

Utilizing the techniques discussed above a system can track and locate a user in an indoor environment using a magnetic field optionally utilizing relative directions depicted as a trace of the user walking and obtained from a gyroscope. Improved accuracy can be obtained by a method that combines these technologies utilization of magnetic fields and inertial sensors with other localization means e.g. Wi Fi to improve the location finding accuracy. In one example a Wi Fi database can also be constructed using the previously discussed compliant walking method and techniques. In the example a map of magnetic signal data and a radio e.g. Wi Fi map may be constructed simultaneously by also collecting Wi Fi data as the magnetic signal data is collected.

One reason to combine the techniques discussed above with Wi Fi or other RF based location finding methods lies in their complementary location finding capabilities. Wi Fi is a short range radio system and thus can differentiate distantly separated locations. However Wi Fi signals are usually similar for locations. Thus when used alone Wi Fi provides limited discernibility between nearby locations. In contrast the geomagnetic field is global. Accordingly the geomagnetic field may provide similar measurements even between two distantly separated locations. However the local magnetic field anomalies are more fine grained. Therefore if the magnetic field information and the Wi Fi signals are considered jointly within a location finding process synergistic interaction may result in better location finding than either technology could provide individually.

When performing a location query the location inference engine may consider a motion trace and the corresponding magnetic signals and Wi Fi information logged as the trace was created. By using both magnetic and RF information the location finding process may be made more accurate. Particularly if given the correct initial location particle filtering will converge faster and yield more accurate result. In one example the Wi Fi localization may be fused with the magnetic signal information through a two pass bidirectional particle filtering process as shown in .

In the first pass a rough location estimate P shown at may be obtained using Wi Fi signals. Using P backward particle filtering may be applied along the reversed direction of a motion trace. The location information provided by a Wi Fi hotspot assists in finding the true position to be near Pat . Therefore an initial distribution of particles may be made only within a proximity of P e.g. in a circle centered at Pwith radius R. Using the backward particle filtering process a good estimate of the starting position P shown at of the logged trace may be obtained. In the second pass a forward particle filtering may be performed along the motion trace normally and the particles may be initialized within a circle around Pwith radius r. Finally a post filtering process may be performed and only the particles that fall within the circle i.e. the range R to P are retained. The weighted average of these particles may be obtained to determine the final localization result at which may be referred to as P .

In example operation the same background logged motion trace may be used twice in the TBPF. This makes the particle filtering in the second pass biased leading to either better or worse results. Thus in some examples it is crucial to apply the final post filtering process i.e. selecting particles within radius Rto P . This selection implicitly uses some truth information e.g. that the true location must be around P and ensures the bias is favorable.

As used herein computer readable media includes computer storage media and communication media. Computer storage media includes volatile and non volatile removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. Computer storage media includes but is not limited to random access memory RAM read only memory ROM electrically erasable programmable ROM EEPROM flash memory or other memory technology compact disk ROM CD ROM digital versatile disks DVD or other optical storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium that can be used to store information for access by a computing device.

In contrast communication media may embody computer readable instructions data structures program modules or other data in a modulated data signal such as a carrier wave. As defined herein computer storage media does not include communication media.

In the example method at block magnetic field strength is measured in a plurality of locations within a building. The measurements may be made by a mobile device or client such as a cell phone tablet laptop etc. The measurements may be of a magnetic field and include measurements such as field strength orientation etc. In the example of the mobile client is moved through a building or other venue shown by floor plan . In a further example magnetic field strength is measured using step sized intervals of distance. The steps may be assumed to be of uniform step distance and uniform step direction. In some examples vectors are formed with each vector including multiple measurements e.g. each measurement associated with a step of the user .

Blocks and show alternative and or supplemental examples of measurements that may be taken by a mobile device. At block magnetic field strength measurements may be made in step sized e.g. walking steps intervals of distance. In the example of the personal step model may be utilized. In other examples assumptions may be made regarding a uniform step distance and or aspects of directional change may be made. Such assumptions may be selected to make certain calculations more manageable. At block at least one indoor geomagnetic field anomaly is measured. Such an anomaly may be location specific and temporally stable. In one example the geomagnetic field anomaly may be created by features of the venue such as concrete and rebar walls metal roofs etc. which may result in temporally steady disruption of the geomagnetic field in specific locations in a floor plan of a building.

At block vectors are formed utilizing magnetic field strength information. In one example a vector may include multiple magnetic field strength measurements. The presence of multiple measurements in a single vector provides information that may be used to more precisely indicate a location of the points in the vector.

At block online and or offline maps are accessed such as by the location inference engine s of . Generally online maps may be accessed when the mobile device has access to the cloud services and offline maps resident on the mobile device may be use otherwise.

At block measured magnetic field strength is compared to previous measurements of magnetic field strength. In one example the previous measurements may be contained in the on off line maps. In another example a vector defining measurements e.g. from block is compared to a map or data base depicting at least part of a building.

At block received Wi Fi signals are compared to known Wi Fi signals and or transmitters. In an example information describing the known or previously measured Wi Fi signals may be documented on the on off line maps.

At block magnetic field and Wi Fi based location finding methods may be fused or otherwise combined to create a unified location finding method. In one example the two pass bidirectional particle filtering methods of may be utilized.

At block a location of the mobile device is identified based at least in part on the magnetic field strength and optionally based at least in part on synergistic utilization of a second technology such as Wi Fi measurement comparisons other RF signals inertial measurements etc.

At block data from an inertial measurement unit IMU may be received as the defined survey paths are walked. Referring to the example of the venue may be walked by the mobile client which may include sensors . As seen in the sensors may include an accelerometer or other IMU device.

At block magnetic field data from a magnetometer may be received as the defined survey paths are walked. In the example of the magnetometer provides a signal to the data log which records magnetic field data.

At block a detection window may be applied to walking traces to search for a candidate turn within the data received from the IMU. As discussed with respect to the examples of a running detection window may be empirically set to a desired number of steps and may be used in conjunction with a walking trace of a surveyor of a venue. At block a candidate turn may be identified if a sum of angle changes within the window exceeds a threshold value. The sum may represent a gradual turn taken using several walking steps by the individual performing the survey. As discussed with respect to the threshold value may be set as indicated by circumstances.

At block an estimated user trace may be matched to a corresponding portion of a pre planned path in the survey plan. and associated discussion shows an example of the use of traces in the example survey method.

At block a map database or other data structure may be created such as by using the IMU data and the received magnetic field data which may include anomalies in the magnetic field data. In the example of the database construction routine may construct the map or other data structure. Detail of the data base construction routine is seen in including the survey plan creator the user trace estimator and the turn matching tool .

At block the survey information e.g. the map database and or data structure may be stored. The information may be stored as a map in a grayscale bitmap format a color gradient a database or in any desired data structure format. The map may be stored on the cloud services as an online map and or the mobile client as an offline map .

Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described. Rather the specific features and acts are disclosed as exemplary forms of implementing the claims.

