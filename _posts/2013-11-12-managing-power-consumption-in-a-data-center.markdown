---

title: Managing power consumption in a data center
abstract: Systems and methods are provided for managing resources. In one implementation, a method is provided in which a management server determines whether a condition related to one or more resources has occurred. The management server further determines at least one program instance to terminate. The at least one program instance executes on one of a plurality of servers. The management server further terminates the determined at least one program instance, which was used by an excess program execution capacity user.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09264334&OS=09264334&RS=09264334
owner: Amazon Technologies, Inc.
number: 09264334
owner_city: Reno
owner_country: US
publication_date: 20131112
---
This application is a continuation of co pending U.S. application Ser. No. 13 495 983 filed Jun. 13 2012 and entitled Managing Power Consumption in a Data Center which is hereby incorporated by reference in its entirety. U.S. application Ser. No. 13 495 983 is a continuation of U.S. application Ser. No. 12 591 990 filed Dec. 7 2009 and entitled Managing Power Consumption in a Data Center now U.S. Pat. No. 8 224 993 which is hereby incorporated by reference in its entirety.

Computer infrastructure services providers supply dynamically scalable and abstracted resources as services over the Internet as well as maintain computers on which users can run applications and store data. Computer infrastructure services providers locate the computers that comprise such infrastructures in one or more facilities that are commonly referred to as data centers. A small data center may occupy a room or a floor of a building while a large data center may occupy several floors or an entire building. A typical data center may house many computers such as servers along with other components e.g. backup power generators un interruptible power supplies power distribution units etc. that support the resources of the data center. Data centers also are built in non traditional ways such as within shipping containers or on boats.

Power is a commodity that is essential to running a data center. Power also is the most constrained resource that is used in a data center. The power consumption of components within a data center varies with the utilization of the components. For example as a server becomes more heavily loaded it consumes more power. To avoid unexpected failures it is thus necessary to provision sufficient power to drive every component of a data center such as servers at full utilization. However because all components of a data center rarely operate at full utilization at all times a data center typically will significantly over provision power.

Over provisioning power that is not used efficiently results in a cost increase for all resources within a data center. For example a server that remains idle or that experiences a small load will nevertheless require a significant power budget in case its load suddenly increases. Increasing utilization of the power delivered to a data center can significantly reduce the cost of operating the data center.

While it is possible to operate individual resources in a data center at levels that are near or over capacity a sudden utilization increase of some resources may drive overall power consumption beyond the data center s available supply. As a result the data center may need to shut down certain resources or some resources may experience sudden failures. Resources that are shut down or fail unexpectedly prevent the computer infrastructure services provider from providing services to customers and can cause data loss or corruption. As a result of these considerations on the one hand a computer infrastructure services provider who is trying to maximize power utilization may oversubscribe power of resources to minimize costs but risks having resources shut down when power consumption exceeds supply. On the other hand the computer infrastructure services provider instead may over provision power which increases power costs. The problem is further complicated by the fact that external environmental factors such as an increase in temperature may cause an increase in power consumption such as by requiring additional cooling capacity to be brought online. Therefore there is a need for improved systems and methods that provide power management for facilities such as data centers.

The following detailed description refers to the accompanying drawings. Wherever possible the same reference numbers are used in the drawings and the following description to refer to the same or similar parts. While several illustrative embodiments are described herein modifications adaptations and other implementations are possible. For example substitutions additions or modifications may be made to the components illustrated in the drawings and the illustrative methods described herein may be modified by substituting reordering removing or adding blocks to the disclosed methods. Accordingly the following detailed description is not limiting of the disclosed embodiments. Instead the proper scope is defined by the appended claims.

Disclosed embodiments provide systems and methods for managing power consumption in a data center by for example terminating resources or shutting down resources in the data center. In some embodiments terminating resources may comprise terminating program instances such as program instances belonging to certain users who make use of services supplied by a computer infrastructure services provider associated with the data center. As the term is used herein a program instance is an occurrence or representation of an object. For example the computer infrastructure services provider may provide various service categories or service class levels such as dedicated program execution capacity users on demand variable program execution capacity users and excess program execution capacity users. These categories or service levels may be specified by service agreements between the computer infrastructure services provider and users. In some embodiments the termination of resources or shutting down of resources may occur according to rules that prioritize these user categories or service levels. For example service agreements may specify acceptable delays related to the availability of data.

Consistent with a disclosed embodiment a computer implemented method is provided for managing resources of a computer infrastructure services provider. The method comprises receiving by a management server data from a plurality of resources of a data center. The data reflects power usage of at least one of the plurality of resources of the data center processing loads of at least one of a plurality of servers in the data center or at least one environmental condition related to the data center. The management server determines whether a condition related to one or more of resources in the data center has occurred and receives priority data reflecting priorities for terminating or shutting down resources of the data center. The management server further determines based at least on the priority data at least one of the plurality of resources of the data center to terminate or shut down. The management server terminates or shuts down the determined at least one of the plurality of resources.

Consistent with another disclosed embodiment a computer implemented method is provided for managing resources. The method comprises determining by a management server whether a condition related to one or more resources has occurred. The management server determines at least one program instance to terminate. The at least one program instance is executing on one of a plurality of servers. The management server terminates the determined at least one program instance which was used by an excess program execution capacity user.

Consistent with another disclosed embodiment a computer implemented method is provided for managing resources. The method comprises determining by a management server whether a condition related to one or more resources has occurred. The management server receives data reflecting terms of service related to data being stored by at least one server. The management server determines whether to power down the at least one server based at least on the terms of service. The management server further powers down the at least one server.

Consistent with yet another disclosed embodiment a system is provided for managing resources. The system comprises a processor for executing program instructions and a memory storing the program instructions. The program instructions are executed by the processor to perform a process. The process includes determining whether a condition related to one or more resources has occurred and determining at least one program instance to terminate. The at least one program instance is executing on one of a plurality of servers. The process further includes terminating the determined at least one program instance which was used by an excess program execution capacity user.

Consistent with yet another disclosed embodiment a system is provided for managing resources. The system comprises a processor for executing program instructions and a memory storing the program instructions. The program instructions are executed by the processor to perform a process. The process includes determining whether a condition related to one or more resources has occurred and receiving data reflecting terms of service related to data being stored by at least one server. The process further includes determining whether to power down the at least one server based at least on the terms of service and powering down the at least one server.

Consistent with other disclosed embodiments computer readable storage media may store program instructions which are executed by a processor and perform any of the methods described herein.

Network provides communications between the resources e.g. computing nodes of data center and terminals . In addition the resources of data center and terminals may access legacy systems not shown via network or may directly access legacy systems data stores or other network applications. Network may be a shared public or private network may encompass a wide area or local area and may be implemented through any suitable combination of wired and or wireless communication networks. Network may further comprise an intranet and or the Internet.

Data center may house various interconnected computing systems e.g. resources of a computing infrastructure services provider such as computing nodes . Consistent with disclosed embodiments data center may be operated by and on behalf of a single user or by a provider e.g. a computer infrastructure services provider that supplies computing resources to users and or customers. For example a computer infrastructure services provider may supply dynamically scalable and virtualized resources as services over the Internet e.g. network . Furthermore the computer infrastructure services provider may supply resources e.g. computing nodes on which users can run applications and store data.

As shown in data center includes power management server program execution service system manager and computing nodes . Power management server may provide functionality for monitoring and managing the power consumption of components of data center such as computing nodes . Program execution service system manager may manage the execution of programs for multiple users such as users executing programs on computing nodes . Additional details regarding power management server and program execution service manager are discussed below in connection with .

Computing nodes may comprise multiple physical computing systems and or virtual machines that are hosted on one or more physical computing systems for executing user programs and or storing user data. For example via terminals users may upload applications libraries data network resources directory resources and associated configuration settings to computing nodes and request a number of virtual machines i.e. server instances on which the users may load applications. The users also may increase or decrease as needed how much central processing unit CPU and storage capacity is needed to run the applications. Further details regarding the components of data center are provided below in connection with the discussion of .

Terminals may be any type device for communicating with the resources of data center and or other systems not shown over network . Terminals may be personal computers handheld devices e.g. PDAs cellular phones etc. or any other appropriate computing platform or device capable of exchanging data with network . For example terminals may each include a processor not shown and a memory not shown . Terminals may further execute program modules that provide one or more graphical user interfaces GUIs for interacting with network resources such as the resources of data center . Alternatively in other embodiments users of terminals may access the resources of data center through other network mechanisms such as through an application programming interface API of a Web service.

Consistent with disclosed embodiments terminals may be used by various users of computing services that are provided by a computer infrastructure services provide associated with data center . For example the users e.g. administrators may use terminals to access and or receive data from the resources of data center . Users of the computing services may be divided into service categories such as dedicated program execution capacity users on demand variable program execution capacity users and excess program execution capacity users. Service categories are discussed in further detail in connection with the following discussion of .

As shown in computing nodes may comprise servers which may be housed in a server rack not shown . For example a certain number of servers e.g. four servers may be housed in a single server rack. Additional server racks not shown may house additional servers not shown that are included in computing nodes . Servers may communicate via an internal network not shown within data center with other servers that are located in data center and or via network with additional servers that are located outside of data center . Accordingly servers may distribute processes for parallel execution among a plurality of servers. Alternatively servers may be specially constructed for storing data and or executing applications.

Servers may each include a processor not shown a memory not shown and a data store not shown for storing data e.g. applications and or data of users that receive services from a computer infrastructure services provider maintaining and or operating data center . The data store may comprise a plurality of storage devices such as disk storage devices optical storage devices etc. For example the data store may comprise multiple disk drives that combine to form a disk array. The disk array may include for example a disk array controller a cache disk enclosures and a power supply. The disk array controller may connect to network via a port not shown which may serve as an interface between the disk array controller and network .

Components of data center that facilitate and or support servers may include backup power generators uninterruptible power supplies and power distribution units . Data center may further include components such as chillers as well as a heating ventilation and air conditioning system and a temperature monitoring system . Furthermore although not shown in data center may include other components that facilitate communications among the resources of data center . For example data center may include routers network switches and communications links that facilitate communications among the components of data center and or facilitate communications over network .

Backup power generators BPGs may comprise batteries for storing power in the event that power is unavailable to data center . For example BPGs may be physically located within or outside of data center . Uninterruptible power supplies UPSs may provide backup power to components of data center such as servers if an unexpected power disruption occurs that could cause an outage or data loss. Power distribution units PDUs may comprise devices that distribute electric power to components of data center such as servers .

Chillers may comprise cooling systems that cool the water of heating ventilation and air conditioning HVAC units. Chillers may each have dedicated power supplies not shown . HVAC system may comprise HVAC units that are used to control the temperature and humidity of data center . Temperature monitoring system may monitor the temperature and or the humidity inside and or outside of data center . For example temperature monitoring system may comprise sensors that are located inside and or outside of data center . The sensors may provide environmental condition data e.g. temperature humidity and or other environmental data .

Program execution service PES system manager may manage the execution of programs for multiple users such as programs executing on computing nodes e.g. servers . As discussed above users who receive services from a computer infrastructure services provider associated with data center may be subdivided into various service categories such as dedicated program execution capacity users on demand variable program execution capacity users and excess program execution capacity users. These categories may represent various levels of services that the computer infrastructure services provider has agreed to provide the users through for example a service agreement. Dedicated program execution capacity users on demand variable program execution capacity users and excess program execution capacity users are discussed next in more detail.

Dedicated program execution capacity users may receive priority access relative to other users to use a respective amount of program execution capacity that is made available to users via one or more of servers . The priority access of the users may be based on each of the users having dedicated or exclusive access to use the respective amount of program execution capacity. For example a respective amount of program execution capacity may be allocated to a particular user for dedicated access over a specified period of time such as in a manner analogous to a lease of one or more physical computing systems so that the respective amount of program execution capacity may be available for executing programs on behalf of the user throughout the specified period of time. For example a user may be given preferential or other dedicated access to execute programs based on one or more factors such as fees paid by the user an agreement to a contractual obligation for using the dedicated access for a period of time and or subject to other conditions etc.

On demand variable program execution capacity users may submit requests to execute programs at a certain time e.g. immediately upon request of those users at an indicated future time at some time during an indicated future time period etc. such that one or more programs indicated by such a request may be executed if computing resources e.g. servers sufficient to satisfy the requested execution are available at or near the requested time but without such a request being guaranteed to be satisfied.

Excess program execution capacity users may execute programs by making use of otherwise unused program execution capacity of servers on a temporary or non guaranteed basis. For example the excess program execution capacity may be available to execute such programs until a time that the program execution capacity is desired for other purposes e.g. for preferential or reserved use by one or more other users . In some cases one or more programs may be executing on behalf of a user using excess program execution capacity at the time that the excess program execution capacity is desired for other purposes and in some such cases the execution of the programs may be automatically terminated e.g. shut down aborted etc. so as to be available for the other purposes. Programs that are automatically terminated may be automatically restarted on behalf of the user at a future time such as a future time when a sufficient amount of excess program execution capacity again becomes available to execute the programs for the user.

Accordingly PES system manager may coordinate the program execution capacity of servers in accordance with the service categories of various users such as dedicated program execution capacity users on demand variable program execution capacity users and excess program execution capacity users. Additional details describing systems and methods for managing program execution capacity are provided for example in U.S. application Ser. No. 12 334 022 filed Dec. 12 2008 entitled Managing Use of Program Execution Capacity the entire contents of which are expressly incorporated herein by reference.

Power management server may provide functionality for monitoring and managing the power consumption of components of data center such as servers . As shown in power management server is located in data center . However in other embodiments power management server may be located at another location that is separate from data center and instead may provide services to data center over network . Additional details regarding power management server are discussed below in connection with .

Power management server may comprise a general purpose computer e.g. a personal computer network computer server or mainframe computer having one or more processors that may be selectively activated or reconfigured by a computer program stored in memory. As shown in power management server may include a processor a memory and a data store .

Memory may comprise one or more memory or storage devices that store data as well as software. Memory also may comprise for example one or more of RAM ROM magnetic storage or optical storage. For example memory may store program modules that when executed by processor perform one or more processes for managing electronic power consumption through the shedding or terminating of programs executing on one or more of servers .

Data store may store data collected from resources of data center such as servers BPGs UPSs PDUs chillers HVAC system etc. Furthermore data store may store rules specifying procedures for terminating program instances being executed on servers and or shutting down resources of data center . For example as discussed above a computer infrastructure services provider may supply resources e.g. servers of data center according to service categories such as dedicated program execution capacity users on demand variable program execution capacity users and excess program execution capacity users. Consistent with disclosed embodiments when power consumption within data center approaches supply power management server may selectively shed or terminate loads of servers by terminating certain programs i.e. program instances being executed on servers and or by shutting down resources entirely. The termination of program instances and or resources may be according to any number of metrics such as business rules specifying a priority or hierarchy of users associated with the program instances and or resources. Furthermore the termination of a program instance may evacuate a resource e.g. a server enabling the resource to be powered down.

In one embodiment after a condition has occurred e.g. power consumption within data center meets or exceeds a threshold which may indicate that data center is near its supply limit power management server may terminate program instances used by excess program execution capacity users. For example a threshold may be set or adjusted by the data center operator based on environmental conditions. In response to the determination that the power threshold has been met or exceed power management server may directly terminate one or more program instances through one or more commands transmitted to one or more of servers . Alternatively in other embodiments power management server may transmit one or more commands to program execution service system manager which in turn may terminate the one or more program instances being executed on one or more of servers . Consistent with disclosed embodiments in which program instances of excess program execution capacity users are terminated servers may continue to provide services for dedicated and on demand variable program execution capacity users.

In one embodiment power management server may provide a software architecture for monitoring and managing power consumption of resources in data center . The software architecture may be stored in for example memory of power management server . The software architecture may provide a program which is executed by processor . Program may includes instructions in the form of one or more program modules . As shown in program modules may include a monitoring module a managing module and a terminating module

Monitoring module may continuously or periodically collect performance telemetry from components within data center . For example monitoring module may receive data from one or more of servers BPGs UPSs PDUs chillers HVAC system and any other components of data center . The collected performance telemetry may include the loads of one or more of servers . For example a load of one of servers may comprise a total number of outstanding requests for one of servers a utilization rate of a processor of one of servers and or a utilization rate of a memory of one of servers . Furthermore the collected performance telemetry may include a power consumption rate of one or more servers and or one or more of other components of data center such as BPGs UPSs PDUs chillers HVAC system etc.

Managing module may implement rules specifying procedures for terminating program instances being executed on servers and or shutting down resources such as servers . For example managing module may continuously or periodically evaluate telemetry collected by monitoring module according to the rules. Furthermore when power consumption within data center meets or exceeds a threshold which may indicate that it is near its supply limit managing module may determine according to the rules which program instances being executed on servers to terminate and or which resources within data center to shut down.

In one embodiment when a condition has occurred e.g. power consumption within data center meets or exceeds a threshold which may indicate that it is near its supply limit power management server may terminate one or more program instances of excess capacity users in order to decrease power consumption within data center to within available power capacity or to a predetermined threshold value. Furthermore in other embodiments managing module may prioritize service categories for termination. Managing module may determine based on data stored in data store for example that program instances of excess program execution capacity users should be terminated first followed by program instances of on demand variable program execution capacity users and then followed by dedicated program execution capacity users until a sufficient power reduction has occurred. Sufficient power reduction may be indicated by power consumption falling below the threshold.

As part of determining whether to terminate program instances managing module may model conditions within data center based on collected telemetry data to anticipate increases in power utilization that may require terminating program instances and or shutting down of components within data center . For example managing module may determine weather trends such as increases in temperature outside and or inside of data center to predict when temperatures may cause for example chillers and or HVAC system to consume increased amounts of power.

Furthermore managing module may determine in some circumstances that an entire server e.g. one of servers should be shut down. This determination may factor in data received over network indicating that certain data being stored at data center has been replicated across multiple data centers in other locations. Accordingly in some embodiments managing module may determine for example that certain servers supported by a particular PDU should be shut down or that certain servers supported by a particular chiller should be shut down.

For example managing module may evaluate terms of a service agreement as part of determining whether or not a server should be shut down. As part of the evaluation managing module may determine whether or not shutting down the server is consistent with terms of one or more service agreements e.g. a term related to providing a particular class or level of service to a user corresponding to one or more users having data stored on the server. As part of the evaluation managing module may determine whether or not data of one or more users is available through another resource e.g. another server stores a copy of the one or more users data . Alternatively managing module may determine whether consistent with the service agreement it is acceptable to power down a server storing data for one or more users. For example a service agreement may allow a particular level of latency e.g. a delay before the data becomes accessible due to the time needed to power on the server as part of the terms of service. As yet another alternative managing module may determine that data has not been accessed in a certain time period i.e. the data is considered cold and accordingly managing module may power down a server storing the data because it is not anticipated that the data will be accessed for a certain time interval. As discussed above in some embodiments replicas of data that becomes unavailable may be available through other resources e.g. other servers at the same or other data centers .

Terminating module may terminate selected instances such as excess capacity program instances and or shut down one or more resources of data center . Terminating module may directly terminate one or more program instances and or shut down one or more resources through one or more commands transmitted to one or more of servers . Alternatively terminating module may transmit one or more commands to program execution service system manager which in turn may terminate the one or more program instances being executed on one or more of servers and or shut down the one or more resources.

In one embodiment the execution of program instances may be automatically terminated e.g. shut down aborted etc. to make the capacity available for other purposes. Programs of users that are automatically terminated may be automatically restarted on behalf of the users at a future time such as a future time when power consumption decreases and a sufficient amount of excess program execution capacity becomes available to execute the programs for the users.

In block power management server may receive telemetry data regarding resources and data center . For example as discussed above power management server may continuously or periodically receive performance telemetry from components within data center . The performance telemetry may relate to a condition such as power consumption temperature or other conditions e.g. processing loads .

In block power management server may determine whether to terminate program instances and or shut down resources. The decision to terminate program instances and or shut down resources may relate to a condition in data center that has occurred such as a condition that has approached or exceeded a threshold. For example power consumption in the data center may be reaching a limit that may have been established by an operator of data center to prevent polder consumption from exceeding supply. The determination may be based on collected telemetry data and or modeling done by power management server to anticipate increases in power utilization that may require terminating program instances and or shutting down resources. For example power management server may use modeling data such as temperature trends as part of the determination.

If power management server determines in block that the condition has not occurred e.g. power consumption is below a threshold routine may end. However if power management server determines that the condition has occurred e.g. power consumption is at or above a threshold routine may proceed to block .

In block power management server may receive priorities of service categories and or resources. Power management server may prioritize service categories and or resources using for example data stored in data store . For example power management server may determine that program instances of excess program execution capacity users should be terminated first followed by program instances of on demand variable program execution capacity users and then followed by dedicated program execution capacity users until power consumption ails below the threshold.

Furthermore in other embodiments priority data may include data reflecting priorities based on other terms of service. For example power management server may determine whether powering down a server is consistent with terms of the service agreement e.g. a term related to providing a particular class or level of service to a user . As part of the determination management server may consider whether data of one or more users is available through another resource e.g. another server stores a copy of the one or more users data . Alternatively management server may determine whether consistent with the service agreement it is acceptable to power down a server storing data for one or more users e.g. terms of service provide for an acceptable delay before the data becomes accessible or data has not been accessed in a certain time period .

In block power management server may determine one or more program instances to terminate on certain ones of computing nodes e.g. on certain ones of servers and or one or more resources to shut down. For example power management server may determine that terminating program instances of a certain number of excess capacity users will result in a recovery of a sufficient amount of power to continue operations of data center without losing components. Furthermore in some embodiments power management server may determine that certain resources should be shut down entirely e.g. certain servers UPSs PDUs etc. . As discussed above the determination may be based one whether or not shutting down a resource e.g. a server is acceptable based on a service agreement with a user having data stored on the resource.

In block power management server may terminate the one or more program instances and or shut down one or more resources. This may be accomplished by terminating execution of selected instances such as excess capacity program instances. As discussed above power management server may directly terminate one or more program instances and or shut down one or more resources through one or more commands transmitted to for example one or more of servers . Alternatively power management server may transmit one or more commands to program execution service system manager which in turn may terminate the one or more program instances being executed on one or more of servers and or shut down the one or more resources. Accordingly the execution of the programs may be automatically terminated e.g. shut down aborted etc. to make that capacity available for the other purposes. Furthermore in some embodiments power management server may shut down components entirely as discussed above.

As one of ordinary skill in the art will appreciate one or more of blocks may be optional and may be omitted from implementations in certain embodiments. Furthermore functionality provided by one or more of blocks may be subdivided into multiple blocks or combined.

The foregoing description has been presented for purposes of illustration. It is not exhaustive and is not limited to the precise forms or embodiments disclosed. Modifications and adaptations will be apparent to those skilled in the art from consideration of the specification and practice of the disclosed embodiments. For example the described implementations include software but systems and methods consistent with the disclosed embodiments be implemented as a combination of hardware and software or in hardware alone. Examples of hardware include computing or processing systems including personal computers servers laptops mainframes micro processors and the like. Additionally although aspects of the disclosed embodiments are described as being stored in memory one skilled in the art will appreciate that these aspects can also be stored on other types of computer readable media such as secondary storage devices for example hard disks floppy disks or CD ROM or other forms of RAM or ROM USB media DVD or other optical drive media.

Computer programs based on the written description and disclosed methods are within the skill of an experienced developer. The various programs or program modules can be created using any of the techniques known to one skilled in the art or can be designed in connection with existing software. For example program sections or program modules can be designed in or by means of .Net Framework .Net Compact Framework and related languages such as Visual Basic C etc. Java C Objective C HTML HTML AJAX combinations XML or HTML with included Java applets. One or more of such software sections or modules can be integrated into a computer system or existing e mail or browser software.

Moreover while illustrative embodiments have been described herein the scope of any and all embodiments having equivalent elements modifications omissions combinations e.g. of aspects across various embodiments adaptations and or alterations as would be appreciated by those skilled in the art based on the present disclosure. The limitations in the claims are to be interpreted broadly based on the language employed in the claims and not limited to examples described in the present specification or during the prosecution of the application which examples are to be construed as non exclusive. Furthermore the blocks of the disclosed routines may be modified in any manner including by reordering blocks and or inserting or deleting blocks. It is intended therefore that the specification and examples be considered as illustrative only with a true scope and spirit being indicated by the following claims and their full scope of equivalents.

