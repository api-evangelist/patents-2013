---

title: Method for efficient database formation and search on media devices acting synchronously with television programming
abstract: Techniques for efficient database formation and search in applications embedded in a media device are provided. The search may be performed synchronously with presentation of media programming content on a nearby media presentation device. A mobile media device captures some temporal fragments of the presented audio/video content on its microphone and camera, and then generates query fingerprints for the captured fragment. A local reference database resides on the mobile media device and a master reference database resides on a remote server with a most recent chunk of reference fingerprints transferred dynamically to the local mobile media device. A chunk of the query fingerprints generated locally on the mobile media device are searched on the local reference database for continuous content search and identification. The method presented automatically switches between the local search on the mobile media device and a remote search on an external search server.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09367544&OS=09367544&RS=09367544
owner: Gracenote, Inc.
number: 09367544
owner_city: Emeryville
owner_country: US
publication_date: 20130314
---
This application claims the benefit of U.S. Provisional Patent Application Ser. No. 61 610 672 entitled A Method for Efficient Data Base Formation and Search on Portable Media Devices Acting Synchronously with Television Programming filed on Mar. 14 2012 which is hereby incorporated by reference in its entirety.

U.S. application Ser. No. 12 141 337 filed on Jun. 18 2009 entitled Method and Apparatus for Multi dimensional Content Search and Video Identification U.S. application Ser. No. 12 141 163 filed on Jun. 18 2008 entitled Methods and Apparatus for Providing a Scalable Identification of Digital Video Sequences now issued as U.S. Pat. No. 8 229 227 U.S. application Ser. No. 12 141 337 filed on Jun. 18 2008 entitled Method and Apparatus for Multi Dimensional Content Search and Video Identification now issued as U.S. Pat. No. 8 171 030 U.S. application Ser. No. 12 788 796 filed on May 24 2010 entitled Multi Media Content Identification Using Multi Level Content Signature Correlation and Fast Similarity Search U.S. application Ser. No. 12 772 566 filed on May 3 2010 entitled Media Fingerprinting and Identification System now issued as U.S. Pat. No. 8 195 689 U.S. application Ser. No. 12 612 729 filed on Nov. 5 2009 entitled Digital Video Content Fingerprinting Based on Scale Invariant Interest Region Detection with an Array of Anisotropic Filters now issued as U.S. Pat. No. 8 189 945 U.S. Pat. No. 8 229 227 filed on Jun. 18 2008 entitled Methods and Apparatus for Providing a Scalable Identification of Digital Video Sequences U.S. patent application Ser. No. 13 094 158 filed on Apr. 26 2011 entitled Actionable Event Detection for Enhanced Television Delivery and Ad Monitoring Based on Video Audio Content Fingerprinting U.S. Provisional Patent Application Ser. No. 61 610 672 filed on Mar. 14 2012 entitled A Method for Efficient Data Base Formation and Search on Portable Media Devices Acting Synchronously with Television Programming and U.S. patent application Ser. No. 13 509 701 filed on Aug. 21 2012 entitled Media Content Identification On Mobile Devices and having the same assignee as the present application are related applications and hereby incorporated by reference in their entirety.

The present invention relates generally to aspects of efficient identification of audio or video media such as television programming by using a media device equipped with audio video signal capturing and fingerprinting mechanisms. More particularly it relates to aspects of robust audio video signal fingerprinting in the presence of ambient noise efficient database formation distributed between a remote server and the media device and database query with automatic switching between remote search on an external search server and local search on a local reference database on the media device.

With the ubiquity of mobile devices especially smart mobile phones a large proportion of the population often simultaneously watch programming content on their television while using their portable mobile device for text messaging or Internet related activities. Recent development of audio video content fingerprinting technologies and capable mobile media devices as smart phones and tablets have opened up many new possibilities in developing sophisticated applications synchronous to detected television programming events. However techniques for identifying captured segments of media presented on a device such as a television have proven to be very difficult to achieve.

Among its several aspects the present invention recognizes it is possible to have efficient video synchronous applications on a media device by providing the media device with capability to promptly identify and track content being played on a television set in the presence of ambient noise.

In one or more of its several aspects the invention addresses problems of efficient media device local data base structuring and query result based switching between query search on the local reference data base and the query search on the remote server reference data base. An embodiment of the invention addresses a method for efficiently querying a database on a media device. A reference cache database is formed on the media device partitioned for multiple levels of query search wherein each search level represents a larger portion of the reference cache database than a previous search level. Each search level is queried in progressively larger portions of the reference cache database on the media device with automatic switching between a local search on the media device and a remote search on an external search database upon not finding a match in any search level portion of the reference cache database. Upon finding a match in the remote search a chunk of reference media content fingerprints is downloaded from a neighborhood of matching reference fingerprints on the external search database to be stored in the reference cache database on the media device whereby the reference cache database is updated with current search area reference material.

Another embodiment addresses a method for simultaneous capture and querying on a mobile media device. A first fragment of media content is captured from a media presentation device during background operations on a mobile media device wherein the captured first fragment of media content is saved to a circular buffer. The first fragment of captured media content retrieved from the circular buffer is fingerprinted to generate signatures representing the first fragment of captured media content. A local reference database on the mobile media device is queried with the generated signatures while a second fragment of media content is being captured from the media presentation device.

Another embodiment addresses a method for manual and automatic local signature cache management. A signature cache is formed on a mobile media device to hold one set of signatures that is automatically managed for switching between a local search and a remote search wherein downloading of reference media signatures and signature cache management are performed automatically based on search responses from the local search and from the remote search. A manually managed signature cache is formed with functions provided that allow for explicit downloading of the reference media signatures to the signature cache.

A further embodiment addresses a computer readable non transitory medium encoded with computer readable program data and code. A reference cache database is formed on the media device partitioned for multiple levels of query search wherein each search level represents a larger portion of the reference cache database than a previous search level. Each search level is queried in progressively larger portions of the reference cache database on the media device with automatic program controlled switching between a local search on the media device and a remote search on an external search database upon not finding a match in any search level portion of the reference cache database. Upon finding a match in the remote search a chunk of reference media content fingerprints is downloaded from a neighborhood of matching reference fingerprints on the external search database to be stored in the reference cache database on the media device whereby the reference cache database is updated with current search area reference material.

A more complete understanding of the present invention as well as further features and advantages of the invention will be apparent from the following Detailed Description and the accompanying drawings.

The present invention will now be described more fully with reference to the accompanying drawings in which several embodiments of the invention are shown. This invention may however be embodied in various forms and should not be construed as being limited to the embodiments set forth herein. Rather these embodiments are provided so that this disclosure will be thorough and complete and will fully convey the scope of the invention to those skilled in the art.

It will be appreciated that the present disclosure may be embodied as methods systems or computer program products. Accordingly the present inventive concepts disclosed herein may take the form of a hardware embodiment a software embodiment or an embodiment combining software and hardware aspects. Furthermore the present inventive concepts disclosed herein may take the form of a computer program product on a computer readable storage medium having non transitory computer usable program code embodied in the medium. Any suitable non transitory computer readable medium may be utilized including hard disks CD ROMs optical storage devices flash memories or magnetic storage devices.

Computer program code or software programs that are operated upon or for carrying out operations according to the teachings of the invention may be written in a high level programming language such as C C JAVA Smalltalk JavaScript Visual Basic TSQL Perl use of .NET Framework Visual Studio or in various other programming languages. Software programs may also be written directly in a native assembler language for a target processor. A native assembler program uses instruction mnemonic representations of machine level binary instructions. Program code or computer readable medium as used herein refers to code whose format is understandable by a processor. Software embodiments of the disclosure do not depend upon their implementation with a particular programming language.

The methods described in connection with the embodiments disclosed herein may be embodied directly in hardware in a software module executed by a processor or in a combination of the two. A software module may reside in RAM memory flash memory ROM memory EPROM memory EEPROM memory registers hard disk a removable disk a CD ROM or any other form of storage medium known in the art. A computer readable storage medium may be coupled to the processor through local connections such that the processor can read information from and write information to the storage medium or through network connections such that the processor can download information from or upload information to the storage medium. In the alternative the storage medium may be integral to the processor.

One aspect of the invention presents a method to identify media content which includes audio video or both audio and video content by capturing the audio and or video data from the mobile device appropriately processing the audio and or video content fingerprinting the audio and or video data and searching fingerprint databases to identify the audio or the video content. Captured fragments of audio video or audio and video signals are hereinafter referred to as media content. illustrates a system for providing audio and video synchronous two screen applications on a media device. The system includes a media presentation device such as a television set a desktop laptop or tablet computer a digital video disc DVD player or a smartphone device configured to display media programming such as television programs movies Internet videos or the like or play audio media such as wireless received radio signals compact discs CDs or the like. The media presentation device such as a television set may be connected to a remote media broadcast system for receiving television programming content. Also the media presentation device may or may not be connected to the Internet . The system also includes a remote content identification system and a mobile media device connected over the Internet to the remote content identification system . The mobile media device includes a smartphone device a laptop a tablet computer or the like. Set top boxes and gaming machines may also act as a media device that is placed intermediate between an external search server and the mobile media device having a remote database that is a subset of an external search server database but of greater capacity than a local reference database on the mobile media device . Connections and may be wired or cabled connections wireless connections or a combination of wire cable and wireless connections. For example the mobile media device may connect wirelessly to the Internet through a wireless router or over 3G or 4G networks while the remote content identification system may be wire or cable attached through a modem to the Internet . The mobile media device may be configured to acquire audio signals from the media presentation device by use of a microphone. The mobile media device may also be configured to acquire images or a video from the media presentation device by use of an image sensor or camera such as a charge coupled device CCD image sensor and a camera lens assembly included in the mobile media device .

Illustrated system supports applications on the mobile media device that operate in real time and in accordance with television or other media programming content that is being presented on a media presentation device and received by the mobile media device . The mobile media device is configured to acquire a temporal fragment of media content including audio content video content or both that are playing on the media presentation device using the mobile device s microphone camera or both and generates query fingerprints from the temporal fragment of the acquired media content.

A chunk of the query fingerprints is a set of the query fingerprints corresponding to a time segment of the query media signal. Also a digest of the chunk of the query fingerprints may be formulated as a search query to a local search database on the mobile media device or transmitted to the remote content identification system also referred to as an external search database or a remote search server for content identification. A digest of the query fingerprints is a summarization of the fingerprints generated for the acquired media content. If the search query is found in a reference database either local or remote the search process responds with responsive data such as a title and timing information of the identified media content along with related metadata and sends the title the timing information and the related metadata to the application that initiated the query on the mobile media device . The original chunk of query reference fingerprints or the digest of the query fingerprints found on the remote search server is stored on the mobile media device for further use in local querying a mobile media device database located on the mobile media device and tracking of media content. The method presented automatically switches between remote search on an external search server and local search on a local reference database on the mobile media device. The local reference database is also described as a signature cache.

The mobile media device may be configured to continuously listen observe or listen and observe the media programming content. The programming content may also be tracked by querying locally stored mobile media device reference content. If a change in the media programming content is detected the mobile media device generates one or more new queries that are searched for content identification. This process continues as long as the mobile media device is listening to and or observing video or both with respect to the media programming content.

The mobile media device may be equipped with an actionable program event detection system which generates an action signal upon detection of a particular audio video or audio and video fragment stored in the reference fingerprint database. A software application running on the mobile media device can then perform actions based on local search results presenting to the user a variety of additional information on the same mobile media device in real time while the remote media programming is still playing the associated media content.

The method presented automatically switches between a remote search on the external search database and a local search on a micro search server on the mobile media device .

The captured 5 10 seconds of audio and video contents are passed to the associated step in the mobile application for processing the audio and video signals as an audio waveform and video frames respectively and to form multi signature queries for television content identification. At step the audio waveform is framed. At step the framed audio waveform is fingerprinted with an audio fingerprinting system such as described in U.S. patent application Ser. No. 13 509 701. At step one or more active regions are determined in the video frames and a set of frames are selected for further processing. At step active television regions in the selected video frames are fingerprinted with a video fingerprinting system such as described in U.S. Pat. No. 8 189 945. This fingerprinting may occur entirely locally on the mobile device entirely remotely on a remote server or partially locally and remotely. If performed entirely remotely the audio waveform and the video frames are transmitted to the remote server. Alternatively some partial fingerprint processing may be done locally and then the remainder of the fingerprint processing may be done remotely. In this alternative embodiment video frame selection from a sequence of video frames is performed locally on the mobile device and then only the selected video frames are transmitted to the remote server for fingerprint processing. For audio the audio waveform may be resampled to a lower sampling rate and down mixed to one channel before generating the fingerprints. Compression of the video frame and the audio samples may be used to reduce transmission costs.

At step the audio fingerprints and video fingerprints are combined and a selected set of fingerprints are used as query fingerprints. Having both audio fingerprints and video fingerprints representing the television programming content increases the reliability of television content identification under severe audio and video signal degradations due to the surrounding ambient conditions. The resulting audio and video query fingerprints are transmitted to a search server. A search function may be either local residing on the mobile media device or remote accessed for example through the Internet cloud. At step the search server responds with a message that details where the audio and video content were found in the search database and if found the title of the content the matching times and related metadata like an image representing the program details about actors or the like. If a match is not found at step the process returns to step to select another fragment of media content for processing. If a match is found at step the process proceeds to step .

At step the mobile application receives the snatch data and may be configured to trigger actions that are based on this data such as described in U.S. patent application Ser. No. 13 094 158. Such actions may include displaying the identity of the content to the user retrieving related information based on the identity of the content allowing the user to register or check in to that piece of content with a registration server online display an interactive ad based on the content and perhaps knowledge about the user or may enable a variety of other real time applications based on detected audio and video content.

At step the media is captured and a media query is generated for the captured media which includes audio fingerprints video fingerprints or audio and video fingerprints. At step the media query is routed initially to the local micro search server and if the media query is not located in the local database the media query is transmitted to a remote search server if authorized to do so. At step a determination is made whether the local match was successful. If the local match was successful the process proceeds to step . At step a tracking application is initialized and executed to track the matched media content.

Returning to step if the local match was not successful the process proceeds to step . At step the media query is transmitted to the remote search server. At step a determination is made whether the remote search server found a match. If a match was found the process proceeds to step . At step a chunk of reference signatures for the matched media content is downloaded to the mobile media device. The process then returns to step to process another media query.

Returning to step if a match was not found the process proceeds to step . At step the media content associated with the media query is marked as not found in current remote search database. At step a decision to continue search and tracking is requested. If the decision is to continue search and tracking the process proceeds to step . If the decision is to not continue search and tracking the process proceeds to step . At step the search media application calls for de initialization when it no longer needs to use the library.

The record and identify application at step performs the identification of the content by activating step . There are three main sub functions inside this function including media capture such as audio fragments for example 5 10 seconds of the television programming audio media fingerprinting such as audio fingerprinting forming multi signature 5 10 second queries and query reference database search. In a similar manner the record and identify application may capture video segments and generate video fingerprints and control video search operations. For example captured audio samples are fed to a fingerprinting system which computes a set of signatures. These signatures are used in the query to the search system. The query function implements automatic routing of the signatures to either the local or the remote search system.

Returning to step if the full local database match is not found the process proceeds to step . At step the miss counter having a count T is incremented. At step if the count value T of the miss counter is greater than the threshold the process proceeds to do a search on a remote search server at step . If at step the count value T of the miss counter is less than the threshold the process goes back to step .

A signature cache is a part of the mobile media device local operating memory dynamically allocated by the application at run time. The signature cache can hold at least one chunk of reference signature data corresponding to a length of time of reference media content for example a number of reference signatures corresponding to 3 minutes of reference media content. The query schemes for immediate search the 1 minute search and the full local search represent the ways and what segments of the signature cache are searched. As an example three minutes worth of reference signature data can be downloaded from the remote server by the client mobile media device allowing for local reference database search as outlined in the previous sections. When a new set of signatures is downloaded the contents of the signature cache are overwritten. The size of the local memory signature cache is programmable. A full local search refers to searching through the entire local memory cache reference content to try to find a match. The full local search is generally the last attempt to find a match to the query in local memory. After the full local search if the query not found a search of the remote reference database is initiated and if a match is found at the remote database a new chunk of reference material for the match is downloaded overwriting the old chunk in the local memory.

Querying with audio content that is not in either the local or remote reference database will result in NOT FOUND at both the local and remote stages. Once the miss threshold has been reached and before a match is found queries will be sent to the remote server. This increases the load on the remote server without getting any of the caching benefits of the local search.

The record and identify application of step in performs capture media and query to the local and remote server. To allow for independent start of media content capture and independent start of fingerprinting and querying the following functions are introduced 

For automatic switching between the local and remote search server the signature cache holds one set of signatures that is automatically managed. That is downloading and cache management are performed automatically based on results of each search. address the flow of local and remote search processes using an automatic reference signature download based on the outcome of a query search.

The signature cache can be also managed manually. A number of signature slots may be specified when instantiating the system. Each signature slot may hold multiple signatures. Manually managing the signature cache is an advanced feature used in some application cases when a particular expected captured media content is desired to trigger events within the mobile media device. Additional functions are provided that allow for user initiated or manual downloading of signatures from the remote server to particular cache slots flushing the contents of the slot and returning a list of the manually downloaded reference signatures. Examples of these additional functions are given below 

As described in the previous paragraphs for the signature cache that is automatically managed if a match is found from the remote server signatures are downloaded for a next specified chunk of time. As long as the same content is being queried and the local cache contains the downloaded reference signatures the local search will match with the signatures in this automatically managed cache keeping track of the time line of matched reference signatures. However after reaching the end of the time line in this signature cache or the last matching signature in the current local cache the local search will return NOT FOUND and the query will eventually hit the remote server and again the signatures will be downloaded for the next specified chunk of time.

However before the end of the signature cache is reached for instance K seconds before the end the next chunk of signatures may be pre fetched or downloaded in advance prior to reaching the end of the signature cache. Each signature is associated with a time stamp and the succession of signatures in a time line is known. Thus before the last signature in the signature cache is reached which would be the end of a time line for the locally stored chunk of signatures a new chunk of signatures associated with the asset id and remaining time for the asset id is requested in advance of reaching the last signature. Thus local search querying can continue uninterrupted.

The size of the chunk of signatures to download may advantageously be programmable and specified by the function setSigDownloadChunkSize. This function specifies in seconds for example the size of the chunk of signature data to be downloaded at one time.

During reference signature download from the remote server the local search database is locked only when copying downloaded signature contents into the database.

It is understood that other embodiments of the present invention will become readily apparent to those skilled in the art from the above detailed description wherein various embodiments of the invention are shown and described by way of the illustrations. As will be realized the invention is capable of other and different embodiments and its several details are capable of modification in various other respects all without departing from the present invention. Accordingly the drawings and detailed description are to be regarded as illustrative in nature and not as restrictive.

