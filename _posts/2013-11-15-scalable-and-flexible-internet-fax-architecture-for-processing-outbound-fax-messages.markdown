---

title: Scalable and flexible internet fax architecture for processing outbound fax messages
abstract: Methods and systems for processing outbound fax messages in an efficient and scalable manner are provided. According to one embodiment, a request to deliver a fax message is received by an Internet fax system. Source files associated with the request and representing at least a portion of content to be included as part of the fax message are stored to a shared storage area accessible by multiple imaging systems and multiple fax processing resources. A load score is calculated for each imaging system based on one or more of a processor load and a memory load. An imaging system is selected, based on the load scores, to convert the source files into a digital representation suitable for faxing. The source files are converted by associating the digital representation with an outbound fax job. The fax message is delivered by submitting the outbound fax job to one of the fax modems.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09225851&OS=09225851&RS=09225851
owner: Advanced Messaging Technologies Inc.
number: 09225851
owner_city: Los Angeles
owner_country: US
publication_date: 20131115
---
This application is a continuation of U.S. patent application Ser. No. 13 565 424 filed on Aug. 2 2012 now U.S. Pat. No. 8 588 381 which is a continuation of U.S. patent application Ser. No. 13 405 614 filed on Feb. 27 2012 now U.S. Pat. No. 8 254 538 both of which are hereby incorporated by reference in their entirety for all purposes.

Contained herein is material that is subject to copyright protection. The copyright owner has no objection to the facsimile reproduction of the patent disclosure by any person as it appears in the Patent and Trademark Office patent files or records but otherwise reserves all rights to the copyright whatsoever. Copyright 2012 2013 EC Data Systems Inc.

Embodiments of the present invention generally relate to receiving documents via email website and or custom application programming interface API integration creating corresponding outbound fax jobs and transmitting the outbound fax jobs to the specified destinations. In particular embodiments of the present invention relate to an improved Internet fax architecture designed for scalability flexibility and efficient outbound facsimile processing that among other things implements a centralized message work queue within a database an imaging system load notification system a fair queuing system to ensure subscribers have equal access to imaging systems an outbound resource selection algorithm based on the customer s subscribed capacity and a mass fax interface capability.

Existing Internet fax systems have numerous limitations in terms of the scalability and flexibility of their architectures and user facing flexibility. Existing Internet fax systems have no mechanism to identify image processing resources that are most capable of processing new work and instead rely on a simplistic first in first out FIFO methodology to assign outgoing fax requests. While such a FIFO approach is easy to implement it sacrifices efficiency in connection with image processing resource utilization and can create bottlenecks in outbound fax processing.

Furthermore the user facing inflexibility exhibited by existing Internet fax systems results in part from an underlying assumption that a single outbound fax job is associated with a single destination. As such when a single fax containing the same content is desired to be sent to multiple destinations customers must submit the fax to the Internet fax system for each destination.

In view of the foregoing and numerous other limitations associated with existing Internet fax systems a more efficient and flexible architecture that better suits the needs of corporate users is needed.

Methods and systems are described for processing outbound fax messages in an efficient and scalable manner. According to one embodiment a request to deliver a fax message to one or more third parties is received at an initial submission gateway device of an Internet fax system. One or more source files associated with the request and representing at least a portion of content to be included as part of the fax message is stored to a shared storage area of the Internet fax system accessible by multiple imaging systems and multiple fax processing resources of the Internet fax system. A load score is calculated for each imaging system based on one or more of a processor load associated with the imaging system and a memory load associated with the imaging system. One of the imaging systems is selected based on the load scores to convert the one or more source files into a digital representation suitable for faxing. The one or more source files are converted into the digital representation by the selected imaging system by associating the digital representation with an outbound fax job. The fax message is delivered to the one or more third parties by submitting the outbound fax job to one of the fax modems.

Other features of embodiments of the present invention will be apparent from the accompanying drawings and from the detailed description that follows.

Methods and systems are described for processing outbound fax messages in an efficient and scalable manner. According to embodiments of the present invention an improved Internet fax architecture is provided that is designed for scalability flexibility and efficient outbound facsimile processing that among other things implements a centralized message queue within a database an imaging system load notification system a fair queuing system to ensure subscribers have equal access to imaging systems an outbound resource selection algorithm based on the customer s subscribed capacity and a mass fax interface capability.

In the following description numerous specific details are set forth in order to provide a thorough understanding of embodiments of the present invention. It will be apparent however to one skilled in the art that embodiments of the present invention may be practiced without some of these specific details. In other instances well known structures and devices are shown in block diagram form.

Embodiments of the present invention include various steps which will be described below. The steps may be performed by hardware components or may be embodied in machine executable instructions which may be used to cause a general purpose or special purpose processor programmed with the instructions to perform the steps. Alternatively the steps may be performed by a combination of hardware software firmware and or by human operators.

Embodiments of the present invention may be provided as a computer program product which may include a machine readable storage medium tangibly embodying thereon instructions which may be used to program a computer or other electronic devices to perform a process. The machine readable medium may include but is not limited to fixed hard drives magnetic tape floppy diskettes optical disks compact disc read only memories CD ROMs and magneto optical disks semiconductor memories such as ROMs PROMs random access memories RAMs programmable read only memories PROMs erasable PROMs EPROMs electrically erasable PROMs EEPROMs flash memory magnetic or optical cards or other type of media machine readable medium suitable for storing electronic instructions e.g. computer programming code such as software or firmware . Moreover embodiments of the present invention may also be downloaded as one or more computer program products wherein the program may be transferred from a remote computer to a requesting computer by way of data signals embodied in a carrier wave or other propagation medium via a communication link e.g. a modem or network connection .

In various embodiments the article s of manufacture e.g. the computer program products containing the computer programming code may be used by executing the code directly from the machine readable storage medium or by copying the code from the machine readable storage medium into another machine readable storage medium e.g. a hard disk RAM etc. or by transmitting the code on a network for remote execution. Various methods described herein may be practiced by combining one or more machine readable storage media containing the code according to the present invention with appropriate standard computer hardware to execute the code contained therein. An apparatus for practicing various embodiments of the present invention may involve one or more computers or one or more processors within a single computer and storage systems containing or having network access to computer program s coded in accordance with various methods described herein and the method steps of the invention could be accomplished by modules routines subroutines or subparts of a computer program product.

For simplicity and sake of brevity various embodiments described herein focus on outbound fax processing and delivery of received documents in the form of fax messages to one or more destinations specified by subscribers however it is to be noted that the Internet fax system may also be capable of facilitating receipt of inbound fax messages on behalf of subscribers as well.

Notably while embodiments of the present invention may be described using modular programming terminology the code implementing various embodiments of the present invention is not so limited. For example the code may reflect other programming paradigms and or styles including but not limited to object oriented programming OOP agent oriented programming aspect oriented programming attribute oriented programming OP automatic programming dataflow programming declarative programming functional programming event driven programming feature oriented programming imperative programming semantic oriented programming functional programming genetic programming logic programming pattern matching programming and the like.

The terms connected or coupled and related terms are used in an operational sense and are not necessarily limited to a direct connection or coupling.

The phrases facsimile call or fax call generally refer to a call carried over a circuit switched network e.g. the public switched telephone network PSTN or a VoIP call carried over a packet switched network e.g. the Internet from a device intending to transmit a facsimile to a particular destination phone number.

The phrases facsimile processing resource and fax processing resource generally refer to a device capable of making a facsimile call establishing a facsimile protocol communication with the destination and transmitting facsimile data to the destination phone number. A non limiting example of a facsimile processing resource is a fax server or a subset of resources associated with a fax server.

The phrases facsimile signal or fax signal generally refer to a digital representation of audio information encoding a facsimile message. According to embodiments of the present invention outbound fax signals may be transmitted over a circuit switched network e.g. the public telephone network or a packet switched network e.g. the Internet via Voice over Internet Protocol VoIP .

The phrases in one embodiment according to one embodiment and the like generally mean the particular feature structure or characteristic following the phrase is included in at least one embodiment of the present invention and may be included in more than one embodiment of the present invention. Importantly such phases do not necessarily refer to the same embodiment.

If the specification states a component or feature may can could or might be included or have a characteristic that particular component or feature is not required to be included or have the characteristic.

Each subscriber account may have one or more users and one or more associated fax numbers. According to one embodiment flexible configuration settings allow do not fax settings image resolution settings notification settings caller ID settings tagline settings time zone settings and retry settings at a subscriber user or job level as appropriate. For purposes of efficiency defaults may be established at an account level and overridden if desired at the user level. For example all outbound faxes from a particular subscriber may be configured to include a particular tagline use a certain time zone when printing the date time in the tagline and perform a particular number of retries. Meanwhile users at different geographical locations may override the time zone setting and or number of retries. Similarly by default all faxes transmitted by a subscribing enterprise may be configured to image the tagged image file format TIFF outbound fax job at a certain resolution on a per account basis e.g. fine hyperfine low normal however a particular user may override the default based on his her personal tradeoff preferences between cost time to transmit and quality of the image as transmitted.

Internet fax system receives and processes requests to deliver outbound fax message from an Internet fax system application programming interface API and or users associated with subscribers e.g. Internet fax system user via an email or web interface and delivers fax messages to one or more destination phone numbers associated with desired recipients e.g. fax recipient . Anyone with a fax machine subscriber or non subscriber can receive faxes originated by Internet fax system user . As described further below embodiments of the present invention also allow for fax delivery requests and data store queries to be made via an API over Hypertext Transport Protocol HTTP or HTTP secure HTTPS that allows programmers to build fax transmission capabilities into their applications.

According to the present example Internet fax system interfaces with Internet fax system APIs such as Internet fax system API Internet fax system users associated with a subscriber account such as Internet fax system user and fax recipients such as fax recipient .

Internet fax system user may communicate requests to deliver outbound fax messages directed to one or more fax numbers via any Internet connected device such as computer a smartphone not shown or the like. As described further below Internet fax system user may provide content to be faxed in a variety of forms including email attachments in the form of standard business documents e.g. Microsoft Word PDF etc. links to web content and inline email content e.g. text HTML and or embedded images .

Fax recipient may receive faxes from subscribers of Internet fax system via a dedicated fax machine computer multifunction all in one printer not shown or other fax capable device not shown just as he she would receive faxes from non subscribers. Fax recipient may but need not be a subscriber of Internet fax system to receive faxes from a subscriber such as Internet fax system user . If fax recipient is a subscriber then he she may receive faxes as email attachments as secure download links embedded within email messages or download them from a web site associated with Internet fax system as described in copending U.S. patent application Ser. No. 13 346 456 which is hereby incorporated by reference in its entirety for all purposes.

Internet fax system API may represent a standardized API associated with Internet fax system or a custom API developed to API specifications established by the owner operator of Internet fax system . Internet fax system API may provide capabilities that an application programmer can use to integrate fax capabilities into their applications utilizing Internet fax system as a backend for example. In one embodiment the integration is accomplished via HTTP or HTTPS POST operations.

Depending upon the particular implementation Internet fax system API may provide operations to support fax sending and receiving call detail record collection and automated number provisioning and de provisioning. Additional details regarding an exemplary set of operations and related variables for an Internet fax system API are described in the Appendix.

In the exemplary simplified architecture depicted Internet fax system includes an email gateway a Web gateway an API gateway multiple imaging systems a file store a data store one or more private branch exchanges PBXs multiple fax processing resources and one or more telecommunications systems interconnected via an appropriate telecommunications signaling network and an Internet Protocol IP network.

According to one embodiment email gateway is operable to receive requests to deliver outbound fax messages from subscribers. Responsive to receipt of an email message email gateway may parse the email to determine the sender the destination s and other optional parameters. In one embodiment the email request may include one or more attachments representing the content of the desired outbound fax message. In such an embodiment email gateway may strip the attachment s from the email message and store the attachment s in file store . As described further below email gateway may also determine the sender based upon the email message and extract information regarding the destination s and other parameters and store this information in data store . According to one embodiment if a system generated cover sheet is set up email gateway may also generate and store a cover sheet as another file for the fax job in the file store and data store . Once the fax content is ready to be processed email gateway may store a work request in a centralized message work queue not shown implemented within a database such as data store . In some embodiments rather than implementing a simplistic FIFO mechanism as described by U.S. Pat. No. 6 597 688 and its progeny a novel imaging system selection process is employed by email gateway to identify a least loaded imaging system of imaging systems to process the fax content e.g. convert to TIFF format transform landscape to portrait print HTML source to a PDF etc. . According to one embodiment after an appropriate imaging system has been selected to process the fax content email gateway assigns a corresponding work request to the selected imaging system by placing a work request in the centralized message work queue within data store for example where the work request contains information identifying the selected imaging system that should process the fax content.

Web gateway is operable to receive and process user requests relating to outbound faxes. For example responsive to a user logging into a web site not shown associated with Internet fax system and navigating to the transmit faxes page the web site may present the user with an interface to specify one or more destinations upload document s to send create a cover sheet and specify other optional parameters. After the information regarding the outbound fax delivery request has been gathered from the user web gateway stores the document s to be faxed in file store stores sender destination s and any other parameters in data store and stores a work request in the centralized message work queue. In some embodiments web gateway may also perform the imaging system selection process to identify a least loaded imaging system of imaging systems to process the fax content. According to one embodiment after an appropriate imaging system has been selected to process the fax content web gateway assigns the work request to the selected imaging system as described above by placing the work request in the centralized message work queue and including therein information identifying the selected imaging system e.g. the hostname of the selected imaging system that should process the fax content.

API gateway supports API based receipt of requests to deliver outbound fax messages wherein the interaction can be with a program on a user system. In this manner API gateway provides an alternative to manual uploading of fax messages in contrast to existing Internet fax systems such as that described in U.S. Pat. No. 6 597 688 and its progeny. As described in further detail below API gateway processes API information to determine the sender destination s and other optional parameters associated with requests to deliver outbound fax messages. As indicated above with respect to email gateway and web gateway after the information regarding the outbound fax delivery request has been gathered API gateway stores the document s to be faxed in file store stores sender destination s and any other parameters in data store and stores a work request in the centralized message work queue. In some embodiments API gateway may also perform the imaging system selection process to identify a least loaded imaging system of imaging systems to process the fax content. According to one embodiment after an appropriate imaging system has been selected to process the fax content API gateway assigns the work request to the selected imaging system as described above by placing the work request in the centralized message work queue and including therein information identifying the selected imaging system e.g. the hostname of the selected imaging system that should process the fax content. Further details regarding an exemplary set of operations that may be automated via API gateway are provided in the attached Appendix.

According to one embodiment imaging systems implement a load notification system in which each imaging system periodically sends load information to an image queue database within data store for example. As described in further detail below the initial submission device e.g. email gateway web gateway or API gateway runs an imaging system selection process to select an appropriate imaging system of imaging systems based on the load information reported by the imaging systems .

File store represents a shared storage resource accessible by the initial submission device e.g. email gateway web gateway or API gateway imaging systems and fax processing resources for storing and accessing fax content in its source format and the corresponding digital representations of fax messages based thereon. According to one embodiment file store is simply a disk with no processing other than storage access logic. According to one embodiment file store is a database implemented within a network attached storage NAS device such as a NetApp NAS filer available from NetApp Inc.

In one embodiment data store includes a centralized message work queue database for storing work requests for imaging systems and a separate application level database that is operable to store information specific to fax jobs e.g. destination number s location s of file s that comprise the fax job source user user account configuration etc. . Data store may also represent storage for accounting billing features and other metadata associated with outbound fax messages. According to one embodiment data store is a Solaris x86 based workstation running an open source database such as MySQL.

Embodiments of the present invention seek to provide redundancy and scalability based on an active 0 active n setup of multiple fax processing resources PBXs etc. that are all essentially identical such that a given fax processing resource does not have to be associated with a backup fax processing resource that is used if it goes down as suggested by prior Internet fax system architectures such as the architecture described in U.S. Pat. No. 6 208 638. Instead in accordance with embodiments of the present invention an n way pool of possible fax servers and modems for example are available for use.

Fax processing resources are operable to accept outbound fax jobs from imaging systems . According to one embodiment fax processing resources send the fax jobs to the destination s with automatic retries and other customer specified parameters. Fax processing resources may include one or more digital access cross connects DACS not shown and one or more fax servers not shown each of which may include one or more analog fax modems digital fax boards and or soft modems modems implemented in software . According to one embodiment fax servers each have 24 ports and those ports are connected to the 24 ports of a single DACS. Those of ordinary skill in the art will appreciate there are a variety of possible combinations of DACS to fax server connections configurations. For example in alternative configurations each DACS may support multiple fax servers theoretically as many fax servers as it has ports by connecting each port of the DACS to a single port of a fax server. According to one embodiment fax servers include Linux servers running open source fax server software such as HylaFAX. According to one embodiment DACS provide DS1 DS0 0 1 cross connect functionality and may be one of Adtran s ATLAS series of enterprise integrated access devices such as the ATLAS 550 series ATLAS 800 series Tellabs Titan series DACS or the like.

According to one embodiment one or more PBXs are logically interposed between fax processing resources and telecom system s . The PBX s are operable to accept outgoing calls initiated by fax processing resources determine an appropriate route for such calls dial the appropriate route and bridge the call to the fax processing resource. At call completion the PBX s record telephony Integrated Services Digital Network ISDN information and call accounting information in data store for billing. PBXs may be implemented by installing and running an open source PBX software package on a server. For example a non limiting example of a suitable PBX is a Linux server running Asterisk. Alternatively PBXs available from Cisco or Avaya may be used.

According to one embodiment telecommunications system s are operable to accept outgoing fax calls and select an appropriate trunk group amongst multiple connected circuit and packet connections based on information received from PBX s . Telecommunications system s dial the outgoing fax call on the appropriate trunk group and upon call completion record telephony ISDN switch accounting and technical information in data store via RADIUS for troubleshooting and debugging purposes. In one embodiment telecommunications system s include one or more switches not shown which may be connected to the Internet via Ethernet and connected to the PSTN via dedicated high bandwidth circuits e.g. DS3 and or DS1 lines . In one embodiment switches are high capacity access servers providing both packet and time division multiplexing TDM switching. Examples of suitable switches include but are not limited to the Cisco AS5850 Universal Gateway the Cisco AS5800 Access Server the Cisco AS5400 Universal Gateway the Cisco AS5350 Universal Gateway and the Cisco AS5300 Universal Access Server. Depending upon the particular implementation telecommunications system s may comprise a single switch or multiple redundant switches in which one of the switches is an active primary switch and the others are active standby switches which can take over for the primary in the event of a failure. In alternative embodiments it is also possible to have an active active redundant switch architecture in which multiple circuits from PSTN and or Internet provide the same services and the circuits are split between multiple switches that are interconnected in a mesh for redundancy and or increased capacity.

According to the present example the computer system includes a bus one or more processors one or more communication ports a main memory a removable storage media a read only memory and a mass storage .

Processor s can be any future or existing processor including but not limited to an Intel Itanium or Itanium 2 processor s or AMD Opteron or Athlon MP processor s or Motorola lines of processors. Communication port s can be any of an RS 232 port for use with a modem based dialup connection a 10 100 Ethernet port a Gigabit port using copper or fiber or other existing or future ports. Communication port s may be chosen depending on a network such as a Local Area Network LAN Wide Area Network WAN or any other network to which the computer system connects. For example in the context of a PBX communication port s may include communication cards supporting Ethernet or DS1 DS3 types of connections and in the context of a fax server communication port s may include Ethernet DS0 T1 DS1 such as ISDN Primary Rate Interface PRI or fractional T1 DS1 or digital DS0 such as ISDN Basic Rate Interface BRI .

Main memory can be Random Access Memory RAM or any other dynamic storage device s commonly known in the art. Read only memory can be any static storage device s such as Programmable Read Only Memory PROM chips for storing static information such as start up or BIOS instructions for processor .

Mass storage may be any current or future mass storage solution which can be used to store information and or instructions. Exemplary mass storage solutions include but are not limited to Parallel Advanced Technology Attachment PATA or Serial Advanced Technology Attachment SATA hard disk drives or solid state drives internal or external e.g. having Universal Serial Bus USB and or Firewire interfaces such as those available from Seagate e.g. the Seagate Barracuda family or Hitachi e.g. the Hitachi Deskstar 7K1000 one or more optical discs Redundant Array of Independent Disks RAID storage such as an array of disks e.g. SATA arrays available from various vendors including Dot Hill Systems Corp. LaCie Nexsan Technologies Inc. and Enhance Technology Inc.

Bus communicatively couples processor s with the other memory storage and communication blocks. Bus can include a bus such as a Peripheral Component Interconnect PCI PCI Extended PCI X Small Computer System Interface SCSI USB or the like for connecting expansion cards drives and other subsystems as well as other buses such as front side bus FSB which connects the processor s to system memory.

Optionally operator and administrative interfaces such as a display keyboard and a cursor control device may also be coupled to bus to support direct operator interaction with computer system . Other operator and administrative interfaces can be provided through network connections connected through communication ports .

Removable storage media can be any kind of external hard drives floppy drives IOMEGA Zip Drives Compact Disc Read Only Memory CD ROM Compact Disc Re Writable CD RW Digital Video Disk Read Only Memory DVD ROM .

In some embodiments a computer system such as computer system is configured to operate as one or more of PBXs. For example as described above any or all of PBX s may be implemented as a Linux server running an open source PBX software package such as Asterisk. In some embodiments a computer system such as computer system is configured to operate as one or more fax servers. For example as described above any or all of fax processing resource s may be implemented as a Linux server running open source fax server software such as HylaFAX. In some embodiments a computer system such as computer system runs multiple virtual machines each of which represents an imaging system of imaging systems . In some embodiments a computer system such as computer system is configured to support one or more databases such as a billing database and or data store including a centralized message work queue accessible by the gateway systems e.g. email gateway web gateway and API gateway and imaging systems . For example as described above any or all of the databases described herein may be implemented within a Solaris x86 based workstation running an open source database such as MySQL. As those of ordinary skill in the art will appreciate the computer system components described above are meant only to exemplify various possibilities. In no way should the aforementioned exemplary computer system limit the scope of the invention.

If the request is received via web then outbound fax processing continues with block in which web gateway processing is performed. According to one embodiment web gateway processing is as described with reference to .

Otherwise if the request is received via API then outbound fax processing continues with block in which API gateway processing is performed. According to one embodiment API gateway processing is as described with reference to .

As the initial submission devices e.g. email gateway web gateway or API gateway process requests to deliver outbound fax messages and create corresponding work requests for selected imaging systems of imaging systems imaging system work selection is performed by each imaging system at block to identify appropriate work requests. According to one embodiment imaging system work selection is as described with reference to .

After an imaging system identifies appropriate work request s at block imaging system work processing is performed. According to one embodiment imaging system work processing is as described with reference to .

After the imaging system has completed its processing and has submitted the corresponding fax job to a fax server at block fax server send fax processing is performed. According to one embodiment fax server send fax processing is as described with reference to .

Responsive to fax server send fax processing PBX call processing is initiated at block . According to one embodiment PBX call processing is as described with reference to .

Responsive to PBX call processing switch route call processing is initiated at block . According to one embodiment switch route call processing is as described with reference to . After switch route call processing is terminated outbound fax processing is complete.

At block the fax destination is identified. In one embodiment Internet fax system users may direct faxes to a desired fax destination by directing the email to a domain owned by the Internet fax system and specifying the desired fax destination in the local part of the email address e.g. 3035551212 faxage.com . In such an embodiment the fax destination may be identified by extracting the local part of the email address in the To header of the email request. In alternative embodiments various other conventions may be used to convey the desired fax destination. For example the fax destination may be identified as such via a labeling or tagging convention in the body of the email request or in the subject line. Those skilled in the art will recognize numerous other alternatives. If a valid destination is not found associated with the email request then a return email may be generated and transmitted to the Internet fax system user identifying the error e.g. no valid fax destination and email gateway processing may terminate. If a valid fax destination is identified then email gateway processing continues with block .

At block parameters fax settings and attachments are gathered. In one embodiment optional parameters such as priority low or high destination name and whether to include text and HTML attachment types on a one off basis may be identified in the email request. As indicated above various conventions may be used to convey values of parameters including but not limited to providing a list of name value pairs in the body of the email request or in the subject line. Other default or custom fax settings may be stored in a subscriber database. For example email fax settings for the subscriber account may specify whether a system generated cover sheet is to be used types of email attachments that are enabled and whether to store the subject line for later return. Having identified the types of permissible email attachments the email gateway can proceed to gather attachments if any according to valid types. In one embodiment the email body itself can serve as a valid email attachment. If no valid email attachments are found then a return email may be generated and transmitted to the Internet fax system user identifying the error e.g. no attachments to fax email and email gateway processing may terminate. If one or more valid email attachments are found then email gateway processing continues with block .

At block copies of files to be faxed are stored in file store for example. In addition to any valid email attachments associated with the email request the files stored may include a cover sheet as the first file to be faxed if a cover sheet is to be generated.

At block fax details are stored to data store for example. Fax details may include one or more of the following 

In one embodiment responsive to the fax details storage request data store returns to email gateway a unique ID e.g. a job ID of 1 to n digits to be associated with this particular outbound fax job. According to one embodiment the job ID is based on an auto incremented unique primary key.

At block an imaging system selection process is performed. According to one embodiment imaging system selection processing is as described with reference to .

At block the files to be faxed are stored in file store for example. In addition to the file s representing the content of the desired fax the files stored may include an optional cover sheet as the first file to be faxed if a cover sheet is to be generated.

At block fax details are stored to data store for example. Fax details may include one or more of the following 

In one embodiment responsive to the fax details storage request data store returns to web gateway a unique ID e.g. a job ID of 1 to n digits to be associated with this particular outbound fax job. As described above with respect to email gateway processing the job ID may be based on an auto incremented unique primary key.

At block an imaging system selection process is performed. According to one embodiment imaging system selection processing is as described with reference to .

At block the fax destination is identified. In one embodiment Internet fax system users may direct faxes to one or more desired fax destination via API gateway by specifying the destination s in the POST request. If a valid destination is not found within the POST request then an error message identifying the error e.g. no valid fax destination may be returned and web services processing may terminate. If one or more valid fax destinations are identified within the POST request then web services processing continues with block .

At block parameters fax settings and attachments are gathered. In one embodiment parameters such as the file s or URL s to fax the recipient name and optional parameters such as priority low or high caller ID resolution contrast algorithm notification preference e.g. via URL or email and tagline name and number may be identified in the POST request. If one or more URLs are specified as the content of the fax then the content of the URLs are downloaded and stored as a file to fax. Any non URL files included within the POST request are base64 decoded. If no valid files are associated with the POST request then an error message identifying the error e.g. no files to fax may be returned and web services processing may terminate. If one or more valid files are associated with the POST request then web services processing continues with block .

At block fax details are stored to data store for example. Fax details may include one or more of the following 

In one embodiment responsive to the fax details storage request data store returns to API gateway a unique ID e.g. a job ID of 1 to n digits to be associated with this particular outbound fax job. As described above with respect to web and email gateway processing the job ID may be based on an auto incremented unique primary key. In one embodiment the job ID is returned to the source of the POST request.

At block an imaging system selection process is performed. According to one embodiment imaging system selection processing is as described with reference to .

At block the least loaded imaging system is selected. Depending upon the particular load score computation the least loaded imaging system may be associated with the lowest load score or the highest load score. In the exemplary load score calculation processing described below with reference to the least loaded imaging system is the one having the lowest load score.

At block an attempt is made to connect to the selected imaging system. According to one embodiment the initial submission device e.g. email gateway web gateway or API gateway to which the outbound fax request was made and which is currently performing the imaging system selection processing attempts to make an HTTP connection to the selected imaging system. Those skilled in the art will appreciate various acknowledgement mechanisms can be employed for the selected imaging system to confirm to the initial submission device that it is able to accept and process a work request. In one embodiment the imaging systems are configured to echo back the job ID passed on the connection if they are up and working.

At decision block a determination is made regarding whether the connection attempt was successful. According to one embodiment this determination is made based on whether the selected imaging system echoes back the job ID to the initial submission device via the HTTP connection. If the connection attempt was unsuccessful then process branches to block otherwise imaging system selection processing continues with block .

At block the selected imaging system is removed from the list of candidates and a new imaging system is selected by looping back to block .

At block the imaging system work request is stored in the centralized message work queue within data store for example and imaging system selection processing is complete. In one embodiment the work request contains information identifying the selected imaging system that should process the work request.

In one embodiment the initial submission device may update the load information associated with the selected imaging system to reflect the newly assigned work request. In this manner to the extent subsequent imaging system selection processing occurs before the load score calculation cycle is able to update the load score for the selected imaging system the subsequent imaging system selection processing will still have the benefit of access to load information for the selected imaging system that more accurately reflects its soon to be currently effective load thereby preventing work requests from being assigned to the selected imaging system based on an out of date load score.

For simplicity and sake of brevity illustrates processing performed by a single imaging system in connection with work selection. It is to be understood that multiple imaging systems may be concurrently performing such processing.

At block the imaging system at issue polls data store for pending imaging system work requests. In one embodiment the imaging system work requests are stored in a centralized message work queue within data store . Thus in response to the polling request data store may return only those work requests from the centralized message work queue that identify the imaging system at issue as the one selected for processing the corresponding work request. Those of skill in the art will appreciate there are numerous mechanisms that can be used to trigger the polling cycle described herein. For example the polling cycle may be triggered responsive to expiration of a configurable timer e.g. every 5 seconds upon the availability of one or more job slots upon the completion of one or more job slots or the like.

At decision block the imaging system determines if it is currently running a maximum number of simultaneous jobs. In one embodiment this involves retrieving the configured simultaneous maximum jobs allowed to be performed by the imaging system e.g. the number of total job slots the imaging system has and subtracting from this the number of jobs currently being processed. If the imaging system is currently processing at its maximum number of simultaneous jobs i.e. all job slots are allocated then imaging system work selection processing loops back to block . If one or more job slots are available then imaging system work selection processing continues with decision block .

At decision block a determination is made regarding whether sufficient job slots are available to process all of the pending imaging system work requests for the imaging system. If not then the fairness aspects kick in and imaging system work selection processing branches to block otherwise processing continues with block .

At block it has been determined that sufficient job slots are available to process all pending job requests for the imaging system so all of these pending job requests are removed from the centralized message work queue and imaging system work processing is triggered.

At block it has been determined that insufficient job slots are available to process all pending job requests for the imaging system so work requests for customers without in process work requests are identified. According to one embodiment this involves building a list of customers for whom jobs are currently processing and then checking for work for customers other than those on the list on a first in first out basis.

At decision block a determination is made regarding whether work requests exist for customers for which jobs are not already in process on the imaging system. If such jobs are found then imaging system work selection processing continues with block otherwise processing branches to block .

At block work requests for customers with in process work requests are identified. According to one embodiment this identification of work requests is performed on a first in first out basis and may be limited by a number of concurrent jobs allowed pursuant to the customer s subscription plan with the Internet fax system. After appropriate work requests have been identified imaging system work selection processing continues with block .

At decision block the imaging system determines whether it is configured to accept jobs. This determination may be performed with reference to configuration information set by an administrator of the Internet fax system for example. According to one embodiment an imaging system is configured not to select jobs by creating a flag file e.g. tmp oor on the imaging system to communicate to the imaging system that it is out of rotation. If the imaging system is currently configured to accept jobs then the load score calculation processing continues with block . If the imaging system is not currently configured to accept jobs then the load score calculation processing branches to block .

At block this imaging system is removed from consideration for work assignment. In one embodiment any existing load information for this imaging system is removed from data store to preclude assignment of imaging work to this imaging system. Alternatively the load score for this imaging system may be set to a value such as the highest load score to indicate this imaging system s unavailability to process work requests. Load score calculation processing is then terminated until the next load score calculation processing cycle is triggered.

At block the load score for this imaging system is calculated. In one embodiment the load score is based on the number of jobs currently in process on the imaging system the current CPU load and the amount of memory currently in use. According to one embodiment the load score is calculated in accordance with the following equation number of jobs pending CPU load megabytes of memory used 

Those skilled in the art will appreciate various alternative calculations can be used. For example the constants A B and or C can be adjusted as appropriate to suit a particular implementation or imaging system configuration.

At block the imaging system updates data store with the newly calculated load score. Notably while the present example is described assuming each imaging system gathers load information e.g. jobs pending CPU load and memory used in alternative embodiments a process external to the imaging systems may be provided with access to load information and may perform the actual load score calculation processing and or reporting to data store on behalf of the imaging systems.

In one embodiment the destination number may be checked against disallowed numbers. For example system wide and or customer specific blacklists do not fax list may be maintained and enforced to prevent calls to certain numbers e.g. 911 411 etc. . In such an embodiment if the destination is on one of the do not fax lists then an error message will be communicated to the user according to the notification settings and imaging system work processing is terminated.

At block the source documents are converted into a digital representation suitable for faxing. In one embodiment this involves converting the source documents into a single multi page TIFF using the resolution and contrast enhancement as previously identified. If the conversion is unsuccessful then an error message will be communicated to the user according to the notification settings and imaging system work processing is terminated. If the conversion is successful then processing continues with block .

At block destination specific fax settings if any are gathered. According to one embodiment destination specific fax settings are gathered from the database e.g. data store and include one or more of the following 

At block an appropriate fax modem of available fax processing resources e.g. fax processing resources is selected. According to one embodiment the available fax processing resources are filtered to produce an initial candidate list based on the ability of the modems to meet the desired capabilities e.g. the destination specific fax settings previously identified . From the initial candidate list the list of potential fax modems to use to transmit the call is further refined based on whether the customer is at or above its subscribed capacity. If the customer is at or above capacity then the lines currently being used are selected otherwise the least used or first unused line found in the database is selected.

At block the fax job is submitted to the fax server containing the selected fax modem. According to one embodiment submitting includes sending the following information to the fax server 

If submission is successful e.g. the fax server returns a unique communication ID to the image server then imaging system work processing continues with block . If submission is unsuccessful then an error message may be communicated to the user according to the notification settings and imaging system work processing may terminate however in an embodiment in which a configurable number of retries may be attempted upon unsuccessful submission imaging system work processing may continue by excluding the previously selected fax modem from the list of potential fax modems and looping back to block until submission is successful or the number of retires is exhausted.

At block the database is updated to reflect successful submission. In one embodiment updating the database includes updating a counter in the database to reflect the customer has a job in progress on the selected fax modem and updating the outgoing fax job with one or more of the following 

At block when this fax comes up in the queue the fax modem is initialized with the requesting capabilities and the destination number is dialed.

At block a DACS connected via a POTS line to the fax modem writes information into the caller ID field to allow an upstream PBX to identify the modem port originating the fax call. According to one embodiment the DACS sets the caller ID field based on a static number assignment mechanism that forms a one to one association between an extension and a particular modem port and then forwards the call to a PBX attached via T1 PRI. In one embodiment each PBX of the Internet fax system architecture is associated with one or more DACS each having 24 fax ports and each fax server is connected to multiple ports of a DACS and the extensions have the following format 

Following the above convention or variations thereof for associating a static number with a modem port the PBX receiving the fax call may use the caller ID information passed to it to identify the specific fax modem on the specific fax server and may use that information to interrogate the fax server for desired information as described further below with reference to .

If the fax call is successful then fax server send fax processing continues with block . If the fax call is unsuccessful then a configurable number of carrier retries may be attempted by recording the number of attempts and causing the PBX to retry with an alternate carrier if the failure reason is one eligible for an alternate carrier retry e.g. disconnected no carrier or busy or retry with the same carrier if the failure reasons is not one eligible for trying an alternate by looping back to block . After the retries have been exhausted processing continues with block .

In some embodiments a notify process may be performed at this point of fax server send fax processing regardless of the success or failure of the fax call to record the location of the file attempted to be faxed a success failure indicator transmission time communications ID sending account ID and number of pages transmitted. This information may be used later in combination with additional information to provide a detailed outbound fax confirmation to the user via their configured notification method e.g. email or API notification . In one embodiment regardless of the configured notification method e.g. even if it is none the database is updated so that web based status information is available to the customer via web retrieval through web gateway for example.

At block a call accounting process is performed. According to one embodiment the call accounting process is as described with reference to .

At decision block a determination is made regarding the type of notification if any to be performed in relation to the completed fax job. According to one embodiment the notification type e.g. email API push to URL or none for this outbound fax is first retrieved from the database. If the notification setting for this outbound fax is none then fax server send fax processing is complete. If the notification setting for this outbound fax is email then fax server send fax processing continues with block otherwise processing branches to block .

At block an email notification process is performed. According to one embodiment the email notification process is as described with reference to .

At block the user is notified regarding the completed fax job via API. According to one embodiment the URL originally recorded by API gateway to which the notification is to be pushed is retrieved from the database. The following data may then be POSTed to the specified URL and fax server send fax processing is complete 

At block the caller ID field is set appropriately for the sending account. According to one embodiment the caller ID field is set with either a default caller ID associated with the subscriber account or a caller ID associated with this communications ID if specified.

As noted above with reference to in one embodiment the caller ID field communicated to the PBX may contain extension information according to a static number assignment mechanism that forms a one to one association between an extension and a particular fax modem DACS port. This allows the PBX to identify the fax server originating the outbound fax call make an IP connection to the fax server and interrogate the fax server for the communications ID of the fax job being sent by the fax modem identified by the caller ID field.

Using the communications ID the PBX may then query the database to identify the sending subscriber account ID that initiated the communications ID and can retrieve the default caller ID associated with the subscriber account ID. This caller ID will be written to the caller ID field unless overridden by a particular caller ID value specified by the user to be associated with this outbound fax call in which case the caller ID field will be set with the call specific caller ID value.

At block a route code is prepended to the destination number. According to one embodiment the database is checked to determine if a destination specific route code exists. In one embodiment the first match of the following takes precedence 

In one embodiment if a default route code is to be used then the database carrier rate tables are queried to determine the lowest cost route code based on NPANXX of the destination number.

In an implementation that allows carrier retries the current route code may be overridden. According to one embodiment after the route code has been determined based on the foregoing criteria the database is queried to determine if the current fax call is a retry attempt wherein an alternate carrier has been requested by the fax server. If so then the current route code is overridden with an alternate carrier route code different from that used in the prior fax call attempt.

In alternative embodiments the order of route code determination described above may be reordered so as to first identify whether the current fax call is a retry attempt and if so identifying the alternate carrier route code otherwise applying the destination specific route code matching algorithm noted above.

In any event after the route code is determined it is prepended to the destination number to cause a switch of telecom system s for example to select an appropriate trunk for the outbound fax call.

At this point in PBX call processing the PBX may internally mark this call for call detail record CDR with one or both of the following 

At block the outbound fax call is dialed to the switch via a T1 PRI connection with the caller ID and destination as set based on the foregoing PBX call processing steps.

At block the PBX waits for the call to complete e.g. switch disconnect . Upon call completion the PBX disconnects the bridged connection from the DACS records the CDR to the database and PBX call processing is terminated.

At block an appropriate trunk group is determined for the call. Trunk groups may provide a transmission channel to a packet switched network e.g. the Internet or a circuit switched network e.g. the PSTN . According to one embodiment the destination number of the call request which includes the route code digits prepended by the PBX is pattern matched against trunk groups e.g. T1 PRI DS3 Session Initiation Protocol SIP and the like attached to the switch with the most specific match taking precedence.

At block the prepended digits are stripped to arrive at an appropriate number of digits to dial e.g. the right most 10 11 7 etc. according to the configuration of the selected trunk group.

At block upon call completion call details are recorded the bridged connection from the PBX is disconnected and switch route call processing is terminated.

At block the fax job is updated in the database. According to one embodiment the fax job ID is first looked up in the database based on the communication ID account ID and in queue state. Then the fax job record is updated in the database to indicate success or failure and a detailed reason for the failure is added in the case of a failure. The number of pages transmitted may also be added to the fax job record.

At block the appropriate job in progress counter is decremented. According to one embodiment a job in progress counter is maintained in the database for each fax modem by customer. In some embodiments this counter is used during imaging system work processing to select an appropriate fax modem see e.g. and block .

At block notification options are checked. According to one embodiment notification options include whether to include a transmittal page and whether to include the original email fax request subject line. Those skilled in the art will appreciate various other options are possible. For example the subscriber may specify email notifications are to be in plain text format versus HTML and that the transmittal page and or the scaled image of the first page are to be sent as attachments versus inline images.

If a transmittal page is to be included with email notifications for this subscriber account then a transmittal page is generated including one or more of the following 

If the subject line from the email fax request that initiated this fax job is to be included then the subject for this job ID is retrieved from the database which was recorded earlier by the email gateway for example .

At block the email notification is formatted according to the identified template and notification options and sent to the user that originated the email fax request for this fax job.

While embodiments of the invention have been illustrated and described it will be clear that the invention is not limited to these embodiments only. Numerous modifications changes variations substitutions and equivalents will be apparent to those skilled in the art without departing from the spirit and scope of the invention as described in the claims.

