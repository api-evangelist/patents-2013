---

title: Distributed energy services management system
abstract: Systems and methods for distributed energy services management are disclosed. A particular embodiment includes: receiving an input command via a network interface at a site gateway, the input command including information for controlling one or more physical devices at a site; converting, by use of a data processor, the input command to a virtualized command in a common command format; executing, by use of the data processor, one or more executor modules to cause execution of one or more corresponding virtual devices associated with the virtualized command; and using the executed one or more virtual devices to control the corresponding one or more physical devices at the site.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09063525&OS=09063525&RS=09063525
owner: SUNVERGE ENERGY, INC.
number: 09063525
owner_city: Stockton
owner_country: US
publication_date: 20130222
---
This is a continuation in part patent application of co pending U.S. patent application Ser. No. 13 016 901 filed Jan. 28 2011 and titled Systems Apparatus and Methods of a Solar Energy Grid Integrated System with Energy Storage Appliance by the same applicant. This present patent application draws priority from the referenced patent application. The entire disclosure of the referenced patent application is considered part of the disclosure of the present application and is hereby incorporated by reference herein in its entirety.

A portion of the disclosure of this patent document contains material that is subject to copyright protection. The copyright owner has no objection to the facsimile reproduction by anyone of the patent document or the patent disclosure as it appears in the U.S. Patent and Trademark Office patent files or records but otherwise reserves all copyright rights whatsoever. The following notice applies to the disclosure herein and to the drawings that form a part of this document Copyright 2010 2013 Sunverge Inc. All Rights Reserved.

This patent document pertains generally to tools systems apparatuses methodologies computer program products etc. for distributed energy services management.

There exist several technologies that can produce electricity on a premises whether a residential or commercial building. Among these are photovoltaic panels e.g. solar panels small scale natural gas turbines also known as micro turbines small scale wind turbines in contrast to the large turbines used in grid connected wind farms low pressure water turbines high pressure low flow water turbines and fuel cells using hydrogen natural gas and potentially other hydrocarbons. These technologies are herein referred to as distributed energy sources. Distributed energy sources have been deployed only to a very limited extent for reasons of cost convenience and a lack of harmonized grid inter connection standards. Historically power storage and supply devices typically involve the charging of batteries that store energy in the event of a power failure of a home or business main source of electricity which is normally provided from a utility power grid connected to the home or business and are designed to support the entire or selected electrical load of the home or business. As a result residential and commercial power storage and supply devices are typically very large and cumbersome. Some power storage and supply devices use alternative energy sources such as the ones listed above. The power storage and supply devices store the electric power produced by an alternative energy source and may even supply power to a utility power grid in essence operating as a small distributed power generation plant. Many local state and federal government agencies as well as private utility companies are encouraging this practice as evidenced by the changing regulatory environment and passage of such distributed power and energy storage policies as AB970 SB412 SB 14 and AB44. Further rule makers such as FERC CASIO and the CPUC are making priority changes e.g. CEC Integrated Energy Policy Report CAISO implementation of FERC Order 719 etc. which encourage or mandate the use of distributed energy storage and power generation. Unfortunately the use of alternative energy sources in conjunction with such power storage and supply device systems has been limited primarily because of cost and convenience and communications standards.

In recent years however the costs associated with adopting and using alternative energy sources has decreased substantially as distributed energy power and storage technologies have been refined sales have increased due to the creation of new markets e.g. plug in electric hybrid vehicles and the globalized adoption of solar technologies and more suppliers have entered the market resulting in greater manufacturing capacity and market competitiveness for both photovoltaic and battery manufacturers. The cost barriers to distributed electrical technologies are also eroding due to factors such as real and or perceived increases in the cost of electricity and other forms of energy the widespread adoption of time of use pricing TOU or real time pricing RTP by utilities favorable terms for the utilities purchase of power from such distributed sources and government financial incentives e.g. The federal business energy investment tax credit available under 26 USC 48 was expanded significantly by the Energy Improvement and Extension Act of 2008 H.R. 1424 enacted in October 2008 etc. which encourage investment in distributed and environmentally more benign electrical technologies.

Adoption of distributed energy power and storage technologies is also increasing due to the widespread implementation of an Advanced Metering Infrastructure commonly referred to as AMI. Advanced metering systems are comprised of state of the art electron digital hardware and software which combine interval data measurement with continuously available remote communications. These systems enable measurement of detailed time based information and frequent collection and transmittal of such information to various parties. AMI typically refers to the full measurement and collection system that includes meters at the customer site communication networks between the customer and a service provider such as an electric gas or water utility and data reception and management systems that make the information available to the service provider. With AMI utilities are now better able to manage installed devices within the homes of participating consumers that under utility control selectively disable energy consuming devices e.g. hot water heaters or air conditioning units in response to peak loading conditions. Furthermore utilities are now able in certain cases to remotely activate and aggregate distributed power and energy supplies to increase the supply of electricity to constrained parts of the electricity grid.

There has been an increasing emphasis in recent years on energy conservation. Electric utilities have also come under increasing pressure to reduce the need to fire up polluting power plants to serve peak demands such as during hot summer days. With the enactment of current legislation and rulemaking e.g. AB970 AB32 and FERC Order 719 etc. electric utilities also have an incentive to smooth out energy demand to minimize the need to install new power transmission and distribution lines further negating environmental and land use issues. Examples of a few of the ways in which utilities can perform these tasks are referred to as demand side management and supply side management. Demand side management refers to the selective reduction of energy demand in response to peak loading conditions. For example utilities have for years installed devices in the homes of participating consumers that under utility control selectively disable energy consuming devices e.g. hot water heaters or air conditioning units in response to peak loading conditions. As another example utilities are able in certain cases to remotely activate energy supplies to increase the supply of electricity to parts of the electricity grid. It would be advantageous to provide more sophisticated control mechanisms to permit electric utilities and others to effectively monitor and control distributed energy resources such as storage units capable of storing electricity and reselling it to the grid on command. It would also be advantageous to provide more sophisticated demand side management tasks using aggregated resources to manage localized constraints on the utility grid e.g. substation feeder line residence etc. .

Systems and methods for distributed energy services management are disclosed. An edge gateway system includes a programming platform or environment for receiving command control data and configuration data from a variety of sources and for dynamically controlling actions and state in a plurality of physical devices connected to the platform via a data communications interface. In a particular embodiment the data communications interface can be implemented as a Controller Area Network CAN bus Web services ModBus or other conventional data communications interface and or protocol.

A set of command channels is provided on the platform to receive commands for driving modes actions and device state in the plurality of physical devices represented by a plurality of corresponding virtual device modules or virtual devices. The command channels can provide an input port for commands in a particular format or protocol. Different command channels can handle different formats or protocols. The plurality of command channels are processed by one or more command translators that convert the various formats protocols to a common format that can be used by one or more executor modules of a set of executor modules to cause execution of one or more corresponding virtual device s . In an example embodiment there are multiple executor modules. The executor modules are typically command specific however a single command can be handled by multiple executor modules.

The virtual device acts like a device driver to translate common format commands to control signals for driving a particular type of physical device to a desired state. The virtual device also collects status information from the physical device for transfer to the network cloud as part of a device report. The virtual device s can communicate with the corresponding physical devices via the data communications interface e.g. the CAN bus Web service ModBus or equivalent . Each virtual device can execute other virtual devices. As a result the set of virtual devices can be executed in a hierarchical fashion.

The platform can include a plurality of programs which are installable and configurable on the platform. The programs can each implement a mode or policy in the set of virtual devices. Programs interact directly with the virtual devices. Each program can cause one or more corresponding virtual device s to implement the corresponding mode. The programs are each assigned a unique priority relative to other programs. An action by a lower priority program can be pre empted by a higher priority program. The plurality of programs is scheduled for execution in priority order.

Each program can be assigned to a specified portion of a resource such as a battery. For example a program e.g. Program A can be assigned to a 40 portion of a battery. Given this assignment the actions of other programs cannot affect the 40 of the battery assigned to Program A. If a resource is not fully allocated e.g. 40 is assigned to Program A and 10 is assigned to Program B any program can use the unallocated capacity of the resource. As a result if Program A is assigned 40 of the battery and Program B is assigned 10 of the battery Program A can affect 90 of the battery e.g. 40 assigned to Program A plus the unassigned 50 Program B can affect 60 of the battery e.g. 10 assigned to Program B plus the unassigned 50 and other programs can only affect the unassigned 50 of the battery. Moreover a particular embodiment is further configured to enable assignment or reservation of the individual capacities of a resource. For example a particular resource such as a battery may have a charge capacity and a discharge capacity. An example embodiment can be configured to enable a particular program such as Program A to reserve a portion e.g. 40 of the discharge capacity of the resource but separately none or some or all of the charge capacity of the resource. This feature of the example embodiment allows for a program to reserve a portion of the discharge capacity of a resource while allowing other programs to separately reserve a portion of the charge capacity of the resource. The interaction between programs with resource capacity reservations is implemented in the same manner as the interaction between programs with resource reservations as described above. The partial resource and resource capacity allocation feature of an example embodiment enables the scope of program operation to be configurable and controllable.

Each program can also be associated with a particular external entity or a combination thereof. For example a program can be associated with a consumer a site owner a unit operator a utility a component supplier or other external entity or a combination thereof. As a result the set of programs on the platform and their collective operational activity can be grouped by the associated external entities.

Each program can implement a mode or policy in the set of virtual devices using any of a variety of available program models. For example the plurality of available program models can include an override process a sequence a timeline or a schedule. It will be apparent to those of ordinary skill in the art that many other program models can be provided and used. In the example embodiment the override process sends control commands to the corresponding set of virtual devices for commanding the virtual devices to transition immediately to the specified state. The sequence process initiates a serial set of actions based on a relative time from an initial starting point in time. The set of actions include commanding the virtual devices to transition to specified states. The timeline process initiates a set of actions based on a clock calendar time. The schedule process can include a rules engine for executing a set of conditional actions based on the state of the platform and the virtual devices at the time of execution. Each program can obtain information on the configuration and actions of other programs on the platform. As a result overlapping duplicative or conflicting actions can be avoided.

Each virtual device can report state parameters operational history errors configuration parameters and the like to a server via the platform and a network cloud. The data from each virtual device can be aggregated in a device report delivered or requested periodically e.g. every five mins. from the edge gateway platform. The server can include a user interface UI to interact with users who can manipulate the configuration of virtual devices via the user interface. The server can also include an application programming interface API server to receive API requests from other network systems. The commands received from the UI or the API can be queued in a server command queue. The server delivers commands to the edge gateway platform via the command queue described above. The server also updates the data shown via the UI based on current data received from the edge gateway platform in the device reports.

By virtue of the processing power made available at the edge gateway the embodiments disclosed herein provide a system that can move a high degree of the system intelligence and decision making to the remote sites where the energy is being used and generated. As a result the various embodiments can rely less on a central control architecture and can react more quickly and efficiently to real time changes and events at the remote site.

In the following description for purposes of explanation numerous specific details are set forth in order to provide a thorough understanding of the various embodiments. It will be evident however to one of ordinary skill in the art that the various embodiments may be practiced without these specific details.

As described in various example embodiments systems and methods for distributed energy services management are described herein. In one particular embodiment the distributed energy services management system is applied in an energy network such as the systems illustrated in . However it will be apparent to those of ordinary skill in the art that the distributed energy services management techniques described and claimed herein can be used in a variety of other applications and systems.

The various embodiments disclosed herein provide a solution for cost effective grid scale energy storage generation and management. The various embodiments combine batteries power electronics and generation into a highly optimized form factor that is remotely managed and controlled by a software as a service SAAS platform. The software platform of an example embodiment aggregates systems together in a real time network for the delivery of both energy and information. The resulting energy cloud pools and dynamically scales energy resources across the grid upon demand. Multiple applications can be delivered to multiple customer segments from this single platform. Generation and storage are controlled by a value optimizing process that determines when and where energy should be delivered. Systems can be deployed anywhere on the grid where needed. Each system is sized according to the specific needs of the customer and the site minimizing component and installation costs. The services provided by the various embodiments deliver value by enabling utilities energy consumers and third parties to buy and sell energy each according to their unique economic interest.

Conventional systems do not configure an energy management system that is placed in part behind the meter e.g. between the meter and site loads at a particular site wherein the energy usage and generation at the site can be aggregated pooled and dispatched through multiple applications that can be delivered simultaneously to both the utility grid operator and the site owner customer. The unique combination of elements in the various embodiments disclosed herein enable distributed localized aggregated and virtualized control of energy for the electricity industry. The system can deliver power to utilities and energy consumers in ways that maximize avoided costs ensure energy reliability and accelerate the integration of renewable energies and electric vehicles.

Referring now to a block diagram of an example distributed energy services management system in which embodiments described herein may be implemented is illustrated. As shown in an energy ecosystem represents a cloud services delivery model for energy. The ecosystem in which the example embodiments are implemented includes a site including a set of site resources . The site can correspond to a residential or commercial location at which various site loads are provided. Site loads correspond to various devices or systems at the site that consume or store electrical energy at various levels. For example site loads can correspond to electrical heating devices air conditioners computing or communications equipment that consumes electrical energy washers dryers pool filtering equipment electrical vehicle chargers manufacturing equipment and other electrical system loads at a particular site.

The site resources also include a conventional smart meter that tracks and wirelessly transmits electrical energy usage information to a utility having various utility resources . A conventional smart meter is typically an electrical meter that records consumption of electric energy in intervals of an hour or less and communicates that information at least daily back to the utility for monitoring and billing purposes. Smart meters enable two way communication between the meter and the central system at the utility. Such two way communication can be enabled by an advanced metering infrastructure AMI that differs from traditional automatic meter reading AMR in that it enables two way communications with the meter. One utility resource is an AMI head end that receives and processes the electrical energy usage information received from the smart meter at the site. Another utility resource is a demand response management system DRMS that can provide a centralized mechanism for managing the demand and supply of electrical energy to a community of sites such as the site with site resources .

In an example embodiment the ecosystem includes a distributed energy storage system DESS which includes a site gateway . The DESS represents a system such as the distributed energy storage and power management system disclosed in the above referenced U.S. patent application. In particular the DESS of an example embodiment includes an energy storage module an inverter and a charge controller. The gateway can include a system controller. The energy storage module of DESS represents a battery system for electrical energy storage. In a particular embodiment lithium ion batteries plus a battery management system can be used. The inverter and charge controller of DESS can be conventional units such as the Schneider XW model. The system controller of gateway can represent for example a standard Linux server that has been extended with a custom input output I O controller board that allows multiple smart energy components to be plugged in or otherwise electrically connected. One such smart energy component is a CT Sensor system that monitors site energy demand in real time. The multiple smart energy components can use data communication technologies such as WiFi cellular Zigbee etc. Plugging in multiple communication technologies allows each component to integrate and control other distributed energy resources e.g. electric vehicles batteries or other loads at the site. The DESS components e.g. the energy storage module the inverter and the charge controller and the gateway e.g. the system controller can all be connected via a CAN Controller Area Network Bus network or other well known data communication technologies. Direct integrations with both the inverter charge controller and the energy storage module give the gateway fine grained control over those components. The inverter charge controller and the energy storage module are wired on a common DC bus within the DESS . This enables direct control of energy generation that can be both stored in the batteries directly as DC without the efficiency loss of converting to AC and converted to AC and dispatched to the grid. The DESS is designed for ease of installation. Energy generation systems e.g. solar arrays can be connected to the DESS through a single or multiple DC inputs. The energy grid can be connected to the DESS through a single or multiple AC inputs. This configuration reduces the costs and complexity of the installation process even in comparison to the installation of a traditional energy generation system.

Referring still to the ecosystem includes the site gateway within the DESS . In an alternative embodiment the site gateway can be housed separately from the DESS . The site gateway provides power and energy services at the site where it is deployed. At the same time reserve energy from the site where the site gateway is deployed can be pooled in the network cloud . From this virtualized energy pool customers can reserve energy in advance and can also request energy in real time. Operators within the ecosystem can bid any remaining available energy reserves both to third party aggregators and into open markets for ancillary services. The site gateway of an example embodiment provides cloud energy services that are constantly working to balance demands by shifting resources to where they are needed most and to optimize how energy is captured and delivered. The ecosystem of an example embodiment enables utilities energy consumers and third parties to buy and sell energy each according to their unique economic interest. The ecosystem of an example embodiment delivers multiple energy services on demand to multiple customers in real time. The site gateway of an example embodiment and its cloud resident services provider the site management system are described in more detail below.

As shown in the site gateway of an example embodiment can operate in concert with the site management system which is accessible to the site gateway via the network cloud . The site gateway is designed to be flexible and to provide interoperability across and within various technologies and protocols. As described in more detail below the site gateway automatically discovers local devices and virtualizes those devices without the use of agents. This configuration lowers the cost and complexity of integrating with other components within the ecosystem . In a particular embodiment the site gateway is integrated with the DESS . This integration enables the site gateway to directly monitor and control the inverter charge controller and the energy storage module of the DESS . The combination of the site gateway and the DESS provides a site resident energy management system that is empowered to make intelligent decisions at the local site level yet is controllable via devices through the network cloud as described in more detail below.

The site management system is also designed to be flexible and scalable from the ground up. The site management system provides a base set of services including 1 remote management and upgrades of local software running in each site gateway . System health is monitored and adverse events are captured and reported 2 remote monitoring of the operational state of the components physical devices at the site and remote metering of the power flows and stored energy at each site. Each site gateway reports its complete set of operational data to the site management system at periodic intervals e.g. every four seconds a setting that can be configured 3 fine grained control of the charge and dispatch of power at each site. The site gateway receives commands from the site management system at periodic intervals e.g. every 500 milliseconds a setting that can be configured utilizing a pull model 4 scheduled control of charge and dispatch based on time of day and state of charge in the battery. These site management system services allow the ecosystem to aggregate the power and energy capacity in each and every site gateway at a variety of sites in a distributed community.

The services provided by the site management system and the site gateway enable the ecosystem to maximize the value of each unit of energy dispatched from each site gateway by means of intelligent decision making at the local site level. Unlike conventional centrally controlled systems the site management system of an example embodiment can delegate many of these intelligent decision making responsibilities and related site specific policy implementations to the site gateway . The site gateway can use its own local resources to implement many of the decisions services and policies for managing energy consumption and generation both locally and in the ecosystem based upon at least the following inputs 

Referring still to a consumer user interface is provided as a site resource to enable a user to interact with the consumer user interface at the site via as consumer portal and the network . The consumer portal provides a web enabled presence for monitoring or controlling operational parameters at the site from a consumer device via the network .

Referring now to the diagrams illustrate details of various implementations of a platform system of two example embodiments. The example embodiment shown in reflects an implementation wherein much of the energy management intelligence in the form of various applications and services is maintained at the site management system . The implementation of represents a model that uses the site management system as a central controller for managing a plurality of site gateways . Although the central control architecture of may be suitable in some circumstances many other situations require a more distributed decision making capability. As such the example embodiment shown in reflects an implementation wherein much of the energy management intelligence in the form of various applications and services is maintained at the site gateway as a site resident system. In the more distributed architecture shown in the site management system can push much of the software and rule logic implementing the various applications and services to the site gateway for execution locally at the site. In this distributed system architecture the site management system acts more as a monitor and command dispatcher rather than as central controller. Other alternative system architectures can also be implemented wherein the software and rule logic implementing the various applications and services can be split between the site management system and the site gateway . In this alternative system architecture the site management system implements a portion of each application or service and the site gateway implements the remaining portion of each application or service.

As described in more detail below and shown in the site gateway of an example embodiment in combination with the site management system provides a set of Smart Grid applications on top of the software platform. As described above and shown in these Smart Grid applications can be implemented primarily on the site management system as shown in or implemented primarily on the site gateway as shown in . In a particular embodiment these Smart Grid applications can include Peak Load Shifting Demand Response Frequency Regulation Uninterruptible Power Supply UPS Management Voltage Support and Optimization Analytics Demand Charge Reduction Regulation Photovoltaic PV Smoothing Reliability and a variety of other applications. These applications are described in more detail below. In a particular embodiment each application can be delivered as a software as a service SAAS . Each application integrates with utility and third party systems by means of open web based standards such as Extended Markup Language XML and Web Services. Additionally all of the monitoring control and reporting functions available in the platform can be exposed as a web services application programming interface API available either or both at the site management system and at the site gateway . This system configuration has at least two advantages first the system configuration provides flexibility and agility to integrate with the broadest possible range of external applications and systems. Secondly the system configuration allows partners and customers to build their own services applications on top of the platform provided by the various embodiments described herein. Moreover application specific protocols such as OpenADR and DNP3 can be quickly built into platform applications and exposed through a platform API. Additionally application end user interfaces can be delivered over conventional Hypertext Transport Protocol HTTP and can be viewed on any web enabled device.

The Smart Grid applications provided by the site management system and the site gateway are deployed to solve real world problems and deliver value streams to at least two sets of parties 1 load serving entities such as utilities and 2 energy consumers such as businesses and residential homeowners. Note that one of the advantages of the various embodiments described herein is that multiple applications can be delivered to multiple parties out of the same system. In practice therefore deployments of distributed energy storage systems will likely combine two or more applications during standard operations.

The Smart Grid applications listed above and shown in can be divided into three categories 1 applications that generally benefit load serving entities 2 applications that generally benefit energy consumers and 3 applications that generally benefit both sets of parties. The Smart Grid applications listed above are described in more detail below in the context of the benefits provided by the particular applications. For example applications that generally benefit load serving entities include the following 

The applications that generally benefit both load serving entities and energy consuming entities include the following 

As shown in the site management system or the site gateway can support a set of services on the software platform. In a particular embodiment these services can include remote command and control scheduling visualization aggregation remote management monitoring and reporting. In an example embodiment as shown in the site gateway can include additional services such as power control energy control system monitoring command processing device virtualization protocol translation and other services. These additional services can also be provided at the site gateway in the distributed system architecture shown in . The software environment in which these applications and services are executed on the site gateway is described in more detail below.

The applications and services provided on the site management system and the site gateway of an example embodiment represent an energy management system. This energy management system has some powerful capabilities. For example the energy management system can monitor the operation of the power electronics inside of each DESS and its corresponding site gateway to ensure the energy system at a particular site is running smoothly. Secondly the energy management system can report on the power and energy being used and or generated at the particular site. The reporting can include information indicative of how much power the renewable power generators are generating how much energy is stored in each battery how much power is being provided to the grid and to the loads at the site. This reporting happens in real time and can be viewed on any network connected information or communication device from any place in the world. The energy management system can also control the operation of each DESS and its corresponding site gateway also in real time. If one unit needs to charge the energy management system can command that unit to charge. If live units on a certain circuit need to discharge the energy management system can command those units to discharge. The energy management system of an example embodiment can mix and match these commands in any order for any combination of devices installed throughout locations on the grid. The energy management system runs a value optimizing process that makes charge and discharge decisions for each unit and across multiple units which exploit the cost and price of energy in and out of the system. The energy management system integrates with existing utility and partner applications and systems by means of open and flexible web services protocols. These remote control capabilities enable the system to have an immediate and powerful impact on the grid. As the number of distributed DESS and corresponding site gateway systems grow so does the aggregated potential of the entire system.

The Smart Grid applications and services provided by the site management system and the site gateway as described above are deployed to manage energy usage and value given a number or factors in the operating environment. These factors can include the following 

The Smart Grid applications and services provided by the various embodiments described herein can perform a detailed analysis of these and other factors to determine when how much how long and to or from which resources the site resident system should charge or dispatch energy. The result is that the value of each unit of energy dispatched is maximized ensuring the maximum possible return on investment over time. In particular the various embodiments provide several advantages over existing systems. These advantages include the following 

Referring now to the diagram illustrates as detail of the input received by a site gateway of a DESS in a particular embodiment. As described above the site resident system including site gateway is an important part of the ecosystem for supporting the applications and services described above. In support of these applications and services the site gateway is configured to receive and process command control and configuration data from a variety of sources via the network cloud . In an example embodiment these command control and configuration data sources can include the site management system the DRMS and third party sources and or such as energy monitoring or control systems using browsers or mobile devices. Each of these command control and configuration data sources may need to monitor or control the operation of the energy consumption or generation at a particular site. The DESS and its corresponding site gateway located at the site are needed to provide this site resident support for effecting the monitoring and control commands sent by any of the network resident command control and configuration data sources. As described in more detail below each of these command control and configuration data commands are received and processed by the site gateway in cooperation with the corresponding DESS .

In an alternative embodiment the DRMS and the third party sources and or can issue command control and configuration data commands for a particular site via the site management system . The site management system can use a command queue to store and marshal the commands for a particular site and forward the commands to the site gateway at the particular site.

At periodic intervals e.g. every four seconds the interval being a configurable parameter the site gateway at each site gathers configuration and status data for each of the energy devices at the site. This configuration and status data can be used internally by the site gateway to generate trending data to assess the operation of the energy devices at the site to compare the energy consumption and generation at the site with desired thresholds and to produce a new command set for driving the energy consumption and generation at the site toward desired thresholds. In this manner the site device status report provides a feedback loop for enabling the site gateway to manage energy consumption and generation at the local level. In addition the site gateway can generate a site device status report that can be sent to the site management system via the network cloud . The site management system can use the site device status report from each site to generate aggregated trending data to assess the operation of the energy devices at a community of sites to compare the energy consumption and generation at the community of sites with desired thresholds and to produce new command sets for driving the energy consumption and generation at particular sites toward desired thresholds. In this manner the site device status report provides a feedback loop for conveying site status to the site management system . In response to this feedback the site management system may issue a new set of command control and configuration data commands to the site gateway at the site. Note also that the feedback received by the site management system from the site via the site device status report may include a new site device configuration or status driven by commands issued by the DRMS or third party sources and or . In this manner the site management system can monitor the operation of the site as controlled by a third party command source. Thus in a variety of ways and from a variety of sources the site gateway can receive command control and configuration data command sets via the network . The processing of these command sets at the site gateway is described next.

Referring now to the diagrams illustrate details of the internal processing structure of to site gateway in a particular embodiment. The site gateway of an example embodiment includes a programming platform or environment for receiving command control data and configuration data commands from a variety of sources and for dynamically controlling actions and state in a plurality of physical devices at a particular site and connected to the platform via a data communications interface. In a particular embodiment the data communications interface connecting the plurality of physical devices to the site gateway can be implemented as a Controller Area Network CAN bus Web services ModBus or other conventional data communications interface and or protocol.

The site gateway of an example embodiment can process the received command sets in at least two different ways or using at least two different processing paths. In a first processing path illustrated in the site gateway can use one or more executor modules of a set of executor modules running at a command virtualization layer to activate one or more virtual device s at a device virtualization layer. The activated virtual device s can control corresponding physical devices. In a second processing path illustrated in the site gateway can use one or more executor modules of the set of executor modules running at the command virtualization layer to activate one of a plurality of programs or platform application apps . The programs can each implement a mode or policy in the set of virtual devices at the device virtualization layer. The activated program can then activate the one or more virtual device s which can control corresponding physical devices.

Referring now to in the first processing path described above a set of command channels is provided on the site gateway platform to receive command control and configuration data command sets from third party command sources via the network . The command sets contain commands for driving modes actions and device state in the plurality of physical devices represented by a plurality of corresponding virtual device modules or virtual devices. The command channels can provide an input port for commands in a particular format or protocol. As such in an example embodiment different command channels can handle different formats or protocols. The plurality of command channels are processed by one or more command translators or command drivers that convert the various formats protocols to a virtualized command in a common command format. The common command format can be used by one or more executor modules of a set of executor modules running at the command virtualization layer . The executor modules operating in response to an input command can cause execution of one or more virtual device s at the device virtualization layer . The one or more virtual device s at the device virtualization layer correspond to the physical devices at the particular site under control of the site gateway . Thus the commands received by the site gateway can be processed by the platform of site gateway shown in to cause the execution of one or more virtual devices at the device virtualization layer to drive a corresponding physical device to a desired state to query the state of a corresponding physical device or to set configuration parameters in a corresponding physical device . In an example embodiment there can be multiple executor modules at the command virtualization layer . The executor modules are typically command specific however a single command can be handled by multiple executor modules.

The virtual devices at the device virtualization layer can use corresponding device drivers and a physical device layer to translate common format commands to control signals for driving a particular type of physical device to a desired state. The virtual device can also collect status information from the physical device via corresponding device drivers for transfer to the network cloud as part of a site device report as described above. The virtual device s can communicate with the corresponding physical devices via the physical device layer and a data communications interface e.g. the CAN bus Web service ModBus or equivalent . In a particular embodiment each virtual device at the device virtualization layer can execute other virtual devices. As a result the set of virtual devices at the device virtualization layer can be executed in a hierarchical fashion.

Referring now to in the second processing path described above the set of command channels is provided on the site gateway platform to receive command control and configuration data command sets from third party command sources via the network . As described above the plurality of command channels are processed by one or more command translators or command drivers that convert the various formats protocols to a virtualized command in a common command format. The common command format can be used by one or more executor modules of a set of executor modules running at the command virtualization layer . The executor modules operating in response to an input command can cause execution of one or more programs or platform application apps as shown in . The example embodiment of the platform of site gateway as shown in can include a plurality of programs or platform application apps which are installable and configurable on the platform of site gateway . The programs can each implement a mode or policy in the set of virtual devices at the device virtualization layer . Programs can interact directly with the virtual devices. Each program can cause one or more corresponding virtual device s to implement the corresponding mode. The execution of a particular executor module in response to an input command can trigger the activation of a corresponding program . Similarly the activation of a virtual device can trigger the activation of a corresponding program . The activation or deactivation of particular programs can also be configured to occur on a periodic timed or scheduled basis. As a result programs can be used on the platform to implement particular modes or policies in one or more virtual device. The programs can each be assigned a configurable unique priority relative to other programs . As a result an action by a lower priority program can be pre empted by a higher priority program . In general however the plurality of programs is scheduled for execution in priority order. By providing a prioritized set of programs on the platform an example embodiment can conveniently and dynamically change the operation of the energy management system at the site gateway . For example particular programs can be used to configure the physical devices to operate in an energy conserving manner during a time when grid power costs are high. When grid power costs decrease below a configured threshold a new set of programs can be dynamically activated to configure the physical devices to operate in an energy storage or energy generation mode.

In one embodiment each program can be configurably assigned to a specified portion of a resource in a corresponding DESS such as a battery. For example a program e.g. Program A can be assigned to a 40 portion of a battery in DESS . Given this assignment the actions of other programs cannot affect the 40 of the battery assigned to Program A. If a resource is not fully allocated e.g. 40 is assigned to Program A and 10 is assigned to Program B any program can use the unallocated capacity of the resource. As a result if Program A is assigned 40 of the battery and Program B is assigned 10 of the battery Program A can affect 90 of the battery e.g. 40 assigned to Program A plus the unassigned 50 Program B can affect 60 of the battery e.g. 10 assigned to Program B plus the unassigned 50 and other programs can only affect the unassigned 50 of the battery. Moreover a particular embodiment is further configured to enable assignment or reservation of the individual capacities of a resource. For example a particular resource such as a battery in DESS may have a charge capacity and a discharge capacity. An example embodiment can be configured to enable a particular program such as Program A to reserve a portion e.g. 40 of the discharge capacity of the resource but separately none or some or all of the charge capacity of the resource. This feature of the example embodiment allows for a program to reserve a portion of the discharge capacity of a resource while allowing other programs to separately reserve a portion of the charge capacity of the resource. The interaction between programs with resource capacity reservations is implemented in the same manner as the interaction between programs with resource reservations as described above. The partial resource and resource capacity allocation feature of an example embodiment enables the scope of program operation to be configurable and controllable. As a result the scope of programs and the degree to which these programs can control physical devices on the site can be tightly and configurably controlled.

In addition in one embodiment each program can also be associated with a particular external entity or a combination thereof. For example a program can be associated with a consumer a site owner a unit operator a utility a component supplier or other external entity or a combination thereof. As a result the set of programs operating on the platform of site gateway and the collective operational activity of these programs can be grouped by the associated external entities. Thus modes or policies can be applied to the operation of the physical devices based on an associated external entity.

Each program can implement a mode or policy in the set of virtual devices using any of a variety of available program models. For example the plurality of available program models can include an override process a sequence a timeline a schedule or other program model. It will be apparent to those of ordinary skill in the art that many other program models can be provided and used. In an example embodiment the override process sends control commands to the corresponding set of virtual devices for commanding the virtual devices to transition immediately to the specified state. The sequence process initiates a serial set of actions based on a relative time from an initial starting point in time. The set of actions include commanding the virtual devices to transition to specified states. The timeline process initiates a set of actions based on a clock calendar time. The schedule process can include a rules engine for executing a set of conditional actions based on the state of the platform and the virtual devices at the time of execution. Each program can obtain information on the configuration and actions of other programs on the platform. As a result overlapping duplicative or conflicting actions can be avoided.

Each virtual device can report state parameters operational history errors configuration parameters and the like to the site gateway and the site management system via the device status report and the network cloud . The data from each virtual device can be aggregated in the device status report which can be delivered or requested periodically e.g. every five minutes from the site gateway platform. The site gateway and the site management system can include a user interface UI to interact with authorized users who can manipulate the configuration of virtual devices and or programs on the site gateway via the user interface. Alternatively a network accessible consumer portal can be provided and used with a consumer user interface to enable authorized users to manipulate the configuration of virtual devices and or programs on the site gateway . The site management system can also include an application programming interface API server to receive API requests from other network systems. The commands received from the UI or the API can be queued in a server command queue . The site management system can deliver commands to the site gateway platform via the command input mechanism described above. The site management system can also update the data shown via the UI based on current data received from the site gateway platform in the site device reports .

Referring now to the diagram illustrates a block diagram of an alternative example of a distributed energy services management system in which embodiments described herein may be implemented. In the embodiment illustrated a host site is shown to include the site management system as described above. In a particular embodiment the host site may also include a web server having a web interface with which users may interact with the host site via a user interface or web interface. The host site may also include an application programming interface API with which the host site may interact with other network entities on a programmatic or automated data transfer level. The API and web interface may be configured to interact with the site management system either directly or via an interface . The site management system may also be configured to access and use a data storage device either directly or via the interface .

In an example embodiment as described herein the system of one embodiment is configured to receive a command stream from a network based energy management system perform command virtualization on the received command stream identify one or more devices corresponding to the virtualized command stream activate one or more platform apps e.g. programs corresponding to the identified devices and use the one or more platform apps e.g. programs to virtualize the identified devices to identify corresponding device drivers and to configure physical devices corresponding to the virtualized devices.

The example computer system includes a data processor e.g. a central processing unit CPU a graphics processing unit GPU or both a main memory and a static memory which communicate with each other via a bus . The computer system may further include a video display unit e.g. a liquid crystal display LCD or a cathode ray tube CRT . The computer system also includes an input device e.g. a keyboard a cursor control device e.g. a mouse a disk drive unit a signal generation device e.g. a speaker and a network interface device .

The disk drive unit includes a non transitory machine readable medium on which is stored one or more sets of instructions e.g. software embodying any one or more of the methodologies or functions described herein. The instructions may also reside completely or at least partially within the main memory the static memory and or within the processor during execution thereof by the computer system . The main memory and the processor also may constitute machine readable media. The instructions may further be transmitted or received over a network via the network interface device . While the machine readable medium is shown in an example embodiment to be a single medium the term machine readable medium should be taken to include a single non transitory medium or multiple media e.g. a centralized or distributed database and or associated caches and servers that store the one or more sets of instructions. The term machine readable medium can also be taken to include any non transitory medium that is capable of storing encoding or carrying a set of instructions for execution by the machine and that cause the machine to perform any one or more of the methodologies of the various embodiments or that is capable of storing encoding or carrying data structures utilized by or associated with such a set of instructions. The term machine readable medium can accordingly be taken to include but not be limited to solid state memories optical media and magnetic media.

The Abstract of the Disclosure is provided to comply with 37 C.F.R. 1.72 b requiring an abstract that will allow the reader to quickly ascertain the nature of the technical disclosure. It is submitted with the understanding that it will not be used to interpret or limit the scope or meaning of the claims. In addition in the foregoing Detailed Description it can be seen that various features are grouped together in a single embodiment for the purpose of streamlining the disclosure. This method of disclosure is not to be interpreted as reflecting an intention that the claimed embodiments require more features than are expressly recited in each claim. Rather as the following claims reflect inventive subject matter lies in less than all features of a single disclosed embodiment. Thus the following claims are hereby incorporated into the Detailed Description with each claim standing on its own as a separate embodiment.

