---

title: Synchronizing the storing of streaming video
abstract: A method, system, and computer-readable medium for synchronizing video are described. The system captures video data with a camera, the video data including a first video data segment and a second video data segment. When a network between the camera and a hub is insufficient to allow downstream real-time streaming of the video data, the system stores the first video data segment on a first storage. When the network is sufficient to allow downstream real-time streaming of the video data, the system transfers the second video data segment from the camera to the hub, reads the first video data segment from the first storage, and transfers the first video data segment to the hub. The system stores the video data segments onto a second storage such that a non-real-time playback from the second storage shows the first video data segment and the second video data segment in sequence.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08863208&OS=08863208&RS=08863208
owner: MicroPower Technologies, Inc.
number: 08863208
owner_city: San Diego
owner_country: US
publication_date: 20130606
---
This application claims the benefit of U.S. Provisional Patent Application No. 61 680 259 filed on Aug. 6 2012 entitled Method for Synchronizing the storing of streaming video and U.S. Provisional Patent Application No. 61 660 953 filed on Jun. 18 2012 entitled Method for Synchronizing the storing of streaming video all of which are hereby incorporated by reference in their entirety for all purposes.

Network camera systems can be based on Internet protocol IP and use Ethernet based networking technology. In some applications network camera systems are replacing analog closed circuit television CCTV due to various factors such as accessibility ease of use cabling scalability and lower cost of deployment and operation. With the ubiquity of wireless networks such as WiFi networks based on IEEE 802.11 standards and the emerging WiMAX networks based on IEEE 802.16 standards wireless network camera systems are gaining popularity and may become the dominant platform for video surveillance applications.

In an IP surveillance environment a network camera system can include IP cameras connected via twisted pair cabling to a network switch. Alternatively the network connection can be achieved using wireless local area networking LAN technology standard. In various applications IP cameras can include a web server capability and remote clients or observers connected to the camera via standard TCP IP interface standards such as FTP or HTTP.

Real time streaming of video can also be an important function for a video surveillance environment. A remote viewer viewing the video may wish to have minimal delays in watching the captured video in order to be able to respond to a situation more clearly. Real time streaming also has other applications. For example sports enthusiasts often wish to watch a sporting event in real time so as to enable up to date information regarding the event.

The current disclosure describes a method network camera system and computer readable medium for synchronizing storing of video. The method includes capturing video data with a camera. The video data includes a first video data segment and a second video data segment. When a network between the camera and a hub is insufficient to allow downstream real time streaming of the video data the first video data segment is stored on a first storage. When the network between the camera and the hub is sufficient to allow downstream real time streaming of the video data the method system medium i transfers the second video data segment from the camera to the hub over the network ii reads the first video data segment from the first storage and iii transfers the first video data segment to the hub over the network. The first video data segment and the second video data segment are stored on a second storage such that a non real time playback from the second storage shows the first video data segment and the second video data segment in sequence.

The present invention is better understood upon consideration of the detailed description below in conjunction with the accompanying drawings and claims.

The invention generally relates to network camera systems and storing captured video data. The current disclosure describes a method network camera system and computer readable medium for synchronizing storing of video. The method includes capturing video data with a camera. The video data includes a first video data segment and a second video data segment. When a network between the camera and a hub is insufficient to allow downstream real time streaming of the video data the first video data segment is stored on a first storage. When the network between the camera and the hub is sufficient to allow downstream real time streaming of the video data the method system medium i transfers the second video data segment from the camera to the hub over the network ii reads the first video data segment from the first storage and iii transfers the first video data segment to the hub over the network. The first video data segment and the second video data segment are stored on a second storage such that a non real time playback from the second storage shows the first video data segment and the second video data segment in sequence. The storing may include constructing a hash table that catalogs and relates the video data segments to respective time segments.

The first video data segment may be transferred over the network on a first channel. The second video data segment may be transferred over the network on a second channel that is more time sensitive than the first channel.

The method may further include displaying a copy of the second video data segment to a viewer in real time during the transferring of the second video data segment. The displaying may include transferring the copy of the second video data segment over a display network. The displaying may also include determining a bandwidth of the display network. Based on the bandwidth of the display network the displaying may also include reducing a full resolution of the second video data segment to make the copy of the second video data segment that is displayed to the viewer.

When the network has sufficient bandwidth for real time streaming of the video data the hub may send control data to the camera requesting the steps of reading the first video data segment and transferring the first video data segment.

The method may further include creating a keyframe index during the storing. When a playback position is requested and the playback position does not exist in the second storage the method may use the keyframe index to find a next decodable video data the next decodable video data being stored in the second storage.

The network camera system includes a camera and a hub. The camera is configured to capture video data including a first video data segment and a second video data segment. The camera stores the first video data segment on a first storage when the network camera system is unable to provide for real time streaming of the video data. When the network camera system is able to provide for real time streaming of the video data the camera transfers the second video data segment to a hub over the network reads the first video data segment from the first storage and transfers the first video data segment to the hub over the network. The hub is configured to store the first video data segment and the second video data segment onto a second storage. A non real time playback from the second storage shows the first video data segment and the second video data segment in sequence. The computer readable medium stores instructions which when executed by a processor causes a network camera system to execute the methods described herein.

Embodiments of the present invention provide for synchronizing the storing of streaming video from a camera for example a wireless camera. Although any communication network can be used to transmit data to and from the camera wireless networks such as WiFi networks based on IEEE 802.11 standards and WiMAX networks based on IEEE 802.16 standards can realize additional benefits from embodiments for reasons discussed below. Therefore although embodiments are described below in wireless environments the skilled artisan will understand that embodiments can be applied to both wired and wireless communication networks.

When a wireless channel exhibits excessive data traffic or loss of signal transmission of camera video data to a hub may be interrupted. In other situations a wireless link between the camera and the hub may be interrupted due to movement of a portable camera or change in the environment where a camera is mounted. Attenuation interference and multipath are all factors which may lead to signal loss or corruption. Other factors may lead to a break in reliable video data transmission from the camera to the hub such that video data may not be transmitted in real time. For example a network between the camera and the hub may be shared by other nodes that compete with the camera and hub for bandwidth. In another example devices supporting the network such as a router switch hub or firewall may become overloaded or otherwise fail to process data at or above the speed at which the data is receive or expected to be transmitted. In these scenarios the network may become insufficient for allowing real time video streaming.

When an interruption occurs a user watching the camera s video in real time will experience a gap or break in the viewed video. The gap or break may be shown as a frozen frame a blank screen a message communicating that transmission has been interrupted or the like.

In response software located in the hub for example can monitor the wireless channel between the camera and the hub to determine when it is restored. When that channel is again robust and able to support video data transmission the software reads lost video data from the time when communication was disrupted from a storage device located on the camera e.g. a flash memory and saves it within the camera video data previously stored at the hub. It is stored in a manner such that when reviewed later the displayed video is continuous and without interruption.

A hub may be utilized to monitor data on a first wireless channel C between the hub and the wireless cameras . The hub may also monitor data on a second wireless channel C C between the hub and the wireless cameras using this second channel C C for command and control and for copying recorded data from the cameras . The cameras may be located physically away from the hub up to any distance in which the cameras can still access the network or even beyond the maximum network access distance. The cameras may be remotely mounted or portable such as a wearable camera. In normal operation the cameras record video data which may be i stored on the cameras for example in the first video record database or stored proximally closer to the cameras for example in an external storage device that can be connected to the cameras and ii transmitted to the hub where the video data is stored and is also made optionally available for viewing by a user in real time.

The terms real time and real time are used herein as understood in the art. For instance the skilled artisan will recognize that real time streaming does not require that the viewer receives and is able to view video data at the exact instant it is captured but substantially instantly taking into account the delays from transmission in physical media and space processing and other constraints of the system.

Embodiments may include a first software application and a second software application. The wireless video camera may be connected to a wireless network at a distance exceeding for example nine 9 meters. The first software application is in communication with the wireless camera and the second software application through the network s . The wireless camera includes a first mechanism to capture and transmit live video in real time to the first and or second software application and a first video record database of video which is previously captured video whose time duration is a function of the configured storage capability of the camera. The first software application also collects the recorded video from the camera according to a usage model for the end application. The end application will choose to manage the collection of the recorded video depending on wireless bandwidth which affects the ability to collect the information simultaneously with live video.

The first software application also contains a second mechanism that determines the integrity of the match between the first video record database and the second video record database such that the second video record database is substantially the same as the first video record database. The second software application is connected to the second video record database and allows viewing of the live video in real time as well as viewing of the second video record database controlled by the first software application.

The first video record database is an example of a first storage. The first video record database can be a memory device such as a flash memory hard disk floppy disk magnetic tape or any other memory device or collection of memory devices that is are connected to the camera. The first video record database may include a non volatile secondary memory in order to persist data across power cycles of the camera although volatile primary memory can also suffice. The first video record database is shown as part of each wireless camera as an internal memory but the first video record database can also include an attached external storage device for example a network attached storage NAS a remote database a cloud storage and or a shared memory device connected to a data bus.

The first mechanism can also request data stored on the first video record database that may not have previously been successfully transmitted for example in a live stream. This video data is merged into the local copy of the camera video recording such that a playback from this recorded video is seamless in the time axis. Wireless cameras transmit data over the wireless network to a hub which is optionally located in a base station via a channel C C. Although five channels are shown the system may have more or less channels. The wireless cameras may also be associated with multiple hubs or base stations. Optionally the first and second software applications may be in a cloud server located physically away from the wireless cameras and the hub .

Depending on the camera s hardware and software capabilities video can be captured recorded and or transmitted at a resolution deemed acceptable for the system. For example to conserve channel communications bandwidth the video may be streamed at a lower resolution than what is recorded. Recorded data can be transmitted to the hub on a back channel that is not as time sensitive as live video when the resolution is higher than the live stream. For example the back channels C C may have lower priorities than the time sensitive live video channel C. The first and or second software application may decide on the system s optimal configuration for live video mixed with the desire for higher resolution playback utilizing the available channel bandwidth on the wireless network .

In this model the cameras can be configured to record at a desirable resolution the cameras can support and the image resolution streamed may or may not be the same as the recorded resolution. The hub can create a copy of the video for example at a lower resolution presented by the cameras and can make decisions on when the hub needs to request recorded video from the cameras for integration into the copy of the video stream. This allows the system to optimize video playback while retaining a recording in a desired resolution that can be used for playback.

The first software application may communicate with the wireless cameras and the second software application through wireless networks . In one embodiment the first software application runs on hub . Hub is configured to receive information from the wireless cameras and has one or more potential communication channels over the network . In this example the network can be a display network that connects hub with a remote client through a wireless network e.g. a Bluetooth connection a cellular network a wireless Ethernet network a WiFi network or a WiMAX network or a wired network e.g. LAN WAN network or POE network .

Remote client may be a device such as a mobile phone personal digital assistant PDA smartphone laptop computer or any other device that allows for viewing of the captured or recorded video. The second software application may run on remote client to provide a user with access to the video.

In one embodiment hub processes the video data received from the wireless cameras . In another embodiment hub can be one or more devices such as a group of computers receiving and processing the video data as a wireless base station. Hence the computers may function as the base station or hub as well as the remote client .

The first software application controls the transfer of the live video and portions of the first video record database to compile a second video record database . The second video record database can be collocated with the hub or may be remotely located for example in a separate database server or cloud.

The hub can use any network protocol that allows for streaming the video data from the wireless camera to the hub to a remote client not shown in . In one embodiment the hub uses Real Time Streaming Protocol RTSP a network control protocol designed for use in communications systems to control streaming media servers. The protocol is used to establish and control media sessions between end points such as the hub and the remote client. RTSP server software residing on the hub receives and processes commands from the remote client. The remote client controlled by a user or automated may issue VCR like commands such as play rewind pause and trick modes fast forward fast reverse etc. to facilitate real time control of playback of video data from the hub . The remote client can access the hub through a network and can proxy the RTSP interface to an uplink over which information is accessed. Provisioning is made for media sessions to present the video stream in different resolutions allowing the end application the hub or both to choose the resolution as desired or allowed by the system. Transcoding of stored video to a resolution selected by the RTSP session can be performed by the hub if stored in storage or by the wireless cameras if stored in a camera side storage .

The hub may monitor a wireless link that enables for example an MPEG transport stream to the wireless camera receive video data from the wireless camera and organize the video data as a time linear buffer of video based on timestamps attached to video data segments received from the wireless camera. The wireless link between the hub and the wireless camera may be interrupted for a variety of reasons such as excessive data traffic changes in environmental factors or the like. During such a condition the video data segments received from the wireless camera may have gaps in the video in the time axis. The storage organization of the video data can account for this by constructing a hash table that catalogs and relates video data segments stored in memory to their respective time ranges for playback. When the wireless link is active or otherwise able to transmit a live stream again the hub retrieves and or the camera transmits the missing blocks of video data that have been cached on the camera to construct a complete set of video data segments that are stored in a location accessible by the hub for playback.

In one embodiment the video data segments stored on the hub are temporal and will be sent to the CUD for transmission to its archival system not shown in via the data service . For example the hub can temporarily record the video data segments while they are being sent in a live stream over wireless in a circular file buffer . The data service can receive video data segments from the circular file buffer to send to the archival system. The data service can also retrieve the video data segments from the archival system upon request . Once the video data segments are sent to the CUD they are eventually removed from the hub to free up storage for new video data segments. This same storage management policy can exist between the wireless camera and the hub.

The wireless cameras can constantly record video in a circular buffer . When the wireless link to the hub is active and can support requested streaming video the cameras stream the live video to the hub as well. Alternatively to save memory write cycles the cameras can be configured to not write the captured video data into the cameras circular buffers when the data is successfully streamed. In this alternate configuration the cameras store only the video data segments that were not successfully transmitted. The video data segments are transmitted as a Moving Picture Experts Group MPEG transport stream so timestamps in the video data segments allow the hub to keep track of missing video. When the hub receives the MPEG transport stream it monitors the Presentation Time Stamps PTS in the stream and uses these to determine which time segments are missing from the recording. In a pull scheme the hub queries the wireless camera data service to retrieve the missing video in order to fill in the blanks in its video cache. Alternatively the system can be configured in a push scheme in which the wireless camera transmits any cached video once it detects that the network supports transmission.

The system can have a mechanism for down converting the video. For example a viewer may request to watch video only in 360 p although the cameras may be recording in 1080 p. Alternatively the system may automatically detect that the communication networks are unable to support live streams in the full resolution captured. In one embodiment the wireless cameras down convert the video quality before they are transmitted to the hub. This allows the system to operate and deliver lower resolution live streams when the communication network between the cameras and the hub are unable to support full resolution and then the system can later deliver the full resolution video for later playback. However this requires additional processing by the camera and thus may not be ideal for cameras with portable power supplies. Thus as one alternative the system may have one or more processing devices external to the cameras but attached to the first video record database a camera side processor. The camera side processor is responsible for down converting the video data segments prior to being lodged into the MPEG transport stream for real time streaming. As another alternative the cameras may transmit the full resolution to the hub the hub is then responsible for down converting the received video prior to live streaming the video to the requesting viewer s .

The hub can synchronize the storing of the video to create a seamless video playback experience. The first software application can include a second mechanism that determines the integrity of the match between the first video record database and the second video record database such that the second video record database is substantially the same as or if there are multiple cameras a sum of the first video record database s . This may optionally be used for evidentiary or legal purposes. When the wireless link between the wireless camera and the hub is interrupted gaps in the video exist in the hub s copy of the recording from the time the wireless link was interrupted until the time the wireless link is re established and the hub is again receiving the live stream from the wireless camera. The hub can manage two processing aspects when this condition exists. First the hub contacts the wireless camera data service and requests the video blocks for the time range over which gaps exist. Second as the hub s RTSP server is feeding video to remote clients and the playback position comes to a gap the RTSP server uses a keyframe index to find the next decodable location in the data that has been stored which can be sent to a video player for seamless decoding. The keyframe index is created by the hub as it records the video on the memory.

As an alternative to the first processing aspect of the hub the wireless cameras can detect which video data segments were and were not successfully transmitted to the hub for example the wireless cameras may receive TCP ACKs in this situation the wireless cameras can be configured to send the segments that were not successfully transmitted to the hub without having to await a request from the hub.

The keyframe index is also used to support trick mode playback. In order to playback the video at higher speeds the RTSP server must skip frames that it sends to the video player. It does this by using the keyframe index to know where to seek to in the video data buffer and then selecting the amount of data necessary for a decoder to completely resolve a video frame for playback. By skipping over frames and inter frame data the video illusion of fast motion playback is created when these frames are rendered on the screen for the user.

In one embodiment the second software application or remote client is connected to the second video record database and allows viewing of the live video in real time as well as viewing of the second video record database controlled by the first software application.

If the network does not allow downstream real time video streaming at S then the wireless cameras can store the captured video on the first video record database storage at S. Alternatively as described above if the cameras are already configured to store video data segments irrespective of whether the video data segments are successfully received by the hub then the cameras may instead mark the unsuccessfully transmitted video data segments so as to later transmit them e.g. at S . After either storing or marking the captured video on the first video record database at S the system continues to make a determination as to whether the network allows downstream real time video streaming at S.

If the playback request is not for real time video at S then the hub determines whether the requested video is on the second video record database storage at S. If so then the method proceeds to step S. If not then the hub can retrieve the cached or queued video from the cameras at S and then proceed to step S.

In a non limiting exemplary use case a law enforcement agent such as a first police officer wears a portable wireless camera. The first officer makes a routine traffic stop and starts recording video via the portable wireless camera. The camera transmits its video to a hub device which is located in the first officer s squad car. The hub receives video collected from the first officer s portable wireless camera and transmits the video to a CUD that connects to a wireless communication uplink. The communication uplink transfers the video data stream to the police station where a second officer views the live video stream in real time. The CUD in the squad car acts as a router between the hub in the squad car and the police station. The RTSP connection to the hub is routed through the CUD and is used to provide users with real time interactive access to the video.

Unfortunately transmission of the camera s video data to the hub becomes interrupted and the second officer viewing the live video stream experiences a frozen frame for for example 30 seconds. After 30 seconds the second officer experiences live video stream again. When the routine traffic stop concludes by the first officer the second officer recalls the stored video from the routine traffic stop. This time when the second officer views the event there is no frozen frame or gap or break in the video stream and the entire event is available for viewing.

During the routine traffic stop the camera recorded live video data or first video record database of video stored the video data in a storage device located within and transmitted the video data to the hub. When the interruption of transmitting this video data to the hub occurred for seconds software or the first software application located in the hub of the officer s squad car monitored the wireless channel between the camera and the hub to determine when it was restored. When that channel was again robust and able to support video data transmission the software read lost video data during the time when communication was disrupted from the storage device located on the camera and saved it within the camera video previously stored at the hub. The video data was then stored in a manner such that when reviewed later the camera video data was continuous and without interruption thus the second video record database of video.

Initially the second officer and or the remote client via the second software application is able to view the live video data in real time or the first video record database of video both of which may contain gaps or breaks in the video stream. At a later time the second officer and or the remote client via the second software application is able to view the entire event or second video record database of video without gaps or breaks. This entire event second video record database of video is controlled by the first software application. In one embodiment the second officer remote client may watch either the live video first video or the entire event second video after the entire event second video becomes available. In another embodiment the second officer remove client may only watch the entire event second video after it becomes available.

While the specification has been described in detail with respect to specific embodiments of the invention it will be appreciated that those skilled in the art upon attaining an understanding of the foregoing may readily conceive of alterations to variations of and equivalents to these embodiments. These and other modifications and variations to the present invention may be practiced by those of ordinary skill in the art without departing from the spirit and scope of the present invention. Furthermore those of ordinary skill in the art will appreciate that the foregoing description is by way of example only and is not intended to limit the invention. Thus it is intended that the present subject matter covers such modifications and variations.

