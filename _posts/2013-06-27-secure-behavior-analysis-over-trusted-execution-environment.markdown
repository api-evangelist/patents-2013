---

title: Secure behavior analysis over trusted execution environment
abstract: Systems and methods for recognizing and reacting to malicious or performance-degrading behaviors in a mobile device include observing mobile device behaviors in an observer module within a privileged-normal portion of a secure operating environment to identify a suspicious mobile device behavior. The observer module may generate a concise behavior vector based on the observations, and provide the vector to an analyzer module in an unprivileged-secure portion of the secure operating environment. The vector may be analyzed in the unprivileged-secure portion to determine whether the mobile device behavior is benign, suspicious, malicious, or performance-degrading. If the behavior is found to be suspicious, operations of the observer module may be adjusted, such as to perform deeper observations. If the behavior is found to be malicious or performance-degrading behavior the user and/or a client module may be alerted in a secure, tamper-proof manner.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09319897&OS=09319897&RS=09319897
owner: QUALCOMM Incorporated
number: 09319897
owner_city: San Diego
owner_country: US
publication_date: 20130627
---
This application claims the benefit of priority to U.S. Provisional Patent Application No. 61 755 171 entitled Secure Behavior Analysis over Trusted Execution Environment filed Jan. 22 2013 and U.S. Provisional Application No. 61 683 274 entitled System Apparatus and Method for Adaptive Observation of Mobile Device Behavior filed Aug. 15 2012 the entire contents of both which are hereby incorporated by reference for all purposes.

Cellular and wireless communication technologies have seen explosive growth over the past several years. This growth has been fueled by better communications hardware larger networks and more reliable protocols. Wireless service providers are now able to offer their customers an ever expanding array of features and services and provide users with unprecedented levels of access to information resources and communications. To keep pace with these service enhancements mobile electronic devices e.g. cellular phones tablets laptops etc. have become more powerful and complex than ever. This complexity has created new opportunities for malicious software software conflicts hardware faults and other similar errors or phenomena to negatively impact a mobile device s long term and continued performance and power utilization levels. Accordingly identifying and correcting the conditions and or mobile device behaviors that may negatively impact the mobile device s long term and continued performance and power utilization levels is beneficial to consumers.

The various aspects include methods devices and systems for adaptive observations of behavior features of mobile devices in order to efficiently identify prevent and or correct the conditions and or mobile device behaviors that often degrade a mobile device s performance and or power utilization levels over time. An aspect includes a method for observing mobile device behaviors over a period of time to recognize mobile device behaviors inconsistent with normal operation patterns. This method may include observing a mobile device behavior in an observer module in a privileged normal portion of a secure operating environment to identify a suspicious mobile device behavior generating a concise behavior vector in the privileged normal portion based on the observations sending the concise behavior vector to an analyzer module in an unprivileged secure portion of the secure operating environment e.g. sending the vector across a secure protection boundary and or storing the vector in a secure buffer and analyzing the concise behavior vector in the unprivileged secure portion to determine whether the mobile device behavior is benign suspicious malicious or performance degrading. In an aspect the method may further include guiding further observations of mobile device behavior based on whether the observed mobile device behaviors is determined to be suspicious which may include communicating with the observer module to request deeper observation of a suspicious behavior. In an aspect the method may further include alerting the user of the device and or a client module of identified malicious or performance degrading behavior in a secure tamper proof manner. In an aspect observing a mobile device behavior in an observer module in a privileged normal portion of a secure operating environment to identify a suspicious mobile device behavior may include collecting behavior information from a module in an unprivileged normal portion of the secure operating environment via an instrumented API. In an aspect analyzing the concise behavior vector in the unprivileged secure portion to determine whether the mobile device behavior is benign suspicious malicious or performance degrading may include sending a result of the analysis to a client module in an unprivileged normal portion of the secure operating environment by writing the result in the secure buffer. In an aspect the method may further include sending a secure tamper proof message to the user of the mobile device alerting to the possibility of malicious or performance degrading behavior in response to determining that the mobile device behavior is malicious or performance degrading behavior.

A further aspect includes a computing device having a processor configured with processor executable instructions to perform operations of the methods described above. A further aspect includes a computing device having means for performing the functions and operations of the methods described above. A further aspect includes a non transitory processor readable storage medium having stored thereon processor executable instructions configured to cause a processor to perform operations of the methods described above.

The various aspects will be described in detail with reference to the accompanying drawings. Wherever possible the same reference numbers will be used throughout the drawings to refer to the same or like parts. References made to particular examples and implementations are for illustrative purposes and are not intended to limit the scope of the invention or the claims.

The word exemplary is used herein to mean serving as an example instance or illustration. Any implementation described herein as exemplary is not necessarily to be construed as preferred or advantageous over other implementations.

The terms computing device and mobile device are used interchangeably herein to refer to any one or all of cellular telephones smartphones personal or mobile multi media players personal data assistants PDA s laptop computers tablet computers smartbooks ultrabooks palm top computers wireless electronic mail receivers multimedia Internet enabled cellular telephones wireless gaming controllers and similar personal electronic devices that include a memory a programmable processor for which performance is important and operate under battery power such that power conservation methods are of benefit. While the various aspects are particularly useful for mobile computing devices such as smartphones which have limited resources and run on battery the aspects are generally useful in any electronic device that includes a processor and executes application programs.

Many mobile computing devices operating system kernels are organized into a user space where unprivileged code runs and a kernel space where privileged code runs . This separation is of particular importance in Android and other general public license GPL environments where code that is part of the kernel space must be GPL licensed while code running in the user space may not be GPL licensed. It should be understood that the various software components modules discussed here may be implemented in either the kernel space or the user space unless expressly stated otherwise.

The terms performance degrading and performance degradation are used herein to refer to a wide variety of undesirable mobile device operations and characteristics such as longer processing times lower battery life loss of private data malicious economic activity e.g. sending unauthorized premium SMS message operations relating to commandeering the mobile device or utilizing the phone for spying or botnet activities etc.

The various aspects provide mobile devices systems and methods for efficiently identifying classifying modeling preventing and or correcting the conditions and or mobile device behaviors that often degrade a mobile device s performance and or power utilization levels over time. By implementing actuating storing and or executing different modules or subsystems in different privilege protection domains or in different portions of a secure computing environment or trusted execution environment e.g. ARM TrustZone etc. the various aspects provide a secure and efficient system for identifying and correcting problematic mobile device behaviors that balances tradeoffs between mobile device security performance and power efficiency.

Generally the performance and power efficiency of a mobile device degrade over time. Recently anti virus companies e.g. McAfee Symantec etc. have begun marketing mobile anti virus firewall and encryption products that aim to slow this degradation. However many of these solutions rely on the periodic execution of a computationally intensive scanning engine on the mobile device which may consume many of the mobile device s processing and battery resources slow or render the mobile device useless for extended periods of time and or otherwise degrade the user experience. In addition these solutions are typically limited to detecting known viruses and malware and do not address the multiple complex factors and or the interactions that often combine to contribute to a mobile device s degradation over time e.g. when the performance degradation is not caused by viruses or malware . For these and other reasons existing anti virus firewall and encryption products do not provide adequate solutions for identifying the numerous factors that may contribute to a mobile device s degradation over time for preventing mobile device degradation or for efficiently restoring an aging mobile device to its original condition.

There are a variety of factors that may contribute to the degradation in performance and power utilization levels of a mobile device over time including poorly designed software applications malware viruses fragmented memory background processes etc. However due to the complexity of modern mobile devices it is increasingly difficult for users operating systems and or application programs e.g. anti virus software etc. to accurately and efficiently identify the sources of such problems and or to provide adequate remedies to identified problems. As a result mobile device users currently have few remedies for preventing the degradation in performance and power utilization levels of a mobile device over time or for restoring an aging mobile device to its original performance and power utilization levels.

To provide better performance in view of these facts the various aspects include mobile devices configured to intelligently and efficiently identify factors that may contribute to the degradation in performance and power utilization levels of the mobile devices over time without consuming an excessive amount of processing memory or energy resources of the mobile device.

Modern mobile devices enable their users to download and execute a variety of software applications from application download services e.g. Apple App Store Windows Store Google play etc. or the Internet. Further mobile device users now demand the capability to purchase goods send and receive communication pay bills manage bank accounts and conduct other secure or sensitive transactions on their mobile devices via downloaded applications. To meet user demands for these features mobile device operating systems now allow third party software applications to have access to many operating system components and functions that have traditionally been restricted to a small number of trusted applications processes. Due to these trends mobile devices are quickly becoming the next frontier for cyber attacks via malicious software applications Trojans and rootkits collectively malware . Such malware is increasingly being used by thieves and hackers to launch attacks on mobile devices and steal confidential information from mobile devices. Consequently any mobile device application system or module that has access to broad swaths of the mobile device such as a comprehensive behavior observation and analysis system may quickly become a target of such malware.

To meet mobile device user demands for both features and security mobile device manufacturers have developed various trusted execution environments e.g. ARM TrustZone etc. that aim to provide the mobile device users with both an open feature rich operating environment and robust security. These solutions establish a trusted execution zone in which a pre authenticated software application is provided access to privileged or restricted features operations of an operating system such as the ability to modify system files start or stop daemons create or remove users groups or override the protections of the operating system. However these solutions rely heavily on the pre authentication process and a malicious software application may simply circumvent the authentication process to gain access to a trusted zone and thus access to the privileged or restricted features operations of an operating system . In addition these solutions typically require that all information communicated to and from the pre authenticated software application be verified encrypted and or otherwise secured which may consume a significant amount of processing and energy resources of the mobile device. For these and other reasons existing solutions are not suitable for use with software systems that require frequent updates or that read write or otherwise communicate a large amount of information to and from a network server between modules or applications or across protection domains as may be required of in comprehensive mobile device behavior observation and analysis system.

To overcome these additional limitations of existing solutions the various aspects intelligently group implement actuate store and or execute different behavior observation and analysis features functions or modules in different privilege protection domains and or in different portions of a secure computing environment or a trusted execution environment to provide a secure and efficient mobile device system for identifying and correcting problematic mobile device behaviors that balances tradeoffs between the security performance and power efficiency of the mobile device.

The various aspects include a secure behavior observation and analysis system that is protected from an exploited compromised operating system spoofed observation data denial of service attacks and from the unauthorized modification or stealing of behavior information e.g. logs data models etc. . Various aspects may enable the behavior observation and analysis system to communicate securely with both the mobile device user and with a network or cloud server.

In an aspect a mobile device may be equipped with a secure computing environment having multiple privilege protection domains areas or portions. In an aspect the mobile device may be equipped with a secure computing environment organized into an unprivileged normal portion an unprivileged secure portion a privileged normal portion and a privileged secure portion.

In an aspect an observer process daemon module or sub system herein collectively referred to as a module of the mobile device may instrument or coordinate various application programming interfaces APIs at various levels of the mobile device system and collect behavior information from the instrumented APIs and generate concise behavior vectors from the collected behavior information. The observer module may constantly monitor the mobile device via a low power process background processes etc. to identify the normal operation patterns of the mobile device and or to identify behaviors that are not consistent with previously computed normal operation patterns. In an aspect the observer module may be included in a privileged normal portion of a secure computing environment or trusted execution environment of the mobile device.

In an aspect the mobile device may include an analyzer module and the observer module may be configured to communicate e.g. via a memory write operation function call etc. the collected behavior information to the analyzer module e.g. via a memory write operation etc. . The analyzer module may analyze and or classify the collected behavior information generate or update behavior vectors generate spatial and or temporal correlations based on the generated behavior vectors and information collected from various other mobile device sub systems and determine whether a particular mobile device behavior software application or process is benign suspicious malicious or performance degrading. In an aspect the analyzer module may be included in an unprivileged secure portion of a secure computing environment or trusted execution environment of the mobile device.

In an aspect the mobile device may include an actuation module and the analyzer module may communicate e.g. via a memory write operation function call etc. the results of its real time analysis operations to the actuator module. The actuation module may perform various actions or operations to correct mobile device behaviors determined to be malicious or performance degrading and or perform operations to heal cure isolate or otherwise fix identified problems. In various aspects the actuation module may be included in an unprivileged normal portion an unprivileged secure portion or a privileged normal portion of a secure computing environment or trusted execution environment of the mobile device.

In the various aspects the mobile device may include a client module configured to receive data behavior models from one or more third party network servers and communicate the received information to the observer and or analyzer modules of the mobile device. The third party servers may be maintained by one or more partner companies that have domain expertise in a particular area or technology that is relevant for identifying analyzing classifying and or reacting to mobile device behaviors but that do not have access to or knowledge of the various mobile device sub systems interfaces configurations modules processes drivers and or hardware systems required to generate effective data behavior models suitable for use by the mobile device. In an aspect the client module may be included in an unprivileged normal portion of a secure computing environment or trusted execution environment of the mobile device.

The various aspects may be implemented within a variety of communication systems such as the example communication system illustrated in . A typical cell telephone network includes a plurality of cell base stations coupled to a network operations center which operates to connect voice calls and data between mobile devices e.g. cell phones laptops tablets etc. and other network destinations such as via telephone land lines e.g. a POTS network not shown and the Internet . Communications between the mobile devices and the telephone network may be accomplished via two way wireless communication links such as 4G 3G CDMA TDMA LTE and or other cell telephone communication technologies. The telephone network may also include one or more servers coupled to or within the network operations center that provide a connection to the Internet .

The communication system may further include network servers connected to the telephone network and to the Internet . The connection between the network server and the telephone network may be through the Internet or through a private network as illustrated by the dashed arrows . The network server may also be implemented as a server within the network infrastructure of a cloud service provider network . Communication between the network server and the mobile devices may be achieved through the telephone network the Internet private network not illustrated or any combination thereof.

The network server may send lean data behavior models to the mobile device which may receive and use lean data behavior models to identify suspicious or performance degrading mobile device behaviors software applications processes etc. The network server may also send classification and modeling information to the mobile devices to replace update create and or maintain mobile device data behavior models.

The mobile device may collect behavioral state classification modeling success rate and or statistical information in the mobile device and send the collected information to the network server e.g. via the telephone network for analysis. The network server may use information received from the mobile device to update or refine the lean data behavior models or the classification modeling information to include a further targeted and or reduced subset of features.

Each of the modules may be implemented in software hardware or any combination thereof. In an aspect one or more of the modules may be implemented as software instructions executing on one or more processors of the mobile device . In various aspects the modules may be implemented within parts of the operating system e.g. within the kernel in the kernel space in the user space etc. within separate programs or applications in specialized hardware buffers or processors or any combination thereof.

In an aspect the mobile device may include secure computing environment. In an aspect the client module may be implemented in an unprivileged normal portion of the secure computing environment of the mobile device. In an aspect the behavior observer module may be implemented in a privileged normal portion of the secure computing environment. In various aspects the behavior analyzer module and or actuator module may be included in an unprivileged secure portion of the secure computing environment. In various aspects the actuation module may be in the unprivileged normal portion or the privileged normal portion of the secure computing environment.

The behavior observer module may be configured to perform cross layer observations on various mobile device modules and sub systems encompassing webkit SDK NDK kernel drivers and hardware in order to characterize the mobile device behavior.

The behavior observer module may be configured to instrument or coordinate application programming interfaces APIs at various levels modules of the mobile device and monitor observe mobile device operations and events e.g. system events state changes etc. at the various levels modules via the instrumented APIs collect information pertaining to the observed operations events intelligently filter the collected information generate one or more observations based on the filtered information and store the generated observations in a memory e.g. in a log file etc. and or send e.g. via memory writes function calls etc. the generated observations to the behavior analyzer module .

The observer module may monitor observe mobile device operations and events by collecting information pertaining to library API calls in an application framework or run time libraries system call APIs file system and networking sub system operations device including sensor devices state changes and other similar events. The observer module may also monitor file system activity which may include searching for filenames categories of file accesses personal info or normal data files creating or deleting files e.g. type exe zip etc. file read write seek operations changing file permissions etc.

The observer module may also monitor data network activity which may include types of connections protocols port numbers server client that the device is connected to the number of connections volume or frequency of communications etc. The observer module may monitor phone network activity which may include monitoring the type and number of calls or messages e.g. SMS etc. sent out received or intercepted e.g. the number of premium calls placed .

The observer module may also monitor the system resource usage which may include monitoring the number of forks memory access operations number of files open etc. The observer module may monitor the state of the mobile device which may include monitoring various factors such as whether the display is on or off whether the device is locked or unlocked the amount of battery remaining the state of the camera etc. The observer module may also monitor inter process communications IPC by for example monitoring intents to crucial services browser contracts provider etc. the degree of inter process communications pop up windows etc.

The observer module may also monitor driver statistics and or the status of one or more hardware components which may include cameras sensors electronic displays WiFi communication components data controllers memory controllers system controllers access ports timers peripheral devices wireless communication components external memory chips voltage regulators oscillators phase locked loops peripheral bridges and other similar components used to support the processors and clients running on the mobile computing device.

The observer module may also monitor one or more hardware counters that denote the state or status of the mobile computing device and or mobile device sub systems. A hardware counter may include a special purpose register of the processors cores that is configured to store a count or state of hardware related activities or events occurring in the mobile computing device.

To reduce the number of factors monitored to a manageable level in an aspect the observer module may perform coarse observations by monitoring observing an initial set of behaviors or factors that are a small subset of all factors that could contribute to the mobile device s degradation. In an aspect the observer module may receive the initial set of behaviors and or factors from a network server and or a component in a cloud service or network via the client module . In an aspect the initial set of behaviors factors may be specified in data behavior models received from the network server or cloud service network .

The behavior analyzer module may receive the observations from the observer module compare the received information i.e. observations with contextual information received from the external context information module and identify subsystems processes and or applications associated with the received observations that are contributing to or are likely to contribute to the device s degradation over time or that may otherwise cause problems on the device.

In an aspect the behavior analyzer module may include intelligence for utilizing a limited set of information i.e. coarse observations to identify behaviors processes or programs that are contributing to or are likely to contribute to the device s degradation over time or that may otherwise cause problems on the device. For example the behavior analyzer module may be configured to analyze information e.g. in the form of observations collected from various modules e.g. the observer module client module etc. learn the normal operational behaviors of the mobile device generate one or more behavior vectors based the results of the comparisons and compare the generated behavior vectors to one or more behavior modules to determine whether a particular mobile device behavior software application or process is performance degrading malicious benign or suspicious.

When the analyzer module determines that a behavior software application or process is malicious or performance degrading the analyzer module may notify the actuator module which may perform various actions or operations to correct mobile device behaviors determined to be malicious or performance degrading and or perform operations to heal cure isolate or otherwise fix the identified problem.

When the analyzer module determines that a behavior software application or process is suspicious the analyzer module may notify the behavior observer module which may adjust the adjust the granularity of its observations i.e. the level of detail at which mobile device behaviors are observed and or change the behaviors that are observed based on information received from the analyzer module e.g. results of the real time analysis operations generate or collect new or additional behavior information and send the new additional information to the behavior analyzer module for further analysis classification. Such feedback communications between the observer module and the analyzer module enable the mobile device to recursively increase the granularity of the observations i.e. make finer or more detailed observations or change the features behaviors that are observed until a source of a suspicious or performance degrading mobile device behavior is identified until a processing or battery consumption threshold is reached or until the mobile device processor determines that the source of the suspicious or performance degrading mobile device behavior cannot be identified from further increases in observation granularity. Such feedback communication also enable the mobile device to adjust or modify the data behavior models locally in the mobile device without consuming an excessive amount of the mobile device s processing memory or energy resources.

In an aspect the observer module and the analyzer module may provide either individually or collectively real time behavior analysis of the computing system s behaviors to identify suspicious behavior from limited and coarse observations to dynamically determine behaviors to observe in greater detail and to dynamically determine the level of detail required for the observations. In this manner the observer module enables the mobile device to efficiently identify and prevent problems from occurring on mobile devices without requiring a large amount of processor memory or battery resources on the device.

The client module may be configured to decode interpret evaluate combine organizing and or encode observed behavior information mobile device features and data models into a communication message suitable for transmission to the third party server and or suitable for sending to the behavior observer and analyzer modules. In various aspects the communication message may include information identifying the existence or presence of a condition on the mobile device a count or frequency of the condition an ordering of features an identified combination of events or conditions a structure or mapping expressed as a finite state machine an identification or classification e.g. benign malicious suspicious etc. of an observed mobile device features or conditions a mapping of suggested actions actuations to mobile device features or conditions recommendations for performing further observation actions and other similar information. The communication message may also include a request for further observation a request for behavior logs and a request for actuation.

In an aspect when the behavior analyzer module determines that a behavior software application or process is suspicious the behavior analyzer module may notify the client module which may format and send the behavior information to the network server and or a component in a cloud service or network for further analysis and use in generating future models. The network server may be configured to generate or update its data behavior models by performing executing and or applying machine learning and or context modeling techniques to the behavior information and or results of behavior analyses provided by many mobile devices. Thus the network server may receive a large number of reports from many mobile devices and analyze consolidate or otherwise turn such crowd sourced information into useable information particularly focused behavior models that can be used or accessed by all mobile devices. In this manner many mobile devices can instantly benefit from the behaviors and conclusions of other mobile devices.

The unprivileged normal portion may include software applications an application framework runtime libraries a secure buffer module and a client module . In an aspect the unprivileged normal portion may also include an actuation module . The secure buffer module may be configured to enable communication between various logical components and across protection domains portions.

In an aspect the secure buffer module may be configured so that any module in any protection domain portion may write to its memory but only modules in the secure portions may read the information stored in the memory. For example the secure buffer module may be configured so that the behavior observer module the behavior analyzer module and the partner services module may write to its memory but only the behavior analyzer module and the partner services module may read from its memory.

The unprivileged secure portion may include a behavior system API module a behavior model module a log summary module and a behavior analyzer module . In an aspect the unprivileged secure portion may further include a partner services module that includes a secure virtual private network VPN module and an encryption decryption module . In an aspect the unprivileged secure portion may also include a secure buffer for display which may be suitable for communicating security encrypted information generated in the unprivileged secure portion to an electronic display or display subsystem of the computing device. In an aspect the unprivileged secure portion may be configured so that buffer control may be transferred directly to the display subsystem not illustrated .

The privileged normal portion may include a high level operating system HLOS kernel and secure infrastructure . The HLOS kernel may include a kernel API module a drivers module and a behavior observer module which may include a secure buffer . The secure infrastructure may include a secure channel driver module and a secure operating system or trusted execution environment driver module . In an aspect the privileged normal portion may also include an actuation module . In an aspect the secure buffer may include or share a memory with the secure buffer .

The privileged secure portion may include a monitor module a secure operation system or trusted execution environment module and a secure services library module . In an aspect the privileged secure portion may also include a secure buffer for display .

In an aspect the mobile device may further include a secure file system not illustrated suitable for long term and secured storage of data and behavior models. In an aspect the secure file system may be configured to store longer term data in encrypted form. In an aspect the secure file system may be configured to store behavior model that are updated infrequently.

In an aspect the mobile device may further include a secure communication link not illustrated in suitable for communicating with a network server and or a component in a cloud service or network . The secure communication link may be configured to support sending and receiving behavior models to and from an external server which may be achieved in the unprivileged secure portion via the partner services module . For example the secure VPN module may receive encrypted behavior models from a network server the encryption decryption module may decrypt the received behavior models in the unprivileged secure portion and send the decrypted behavior models to the client module in the unprivileged normal portion .

The application framework runtime libraries kernel APIs and drivers may each include an instrumented API which may be used by the behavior observer module to collect behavior information from each respective module . Further since these module and are situated in the normal portions of the secure system behavior information may be sent from components in the unprivileged normal portion to the behavior observer module in the privileged normal portion with minimal latency and without consuming a significant amount of the processing and battery resources of the mobile device. In addition by situating the behavior observer module in the privileged normal portion as opposed to the unprivileged portion the behavior observer module is protected from unauthorized access by user level software applications which may be malicious buggy or otherwise contribute to the performance degradation of the mobile device.

The behavior analyzer module may analyze and or classify the collected behavior information and determine whether a particular mobile device behavior software application or process is benign suspicious malicious or performance degrading. The analyzer module may send feedback to the behavior observer module via the behavior system API .

As another example if the behavior analyzer module determines that a behavior software application or process is suspicious the behavior analyzer module may notify the client module which may format and send behavior information e.g. information received from the log summary module to the network server and or a component in a cloud service or network for further analysis and use in generating future models.

In an aspect the behavior analyzer module may be configured to communicate directly and securely with a user of the mobile device by writing information to the secure buffer for display thereby bypassing the traditional user interface for rendering output on the electronic display. Thus if a malicious application or process infiltrates the system and takes control of the mobile device display user interface or display subsystem the behavior analyzer module may still notify the user of the presence or existence of the malicious application.

In an aspect the behavior analyzer module may be configured to notify the client module when it determines that a mobile device behavior is suspicious and the client module may initiate the processes of encrypting formatting and sending behavior information e.g. information received from the log summary module to the network server and or a component in a cloud service or network for further analysis.

The software levels of the system may be broken down into a client level a secure virtual environment a middleware level and a hardware level . Client level software may include general mobile device software applications and trusted mobile applications which may be pre authorized software provided by a third party or which is identified as complying with specific security and or operability requirements.

The secure virtual area may be a software level or run time environment established on a mobile device. The secure virtual area may be established using a single application or a group of applications. The secure virtual environment may contain a secure broker that acts as a gate keeper for the secure virtual environment and controls the operation of data and mobile applications received from the non secure area .

The secure broker may allow application designers to create mobile applications that can operate in the secure virtual environment . In this manner application designers need not interact with the third party entity directly to produce or provide applications to mobile devices. That is an application designer may create a mobile application that meets the security requirements of the secure virtual environment independent of the corporate entity.

A mobile device user may attempt to download or access the mobile application stored in a non secure area. In response the secure broker may determine if the mobile application meets the security and operability requirements for the specific secure virtual environment established on the mobile device. Should the mobile application meet the security and operability requirements the mobile application may be allowed to operate in the secure virtual environment and be provided to the trusted mobile application environment . The trusted mobile application environment may be an area of the secure virtual environment including a GUI in which the authorized applications operate. Should the mobile application not meet the requirements of the secure broker the mobile application may be restricted from further interactions with the secure virtual environment .

Additionally the secure virtual environment may include a security and storage management system that interacts with the trusted mobile application environment and the key management system to provide necessary security and storage capability.

An unsecure operating system may be provided on the mobile device in a non secure area and a non secure memory may be provided in a non secure area . A mobile application that does not meet the requirements of the secure broker may only operate in the unsecure operating system and may only write or read data to the non secure memory .

Provided in the secure area of the mobile device may be a secure operating system and a secure memory . Trusted mobile applications may be provided to the trusted mobile application environment . Trusted mobile applications or mobile applications that meet the requirements of the secure broker may be provided to the secure operating system through the trusted mobile application environment . Only applications in the trusted mobile application environment interact with the secure operating system and the secure memory . In the aspect illustrated in the non secure memory the secure memory and the key provisioning system reside at the hardware level .

The policy manager broker may enable the corporate entity to update security protocols update operating restrictions and perform various functions in the secure virtual environment and the secure area of the mobile device. The policy manager broker gives the corporate entity the ability to remotely update and control the secure virtual environment and secure area of the mobile device.

The software levels of the system may be broken down into a client level a secure virtual environment a middleware level and a hardware level .

Similar to the aspects discussed above the client level software includes mobile or standard applications and trusted mobile applications also called simply trusted applications. Trusted mobile applications may be applications specifically provided by the corporate entity that may be identified as meeting security requirements and authorized to handle corporate entity data and to operate on the corporate entity s networks and equipment. Trusted mobile applications may be specific applications designed for the corporate entity or public applications that the corporate entity has previously established as meeting security requirements and operability requirements.

Similar to the aspects discussed above the secure virtual area may be a software level or run time environment established on a mobile device. The secure virtual area may be established using a single application or a group of applications. The secure virtual environment may contain a secure broker that acts as a gate keeper for the secure virtual environment and controls the operation of data and mobile applications received from the non secure area .

Similar to the aspects discussed above the secure broker may allow application designers to create mobile applications that can operate in the secure virtual environment . In this manner application designers need not interact with the corporate entity directly to produce applications and provide applications to mobile devices. An application designer may create a mobile application that meets the security requirements of the secure virtual environment independent of the corporate entity.

Similar to the aspects discussed above a mobile device user may attempt to download or access the mobile application stored in a non secure area. In response the secure broker may determine if the mobile application meets the security and operability requirements for the specific secure virtual environment established on the mobile device. Should the mobile application meet the security and operability requirements the mobile application may be allowed to operate in the secure virtual environment and be provided to the trusted mobile application environment . The trusted mobile application environment may be an area of the secure virtual environment including a GUI in which the authorized applications operate. Should the mobile application not meet the requirements of the secure broker the mobile application may not be allowed to interact further with the secure virtual environment .

Additionally the secure virtual environment may include a security and storage management system that interacts with the trusted mobile application environment and the key management system to provide necessary security and storage capability.

An operating system may be provided on the mobile device in both a non secure area and a secure area . The single operating system interacts with the secure virtual environment through the trusted mobile application environment and mobile applications in a non secure area . The operating system may be configured such that a mobile application that does not meet the requirements of the secure broker may only function in a non secure area of the operating system and may only write or read data to the non secure memory . The operating system may also operate in the secure area of the mobile device and read and write data to a secure memory .

Trusted mobile applications may be provided to the trusted mobile application environment . Either trusted mobile applications or mobile applications that meet the requirements of the secure broker may be provided to the operating system through the trusted mobile application environment . Only applications in the trusted mobile application environment interact with the secure memory through the operating system . In the aspect illustrated in the non secure memory the secure memory and the key provisioning system reside at the hardware level .

The policy manager broker may enable the corporate entity to update security protocols update operating restrictions and perform various functions in the secure virtual environment and the secure area of the mobile device. The policy manager broker gives the corporate entity the ability to remotely update and control the secure virtual environment and secure area of the mobile device.

The observer mode module may receive control information from various sources which may include an analyzer unit e.g. the analyzer module described above with reference to and or an application API. The observer mode module may send control information pertaining to various observer modes to the adaptive filter module and the high level behavior detection module .

The adaptive filter module may receive data information from multiple sources and intelligently filter the received information to generate a smaller subset of information selected from the received information. This filter may be adapted based on information or control received from the analyzer module or a higher level process communicating through an API. The filtered information may be sent to the throttle module which may be responsible for controlling the amount of information flowing from the filter to ensure that the high level behavior detection module does not become flooded or overloaded with requests or information.

The high level behavior detection module may receive data information from the throttle module control information from the observer mode module and context information from other components of the mobile device. The high level behavior detection module may use the received information to perform spatial and temporal correlations to detect or identify high level behaviors that may cause the device to perform at sub optimal levels. The results of the spatial and temporal correlations may be sent to the behavior vector generator which may receive the correlation information and generate a behavior vector that describes the behaviors of particular process application or sub system. In an aspect the behavior vector generator may generate the behavior vector such that each high level behavior of a particular process application or sub system is an element of the behavior vector. In an aspect the generated behavior vector may be stored in a secure buffer . Examples of high level behavior detection may include detection of the existence of a particular event the amount or frequency of another event the relationship between multiple events the order in which events occur time differences between the occurrence of certain events etc.

In the various aspects the observer module may perform adaptive observations and control the observation granularity. That is the observer module may dynamically identify the relevant behaviors that are to be observed and dynamically determine the level of detail at which the identified behaviors are to be observed. In this manner the observer module enables the system to monitor the behaviors of the mobile device at various levels e.g. multiple coarse and fine levels . The observer module may enable the system to adapt to what is being observed. The observer module may enable the system to dynamically change the factors behaviors being observed based on a focused subset of information which may be obtained from a wide verity of sources.

As discussed above the observer module may perform adaptive observation techniques and control the observation granularity based on information received from a variety of sources. For example the high level behavior detection module may receive information from the throttle module the observer mode module and context information received from other components e.g. sensors of the mobile device. As an example a high level behavior detection module performing temporal correlations might detect that a camera has been used and that the mobile device is attempting to upload the picture to a server. The high level behavior detection module may also perform spatial correlations to determine whether an application on the mobile device took the picture while the device was holstered and attached to the user s belt. The high level behavior detection module may determine whether this detected high level behavior e.g. usage of the camera while holstered is a behavior that is acceptable or common which may be achieved by comparing the current behavior with past behaviors of the mobile device and or accessing information collected from a plurality of devices e.g. information received from a crowd sourcing server . Since taking pictures and uploading them to a server while holstered is an unusual behavior as may be determined from observed normal behaviors in the context of being holstered in this situation the high level behavior detection module may recognize this as a potentially threatening behavior and initiate an appropriate response e.g. shutting off the camera sounding an alarm etc. .

The various aspects may provide cross layer observations on mobile devices encompassing webkit SDK NDK kernel drivers and hardware in order to characterize system behavior. The behavior observations may be made in real time.

The observer module may perform adaptive observation techniques and control the observation granularity. As discussed above there are a large number i.e. thousands of factors that could contribute to the mobile device s degradation and it may not be feasible to monitor observe all of the different factors that may contribute to the degradation of the device s performance. To overcome this the various aspects dynamically identify the relevant behaviors that are to be observed and dynamically determine the level of detail at which the identified behaviors are to be observed.

In determination block the mobile device processor may determine whether suspicious behaviors or potential problems can be identified and corrected based on the results of the behavioral analysis. When the mobile device processor determines that the suspicious behaviors or potential problems can be identified and corrected based on the results of the behavioral analysis i.e. determination block Yes in block the processor may initiate a process to correct the behavior and return to block to perform additional coarse observations.

When the mobile device processor determines that the suspicious behaviors or potential problems cannot be identified and or corrected based on the results of the behavioral analysis i.e. determination block No in determination block the mobile device processor may determine whether there is a likelihood of a problem. In an aspect the mobile device processor may determine that there is a likelihood of a problem by computing a probability of the mobile device encountering potential problems and or engaging in suspicious behaviors and determining whether the computed probability is greater than a predetermined threshold. When the mobile device processor determines that the computed probability is not greater than the predetermined threshold and or there is not a likelihood that suspicious behaviors or potential problems exist and or are detectable i.e. determination block No the processor may return to block to perform additional coarse observations.

When the mobile device processor determines that there is a likelihood that suspicious behaviors or potential problems exist and or are detectable i.e. determination block Yes in block the mobile device processor may perform deeper logging observations or final logging on the identified subsystems processes or applications. In block the mobile device processor may perform deeper and more detailed observations on the identified subsystems processes or applications. In block the mobile device processor may perform further and or deeper behavioral analysis based on the deeper and more detailed observations. In determination block the mobile device processor may again determine whether the suspicious behaviors or potential problems can be identified and corrected based on the results of the deeper behavioral analysis. When the mobile device processor determines that the suspicious behaviors or potential problems can not be identified and corrected based on the results of the deeper behavioral analysis i.e. determination block No the processor may repeat the operations in blocks until the level of detail is fine enough to identify the problem or until it is determined that the problem cannot be identified with additional detail or that no problem exists.

When the mobile device processor determines that the suspicious behaviors or potential problems can be identified and corrected based on the results of the deeper behavioral analysis i.e. determination block Yes in block the mobile device processor may perform operations to correct the problem behavior and the processor may return to block to perform additional operations. Alternatively or in addition as part of operations in block the mobile device processor may configure or guide further observations of mobile device behavior based on whether the observed mobile device behaviors is determined to be suspicious. Alternatively or in addition as part of operations in block the mobile device processor may alter the user of the device and or a client module of malicious or performance degrading behavior in a secure tamper proof manner.

In a further aspect the mobile device processor may communicate with the observer module to request deeper observation of the suspicious behavior in response to determining that the mobile device behavior is suspicious. In another aspect the mobile device processor may send a secure tamper proof message to the user of the device alerting to the possibility of malicious or performance degrading behavior in response to determining that the mobile device behavior is malicious or performance degrading behavior.

In an aspect as part of blocks of method the mobile device processor may perform real time behavior analysis of the system s behaviors to identify suspicious behavior from limited and coarse observations to dynamically determine the behaviors to observe in greater detail and to dynamically determine the precise level of detail required for the observations. This enables the mobile device processor to efficiently identify and prevent problems from occurring without requiring the use of a large amount of processor memory or battery resources on the device.

In block the analyzer module may analyze the concise behavior vector in order to determine whether the observed behaviors are benign suspicious or malicious in determination block . If the analyzer module determines that the observed behaviors are benign the processor may continue observing mobile device behaviors in the observer module in block .

If the analyzer module determines that the behaviors are suspicious in block the analyzer module or another module executing in the processor may request adjustment in the type of behavior observations that are made by the observer module. For example in response to recognizing a suspicious behavior the analyzer module may communicate with the observer module to request deeper observation of the suspicious behavior.

If the analyzer module determines that the behaviors are malicious in block the analyzer module or another module executing in the processor may use a secure pepper proof method to alert the user of the mobile device and or a client module executing in the mobile device. This operation in block may involve sending a result of the analysis to the client module in an unprivileged normal portion of the secure operating environment by writing the result in a secure buffer. When the user is notified the operation in block may involve sending a secure tamper proof message to the user of the device alerting to the possibility of malicious or performance degrading behavior in response to determining that the mobile device behavior is malicious or performance degrading behavior.

The operations in method may be executed continuously such that observations of the mobile device behaviors continue even as behavior vectors are analyzed by the analyzer module and further actions are taken in response.

The various aspects may be implemented on a variety of mobile computing devices an example of which is illustrated in in the form of a smartphone. A smartphone may include a processor coupled to internal memory a display and to a speaker. Additionally the smartphone may include an antenna for sending and receiving electromagnetic radiation that may be connected to a wireless data link and or cellular telephone transceiver coupled to the processor . Smartphone typically also include menu selection buttons or rocker switches for receiving user inputs.

A typical smartphone also includes a sound encoding decoding CODEC circuit which digitizes sound received from a microphone into data packets suitable for wireless transmission and decodes received sound data packets to generate analog signals that are provided to the speaker to generate sound. Also one or more of the processor wireless transceiver and CODEC may include a digital signal processor DSP circuit not shown separately .

Portions of the aspect methods may be accomplished in a client server architecture with some of the processing occurring in a server such as maintaining databases of normal operational behaviors which may be accessed by a mobile device processor while executing the aspect methods. Such aspects may be implemented on any of a variety of commercially available server devices such as the server illustrated in . Such a server typically includes a processor coupled to volatile memory and a large capacity nonvolatile memory such as a disk drive . The server may also include a floppy disc drive compact disc CD or DVD disc drive coupled to the processor . The server may also include network access ports coupled to the processor for establishing data connections with a network such as a local area network coupled to other broadcast system computers and servers.

The processors may be any programmable microprocessor microcomputer or multiple processor chip or chips that can be configured by software instructions applications to perform a variety of functions including the functions of the various aspects described below. In some mobile devices multiple processors may be provided such as one processor dedicated to wireless communication functions and one processor dedicated to running other applications. Typically software applications may be stored in the internal memory before they are accessed and loaded into the processor . The processor may include internal memory sufficient to store the application software instructions.

The foregoing method descriptions and the process flow diagrams are provided merely as illustrative examples and are not intended to require or imply that the steps of the various aspects must be performed in the order presented. As will be appreciated by one of skill in the art the order of steps in the foregoing aspects may be performed in any order. Words such as thereafter then next etc. are not intended to limit the order of the steps these words are simply used to guide the reader through the description of the methods. Further any reference to claim elements in the singular for example using the articles a an or the is not to be construed as limiting the element to the singular.

The various illustrative logical blocks modules circuits and algorithm steps described in connection with the aspects disclosed herein may be implemented as electronic hardware computer software or combinations of both. To clearly illustrate this interchangeability of hardware and software various illustrative components blocks modules circuits and steps have been described above generally in terms of their functionality. Whether such functionality is implemented as hardware or software depends upon the particular application and design constraints imposed on the overall system. Skilled artisans may implement the described functionality in varying ways for each particular application but such implementation decisions should not be interpreted as causing a departure from the scope of the present invention.

The hardware used to implement the various illustrative logics logical blocks modules and circuits described in connection with the aspects disclosed herein may be implemented or performed with a general purpose processor a digital signal processor DSP an application specific integrated circuit ASIC a field programmable gate array FPGA or other programmable logic device discrete gate or transistor logic discrete hardware components or any combination thereof designed to perform the functions described herein. A general purpose processor may be a multiprocessor but in the alternative the processor may be any conventional processor controller microcontroller or state machine. A processor may also be implemented as a combination of computing devices e.g. a combination of a DSP and a multiprocessor a plurality of multiprocessors one or more multiprocessors in conjunction with a DSP core or any other such configuration. Alternatively some steps or methods may be performed by circuitry that is specific to a given function.

In one or more exemplary aspects the functions described may be implemented in hardware software firmware or any combination thereof. If implemented in software the functions may be stored as one or more instructions or code on a non transitory computer readable medium or non transitory processor readable medium. The steps of a method or algorithm disclosed herein may be embodied in a processor executable software module that may reside on a non transitory computer readable or processor readable storage medium. Non transitory computer readable or processor readable storage media may be any storage media that may be accessed by a computer or a processor. By way of example but not limitation such non transitory computer readable or processor readable media may include RAM ROM EEPROM FLASH memory CD ROM or other optical disk storage magnetic disk storage or other magnetic storage devices or any other medium that may be used to store desired program code in the form of instructions or data structures and that may be accessed by a computer. Disk and disc as used herein includes compact disc CD laser disc optical disc digital versatile disc DVD floppy disk and blu ray disc where disks usually reproduce data magnetically while discs reproduce data optically with lasers. Combinations of the above are also included within the scope of non transitory computer readable and processor readable media. Additionally the operations of a method or algorithm may reside as one or any combination or set of codes and or instructions on a non transitory processor readable medium and or computer readable medium which may be incorporated into a computer program product.

The preceding description of the disclosed aspects is provided to enable any person skilled in the art to make or use the present invention. Various modifications to these aspects will be readily apparent to those skilled in the art and the generic principles defined herein may be applied to other aspects without departing from the spirit or scope of the invention. Thus the present invention is not intended to be limited to the aspects shown herein but is to be accorded the widest scope consistent with the following claims and the principles and novel features disclosed herein.

