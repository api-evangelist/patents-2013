---

title: Broadcast receiving terminal and program execution method for resource reservation
abstract: Under a resource manager, unexpected blocking is prevented without calling a handler for resolving a resource contention, by assigning a priority level depending on the program that has requested for a reservation of a resource as well as by assigning a special priority level which permits a reservation of a resource without any conditions in the case of a program which is urgently needed such as an EAS module.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08745632&OS=08745632&RS=08745632
owner: Panasonic Corporation
number: 08745632
owner_city: Osaka
owner_country: JP
publication_date: 20130528
---
This application is a continuation application of U.S. application Ser. No. 11 421 126 filed May 31 2006 now issued U.S. Pat. No. 8 677 368 which claims the benefit of U.S. Provisional Application No. 60 685378 filed May 31 2005 the contents of which are herein incorporated by reference in its entirety.

The present invention relates to a broadcast receiving terminal in particular to a setup for facilitating viewing video audio and data such as a program by receiving a broadcast wave with which contents made up of video audio and data such as a program which are mutually synchronized are multiplexed as well as a setup for overcoming the case where a contention of a resource such as a tuner occurs between the contents.

Various contents are included in a broadcast wave sent from a broadcast station. Aside from video and audio used in a normal TV show there are cases where data is included in the contents. There are several methods for sending the data which can be roughly divided into a method of sending the data chronologically and a method of repeatedly sending the data per set interval. In the former method of sending the data chronologically for example data that continues over the course of time is sent in sequential order. This method is suitable for sending large amounts of data over a long period of time but there is a drawback in that data that could not be received due to timing of the send cannot be received again. On the other hand in the later method of repeatedly sending the data at a set interval the same data is repeatedly sent any number of times during a fixed period. This method has an advantage in that during the period when the same data is being sent any one of the repeatedly sent pieces of data can be received and thus the timing of receiving is not limited. Data broadcast represented by BML and file sending through DSMCC data carousel are the examples of this method. It is unknown particularly in broadcast when a recipient will select a channel and commence reception. In the method of sending the data chronologically when the start of reception falls behind the timing of the sending and acquisition of the data fails the data cannot be re acquired. Therefore when sending data such as an application program along with video and audio in the broadcast wave the method of repeatedly sending the data per set interval is favorable.

At present specifications for receiving a broadcast wave that includes video audio and an application program and executing the application program in synchronization with video and audio as in the above method have been developed and are in operation. It is possible to receive the sent application program load the application program into a broadcast receiving terminal hereinafter to be simply referred to as terminal or terminal apparatus and implement various extra functions by executing the application program rather than simply viewing the video and audio. This method for sending the application program and importing the application program into the terminal is also called downloading . For example a specification called Digital Video Broadcasting Multimedia Home Platform DVB MHP ETSIES201812 v1.1.1 2003 12 has been developed in Europe and operations according to this specification have already commenced. In addition Open Cable Application Platform OCAP which provides the same specification in the cable broadcast environment in the United States is being developed in the United States and actual operations are set to commence. In these specifications the application program is written in the Java language. Various Application Programming Interfaces APIs for tuning graphics display and the like are provided in the terminal and the Java application program can control those functions by calling the APIs.

In addition in North America the OCAP DVROC SP OCAP DVR I01 040524 specification which is aimed at adding a function for recording and reproducing the contents in the OCAP specification is being developed. With this specification the video audio and the Java application program synchronized therewith are executed which are sent as a cable television broadcast are recorded as contents and furthermore are reproduced in the same manner as when the recorded contents are directly reproduced from the broadcast wave. The application program is reproduced in synchronization with the video and audio in the same manner as direct reproduction from the broadcast wave.

Moreover with OCAP DVR trick play of the contents is realized by recording broadcast contents to a high speed random accessible storage medium such as a hard disk a semiconductor memory and the like. Here the trick play refers to functions for reproducing the contents at an arbitrary speed from an arbitrary position and so on such as fast forward rewind slow motion pause skip and the like. With OCAP DVR the application program imported into the terminal from the broadcast wave can control the recording and trick play of the contents. In other words APIs for recording and trick play are provided in the terminal and the Java application program controls each function by calling those APIs.

Normally in order that the application program is executed in synchronization with the video and audio control information for the synchronization is already multiplexed in the broadcast wave. The application program is sequentially executed according to the synchronization control information and is terminated. Thus it is possible to execute the application program by switching the program to an appropriate one in accordance with a specific scene of video and audio.

The OCAP and OCAP DVR standards provide for the case where a contention between resources such as tuners and AV encoders occurs between the application programs and defines a framework of invoking a handler previously registered by a privileged application program or a framework that is based on priorities held by the application programs aiming to overcome such case.

As has been described above the OCAP and OCAP DVR standards provide for the case where a contention of a resource such as a tuner and an AV encoder occurs between the application programs and defines a framework of invoking a handler previously registered by a privileged application program or a framework that is based on priorities held by the application programs aiming to overcome such case. Even in the case where the contention of a resource occurs the resources are appropriately assigned to the application programs according to the framework.

In the case of invoking the handler previously registered by a privileged application program in order to solve a contention of a resource there is a possibility that the call may be blocked by a wait of user s input or the like. Though being blocked there normally should be no problems but in the case where a forced tuning has to be executed for notifying the user of an alert by an Emergency Alert System EAS when the call is blocked by the handler the notification to the user may be delayed.

In order to solve the above problem in the case of emergency such that the forced tuning has to be executed in order to inform the user of the EAS alert the handler that may block shall not be invoked even though the handler is previously registered by the privileged application program.

The present invention is therefore conceived in view of the above mentioned problems and provides a broadcast receiving terminal which can promptly execute forced tuning so as to inform the user of an alert without destroying the conventional framework for solving the problem of resource contention and without unexpected blocking upon invoking a resource contention handler already registered by a privileged Java program even in the case where forced tuning is caused by EAS.

In one embodiment of the disclosure there is a broadcast receiving terminal comprising a processor a program executioner configured to control execution of a program via the processor according to a priority level of the program a resource contention detector configured in a case where a reservation of a resource is requested according to the execution of the program performed by said program executioner to detect via the processor whether or not a contention of the resource occurs due to a fact that the requested resource has already been reserved by another program executed by said program executioner a resource reservation program determiner configured when the contention occurs via the processor to i when the program requesting the reservation of the resource is not a program having a highest priority level call a resource contention handler for resolving the contention in the case where the resource contention handler is registered and determine to permit a program according to a priority level returned from the resource contention handler and determine to permit the program to reserve the resource which is under contention according to the priority level of the program in the case where the resource contention handler is not registered and ii when the program has the highest priority level determine to permit the program having the highest priority level to reserve the resource which is under contention without imposing any conditions or any resource contention handler and a resource reservation program notifier configured to notify of the reservation of the resource to the program which is permitted to reserve the resource via the processor based on the determination made by said resource reservation program determiner.

In another embodiment of the disclosure there is a program execution method for executing a program in a broadcast receiving terminal comprising controlling via a processor execution of a program according to a priority level of the program detecting via the processor when a reservation of a resource is requested according to the execution of the program performed by processor whether or not a contention of the resource occurs due to a fact that the requested resource has already been reserved by another program executed by said processor determining via the processor when the contention occurs to i when the program requesting the reservation of the resource is not a program having a highest priority level call a resource contention handler for resolving the contention in the case where the resource contention handler is registered and determine to permit a program to reserve the resource which is under contention according to a priority level returned from the resource contention handler and determine to permit the specified program to reserve the resource which is under contention according to the priority level of the program in the case where the resource contention handler is not registered and ii when the program has the highest priority level determine to permit the program having the highest priority level to reserve the resource which is under contention without imposing any conditions or any resource contention handler and notifying via the processor of the reservation of the resource to the program which is permitted to reserve the resource based on the determination made by said processor.

In one aspect of the disclosure the processor includes a program executioner to perform the controlling a resource contention detector to perform the detecting a resource reservation program determiner to perform the determining and a resource reservation program notifier to perform the notifying.

Note that the present invention can be realized not only as such broadcast receiving terminal but also as a method of executing a program in the broadcast receiving terminal and as a program for the broadcast receiving terminal and even as a computer readable storage medium such as a CD ROM in which the program is stored.

With the broadcast receiving terminal and the program execution method according to the present invention it is possible to rapidly execute a forced tuning so as to notify the user of an alert without destroying the conventional framework for solving the problem of resource contention and without unexpected blocking upon invoking a resource contention handler already registered by a privileged Java program even in the case where forced tuning is caused by EAS.

As further information about technical background to this application the disclosure of U.S. Provisional Application No. 60 685 378 filed May 31 2005 including specification drawings and claims is incorporated herein by reference in its entirety.

Hereafter a broadcast receiving terminal and a program execution method according to the first embodiment of the present invention will be described with reference to the drawings. In the present embodiment a cable television broadcast system is described as an example. In the cable television broadcast system the broadcast receiving terminal apparatus of the present invention is for instance a broadcast recording and reproduction apparatus and is generally called a terminal apparatus.

The broadcast station side system sends information such as video audio data for data broadcast in a broadcast signal to a plurality of terminal apparatuses. The broadcast signal is sent using a frequency within a frequency band set by operational regulations of the broadcast system and the laws of a country region in which the broadcast system is operated and so on.

With the cable system according to the present embodiment the frequency band used in broadcast signal transmission is divided into the data content and transmission direction inbound outbound and then applied. is a chart indicating one example of the division of the frequency band. The frequency band is roughly divided into two types Out Of Band abbr. OOB and In Band. 5 MHz to 130 MHz is assigned as OOB and is mainly used in in bound out bound data exchange between the broadcast station side system and the terminal apparatus A the terminal apparatus B and the terminal apparatus C. 130 MHz to 864 MHz is assigned as In Band and is mainly used in an outbound only broadcast channel that includes video audio. QPSK modulation scheme is used with OOB and QAM64 or QAM256 modulation type is used with In Band. Modulation scheme technology is generally known and of little concern to the present invention and therefore detailed description is omitted. is one example of a more detailed use of the OOB frequency band. 70 MHz to 74 MHz is used in outbound data sending from the broadcast station side system and all of the terminal apparatus A the terminal apparatus B and the terminal apparatus C receive the same data from the broadcast station side system . On the other hand 10.0 MHz to 10.1 MHz is used in inbound data sending from the terminal apparatus A to the broadcast station side system 10.1 MHz to 10.2 MHz is used in inbound data sending from the terminal apparatus B to the broadcast station side system and 10.2 MHz to 10.3 MHz is used in inbound data sending from the terminal apparatus C to the broadcast station side system . Through this it is possible to independently send unique data from each terminal apparatus A B and C to the broadcast station side system . is one example of use of the In Band frequency band. 150 MHz to 156 MHz and 156 MHz to 162 MHz are assigned to a TV channel 1 and a TV channel 2 respectively and thereafter TV channels are assigned at 6 MHz intervals. Radio channels are assigned in 1 MHz units from 310 MHz on. Each of these channels may be used as analog broadcast or as digital broadcast. In the case of transmitting digital broadcast a TS packet format based on the MPEG 2 specifications is used for the transmission and it is also possible to send data for various data broadcast and TV show composition information for configuring EPG in addition to audio and video.

The broadcast station side system uses the frequency bands described above to send an appropriate broadcast signal to the terminal apparatuses and therefore has a QPSK modulation unit a QAM modulation unit and so on. In addition the broadcast station side system has a QPSK demodulator for receiving data from the terminal apparatuses. Moreover the broadcast station side system can be thought of as having various devices related to the modulation units and the demodulation unit. However the present invention relates mainly to the terminal apparatuses and therefore detailed descriptions are omitted.

The terminal apparatuses A B and C have a QAM demodulation unit and a QPSK demodulation unit in order to receive and reproduce a broadcast signal from the broadcast station side system . In addition each terminal apparatus has a QSPK modulation unit in order to send the data unique to the apparatus to the broadcast station system side . In the present invention the terminal apparatuses are broadcast recording and reproduction apparatuses and detailed configurations will be described later.

The broadcast station side system modulates an MPEG 2 transport stream and transmits the stream within the broadcast signal. The terminal apparatuses receive the broadcast signal demodulate the broadcast signal so as to reproduce the MPEG 2 transport stream extract necessary information wherefrom and use the extracted information. In order to describe a device function and connection structure present in the terminal apparatus the structure of the MPEG 2 transport stream will be first described in a simple manner.

TS packets that have identical PIDs hold identical types of information. Therefore the terminal apparatus reproduces video and audio data such as TV show composition information by receiving multiplexed TS packets and extracting per PID the information held by the TS packet. In the TS packet and the TS packet each transmit information regarding the video and the TS packet and the TS packet each transmit information regarding the data .

Video and audio are represented by a format called a Packetized Elementary Stream PES packet. The PES packet includes video information and audio information of a certain time period and by receiving the PES packet the broadcast recording and reproduction apparatus can output the video and audio information contained in that PES packet to a screen and a speaker. The broadcast station transmits the PES packets without pause and therefore it is possible for the broadcast recording and reproduction apparatus to continuously reproduce the video and audio without pause. When the PES packet is actually transmitted the PES packet is divided and stored in the payloads of a plurality of TS packets in the case where the PES packet has a size larger than the payload of one TS packet. shows an example of the division when a PES packet is transmitted. A PES packet is too large to be stored and transmitted in a payload of a single TS packet and therefore the PES packet is divided into a PES packet division A a PES packet division B and a PES packet division C and is carried in three TS packets to which have identical PIDs. In actuality the video and audio is obtained as an elementary stream ES that is obtained by concatenating data contained in the payloads of a plurality of PES packets. The elementary stream is in the form of digitalized video and audio such as defined by the MPEG 2 Video standards the MPEG 1 and 2 Audio standards and the like.

On the other hand information such as the TV show composition information and data used for data broadcast is expressed using a format called MPEG 2 section. When the MPEG 2 section is actually transmitted the MPEG 2 section is divided and stored in the payloads of a plurality of TS packets in the case where the MPEG 2 section has a size larger than the payload of one TS packet. shows an example of the division when the MPEG 2 section is transmitted. As an MPEG 2 section is too large to be stored and transmitted in a payload of a single TS packet the MPEG 2 section is divided into a section division A a section division B and a section division C and is carried in three TS packets to which have identical PIDs.

The PES format does not exist in the case of the MPEG 2 section. For that reason the elementary stream ES is a concatenation of the payloads of the TS packets identified by the identical PIDs within the MPEG 2 transport stream. For example in all of the TS packets to in which the MPEG 2 section is divided and transmitted are identified with the PID of 200. It can be said that this is an ES which transmits the MPEG 2 section .

A concept called a program further exists in the MPEG 2 transport stream. The program is expressed as a collection of ESs and is used in the case where handling a plurality of ESs all together is desirable. With the use of the program it is possible to handle video audio as well as accompanying data broadcast data all together. For example in the case of handling together the video audio to be simultaneously reproduced by grouping the video ES and the audio ES as a program it can be seen that the broadcast recording and reproduction apparatus should simultaneously reproduce these two ESs as one TV show.

To express the program two tables called a Program Map Table PMT and a Program Association Table PAT are used in MPEG 2. Detailed descriptions can be found in the specifications of ISO IEC 13818 1 MPEG 2 Systems . The PMT and the PAT are briefly described hereafter.

The PMT is a table included in the MPEG 2 transport stream in a number as many as that of the program. The PMT is configured as an MPEG 2 section and has a table id of 2. The PMT holds a program number used in identifying the program and additional information of the program as well as information regarding an ES belonging to the program. An example of the PMT is given in is a program number. The program number is assigned uniquely to programs in the same transport stream and is used in identifying the PMT. Rows to express information regarding individual ESs. A column is a type of ES in which video sound data and so on are specified. A column is the PID of the TS packets that make up the ES. A column is additional information regarding the ES. For example the ES shown in row is an audio ES and is carried in the TS packets with a PID of 5011.

The PAT is a table of which only one is present in the MPEG 2 transport stream. The PAT is configured as an MPEG 2 section has a table id of 0 and is carried in the TS packet with a PID of 0. The PAT holds a transport stream id used in identification of the MPEG 2 transport stream and information regarding all the PMTS that represent a program in the MPEG 2 transport stream. An example of the PAT is given in indicates a transport stream id. The transport stream id is used in identifying the MPEG 2 transport stream. Rows to express information regarding the program. A column indicates a program number. A column indicates the PID of the TS packet which sends the PMT that corresponds to the program. For example the PMT of the program shown in row has a program number of 101 and the corresponding PMT is carried in the TS packet with a PID of 501.

In the case where the terminal apparatus reproduces a certain program the terminal apparatus and specifies the video and audio that make up a program with reference to the PAT and the PMT and reproduces that video and audio. For example in regards to the MPEG 2 transport stream that transmits the PAT in and the PMT in the following procedure is taken in the case where the video and audio belonging to the program with a program number of 101 are reproduced. First a PAT transmitted as an MPEG 2 section with a table id of 0 is acquired from a TS packet with a PID of 0 . The PAT is searched for a program with the program number and row is obtained. From row the PID of the TS packet which transmits the PMT of the program with a program number is obtained. Next the PMT transmitted as a MPEG 2 section with a table id of 2 is acquired from the TS packet with a PID of 501 . Row which is audio ES information and row which is video ES information are obtained from the PMT. A PID of the TS packet which transmits the audio ES is obtained from row . In addition a PID of the TS packet which transmits the video ES is obtained from row . Next an audio PES packet is acquired from the TS packet with a PID and a video PES packet is acquired from the TS packet with a PID of . Through this it is possible to acquire the video and audio ES packets to be reproduced and the video and audio which make up the program number can be reproduced.

Note that there are cases where the MPEG 2 transport stream is scrambled. This is a setup called conditional access system. For example by scrambling the PES packets which transmit certain video audio information only specified viewers who can descramble them are able to view that video and audio information. In order to descramble them and view the video and audio a viewer must descramble using a device called a descrambler. For example in an OCAP compatible terminal apparatus a card type adapter with a built in descrambler is used. A cable television operator distributes an adapter configured to be able to descramble a specific program to each viewer and the viewer inserts that adapter into the terminal apparatus. Upon doing so the adapter descrambles the specific program based on descrambling information such as a descrambling key and contract information of each contract holder. A method of descrambling a method of obtaining the descrambling key and the like depend on the adapter and have no influence on the realization of the present invention.

Thus far simple descriptions regarding the MPEG 2 specifications have been provided hereafter detailed definitions of terminology are given. In the present invention two types of the term program exist. One is a program which appears in the MPEG 2 specifications and the other is a program referring to an assemblage of code executed by a CPU. As the former is synonymous with the term service used in the operation regulations hereafter to avoid confusion the former is called service and the latter is called simply program . Furthermore concerning the latter a program particularly written in the Java language is called a Java program .

Description has been given regarding several kinds of general information specified in the MPEG 2 specifications according to the present invention. Hereafter a hardware configuration prerequisite to the present embodiment is described.

The tuner is a device which demodulates a broadcast signal modulated and transmitted from the broadcast station side system in accordance with tuning information including a frequency prescribed by the CPU . Here the tuning information is information that can specify a frequency a modulation method and the like. An MPEG 2 transport stream obtained as a result of the demodulation performed by the tuner passes through the adapter that has a descrambling function and is sent to the TS decoder .

The TS decoder is a device which has a function to segregate PES packets and MPEG 2 sections which comply with specified conditions from the MPEG 2 transport stream based on a PID a section filter condition and so on prescribed by the CPU . In the case where a broadcast is received and a service is reproduced without recording the MPEG 2 transport stream outputted by the adapter is inputted to the TS decoder . On the other hand in the case of reproducing a service recorded in the secondary storage unit the MPEG 2 transport stream which the secondary storage unit outputs is inputted to the TS decoder . Which input to receive is controlled by the CPU .

The PES packets of the video and audio segregated by the TS decoder are outputted to the AV decoder . In addition the MPEG 2 section segregated by the TS decoder is transferred to the primary storage unit through Direct Memory Access DMA and is used by a program executed by the CPU .

The AV decoder is a device with a function to decode the encoded video ES and audio ES. The AV decoder fetches the ES from the PES packet that transmits the audio and video information sent from the TS decoder and decodes the ES. An audio signal and a video signal obtained through the decoding performed by the AV decoder are sent to the speaker and the display at the time of service reproduction but are sent to the AV encoder at the time of service recording. Which output route to take is controlled by the CPU according to an instruction from the user.

The CPU executes a program that operates in the broadcast recording and reproduction apparatus. The CPU executes a program contained in the ROM . Or the CPU also executes a program downloaded from a broadcast signal or a network and held in the primary storage unit . Or the CPU executes a program downloaded from a broadcast signal or a network and held in the secondary storage unit . The tuner TS decoder AV decoder speaker display secondary storage unit primary storage unit ROM input unit adapter AV encoder and multiplexer are controlled in accordance with the directions of the executed program. In addition the CPU is capable of controlling the adapter by communicating not only with the devices present within the terminal apparatus but also with the devices within the adapter .

The secondary storage unit is a memory apparatus the memory of which is not deleted even if the power supply to the device is interrupted. Such secondary storage unit is configured of devices e.g. a nonvolatile memory such as a FLASH ROM a Hard Disk Drive HDD a rewritable media such as a CD R and a DVD R the information of which is not deleted even if the power supply of the terminal apparatus is cut off. The secondary storage unit saves information according to an instruction from the CPU .

The primary storage unit is a device which has a function for temporarily saving information in accordance with an instruction from the CPU a DMA transmittable device and so on and is configured of a RAM or the like.

The ROM is a non rewritable memory device and to be more specific is configured of a ROM a CD ROM a DVD and the like. The program which the CPU executes is stored in the ROM .

The input unit is to be more specific configured of a front panel or a remote control receiver and accepts an input from the user. is one example of a case where the input unit is configured of the front panel. A front panel has seven buttons an up cursor button a down cursor button a left cursor button a right cursor button an OK button a cancel button an EPG button and a mode switch button . When the user presses a button an identifier of the pressed button is notified to the CPU .

The adapter is a device for descrambling a scrambled MPEG 2 transport stream sent in the In band frequency range and includes one or more descramblers. The MPEG 2 transport stream outputted by the tuner is inputted into the adapter and descrambling is carried out on the TS packet that has the PID specified by the CPU . The adapter outputs the descrambled MPEG 2 transport stream to the TS decoder .

Furthermore the adapter carries out format conversion of data sent in an OOB frequency range. The information sent in the OOB frequency range may be alert information that urgently needs to be displayed and is modulated by the QPSK modulation scheme. Regarding outbound transmission the QPSK demodulator demodulates the outgoing signal sent from the broadcast station side system and inputs a generated bit stream into the adapter . The adapter extracts information specified by the CPU from the various information included in the bit stream converts the information to a format that can be interpreted by a program that operates in the CPU and provides this to the CPU . On the other hand regarding inbound transmission the CPU inputs information to be sent to the broadcast station side system into the adapter . The adapter converts the information inputted from the CPU to a format that can be interpreted by the broadcast station side system and inputs this to the QPSK modulator . The QPSK modulator QPSK modulates the information inputted from the adapter and sends this to the broadcast station side system .

A Cable CARD formerly called a Point of Deployment POD used in the United States cable system can be given as a specific example of the adapter .

The AV encoder encodes the audio signal decoded by the AV decoder into audio in the MPEG audio format and encodes the video signal into video in the MPEG video format. The video and audio encoded by the AV encoder are outputted to the multiplexer .

The multiplexer is a device with a function for multiplexing the video and audio inputted from the AV encoder into an MPEG 2 transport stream.

An operation in which the broadcast recording and reproduction apparatus described above records a service contained in a broadcast wave into the secondary storage unit and an operation where the broadcast recording and receiving apparatus consecutively reads out from the secondary storage unit and reproduces the service is hereafter described in detail.

First the operation in which the service contained in the broadcast wave is recorded into the secondary storage unit is described.

First the tuner performs tuning on the broadcast wave in accordance with tuning information prescribed by the CPU . Here the tuning information is information that can specify a frequency a modulation method and the like. The tuner demodulates the broadcast wave and inputs the MPEG 2 transport stream into the adapter .

The descrambler which is within the adapter descrambles from the MPEG 2 transport stream based on conditional access information for each viewer. The descrambled MPEG 2 transport stream is inputted into the TS decoder.

Two types of devices that process the MPEG 2 transport stream are present within the TS decoder the PID filter and the section filter .

The PID filter extracts from the inputted MPEG 2 transport stream a TS packet that has a PID specified by the CPU and then extracts a PES packet and an MPEG 2 section present in that payload. For example when the MPEG 2 transport stream in is inputted in the case where the CPU has instructed PID filtering which extracts the TS packet with a PID 100 packets and are extracted then concatenated and thus a PES packet of a video is reconfigured. Or when the MPEG 2 transport stream in is inputted in the case where the CPU has instructed PID filtering which extracts the TS packet with a PID 200 packets and are extracted then concatenated and thus an MPEG 2 section of data is reconfigured.

The section filter extracts from among the inputted MPEG 2 sections the MPEG 2 section which conforms to a section filter condition specified by the CPU and DMA transfers this MPEG 2 section to the primary storage unit . For example the CPU specifies to the section filter PID filtering which extracts the TS packet with a PID 200 and section filtering which extracts a section with a table id of 64. As mentioned earlier after the MPEG 2 section of the data is reconfigured the section filter extracts only the section with a table id of 64 from among those MPEG 2 sections and DMA transfers this to the primary storage unit .

A video PES packet and an audio PES packet extracted by the TS decoder are inputted into the AV decoder .

The AV decoder decodes the video PES packet so as to convert it into video and inputs the video into the AV encoder . The AV decoder also decodes the audio PES packet so as to convert it into audio and inputs the audio into the AV encoder .

The AV encoder converts the video into MPEG video and inputs this into the multiplexer . The AV encoder also converts the audio into MPEG audio and inputs this into the multiplexer .

The multiplexer multiplexes the MPEG video and MPEG audio inputted from the AV encoder with the MPEG 2 section inputted from the primary storage unit and thus generates an MPEG 2 transport stream. The generated MPEG 2 transport stream is recorded into the recording area .

The recording area is made up of all or a part of the secondary storage unit or another recording area and records the MPEG 2 transport stream that makes up a service.

Next an operation in which the service is consecutively read out from the secondary storage unit and reproduced will be described.

In the order described in the MPEG 2 transport stream recorded in the recording area is inputted into the TS decoder .

Then a video PES and an audio PES that have a PID specified by the CPU are extracted by the PID filter within the TS decoder . The extracted PES packet is inputted into the AV decoder . Or the MPEG 2 section that has a PID and a table id specified by the CPU is extracted by the PID filter and the section filter within the TS decoder . The extracted MPEG 2 section is DMA transferred to the primary storage unit .

The video PES and the audio PES inputted into the AV decoder are decoded and outputted as an audio signal and a video signal. After that the audio signal and the video signal are inputted into the display and the speaker thus reproducing the audio and the video.

Thus far an example of a hardware configuration regarding the present invention has been described. Hereafter a chief function of the present invention which is control of recording the service and trick mode control via a Java program is described.

Recording of the service in the present invention refers to recording video audio a Java program synchronization information of the Java program and so on that are contained in the service into a storage medium such as a hard disk a Blu ray Disc BD a Digital Versatile Disc DVD and a Secure Digital SD memory card. Reproduction of the service refers to execution and reproduction of the video audio and Java program recorded in the recording medium based on the synchronization information. It is required that a reproduction result of a recorded service is almost equivalent to a result of directly reproducing the service upon receiving a broadcast wave.

The OS is an Operating System Linux Windows and the like are examples. The OS is configured of a kernel for executing other sub programs such as the EPG and the Java VM a library used by the sub programs to control the constituent elements of the terminal apparatus and an EAS module . The kernel is publicly known technology and therefore the detailed description is omitted.

The library provides for example a tuning function for controlling a tuner. The library accepts from another sub program tuning information that can specify a frequency and a modulation scheme and supplies the information to the tuner . The tuner performs demodulation processing based on the provided tuning information and can pass the demodulated MPEG 2 transport stream to the TS decoder . As a result other sub programs can control the tuner through the library

Also the library provides channel information for uniquely identifying a channel. An example of the channel information is shown in . The channel information is sent using an OOB or an In band frequency range is converted into a chart format by the adapter and is stored in a temporary memory unit accessible by the library. A column is a channel identifier and is equivalent to for example a source ID as defined by SCTE65 Service Information Delivered Out Of Band For Digital Cable Television. A column is a channel name and is equivalent to a source name as defined by the same SCTE65 standard. A column is tuning information and is information which can specify a frequency a transfer rate a modulation scheme and the like that is given to the tuner . A column is a program number for specifying the PMT. For example a row is a group of service information with a channel identifier of 1 a channel name of channel a frequency of 150 MHz . . . for the tuning information and a program number of 101 .

The tuner library has a function for allowing a tuner to perform tuning at a specified frequency. The tuning information which includes a frequency and a tuner identifier are inputted from the Tuner of the Java library into the tuner library . The tuner library specifies a tuner that corresponds to the inputted tuner identifier. The tuner library outputs the inputted tuning information to the specified tuner. The tuner library refers to the tuner information stored in the secondary storage unit and specifies a tuner that corresponds to the tuner identifier.

The recording library has a function for storing into the secondary storage unit the MPEG 2 transport stream outputted from the tuner. The tuner identifier and information for specifying a recording area within the secondary storage unit are inputted from the recording manager into the recording library . The recording library refers to the tuner information stored in the secondary storage unit and specifies the tuner indicated by the inputted tuner identifier. The recording library stores the MPEG 2 transport stream outputted by the specified tuner into the inputted recording area within the secondary storage unit .

The reproduction library reproduces the MPEG 2 transport stream recorded in the recording area within the secondary storage unit . Information for specifying the recording area within the secondary storage unit is inputted from the service manager into the reproduction library via the JMF . The reproduction library outputs to the TS decoder the MPEG 2 stream data stored in the inputted recording area within the secondary storage unit . The reproduction library sends a command for reproducing AV to the AV decoder .

Note that the recording library and the reproduction library are capable of simultaneously operating for the same recording area. With such simultaneous operation it is possible to realize time shift playback which allows the reproduction library to replay from the head the record data of a certain TV program during the recording operated by the recording library . With such time shift playback it is possible for the user to view a TV show that is being recorded without waiting for the completion of the recording.

The section library outputs to another sub program the data taken out for the filter processing performed by the TS decoder . The packet ID which corresponds to the alert information is inputted from the EAS module to the section library . For example in the case where the packet IDs of the MPEG 2 transport stream are assigned as shown in the packet ID is inputted from the EAS module to the section library . The section library outputs the inputted packet ID to the TS decoder . The section library outputs the alert information outputted by the TS decoder to the EAS module

The EAS module has a function for interpreting the details of the alert information transmitted by the head end . The EAS module outputs the packet ID which corresponds to the alert information to the section library . The alert information is inputted from the section library to the EAS module . The alert information may be for example cable emergency alert defined by SCTE 18 2002 Formerly DVS208 Emergency Alert Message for Cable approved as a joint standard with CEA as ANSI 042 2002 standard. shows one example of a data format of the alert information. The alert information is made up of a header portion and a data portion . The data portion includes values such as Alert priority which indicates priority of alert Audio OOB source ID which indicates a channel identifier of a forced tuning destination and Alert message time remainin which indicates a valid time of the forced tuning.

The EAS module interprets the details of the inputted alert information and judges whether or not a forced tuning is required. As a result of the judgment in the case where a forced tuning is required the EAS module outputs to the service manager the channel identifier of the forced tuning destination and the valid time of the forced tuning.

The Java VM is a Java virtual machine which sequentially analyzes and executes programs written in the Java language. Programs written in the Java language are compiled of intermediate code called bytecode which does not depend on the hardware. The Java virtual machine is an interpreter which executes this bytecode. The Java VM executes the Java library that is written in the Java language. Details of the Java language and the Java VM are explained in publications such as Java Language Specification ISBN 0 201 63451 1 and Java Virtual Machine Specification ISBN 0 201 63451 X . In addition it is possible to call or be called by other sub programs not written in the Java language through a Java Native Interface JNI . Details regarding the JNI can be found in a publication Java Native Interface and so on.

The Java library is a library written in the Java language and is called by the Java program in order to control functions of the broadcast recording and reproduction apparatus. However there are situations where a sub program not written in the Java language such as the library of the OS is used as necessary. The Java program can use a function provided by the Java library by calling a Java Application Programming Interface API held by the Java library .

A Tuner is a Java library for controlling the In band receiving tuner of the broadcast recording and reproduction terminal. shows an internal structure of the Tuner

The Tuner is configured of a tuning control unit and a resource contention detection unit . The tuning control unit controls the In band receiving tuner . When the Java program passes tuning information to the tuner the tuning control unit uses that information to call a tuning function of the library and as a result it is possible to control an operation of the In band receiving tuner of the broadcast recording and reproduction terminal. Here the tuning information is information that can specify a frequency a modulation scheme and the like.

In the case where a reservation of a tuner hardware resource is requested the resource contention detection unit detects a tuner resource contention with another program and asks the resource contention program distinguishing unit in the resource manager to resolve the contention.

The resource contention detection unit has as a Java API a reserve tuner identifier method for requesting for a reservation of a tuner. The program calls out this method so as to request for a reservation of the tuner resource specified by a tuner identifier.

When the reserve method is called out the resource contention detection unit refers to the resource management information held by the resource management information holding unit and examines whether or not the specified tuner has already been reserved. In the case where the tuner has already been reserved by one of the programs the resource contention detection unit provides the resource contention program distinguishing unit within the resource manager with a resource identifier which identifies the tuner a priority level that depends on the requester of the tuner and a program identifier which identifies the requester of the tuner so as to request the resource contention program distinguishing unit to resolve the contention of the tuner. Here the request for a reservation of a resource such as a tuner is made by a downloaded Java program or a program that is previously incorporated into the terminal. Such Java program and terminal incorporated program shall be both referred to as program . In the case of the Java program a Java program identifier is used as a program identifier while in the case of the terminal incorporated program a program name is used as a program identifier. Also in the case where the requester of the tuner is a forced tuning from the EAS module the highest priority is given to that requester. In the case where the highest priority is given a reservation of the resource requested by the program is permitted unconditionally. For example in the case where a program that has a program identifier EAS module requests for a reservation of a tuner reserve tuner is called using a resource identifier tuner of the tuner to be reserved as an argument based on the Java method reserve provided for the Tuner for reserving a tuner. In such case providing that another program has already reserved the tuner the resource contention detection unit detects a resource contention as well as gives the resource identifier tuner the priority level and the program identifier EAS module so as to request the resource manager to resolve the resource contention.

An SF is a Java library for controlling a function of the PID filter and the section filter of the broadcast recording and reproduction terminal. When the Java program passes filter conditions such as a PID table id and the like to the SF the SF controls the PID filter and the section filter using a function of the library based on such conditions acquires an MPEG 2 section that fulfills desired filter conditions and passes the MPEG 2 section to the Java program that set filter conditions.

A DSM CC is a Java library for accessing a file system of a DSM CC object carousel. The DSM CC object carousel is included in the MPEG 2 section acquired by the SF . The DSM CC is defined by the ISO IEC13818 6 standard and is a mechanism for sending an arbitrary file using the MPEG 2 section. By using this system it is possible to send a file from a broadcast station to a terminal. A detailed method for implementing the DSM CC is of no relation to the present invention and therefore details are omitted.

An AM is an application manager that provides a function for managing the execution and termination of the Java programs contained in the service. The AM extracts a Java program multiplexed onto a channel specified by a specified MPEG 2 transport stream and causes the execution or termination of that extracted Java program in accordance with separately multiplexed synchronization information. A Java class file of the Java program is multiplexed onto the MPEG 2 transport stream based on the aforementioned DSM CC method. In addition the synchronization information of the Java program is multiplexed onto the MPEG 2 transport stream in a format called AIT. AIT is an acronym of Application Information Table as defined in chapter 10 of the DVB MHP specification ETSITS 101812 DVB MHP specification V1.0.2 and is an MPEG 2 section with a table id of 0 74 .

The AM specifies the PID and the section filter conditions of the TS packet for sending the MPEG 2 section in which data is inserted based on the DSMCC method. Here the packet ID is provided. As a result the AM can collect necessary DSMCC MPEG 2 sections. The AM reconstructs the file system from the collected MPEG 2 sections according to the DSMCC method and stores the reconstructed file system into the primary storage unit . Fetching data such as the file system from the TS packet in the MPEG 2 transport stream and saving the data into a storage means such as the primary storage unit and the secondary storage unit is hereafter called downloading.

Subsequently the AM passes to the Java VM a Java program to be executed out of the file system downloaded into the primary storage unit . Here assuming that the Java program name to be executed is a TopXlet a file a TopXlet.class resulting from the appendage of .class to the above Java program name is a file to be executed. is a division between the directories and between the file names and the file is the Java program which should be executed with reference to . Then after the AM passes the file to the Java VM the file is executed as a Java program in the Java VM.

Every time an AIT with the new AIT version is inputted the AM analyzes the AIT and changes the execution status of the Java program. Here in the case where kill is specified for the control information the AM terminates the Java program.

A JMF handles control of reproduction of the video and audio contained in the service. To be more concrete the JMF inputs the video ES and audio ES multiplexed onto the channel specified by the specified MPEG 2 transport stream into the AV decoder so that the AV decoder reproduces them. In the case of reproducing the service directly from the received broadcast wave it is specified that the MPEG 2 transport stream outputted from the adapter should be reproduced. In the case of reproducing the service that is once recorded into the secondary storage unit it is specified that the MPEG 2 transport stream outputted from the recording area within the secondary storage unit should be reproduced.

First the JMF searches for channel information in the library with a specified channel identifier as a key and obtains the program number. Next using the SF and the like the PAT is acquired from the MPEG 2 transport stream. Then the PID of a PMT that corresponds to the obtained program number is acquired from the information of the PMT. Using again the SF the actual PMT is acquired. The acquired PMT is in the format as shown in and the PIDs of elementary streams that have video and audio as stream types are written therein. When the JMF sets those PIDs in the PID filter of the TS decoder the video ES and the audio ES onto which those PIDs are multiplexed are reproduced via the AV decoder as shown in or .

In the particular case where the JMF inputs the MPEG 2 transport stream which is already recorded in the secondary storage unit the JMF can change the reproduction speed of the video and audio by changing the speed and position of reading out the MPEG 2 transport stream. Thus it is possible to perform trick play such as fast forward and skip. For example in the case where the MPEG 2 transport stream is read out at the speed twice as fast as the normal speed the video and audio are also reproduced at the speed twice as fast as the normal speed. In the case where the position of reading out the MPEG 2 transport stream is read out after a predetermined interval is skipped the video and audio will be reproduced with such skip mode operation. The JMF controls the secondary storage unit using the functions of the library and changes the speed and position of reading out the MPEG 2 transport stream. The method of performing such trick play in a high level deviates from the scope of the present invention therefore descriptions are omitted. In order that the Java program instructs on trick play the JMF provides the Java program with for example an API called setRate float factor . When the parameter factor is specified to be 1.0 reproduction is performed at the normal speed whereas when the parameter factor is specified to be 2.0 trick play with the speed twice as fast as the normal speed will be performed.

Having the channel identifier start time and end time inputted as inputs the recording manager records the service into the secondary storage unit only for the period of time between the start time and the end time which are specified. For example when the channel identifier start time and end time are specified by the EPG the recording manager waits until the start time is reached. Then when the start time is reached the recording manager starts recording the specified service and when the end time is reached the recording manager terminates the recording. The details will be described below.

When the recording start time is reached the recording manager firstly secures within the secondary storage unit a recording area for recording the MPEG 2 transport stream from the specified start time to the specified end time. A media identifier is supplied to the reserved recording area. Next with the channel identifier as a key the recording manager obtains tuning information that corresponds to the channel identifier from the channel information held by the library . After that when the tuning information is supplied to the Tuner the Tuner commences tuning. Here the tuning information is information that can specify a frequency a modulation method and the like. Then as shown in the MPEG 2 transport stream is inputted into the TS decoder via the adapter .

Next using the SF the recording manager acquires the PAT from the MPEG 2 transport stream obtained through the tuning. In addition the recording manager searches for the program number that corresponds to the specified channel identifier in the library and searches for the PID of the corresponding PMT in the PAT. After that using the SF the recording manager acquires an actual PMT and obtains all the PIDs of the ESs which constitute the specified channel. The recording manager sets the obtained PIDs in the PID filter of the TS decoder. Moreover an output destination of each hardware constituent element is set through the library so as to follow the operation of recording the service included in the broadcast wave into the secondary storage unit . Then in accordance with the flow described in all of the ESs that make up a desired channel are recorded into the reserved recording area .

After that when the specified end time is reached the recording manager stops the tuning operation of the Tuner and causes the writing of the MPEG 2 transport stream into the recording area to end. In addition a record information management table as shown in is created as management information of the MPEG 2 transport stream recorded earlier.

A service manager manages reproduction of the service within the MPEG 2 transport stream that has been recorded into the secondary storage unit or the service within the MPEG 2 transport stream inputted from the adapter .

Hereafter an operation in the case of managing reproduction of the service contained in the MPEG 2 transport stream that has already been recorded in the secondary storage unit is described. This is equivalent to reproduction of an already recorded service. In this case the service manager has the record identifier as an input. The service which is already recorded in the secondary storage unit and is specified by that record identifier is to be reproduced.

First referring to the record information management table created by the recording manager the service manager obtains the channel identifier and the media identifier of the channel to be reproduced with the specified record identifier. Then through the library the service manager instructs the secondary storage unit to output to the TS decoder the MPEG 2 transport stream specified by the obtained media identifier. In addition through the library the service manager sets the output destination of each hardware constituent element to flow through the path shown in . After that the secondary storage unit is provided to the JMF as the location of the MPEG 2 transport stream and the channel identifier of the channel to be reproduced is provided. Then through the operation described above the JMF starts reproduction of the audio and video multiplexed onto the MPEG 2 transport stream outputted from the secondary storage unit . After that the secondary storage unit is provided to the JMF as the location of the MPEG 2 transport stream and the channel identifier of the channel to be reproduced is provided. Then in accordance with the AIT multiplexed onto the MPEG 2 transport stream outputted from the secondary storage unit the AM commences execution and termination of the Java program multiplexed onto the MPEG 2 transport stream outputted from the secondary storage unit . After that reproduction of the service is continued until the end of the MPEG 2 transport stream outputted from the secondary storage unit .

On the other hand the case of managing reproduction of the service within the MPEG 2 transport stream inputted from the adapter is described hereafter. This is equivalent to reproduction of the service directly from the broadcast wave. In this case the service manager has the channel identifier of the service to be reproduced as the input.

Through the library the service manager instructs the MPEG 2 transport stream outputted from the adapter shown in to be outputted to the TS decoder . In addition through the library the service manager sets the output destination of each hardware constituent element to flow through the path shown in . After that the adapter is provided to the JMF as the location of the MPEG 2 transport stream and the channel identifier of the channel to be reproduced is provided. Then through the operation described above the JMF starts reproduction of the audio and video multiplexed onto the MPEG 2 transport stream outputted from the adapter . Furthermore the adapter is provided to the AM as the location of the MPEG 2 transport stream and the channel identifier of the channel to be reproduced is provided. Then in accordance with the AIT multiplexed onto the MPEG 2 transport stream outputted from the adapter the AM commences execution and termination of the Java program multiplexed onto the MPEG 2 transport stream outputted from the secondary storage unit . After that reproduction of the service is continued until the end of the MPEG 2 transport stream outputted from the secondary storage unit .

In the case where a resource such as a tuner is requested to be reserved the resource manager invokes a resource contention handler registered by a privileged Java program or resolves a resource contention based on the priority level of the program with reference to the resource management information so as to provide an appropriate program with a resource that is requested to be reserved.

The resource manager is configured of a resource contention program distinguishing unit a resource contention program processing unit a resource management information holding unit an end program information holding unit a resource contention handler registration unit and a resource contention handler registration privilege judgment unit .

In the case where the Tuner or the like requests for a reservation of a resource such as a tuner the resource contention program distinguishing unit invokes the resource contention handler which is registered in the resource contention handler registration unit by a privileged Java program or resolves a resource contention based on the priority level of the program with reference to the resource management information held in the resource management information holding unit and notifies the resource contention program processing unit of the program which permits the reservation of the requested resource.

The resource program processing unit notifies the program permitted to reserve the resource by the resource contention program distinguishing unit of the reservation of the resource. For the notification to the program that the tuner is reserved for example notifyReserve tuner is called using a resource identifier tuner as an argument for which the reserve is permitted based on the Java method notifyReserve for notifying that a resource is reserved.

Also the resource contention program processing unit notifies the program forced to release the resource by the resource contention program distinguishing unit of the release of the resource. For the notification to the program that the tuner is released for example notifyRelease tuner is called using a resource identifier tuner as an argument for which the release is forced based on the Java method notifyRelease for notifying that a resource is released. Note that the notifyReserve method and the notifyRelease method are call back functions to the program which has requested the reservation of a resource.

In addition the resource contention program processing unit updates based on the result the resource management information held in the resource management information holding unit and the processing program information held in the processing program information holding unit .

In the case where the program which seizes the resource has a valid time the resource contention program processing unit has a function for measuring an execution time of the program with a timer and reallocating the resource to the program from which the resource is seized after the valid time has passed. is a flowchart showing the case of reallocating the resource to the program from which the resource is seized after the valid time of the program which seizes the resource passes. In the case where the program which seizes the resource has a valid time the resource contention program processing unit holds that valid time. In the resource contention program processing unit a timer interrupt occurs at predetermined intervals S and the time indicated by the timer is updated S . For example when a program having a certain valid time is activated the timer is reset and a timer interrupt occurs every 0.1 second. When the timer interrupt occurs the time indicated at that time is updated to advance 0.1 second. In the case where the time indicated by the timer corresponds to the valid time of the program which has seized the resource S the resource contention program processing unit seizes the resource allocated for that program and notifies the program that the resource is seized by calling the notifyRelease method S as well as reallocates by the reserve method a resource to the program which had been reserving that resource before the program has seized it with reference to the processing program information held in the processing program information holding unit S . In addition the resource contention program distinguishing unit updates based on the result the resource management information held in the resource management information holding unit and the processing program information held in the processing program information holding unit S .

The resource management information holding unit holds the resource management information which associates a resource such as a tuner and an AV encoder a program which has been reserving the resource and a priority level of the program with one another.

The processing program information holding unit holds processing program information which associates the program from which the reserving resource was seized by the resource contention program processing unit with the seized resource.

The resource contention handler registration unit holds a resource contention handler for resolving a contention between the resources which has already been registered by a privileged Java program and is invoked in the case where a reservation of a resource such as a tuner and an AV encoder is requested.

In the case where a certain Java program attempts to register a resource contention handler the resource contention handler registration privilege judgment unit judges whether or not the Java program has a privilege necessary for registering a resource contention handler. In the case where the Java program is a Java program that has such privilege the resource contention handler is held in the resource contention handler registration unit . For example in order for a certain Java program to register a resource contention handler rcHandler into the resource contention handler registration unit setResourceContentionHandler rcHandler is called by the Java method setResourceContentionHandler for registering a resource contention handler. Here an array applD of the program identifiers which correspond to programs can be taken as an example of an argument of the resource contention handler rcHandler . When rcHandler applD is invoked the return value may be for example an array prioritizedApplD of the program identifiers that are sorted in the order of priority.

The EPG is an Electric Program Guide and is a function which lets a user choose a TV show to be recorded and reproduced. Normal reproduction after receiving a broadcast wave deviates from the scope of the present invention and thus descriptions are omitted.

In the case of recording a TV show the EPG displays a list of broadcasted TV shows and lets the user choose a desired TV show. is an example of a screen display for letting the user select a TV show to be recorded. A time and channels and are displayed in a grid and it is possible to check the TV shows of each channel that is recordable at each time. It is possible for the user to move a focus within the screen by using top bottom right and left cursor buttons to which are included in the input unit of the terminal apparatus . Furthermore when an OK button is pushed the TV show which is currently highlighted is selected to be recorded. The EPG acquires the channel identifier of the TV show from the library and when the TV show to be recorded is selected by the user notifies the channel identifier start time and end time of the TV show to the recording manager . Based on that information the recording manager records the TV show into the secondary storage unit .

On the other hand in the case of reproducing an already recorded TV show the EPG displays a list of the already recorded TV shows and lets the user choose a desired TV show. is an example of a screen display for causing selection of an already recorded TV show. All TV shows stored in the secondary storage unit at that point in time are listed. It is possible for the user to move a focus within the screen by using the top and bottom cursor buttons and which are included in the input unit of the terminal apparatus . Furthermore when the OK button is pushed the TV show which is currently highlighted is selected to be reproduced. The EPG acquires the record identifier of the TV show from recording manager and when the TV show to be reproduced is selected by the user notifies the service manager of the record identifier of that TV show. Based on that information the service manager reads out the TV show from the secondary storage unit and reproduces it.

The operation characteristic to the present embodiment applying the configuration as described above will be described below with reference to a flowchart.

The Java program attempting to register a resource contention handler requests the resource manager to register the resource contention handler S . The resource manager having received the request for the registration of the resource contention handler judges in the resource contention handler registration privilege judgment unit whether the Java program has a privilege necessary for registering the resource contention handler S . In the case of judging that the Java program has a privilege necessary for registering the resource contention handler the resource contention handler requested by the Java program is registered into the resource contention handler registration unit S .

When the EAS module causes a forced tuning the EAS module outputs a channel identifier and a valid time of the forced tuning to the service manager . Next with the channel identifier as a key the service manager obtains tuning information that corresponds to the channel identifier from channel information held by the library . After that the tuning information is supplied to the Tuner the Tuner commences tuning. Here the tuning information is information that can specify a frequency a modulation method and the like. In the case where the resource contention detection unit in the Tuner detects a resource contention between a forced tuning and a service that is already executed whether or not a service to be executed attributes to the forced tuning is judged S . In the case where it is judged that the service attributes to the forced tuning the priority level is forcedly set to the highest 100 S . In the case otherwise an appropriate value is set for the priority level depending on the requester of the service S . Either of the value being set the resource contention detection unit passes to the resource manager a priority level that is set a resource identifier which identifies the tuner in contention and a program identifier which identifies the requester of the tuner and requests the resource manager to resolve the resource contention S . In the resource manager in the case where the passed priority is the highest S the resource contention program distinguishing unit refers to the resource management information held in the resource management information holding unit and distinguishes the contention program which reserves the resource S . The resource contention program distinguishing unit then passes the program identifier which identifies the distinguished contention program to the resource contention program processing unit seizes a resource in contention from that contention program and notifies the contention program that the resource is seized as well as notifies the requester program that the seized resource is reserved S . Moreover the resource contention program distinguishing unit updates based on the result the resource management information held in the resource management information holding unit and the processing program information held in the processing program information holding unit S . In the case where the passed priority is not the highest in S the resource contention program distinguishing unit judges if the resource contention handler registration unit has the resource contention handler that has been registered by a privileged Java program S . In the case where such resource contention handler is registered the resource contention handler registration unit invokes the resource contention handler so as to consign the resolution of the resource contention to the resource contention handler S . In the case where such resource contention handler is not registered the resource contention program distinguishing unit refers to the resource management information held in the resource management information holding unit and distinguishes the contention program which reserves that resource S . In the case where the priority level corresponding to the distinguished contention program is compared with the priority level corresponding to the requester program and as a result the latter is higher the resource contention program distinguishing unit passes a program identifier which identifies that contention program to the resource contention program processing unit seizes a resource in contention from the contention program and notifies the contention program that the resource is seized as well as notifies the requester program that the seized resource is reserved S . In addition the resource contention program distinguishing unit updates based on the result the resource management information held in the resource management information holding unit and the processing program information held in the processing program information holding unit S . In S a program identifier which identifies the program that is deprived of the resource by the program in contention and a resource identifier which identifies that resource are held as the processing program information in an associated manner in the processing program information holding unit .

As described above even in the case where a forced tuning is caused by the EAS module the service manager sets the priority level by the requester of the resource and also the resource contention program distinguishing unit permits the program with the highest priority level to forcedly reserve the resource with priority over other programs without invoking a resource contention handler. Thus it is possible to rapidly execute a forced tuning so as to notify the user of an alert without destroying the conventional framework for solving the problem of resource contention and without unexpected blocking upon invoking a resource contention handler which is already registered by a privileged Java program.

Hereafter the broadcast receiving terminal and the program execution method according to the second embodiment of the present invention are described with reference to the drawings.

The second embodiment provides an embodiment of a different hardware configuration for realizing the first embodiment described above. The hardware configuration and the like used in the second embodiment are shown in .

In the case of a file system recorded within an MPEG 2 transport stream in a DSMCC file system the file system is converted into a file system format unique to the recording area which is in turn unique to a terminal and records the file system into the recording area .

In addition with regard to an AIT the AIT is converted into a format of an expanded record information management table as in and is recorded into the recording area . The record information management table shown in is an expanded version of the record information management table shown in items identified with the same numbers in both tables have the same meaning as those in the record information management table shown in . The descriptions are therefore omitted.

Each of rows and shows record information of one service. Each of the rows has a record identifier a channel identifier a program number a service record start time a service record end time a media identifier and a reference to an AIT information management table. The AIT information management table has a media time and an AIT version corresponding thereto. The media time is the time at the time of reproduction of the corresponding MPEG 2 transport stream and shows a position in the corresponding MPEG 2 transport stream. The AIT version number corresponds to an AIT version number in . For example record information of the service that has 001 as a record identifier has TS002 as a media identifier and when the media time indicates 00 00 00 in the referred AIT information management table the corresponding AIT version number is 1 . In the same manner when the media time indicates 00 05 00 the corresponding AIT version number is 2 and when the media time indicates 00 20 00 the corresponding AIT version number is 3 . For example at the time of reproduction of the service that has 001 as a channel identifier referring to the record information management table the MPEG 2 transport stream that is multiplexed with the video and audio specified by the media identifier of TS002 is reproduced in addition referring to the AIT information management table when the media time reaches 00 00 00 control which causes the Java program to start up or terminate is performed in accordance with the AIT with an AIT version number of 1 . In a similar manner the control which causes the Java program to start up or terminate is performed in accordance with the AIT with an AIT version number of 2 when the media time reaches 00 05 00 and in accordance with the AIT with an AIT version number of 3 when the media time reaches 00 20 00 . The actual AIT is converted as a binary file in private section format into the file system format unique to the recording area which is in turn unique to a terminal and is recorded into the recording area . The recorded file is given a unique file name by which it can be uniquely identified and which is recorded in the record information administration table as an AIT file name .

In an actual broadcast wave AITs with the same AIT version are repeatedly transmitted any number of times but in the present embodiment by detecting a change in the received AIT version only the first AIT that is updated at that point in time is recorded into the recording area .

The hardware configuration shown in differs from that in in that the section recorded in the recording area is read into the primary storage without going through the TS decoder. The media time that corresponds to the present reproduction time of the MPEG 2 transport stream read out from the recording area is searched for and the AIT and DSMCC file system corresponding to that media time are read out from the file.

Here the case of reproducing from the recording area the service corresponding to the channel identifier 001 using the AIT shown in and the record information management table shown in is taken as an example.

When the service corresponding to the channel identifier 001 is specified as a service to be reproduced each of the audio video and Java program belonging to and the service are reproduced and activated as already mentioned in the description regarding the reproduction of the service.

In the case where a media time to start the reproduction is not specified the reproduction is commenced from the media time of 00 00 00 . In other words as audio and video the MPEG 2 transport stream having a media identifier of TS002 corresponding to a record identifier of 001 is reproduced from the media time of 00 00 00 . Referring to the AIT information management table since the AIT version corresponding to the media time of 00 00 00 is 1 the AIT with the AIT version of 1 is read out from the file. Based on the details of the AIT the Java program corresponding to the program name having control information of autostart is activated.

Then the reproduction of the service continues and when the position at which the MPEG 2 transport stream corresponding to the media identifier TS002 is being reproduced indicates the media time of 00 05 00 referring to the AIT information management table since the AIT version number corresponding to the media time of 00 05 00 is 2 the Java program corresponding to the program name having control information of autostart is activated and also the Java program corresponding to the program name having control information of destroy or kill is terminated based on the AIT with the AIT version number of 2 . Here referring to the program name having control information of destroy is b MusicXlet and the program name having control information of kill is z StudyXlet therefore in the case where the Java programs corresponding to these program names are executed at the media time of 00 05 00 those Java programs are terminated.

Then the reproduction of the service continues and when the position at which the MPEG 2 transport stream corresponding to the media identifier TS002 is being reproduced indicates the media time of 00 20 00 referring to the AIT information management table the AIT version number corresponding to the media time of 00 20 00 is 3 therefore the Java program corresponding to the program name having control information of autostart is activated and also the Java program corresponding to the program name having control information of destroy or kill is terminated based on the AIT with the AIT version of 3 .

According to the second embodiment described above it is possible to combine the video and audio multiplexed by the multiplexer with the DSMCC file system and AIT file which are separately recorded in a different format so as to reproduce the service. Thus the DSMCC file system and AIT which are repeatedly transmitted any number of times through broadcast need to be recorded only for the amount equivalent to one update so that it is possible to reduce the consumption of a memory capacity in a recording area.

Hereafter the broadcast receiving terminal and the program execution method according to the third embodiment of the present invention are described with reference to the drawings.

The hardware configuration and the like used in the third embodiment are identical to the first embodiment of the present invention therefore shall be used. The constituent elements in the diagrams have the same function as those described in the first embodiment descriptions are omitted.

The software configuration according to the third embodiment is the same as the one shown in . The constituent elements other than the service manager and the resource manager have the same function as the function of the constituent elements in the software configuration according to the first embodiment therefore descriptions are omitted. The various data formats used in the third embodiment are also the same as those shown in and therefore descriptions are omitted.

The Tuner is as in the first embodiment configured of the tuning control unit and the resource contention detection unit .

As the tuning control unit has the same function as the one described in the first embodiment descriptions are omitted.

In the case where the service manager or the like requests for a reservation of a tuner hardware resource the resource contention detection unit detects a tuner resource contention with other programs and asks the resource contention program distinguishing unit within the resource manager to resolve the contention.

The resource contention detection unit has as a Java API a reserve tuner identifier method for requesting for a reservation of a tuner. The program calls out this method and requests for a reservation of the tuner resource specified by the tuner identifier.

The reserve method being called out the resource contention detection unit refers to the resource management information held by the resource management information holding unit and examines whether or not the specified tuner is already reserved. In the case where the specified tuner is already reserved by any of the programs the resource contention detection unit gives to the resource contention program distinguishing unit within the resource manager a resource identifier which identifies that tuner and a program identifier which identifies the requester of the reservation of that tuner so as to request the resource contention program distinguishing unit to resolve the contention of that tuner. The request for the reservation of a resource such as a tuner here is requested from a downloaded Java program or a program that is already incorporated into the terminal. The Java program and the terminal incorporated program shall be both referred to as program . In the case of the Java program a Java program identifier is used as a program identifier while in the case of the terminal incorporated program a program name is used as a program identifier. For example in the case where the program that has a program identifier EAS module requests for a reservation of a tuner reserve tuner is called using a resource identifier tuner of the tuner to be reserved as an argument based on the Java method reserve provided for the Tuner for reserving a tuner. In such case providing that another program has already reserved the tuner the resource contention detection unit detects a resource contention as well as gives the resource identifier tuner and the program identifier EAS module so as to request the resource manager to resolve the resource contention.

The resource manager is as in the first embodiment configured of the resource contention program distinguishing unit the resource contention program processing unit the resource management information holding unit the end program information holding unit the resource contention handler registration unit and the resource contention handler registration privilege judgment unit .

The constituent elements other than the resource contention program distinguishing unit have the same function as those described in the first embodiment descriptions are omitted.

In the case where the Tuner or the like requests for a reservation of a resource such as a tuner the resource contention program distinguishing unit calls a resource contention handler which is registered in the resource contention handler registration unit by a privileged Java program or resolves a resource contention based on the priority level of the program with reference to the resource management information held in the resource management information holding unit and notifies the resource contention program processing unit of the program which permits the reservation of the requested resource. In the case of holding the resource priority reserve program information shown in and also being requested to reserve a resource such as a tuner by the Tuner the resource contention program distinguishing unit judges whether the requester of the reservation of that resource is the program to which the reservation of that resource is permitted with reference to the resource priority reserve program information and also requests the resource contention program processing unit to allocate a resource to an appropriate program or the like.

The operation characteristic to the present embodiment applying the configuration as described above will be described below with reference to a flowchart.

The flow of the operation in the case where a Java program registers a resource contention handler into the resource contention handler registration unit in the resource manager is as same as the one described in the first embodiment therefore shall be used.

When a forced tuning is caused by the EAS module the EAS module outputs a channel identifier and a valid time of the forced tuning to the service manager . Next with the channel identifier as a key the service manager obtains tuning information that corresponds to the channel identifier from channel information held by the library . After that when the tuning information is supplied to the Tuner the Tuner commences tuning. Here the tuning information is information that can specify a frequency a modulation method and the like. In the case of detecting a tuner resource contention between the forced tuning and the service that is already executed S the resource contention detection unit passes to the resource manager a resource identifier which identifies the tuner in contention and a program identifier which identifies the requester of the tuner so as to request the resource manager to resolve the resource contention S . Then the resource contention program distinguishing unit in the resource manager refers to the held resource priority reserve program information and judges whether the requester of that resource is permitted to forcedly reserve that resource with priority over other programs S . In the case where the requester program is permitted to forcedly reserve that resource the priority level of the program is set to the highest S . In the case otherwise an appropriate value is set for the priority level which depends on the requester program of the service S . In the case where the priority level is the highest S the resource contention program distinguishing unit refers to the resource management information held in the resource management information holding unit and distinguishes the contention program which reserves that resource S . The resource contention program distinguishing unit passes a program identifier which identifies the distinguished contention program to the resource contention program processing unit seizes a resource in contention from that contention program and notifies the contention program that the resource is seized as well as notifies the requester program that the seized resource is reserved S . Moreover the resource contention program distinguishing unit updates based on the result the resource management information held in the resource management information holding unit and the processing program information held in the processing program information holding unit S . In the case where the passed priority level is not the highest in S it is judged whether the resource contention handler registration unit has the resource contention handler that has previously been registered by a privileged Java program S . In the case where such resource contention handler is registered the resource contention program distinguishing unit consigns the resolution of that resource to the resource contention handler by calling the resource contention handler S . In the case where such resource contention handler is not registered the resource contention program distinguishing unit refers to the resource management information held in the resource management information holding unit and distinguishes the contention program which reserves that resource S . In the case where the priority level corresponding to the distinguished contention program is compared with the self possessing priority level and as a result the latter is higher the resource contention program distinguishing unit passes a program identifier which identifies that contention program to the resource contention program processing unit seizes a resource in contention from the contention program and notifies the contention program that the resource is seized as well as notifies the requester program that the seized resource is reserved S . Moreover the resource contention program distinguishing unit updates based on the result the resource management information held in the resource management information holding unit and the processing program information held in the processing program information holding unit S . In S a program identifier which identifies the program that is deprived of the resource by the program in contention and a resource identifier which identifies that resource are held as the processing program information in an associated manner in the processing program information holding unit .

The flow of the operation in the case of reallocating a resource such as a tuner to the program that was reserving that resource prior to a forced tuning caused by the EAS module after the valid time of the forced tuning has elapsed is as same as the one described in the first embodiment therefore shall be used.

As described above even in the case where a forced tuning is caused by the EAS module the resource contention program distinguishing unit refers to resource priority reserve program information and also distinguishes the program that is permitted to forcedly reserve a resource with priority over other programs. Thus it is possible to rapidly execute a forced tuning so as to notify the user of an alert without destroying the conventional framework for solving the problem of resource contention and without unexpected blocking upon calling a resource contention handler which is already registered by a privileged Java program.

Some of the embodiments described above indicate embodiments of the present invention but other embodiments can be considered without deviating from the scope of the present invention.

In the embodiments a configuration for a cable system has been shown but the present invention can be applied independent of the type of broadcast system. For example the present invention can easily be applied to a satellite system a ground wave system or a TV show distribution system that uses an IP network. In addition as the present invention has no direct relationship with the differences between each broadcast system the present invention can be applied to an arbitrary transmission medium regardless of the broadcast system. The present invention is also applicable regardless of whether the system is a wired or wireless system.

It is not necessary for the AV decoder to decode video and audio at the same time. The present invention can be implemented even if the AV decoder is configured as separate video and audio decoders. In addition the AV decoder may have a decode function for data such as closed captioning and the like without any interference. The audio signal and video signal decoded by the AV decoder may be scrambled at any stage up until being stored in the recording area .

In the embodiments an example is given in which an adapter that controls conditional access system has been introduced but the adapter is not necessary for the implementation of the present invention. The adapter may be of any format and a configuration without the adapter is also possible. In such a case in the MPEG 2 transport stream from the tuner is inputted directly into the TS decoder. The present invention is applicable is such a case as well. In addition descrambling of the MPEG 2 transport stream by the adapter does not necessarily have to be carried out before the TS decoder. A configuration in which the adapter is in an arbitrary position and is used to descramble the MPEG 2 transport stream is easily implementable and the present invention is applicable in such a case as well.

Regarding an encoding format into which the AV encoder encodes the audio and video signal an arbitrary format is acceptable. The present invention is applicable regardless of the encoding format.

A multiplexing format of the multiplexer may also be an arbitrary format. The present invention is applicable regardless of the multiplexing format.

The display and the speaker may be contained within the broadcast recording and reproduction apparatus or an external display and speaker may be connected to the broadcast recording and reproduction apparatus. The present invention is applicable regardless of the location and number of the display and speaker.

The present invention can be implemented even if the CPU itself is a system which performs multiple processes the operations being all or some of TS decoding AV decoding AV encoding and multiplexing.

As a format for recording the service the MPEG 2 transport stream can also be recorded directly into the recording area after being outputted from the tuner without going through the TS decoder or the format of the MPEG 2 transport stream from the tuner can be converted by installing a translator that converts the format of the MPEG 2 transport stream and recorded into the recording area. The present invention can be implemented regardless of the service recording method.

Some of the Java virtual machines translate the bytecode into an executable form which can be interpreted by the CPU and pass the resultant to the CPU which executes it the present invention is applicable in such case as well.

The above embodiments describe a method for implementation regarding the AIT in which the transport stream is obtained from in band however the method for referring to the Java program which the AM shall execute does not solely depend on the AIT. In the OCAP which is assumed to be used in the US cable system XAIT which describes reference information of an application program is utilized in the OOB shown in . In addition methods such as starting a program pre recorded in the ROM starting a program downloaded and recorded in the secondary storage unit and so on can be considered.

Although only some exemplary embodiments of this invention have been described in detail above those skilled in the art will readily appreciate that many modifications are possible in the exemplary embodiments without materially departing from the novel teachings and advantages of this invention. Accordingly all such modifications are intended to be included within the scope of this invention.

With the broadcast receiving terminal and the program execution method according to the present invention it is possible to rapidly execute a forced tuning so as to notify the user of an alert without destroying the conventional framework for solving the problem of resource contention and without unexpected blocking upon calling a resource contention handler that is already registered by a privileged Java program. For example the present invention is applicable to cable STB digital TV and the like. Furthermore the present invention is also applicable in devices with a broadcast receiving function such as for example a cellular phone device and the like.

