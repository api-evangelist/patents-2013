---

title: Method and system for controlling message routing
abstract: A system and method for transmitting telephony messages that includes transmitting a first outgoing telephony message through a first channel using a first routing option selected from a plurality of routing options; receiving a message delivery report through at least a second channel; updating message routing data in response to the message delivery report; selecting a second routing option for at least a second outgoing message, the second routing option selected from the plurality of routing options prioritized by the updated message routing data; and transmitting a second outgoing telephony message through the first channel using the selected second routing option.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08738051&OS=08738051&RS=08738051
owner: Twilio, Inc.
number: 08738051
owner_city: San Franciso
owner_country: US
publication_date: 20130725
---
This application claims the benefit of U.S. Provisional Application Ser. No. 61 676 261 filed on 26 Jul. 2012 and U.S. Provisional Application Ser. No. 61 751 773 filed on 11 Jan. 2013 which are incorporated in their entirety by this reference.

This invention relates generally to the telephony messaging field and more specifically to a new and useful method and system for controlling message routing in the telephony messaging field.

Text messaging is one of the most widely used communication methods in the world. In recent years telephony based applications have been able to utilize text and multimedia messaging as a form of communication with users. Despite the wide use of text messaging the underlying infrastructure is complex and obfuscated. Telephony infrastructure is highly dependent on constantly changing contracts negotiations and international regulations. As a result application platforms and other parties wishing to facilitate the sending and receiving of messages in some situations do not retain control over how a message is sent. Platforms sending a message often must trust partners and other parties to deliver the message. Those partners and parties may also rely on other parties to participate in message delivery. There is little visibility into message delivery. Delivery receipts can be used to indicate if a message delivery succeeded or failed. However the delivery reports are often unreliable and cannot always be a trusted indicator of message delivery.

Additionally when sending a message in a telephony system such as sending a short message service SMS message the message is routed through multiple messaging nodes. The intermediary nodes through which the message passes may be operated by various networks may reside in arbitrary locations may have various protocols for handling messages or may impact the outcome of message routing in a number of alternative ways. In the current telephony messaging ecosystem a single party does not control the dynamics of how messages are routed. Thus the route of a message is highly dependent on multiple variable parties. Messages may be altered delayed dropped split into multiple messages suffer from character encoding issues or have any number of issues due to the message handling of an encountered node on the message s way to the destination. This makes it extremely difficult for a party wishing to send and or receive a message to ensure the integrity and reliability of communicating a message. Thus there is a need in the telephony field to create a new and useful method and system for controlling message routing. This invention provides such a new and useful method and system.

The following description of the preferred embodiments of the invention is not intended to limit the invention to these preferred embodiments but rather to enable any person skilled in the art to make and use this invention.

As shown in a method for controlling message routing of a preferred embodiment includes sending a first outgoing message through a first channel using a first routing option selected from a plurality of routing options Block S receiving a message delivery report through at least a second channel Block S updating message routing data with the message delivery report Block S selecting a second routing option for at least a second outgoing message the second routing option selected from the plurality of routing options according to an optimality assessment of the message routing data Block S. The method functions to enable real time adjustments to message routing according to feedback through a secondary channel. The first channel is typically characterized by having intermediary node to node transmissions uncontrolled by either the sender or the receiver as shown in . For example in short message system SMS transmission the method implementer preferably routes the message to one of a selection of routing options and after that initial routing node the message is routed through various nodes in route to a destination. The various intermediary nodes are typically unspecified by the transmitter. Additionally information about the routing of a message may not be exposed to the original transmitter.

The method is preferably implemented by a telephony platform with messaging support such as the telephony platform described in published U.S. Patent Application No. 2009 0252159 titled SYSTEM AND METHOD FOR PROCESSING TELEPHONY SESSIONS which is hereby incorporated in its entirety by this reference. Telephony messaging preferably includes SMS multimedia messaging service MMS image messaging animation messaging video messaging audio music messaging internet protocol IP messaging push notifications and or any suitable messaging technique. The method may alternatively or additionally apply to messaging mediums outside of the telephony field. The telephony platform preferably includes a message router responsible for sending and or receiving messages. The message router is preferably configured to have at least two routing options. The second channel is preferably a channel differing from the first channel. In one exemplary variation the first channel is a SMS message routing channel and the second channel is an internet network channel. A system implementing the method may include system components such as user feedback interface coupled to the telephony platform a link redirector a pin code API service or any other suitable feedback mechanism for capturing and communicating feedback. As the routing patterns of a routing option may vary considerably with time the method preferably obtains feedback through the second channel and responds by updating a new selected routing option in substantially real time. In some variations the feedback requires action by the receiver of the message. After feedback is acquired the selected routing option for subsequent messages may be updated appropriately.

Block S which recites at a message router sending a first outgoing message through a first channel using a routing option selected from a plurality of routing options functions to exercise the control of a sender over the routing of a message. The message router is preferably configured to have a plurality of message routing options. Routing options are preferably different initial nodes to which a message may be initially sent. The routing options may be characterized by different service providers networks geographic locations physical machines resource addresses contractual agreements communication protocols time dependent quality performance properties and or any other suitable distinguishing characteristics of message routing node. For example a message router may be configured to selectively transmit a message to one of four different service providers. Depending on the message medium and possibly the source and destination endpoints the routing options may be different channel protocols directed at different service provider destinations. For an SMS message the routing options may be SMPP connections to various service provider destinations. For an MMS message the routing option may be an SMTP connection to various service provider destinations. Depending on the used protocol the routing options of an MMS message can be SMTP connections to various service provider destinations for MM4 or alternatively they can be various service resources accessed over HTTP SOAP for MM7 . The routing options preferably include various commercial relationships between the service provider and the communication platform. As another example a message router may be configured to selectively transmit a message using a routing option selected from SMS routing options proprietary push notification routing options e.g. Apple or Google push notifications and application messaging routing options e.g. message sent to a Whatsapp user . The message router may or may not have visibility into the routing beyond the initial node. The selection of an initial node preferably functions as a fundamental point of control to the full route a message will take to arrive at a destination. In one preferred embodiment the method is preferably implemented in a continuous manner such that the first selected routing option was preferably selected according to an optimality assessment as described below for Block S. The first channel is preferably the messaging channel such as communication with a SMS or MMS gateway used to communicate the message to the destination. In some situations internal routing such as over the internet may be used to access additional routing option. There may additionally be a plurality of types of channels available for sending a message such as SMS or MMS push notifications or any suitable messaging channel. The outgoing message is preferably sent to a single destination endpoint e.g. a phone number but may alternatively be sent to a plurality of endpoints. In a variation where the outgoing message is sent to a plurality of destination endpoints Block S preferably includes receiving message delivery reports through at least a second channel for a plurality of destination endpoints.

Block S which recites receiving a message delivery report through at least a second channel functions to obtain feedback from the message destination. The message delivery report preferably indicates the status of the message at the destination endpoint and the message delivery report is preferably generated in response to the message arriving at the destination. In one variation the message delivery report indicates the success or failure of message delivery to the intended destination s . If a message is received the message delivery report will preferably indicate that the message was successfully received. The message delivery report will preferably include an indicator that the message was undelivered if the message is not received at the destination. An undelivered message delivery report is preferably sent after a specified amount of time has elapsed. The time out period is preferably the maximum satisfactory amount of time a message should take to be delivered to a destination. This timeout may additionally be dynamically adjusted based on the destination to accommodate for longer than expected delivery times. The delivery report may additionally or alternatively include other information about the message received at the destination such as message condition. Message condition preferably describes properties such as if the message was altered censored truncated encoded improperly split into multiple messages or otherwise not conforming to the original outgoing message.

The message delivery report is preferably received in near real time e.g. under a minute from a message being delivered or classified as undelivered but the message delivery report may occur at any suitable time. For example message delivery reports may be retrieved or collected at designated intervals. In an alternative variation described below the message delivery report may be collected from user feedback at a time well after the message has been received.

Preferably the delivery report is transmitted in response to an action at the destination endpoint but delivery reports may be stored and actively retrieved by the message router or any suitable system. For example the status of a message in the form of a delivery report may be an accessible resource accessed through an API. A default delivery report status may be set or assumed. For example if no message delivery report is received then the report for the transmission of the sent message may default to un received status until the delivery report is updated based on a received message.

Additionally Block S of a preferred embodiment may additionally include generating a delivery report S as shown in which functions to facilitate extracting message outcome from the destination. Generating a delivery report may include a number of various implementations. The channel of the delivery report at least in part comes through a second channel. Some exemplary approaches to collecting a delivery report may include providing a user feedback interface S redirecting internet and app links through a monitored system S providing a monitored pin code service S monitoring a user reply signal S and or using any suitable alternative technique. The different channels may be capable of collecting varying types of information of either qualitative or quantitative measures. The different channels may have varying relevance to the immediate receipt of a message integrity of a message user perceived quality of a message and other suitable qualities of a message.

As shown in a variation of the preferred embodiment may include providing a user feedback interface Block S which functions to enable reports to be filed through an application programming interface API or a visual interface. The interface preferably enables issues with the delivery of a particular message to be logged. As shown in a user may select a message and file a report. The filed report preferably updates the delivery report which in turn will be factored into the optimality assessment for future messages. Similarly reports may be filed programmatically using an API. This preferably enables developers of messaging applications to provide their own user facing interface. The API is preferably used to collect message voice and or video quality from a user e.g. a user of a service or a developer . In one variation a developer may integrate a poll during an interaction with an application preferably at the end of the interaction. The user response to the poll is then added to a delivery report using the feedback API. In another variation a developer may develop custom logic in their application to detect quality or deliverability issues. When an issue is detected the application of the developer preferably uses the API to add information to a delivery report. The API may alternatively be used in any suitable manner.

As shown in a variation of the preferred embodiment includes redirecting links through a monitored system Block S which functions to place an intermediary component capable of generating a delivery report once an action was taken for a particular message. In many situations messages may include a link to a URI app or any suitable resource and this technique can preferably be applied to such messages. When a link is detected in a message a trackable link specific for a particular message transaction is preferably generated and used in place of the original link. Alternatively a service may be provided such that the creator of the message may add the link to the message independently. The trackable link will preferably lead to a URI which when visited indicates that the message has been received and at least in part was not corrupted at least to the extent that the link was successfully visited by the recipient of the message. After visiting the trackable link the link preferably redirects the user to the original resource linked to in the message. As shown in similar variation of the preferred embodiment may include providing a monitored pin code service Block S which functions to monitor a code for user activation. This technique works in a similar manner in that it relies on a pin code being transmitted in the message and then acted upon by the user. If a user correctly acts on the pin code the message is assumed to have been received and not corrupted. This variation may be applicable in messages being used in a form of secondary verification in a login system. The pin code is preferably unique for a particular message transaction. A pin code API preferably receives a notification that the pin code has been entered and the delivery report is preferably generated for the message containing that pin code. The pin code API may additionally validate the pin code or provide any other suitable service with the pin code. But the act of being notified the pin code was entered is preferably interpreted as the message being received. As described below the variation of Blocks S and S may be applied towards an embodiment used in testing or facilitating the selecting of routing options.

As shown in another variation of the preferred embodiment includes monitoring a user reply signal Block S which functions to determine if a message was delivered based on a message response from the destination. If a message requests or necessitates a message response to the endpoint sending the message or to any other observable endpoint then the user reply signal may provide information of whether a message was delivered. Preferably this variation is employed when the sending endpoint or a reply endpoint are managed by the message routing system. For example if the operator of the method provides messaging endpoints for the sender then any communications going to that endpoint will preferably go through the message routing system. A response following the outgoing message will preferably indicate that the user received the message and that the message was understandable. There may additionally be a time window or other rules for determining when the response from the destination endpoint is associated with the outgoing message. Additionally the response may be analyzed to determine if the user understood the message e.g. the user correctly followed instructions . If the user response does not fall within an expected response pattern then the first outgoing message may not have been accurately communicated to the desired destination.

Block S which recites updating message routing data with the message delivery report functions to adjust the criteria used in selecting routing options of messages in Block S. The information included in the message delivery report is preferably added to message routing data that is preferably a record of previous delivery reports. The message routing data is preferably used to improve subsequent message routing. In other iterations of the method the sending of a message through a routing option will typically use a routing option that is preferably more optimal than the initially used routing option according to the collected delivery report. Updating the message routing data can include ranking routing options based at least in part on delivery success rates. Other properties of the routing option may additionally be considered such as price contract obligations time of day. Alternatively the message routing data may only store a limited number of delivery reports. The message routing data may be limited to data associated to messages sent in a particular time window the nth most recent outgoing messages or any suitable group of data. The message routing data may additionally include data from sources other than the delivery reports. Data or parameters from routing option contracts data from message routing infrastructure such as Signaling System No. 7 SS7 or any other resource that may be used in determining an optimality assessment. The optimality assessment mapping for optimal preferred recommended routing options may be updated on receipt of new message delivery reports but alternatively the data from delivery reports may be added to the message routing data and optimal new routing options calculated periodically when a new message requires routing or at any suitable time. The message routing data is preferably used to improve message delivery performance. In a variation described where outgoing messages are classified message routing data is preferably stored with an associative link between a message classification type and the message delivery report. This allows historical data to be filtered based on message classification.

Block S which recites selecting a second routing option for a second outgoing message the second routing option selected from the plurality of routing options according to an optimality assessment of the message routing data functions to determine a preferred way to route a message. As indicated above the selection of an initial node preferably functions as a fundamental point of control to the full node to node route a message will take to arrive at a destination. The optimality assessment is preferably a statistical computation for determining the optimal routing option for a particular destination endpoint. The optimality assessment may factor in message delivery rate delivered message quality message delivery time cost time of day message properties classification or any suitable parameter of message communication. Additionally the operator of the message router may consider additional factors in the optimality assessment. For example an operator may have various service agreements for the plurality of routing options some of which may have minimum messaging requirements that must be satisfied during a specified time period. Such data is preferably stored in the message routing data but may be stored or retrieved from any suitable source.

In a variation of the preferred method the optimality assessment may indicate a processing rule to be applied to a message for a particular routing option. For example a message may be edited split encoded into a different format translated compressed linked to through a URL or otherwise altered in any suitable manner. The processing rule is preferably applied to mitigate poor messaging performance based on historical data collected. This may be performed for particular regions or message types that historically have poor messaging performance for all routing options or perhaps could see improved deliverability if altered.

As shown in a method of a preferred embodiment may additionally or alternatively include classifying the first and second outgoing message Block S wherein the optimality assessment associated with the determined message classification is used to select the routing option. An outgoing message is preferably classified prior to selecting a routing option. For example a message may be classified as a marketing message if the message appears to be an automated solicitation as determined by natural language processing. Other classifications may include human typed message pin code message web or app link message associated media type message junk message or any other suitable message classification. Alternatively or additionally the first and second outgoing messages may be classified according to the transport properties of the message. The transport properties of a message preferably include if the source or destination use a short code long code IP messaging. Similarly a message may be classified by geographic region as detected through source or destination endpoints or detected in any suitable manner. Similarly messages may be classified according to languages or characters used in the message. The message classification preferably enables the message router to select the initial node according patterns in how types of messages are routed. The message routing data is preferably maintained such that data from a delivery report can be associated with the message classification of the associated outgoing message. In this manner routing performance may be segregated according to the type of message. If a routing option due to internal routing rules of a network or region often filters or drops particular types of messages the classification and optimality assessment will preferably elect to select a different routing option where the message will be delivered with a higher performance.

Additionally selecting a routing option of Step S may include querying destination properties S as shown in . Destination properties may indicate a geographic region of the number destination network price of messaging through a route and any suitable characteristic of the message transmission. This destination information may be collected from a service such as the telephony number mapping facility E.164 Number Mapping ENUM Home Location Register HLR or Visitor Location Register VLR . Alternatively destination and routing data may be collected during operation of the messaging system or from any suitable source. Block S may be used in combination or in cooperation with Block S.

As shown in a method of a preferred embodiment may additionally or alternatively include outputting information collected from a message delivery report Block S which functions to enable application developers using the messaging platform to act on events and information included in the message delivery reports. Outputting delivery report information may include passing information through a webhook publishing subscription channel logging triggering an event or through any suitable technique. An application will preferably integrate the outputted information into the business logic of their application to perform any suitable task. An application application developer or any suitable system can preferably use the outputted information and a plurality of entities may access the outputted information. The outputted delivery report may include all the collected information or a subset of information in the received message deliver reports. This information may include the message delivery status such as delivered undelivered corrupted truncated improper encoding or any suitable delivery status. The information may additionally or alternatively include raw information collected through the second channel such as recipient customer feedback or customer message replies. Any suitable information collected through the method may additionally or alternatively be outputted.

As shown in a method of a second preferred embodiment can include providing a messaging supported service S sending a coded identifier in a message S tracking message delivery through a processed coded identifier S and generating a score for message delivery S. The method functions to implement a service that as at least one benefit enables the testing of message communication through use of the service. The messaging supported service may be any suitable service. Typically an operator of a messaging platform will implement the service but any suitable entity may alternatively implement the method. The score reflects the operational health of messaging communication and more preferably a messaging routing option. The score is obtained through the transformation of service communication to a trackable user interaction. Some embodiments of the method in a sense transparently crowdsources communication testing to users of the messaging supported service. The score is preferably related to specific routing options and may be used in the determination of subsequent routing options such as in the method described above. The method may additionally supplement message delivery reports of the above method. Alternatively the method may be used for communication quality health analytics error detection or any suitable application.

Block S which includes providing a messaging supported service functions to implement a service that forces user interaction with a second channel as a result of a message received in a first channel. The service preferably promotes expected user behavior when a message is delivered. Typically the user behavior required to complete a request is the result of an initial user interaction with the service. For example a two factor authentication service often includes the user behavior of reading and entering in a code delivered over SMS MMS voice or other communication medium. Alternatively the user behavior may be one that a typical user feels compelled to complete based on the request of another entity. For example a user will typically view links and or media sent by a friend. If the service is a link shortening and messaging service content sent through the service can enable the tracking of message delivery. In addition to a two factor authentication service the messaging supported service may be a link shortening service a media proxying service a coupon code service an application notification service a game mechanic service e.g. virtual item collection and or any suitable service.

Block S which includes sending a coded identifier in a message functions to use a unique identifier used in detecting a completed user interaction. The coded identifier is preferably unique to a particular message. The messaging supported service preferably creates a mapping between the identifier and at least one component of the communication e.g. the routing option the communication destination message content etc. . The coded identifier may be a text or graphical code readable by a user or machine. The user will typically be required to report the text or graphical code through a second communication channel e.g. a webpage login screen or in a coupon redemption form . Similarly a code reader may scan and read the code. The coded identifier may alternatively be redirection URI. The redirection URI is a tracking URI that monitors when a user accesses the URI and also redirects a user to an original URI. The redirection URI may additionally be a shortened URI. In a similar variation the message includes a resource link that sends a user to a controlled resource. The controlled resource may be a webpage an application or any suitable resource. The controlled resource is preferably monitored and when a user accesses that resource that action can be mapped to a coded identifier associated with the communication. Any other suitable coded identifier may alternatively be used.

Block S which includes tracking message delivery through a processed coded identifier functions to identify when a coded identifier is triggered. The message delivery is preferably tracked through a communication channel that is different from the one used in transmitting the message. A coded identifier is preferably triggered when a user completes a user interaction associated with the coded identifier. The user interaction is preferably logically associated with the receipt of the sent message. So when a user completes the desired user interaction explicitly or implicitly using the coded identifier the service can determine if a message succeeded or failed in delivery. Other states of message deliverability may also be tracked such as pending message corruption delivery delay delivery error or any suitable state of message delivery. In tracking delivery delay the time between sending the message and completing the user interaction is preferably tracked. The time from sending to first interaction may have a strong correlation to speed of delivery especially in certain variations where user interaction is expected to occur immediately after message delivery.

In a variation where the service is a two factor authentication service block S includes sending an authentication code. The code is used for authenticating a user by providing some level of proof that the user has access to a particular device as is commonly done in two factor authentication. Message delivery is preferably marked as delivered if the code is correctly verified and used in authenticating the user. Message delivery is preferably marked as a failed delivery if the user does not complete authentication. Additionally message delivery may be marked with corrupted delivery encoding failure or some other error diagnosis if the code is incorrectly entered but follows patterns of a corrupted message delivery. The two factor authentication service can be extended to a coupon redemption service. The coupon service preferably delivers requested coupons to a user in an SMS or other message. The user is required to enter a code or scan a graphic to redeem the coupon.

In a variation where the service is a link shortening service block S includes converting a URI to a redirection URI. When a user clicks on the redirection URI a browser is preferably directed to the redirection URI. The redirection URI is preferably unique to that message. A message is preferably marked as successfully delivered if the redirection URI is visited. The message delivery state preferably defaults to un delivered unless the redirection URI is visited.

Block S which includes generating a score for message delivery functions to use tracked message delivery across the message supported service to determine a state of message communication. The score preferably relates to the quality of message deliverability. The message supported service can additionally selectively use different message delivery options to generate a score for particular communication options. For example the service can track what routing option is used for sending the coded identifier and message delivery is tracked for that particular routing option. Steps S and S are preferably performed a plurality of times for different users and messages during various uses of the service. The combined usage of the service enables a plurality of communication data samples. The results are preferably consolidated and used together to generate a score. With a wide variety of samples the score may be function of one or more variables such as time of day carrier originating endpoint destination endpoint origination geographic location destination geographic location message content and or any suitable communication variable. The score may be used in the determination of routing options providing communication analytics or used in any suitable application.

The above methods are preferably implemented continuously on at least a sub set of messages that are transmitted by a communication platform. In one variation not all messages provide delivery reports but at least a sub set does provide delivery reports. For example the messaging service may enable developers to programmatically send messages for any suitable use case. Of those a subset may share links or send pin codes. This subset of use cases can preferably provide routing data to inform the routing of other messages. When implemented on a multitenant communication platform this can be particularly beneficial to the various entities using the platform. Some use cases may not have the necessary message volume or coverage to generate enough data. Or a use case may not have a reasonable mechanism to obtain message delivery reports. When implemented across multiple accounts the combined message delivery reports of multiple accounts can improve route option selection. Additionally multiple techniques can be combined. For example coded identifier service can be used to contribute message delivery successes and failures as shown in a user interface can be used to obtain user feedback on the quality of the message as shown in user response monitoring can detect other forms of message delivery success and failure as shown in and or any suitable variations of the above methods can be cooperatively used.

The above methods are preferably implemented by a system that includes telephony message service a routing option database and at least an interface to communication of a second channel. The telephony message service is preferably used in transmission of messages. As described above the messages are preferably SMS or MMS but can be any suitable type of message. The telephony message is preferably enabled for programmatic transmission of messages. The telephony messages may be sent based on API requests or from application instructions. The telephony message service is preferably a multitenant service. Multiple users and multiple account holders e.g. application developers are preferably used to facilitate collection of delivery receipt confirmation. When the above methods are implemented across multiple accounts and with multiple users the routing options even a set of routing options covering various global regions can be simply checked and monitored. The routing option database preferably stores any routing option data and information to establish communication with a routing option service carrier entity. A routing service may provide an interface in front of the routing option database. The service can be used to easily determine what routing option should be used. Similarly the interface may simplify the act of providing new message delivery report data.

An alternative embodiment preferably implements the above methods in a computer readable medium storing computer readable instructions. The instructions are preferably executed by computer executable components preferably integrated with a message router. The message router is preferably part of a telephony platform and may additionally be coupled with a feedback interface a link redirector pin code API or any suitable component to facilitate message delivery feedback. The computer readable medium may be stored on any suitable computer readable media such as RAMs ROMs flash memory EEPROMs optical devices CD or DVD hard drives floppy drives or any suitable device. The computer executable component is preferably a processor but the instructions may alternatively or additionally be executed by any suitable dedicated hardware device.

As a person skilled in the art will recognize from the previous detailed description and from the figures and claims modifications and changes can be made to the preferred embodiments of the invention without departing from the scope of this invention defined in the following claims.

