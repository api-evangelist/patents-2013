---

title: Peer-to-peer communication in ad hoc wireless network
abstract: For a peer-to-peer call in an ad hoc wireless network, a wireless device performs discovery of a target wireless device, performs authentication of the target wireless device and generates a session key (e.g., using a pre-shared key or a certificate provisioned on the wireless device), forms an ad hoc wireless network with the target wireless device, and communicates peer-to-peer with the target wireless device via the ad hoc wireless network. The wireless device may perform discovery with a list of identifiers for wireless devices designated to communicate with this wireless device. The wireless device may derive a service set identifier (SSID) used to identify the ad hoc wireless network based on its user-specific identifier (e.g., its phone number) and/or a user-specific identifier for the target wireless device. Other aspects, embodiments, and features are also claimed and described.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08942133&OS=08942133&RS=08942133
owner: QUALCOMM Incorporated
number: 08942133
owner_city: San Diego
owner_country: US
publication_date: 20131101
---
The present application is a continuation of U.S. application Ser. No. 11 538 222 entitled PEER TO PEER COMMUNICATION IN AD HOC WIRELESS NETWORK filed Oct. 3 2006 and issued as U.S. Pat. No. 8 576 846 which in turn claims priority to provisional U.S. Application Ser. No. 60 724 226 entitled Methods And Devices For Peer To Peer Communication In Wireless Networks filed Oct. 5 2005 each of which is assigned to the assignee hereof and each of which is incorporated herein by reference in its entirety.

The present disclosure relates generally to communication and more specifically to techniques for supporting communication for wireless devices.

Wireless communication networks are widely deployed to provide various communication services such as voice video packet data etc. These wireless networks include wireless wide area networks WWANs that provide communication coverage for large geographic areas wireless local area networks WLANs that provide communication coverage for medium geographic areas and wireless personal area networks WPANs that provide communication coverage for small geographic areas. Different wireless networks typically have different capabilities requirements and coverage areas.

A wireless device e.g. a cellular phone may be capable of communicating with one or more wireless networks e.g. a WWAN and or a WLAN. The wireless device may also be capable of communicating peer to peer with other wireless devices. The wireless device may be invoked by a user to make a call to another wireless device. The wireless device may be located within the coverage of zero one or multiple wireless networks at the time the call is placed. From the user s perspective it is desirable for the call to be connected as quickly and efficiently as possible regardless of whether the wireless device is under the coverage of any wireless network.

There is therefore a need in the art for techniques to efficiently support communication for a wireless device.

Techniques for supporting peer to peer PTP communication between wireless devices are described herein. The techniques support communication even when WWAN and WLAN are not present. For a peer to peer call a wireless device performs discovery of a target wireless device performs authentication of the target wireless device and generates a session key e.g. using a pre shared key or a certificate provisioned on the wireless device forms an ad hoc wireless network with the target wireless device and communicates peer to peer with the target wireless device via the ad hoc wireless network. Each of the phases may be performed in various manners. This aspect may also be implemented via a method apparatus or computer program product.

In an aspect a wireless device performs discovery with a list of identifiers. The wireless device receives a frame e.g. a beacon frame or a probe request from another wireless device extracts an identifier from the received frame determines whether the extracted identifier is included in the list of identifiers and sends a response if the extracted identifier is included in the list. An identifier may be derived based on one or more phone numbers and or other identification information for one or more wireless devices. The list may include identifiers for other wireless devices designated to communicate peer to peer with this wireless device. This aspect may also be implemented via a method apparatus or computer program product.

In another aspect a wireless device performs background or active discovery to discover other wireless devices. For background discovery the wireless device may periodically send and receive frames for discovery of other wireless devices. Each frame may include an identifier for the sending wireless device. For active discovery the wireless device may periodically receive frames and may send frames only to discover a target wireless device e.g. at the start of a call . Each transmitted frame may include an identifier for the target wireless device. For both background and active discoveries the wireless device may send and or receive frames during pseudo randomly selected time intervals or fixed time intervals determined based on timing obtained from a wireless communication network e.g. a cellular network. This aspect may also be implemented via a method apparatus or computer program product.

In yet another aspect a service set identifier SSID used to identify an ad hoc wireless network is derived based on one or more user specific identifiers for one or more wireless devices e.g. a phone number for a calling wireless device and or a phone number for a called wireless device in a peer to peer call. The SSID may be used as an identifier that is included in each frame sent for discovery. This aspect may also be implemented via a method apparatus or computer program product.

In yet another aspect a wireless device performs Internet Protocol IP address discovery for a peer to peer call. The wireless device forms a packet containing a user specific identifier e.g. a phone number for a target wireless device sends the packet to request for an IP address of the target wireless device receives a response including the IP address of the target wireless device and communicates peer to peer with the target wireless device using the IP address. This aspect may also be implemented via a method apparatus or computer program product.

In yet another aspect the wireless device handles traffic data for a peer to peer call to achieve the desired performance. The wireless device ascertains quality of service QoS requirements for a peer to peer call with a target wireless device processes traffic data for the peer to peer call in accordance with the QoS requirements and sends the processed traffic data to the target wireless device. This aspect may also be implemented via a method apparatus or computer program product.

In a further aspect a wireless communication device is configured to obtain authorization for communication via a wireless network from a wireless client device of the wireless network and to communicate via the wireless network after obtaining authorization from the wireless client device. This aspect may also be implemented via a method apparatus or computer program product.

In following description WWAN is a cellular network that includes base stations that support communication for wireless devices within the coverage area of the WWAN. For simplicity only two base stations and are shown in . A base station is a station that communicates with the wireless devices. A base station may also be called and may contain some or all of the functionality of a Node B a base transceiver station BTS an access point etc. A core network couples to the base stations and provides coordination and control for the base stations. Core network may also couple to other networks e.g. a public switched telephone network PSTN a wide area network WAN such as the Internet etc.

WLAN provides communication coverage for a medium geographic area such as a mall an airport terminal a building etc. WLAN may include any number of access points that support communication for any number of stations. For simplicity only one access point is shown in . WLAN may implement the IEEE 802.11 family of standards some other WLAN standard or some other WLAN radio technology. The IEEE 802.11 family of standards covers 802.11 802.11b 802.11g and 802.11n which specify different radio technologies. As used herein Wi Fi refers to IEEE 802.11 as well as other WLAN standards and radio technologies. Access point may couple to a hub router that may support communication with a local area network LAN and or a WAN. Access point and hub router may also be combined into a single wireless router.

Wireless devices may be dispersed throughout the coverage areas of WWAN and WLAN as well as outside the coverage of these wireless networks. For simplicity only five wireless devices through are shown in . A wireless device may be stationary or mobile. A wireless device may also be called and may contain some or all of the functionality of a mobile station a user equipment a station a terminal an access terminal a subscriber unit etc. A wireless device may be a cellular phone a handheld device a personal digital assistant PDA a laptop computer a wireless modem a handset etc.

A wireless device may be capable of communicating with any number of wireless networks of any radio technologies. For example a wireless device may be capable of communicating with WWAN and or WLAN . A wireless device may thus be a WWAN device as well as a WLAN station e.g. a cellular phone with Wi Fi capabilities.

A wireless device may be able to communicate with zero one or multiple wireless networks at any moment depending on a the capabilities of the wireless device and b the location of the wireless device e.g. whether it is located within the coverage of any wireless network. In the example shown in wireless device can communicate with WWAN wireless device can communicate with WLAN wireless device can communicate with both WWAN and WLAN and wireless devices and are outside of the coverage of WWAN and WLAN .

Wireless devices with Wi Fi capabilities may be able to communicate directly with each other via ad hoc wireless networks. An ad hoc wireless network is a wireless network that may be formed on the fly as needed typically without a central controlling entity such as an access point and may be dissolved when no longer needed. An ad hoc wireless network may be formed by and may include wireless devices desiring to communicate peer to peer with one another.

Peer to peer PTP and push to talk PTT features may be supported in wireless devices using Wi Fi capabilities. PTT typically involves maintaining a connection so that communication can quickly commence when initiated by a user. The PTP and PTT features may be desirable in various scenarios. For example a family may visit a mall and each family member may go to a different store. The family members may be able to keep in touch by calling one other directly using Wi Fi. As another example a group may go on a hike where WWAN coverage is not available. The group members may be able to communicate with one another using Wi Fi.

The techniques described herein may be used for various types of call between Wi Fi enabled wireless devices. For example the techniques may be used for Voice over Internet Protocol VoIP calls data calls video calls Short Message Service SMS messaging etc.

Some of the phases may be performed in different manners depending on whether WWAN and or WLAN are present as described below.

Discovery may be performed in various manners with and without WLAN and with and without WWAN. To facilitate discovery e.g. when WLAN and WWAN are not present a wireless device may be provisioned with a list of identifiers for other wireless devices that can communicate peer to peer with this wireless device. This list may be referred to as a PTP list a buddy list etc. The provisioning of the PTP list may be done by a service provider a user and or some other entity. For example the wireless device may have a phone book of numbers for convenient dialing and all wireless numbers or just certain wireless numbers in the phone book may be included in the PTP list. The PTP list may be provisioned on the wireless device and may include all phone numbers that the user expects to communication with via peer to peer.

In one design which is referred to as background discovery a wireless device periodically sends and receives frames for discovery of other wireless devices. Each wireless device periodically sends beacon frames with each beacon frame containing an identifier for the sending wireless device. A beacon frame is a management frame that conveys certain information regarding the sending wireless device. In general an identifier may be an SSID a phone number a hash of the phone number or some other identification information. Other wireless devices in the vicinity of the sending wireless device receive the beacon frames. Each receiving wireless device extracts the identifier from each received beacon frame and compares the extracted identifier against the identifiers in its PTP list. If the extracted identifier is included in the PTP list then the receiving wireless device sends a response back to the sending wireless device. After discovery the sending and receiving wireless devices may engage in the next phase e.g. authentication if a call is initiated between the two wireless devices. The PTP list may be used to filter unwanted frames and to respond to frames from only wireless devices of interest.

A wireless device may operate in a power save mode to conserve battery power. In the power save mode the wireless device may power up periodically for a short period of time to send and or receive frames and may power down in the time between the awake periods. The wireless device may thus operate in accordance with a sleep awake cycle which is one cycle of an awake period and a sleep period.

The wireless devices are generally not synchronized in time and while in the power save mode their sleep awake cycles are likely to be different. Hence even though the wireless devices may be close by one wireless device may be asleep when another wireless device is sending a frame and vice versa. To combat unsynchronized timing the wireless devices may wake up randomly to send and or receive frames. A wireless device may use a random number generator to select when to wake up next then go to sleep and then wake up at the expiry of the randomly selected time. The amount of time for two wireless devices to discover one another may then be dependent on the awake duration and the sleep awake cycle. For example if each wireless device is awake for a 10 millisecond ms period within a sleep awake cycle of 100 ms then the two wireless devices will discover each other with high probability after seconds.

A wireless device may turn off its radio frequency RF and physical layer PHY sections during sleep time and only a processor may be awake. The processor may use a timer to trigger power up of the RF and PHY sections to send frames and to scan the wireless medium for frames from other wireless devices. The wireless device may be awake e.g. for 10 ms in a sleep awake cycle of 100 ms. All wireless devices may have the same sleep awake cycle but may not be synchronized. The 100 ms sleep awake cycle may be partitioned into ten slots with each slot having a duration of 10 ms. The wireless device knows its sleep awake cycle duration and keeps track of the ten slots in the sleep awake cycle. In a given sleep awake cycle the processor may select a random number between 0 and 9 and may turn on the RF and PHY sections in the selected slot to listen for frames from other wireless devices. If no frames are received during the selected slot the processor may turn off the RF and PHY sections. In the next sleep awake cycle the processor may again select a random number and may repeat the process. If another wireless device in the vicinity is doing the same transmit and receive processing then there is over 99 chance that the two wireless devices will discover each other in five seconds. The discovery time may be greater or less depending on the duty cycle which is the ratio of the awake duration to the sleep awake cycle duration. However this processing is background activity and power is mainly consumed during the awake time of the sleep awake cycle.

In another design which is referred to as active discovery a wireless device periodically receives frames from other wireless devices but sends frames only to discover a target wireless device e.g. when a call is made. When a user places the call the calling wireless device enters a discovery mode and broadcasts a probe request containing an identifier for a called wireless device. The calling wireless device then waits for a probe response from the called wireless device and if none is received within a predetermined amount of time sends another probe request. The calling wireless device may also continuously send probe requests through at least one sleep awake cycle because the called wireless device may be in the power save mode. The calling wireless device may send probe requests through a sufficient number of sleep awake cycles of the called wireless device in order to ensure that the called wireless device is given sufficient opportunity to receive a probe request. To cover the case in which the called wireless device is operating on a different frequency channel the calling wireless device may send probe requests for at least one sleep awake cycle on one frequency channel and if a probe response is not received switch to another frequency channel and continue to send probe requests. When the called wireless device receives a probe request and determines that the probe request is addressed to it the called wireless device sends a probe response to the calling wireless device.

With active discovery a wireless device sends probe requests only when needed e.g. when a call is made. All wireless devices are in a passive listen mode whenever they are awake. To combat unsynchronized timing a calling wireless device may send probe requests at randomly selected time intervals. Each wireless device may listen for probe requests in randomly selected time intervals.

Active and background discoveries may be enhanced by the presence of WWAN and or WLAN. The wireless devices may be able to obtain timing from the WWAN or WLAN and may use the timing to achieve time synchronization. The wireless devices may schedule their beacon frames and or probe requests based on the timing from the WWAN or WLAN. For example when a call is placed the calling wireless device may send a probe request at a predetermined time. Other wireless devices are awake at that time because of the synchronization provided by the WWAN or WLAN timing and can efficiently receive the probe request from the calling wireless device.

Discovery may also be performed with assistance from the WWAN and or WLAN if present. For example the calling wireless device may communicate with the WWAN or WLAN and may request the WWAN or WLAN to page the called wireless device. The called wireless device may respond to the WWAN or WLAN or directly to the calling wireless device.

WLAN devices may operate on different frequency channels which may be determined by regulatory agencies. For example in the United States there are 11 frequency channels in 802.11b g and 12 frequency channels in 802.11a. A wireless device may send and or receive frames on one or more frequency channels for discovery. The specific frequency channel s to use for discovery may be determined in various manners. In one design when WLAN and WWAN are not present one or more frequency channels may be configured by the service provider or user. For example the configured frequency channel s may be included in the PTP list. For background discovery the wireless device may broadcast beacon frames on each configured frequency channel e.g. by cycling through all configured frequency channels. For active discovery the wireless device may send probe requests on all configured frequency channels e.g. by cycling through all frequency channels and sending probe requests through at least one sleep awake cycle for each frequency channel.

When WWAN is present the channel selection may be controlled by the WWAN. For example the WWAN may indicate e.g. broadcast one or more specific frequency channels available for use. When WLAN is present the wireless device may operate on the same frequency channel used by the WLAN and or may operate on other frequency channel s .

An 802.11 wireless network is identified by an SSID which is the name of the wireless network. The SSID is included in certain types of frames such as beacon frames probe requests probe responses etc. A basic service set identifier BSSID is a 48 bit identifier that all wireless devices in a basic service set BSS include in the header of data frames poll frames etc. In an infrastructure BSS with an access point the BSSID is a Medium Access Control MAC address of the access point. In an independent BSS IBSS without an access point a wireless device may randomly select a BSSID.

An access point in a WLAN periodically broadcasts the SSID in beacon frames. The wireless devices can obtain the SSID from the beacon frames and use the SSID in probe requests and probe responses sent by these wireless devices. When a WLAN is not present an SSID for an ad hoc wireless network may be formed in various manners.

In one design an SSID is formed based on a user specific identifier for a sending calling wireless device. For example the SSID may be set to the phone number of the sending wireless device a hash of the phone number some other identification information etc. For this design the PTP list for a given wireless device may contain an SSID for each wireless device included in the PTP list e.g. as shown in . For background discovery the sending wireless device may periodically send beacon frames containing its SSID. Other wireless devices receive the beacon frames extract the SSID from each beacon frame compare the extracted SSID against the SSIDs included in their PTP lists and respond to the sending wireless device if there is a match.

In another design an SSID is formed based on a user specific identifier for a target called wireless device. For active discovery the sending wireless device may send probe requests containing the SSID for the target wireless device. Other wireless devices receive the probe requests extract the SSID from each probe request compare the extracted SSID against their own SSIDs and respond to the sending wireless device if there is a match. This design allows each wireless device to listen to only one SSID which is the SSID for that wireless device. Each wireless device may use its SSID to filter received frames and may respond only to frames sent with its SSID.

In yet another design an SSID is formed based on user specific identifiers for the sending and target wireless devices. For this design the PTP list for a given wireless device may contain an SSID for each wireless device included in the PTP list. For active discovery the sending wireless device may send probe requests containing the SSID for the target wireless device. The target wireless device can ascertain both the sender of the probe requests and the intended recipient based on the SSID.

Once the wireless devices discover one another an ad hoc wireless network may be formed as described in IEEE 802.11. The wireless device with the fastest clock becomes an access point for the ad hoc wireless network and transmits beacon frames that are used by other wireless device s to synchronize their timing.

Security for a peer to peer call may be achieved in various manners with and without WLAN and with and without WWAN. To facilitate security e.g. when WLAN and WWAN are not present a wireless device may be provisioned with a pre shared key PSK for each wireless device included in its PTP list e.g. as shown in . A PSK is a secret key that is shared between two wireless devices in a pair wise manner. The provisioning of the PSKs may be done by the service provider the user and or some other entity. For example a PSK for two wireless devices may be generated based on a hash of the serial numbers of these two devices passwords created for these devices etc. For a given wireless device the PSKs for all wireless devices in the PTP list are provisioned on that wireless device. The PSKs may be used for security as described below.

After completing discovery the calling and called wireless devices may perform handshake to authenticate one another and to generate session keys. The wireless devices may use the PSK for authentication as described in IEEE 802.11. The wireless devices may then use the PSK to generate a pair wise master key PMK and a group master key GMK . The wireless devices may then use the PMK and GMK to generate session keys as described in IEEE 802.11i. The wireless devices may thereafter use the session keys to encrypt traffic data exchanged during the call.

A wireless device may also be provisioned with a certificate e.g. an X.509 certificate by the service provider. The certificate may contain one or more digital signatures that may be used to authenticate information received from another entity. The certificate may also be used for security. The calling and called wireless devices may perform handshake to authenticate one another and to generate session keys using the certificate e.g. as described in IEEE 802.11i.

Security may also be achieved in other manners when the WWAN is present. In one design authentication is achieved via signaling with the WWAN using security protocols supported by the WWAN. For example the wireless devices in a peer to peer call may perform Challenge Handshake Authentication Protocol CHAP Authentication and Key Agreement AKA Session Initialization Protocol SIP authentication etc. with the WWAN. In another design the WWAN assigns the PMK and GMK to the wireless devices which may use the PMK and GMK to generate session keys. In general authentication may be performed peer to peer or via the WWAN or WLAN while encryption may be performed by the wireless devices.

A WLAN may be present but may defer to a client device in the WLAN to authenticate and or authorize another device requesting access to the WLAN or to local content. For example a user with device A may visit a location with a WLAN e.g. another user s home or a store. The user with device A may desire to make a VoIP call via the WLAN. The user with device A may be required to obtain permission from another person at the location e.g. the home owner or store manager before the WLAN will allow the VoIP call to be placed. In this case a client device of the person at the location may become a surrogate administrative network element. Device A may perform authentication with the client device and or may obtain authorization from the client device. The client device may then send a command to the network administrative element to allow device A to access the WLAN. Device A may be granted access in full or partial timer based or unrestricted etc. For example device A may be granted access just for the present VoIP call for a specific time duration for certain content etc.

A wireless device requesting access to a WLAN may not be on an administrator list of wireless devices allowed to access the WLAN. An administrator for the WLAN may be given the option to add this wireless device to the list e.g. temporarily or permanently. The wireless device may be allowed to access the WLAN after being added to the list.

The wireless devices may communicate using IP at a network layer and Ethernet at a link layer. In this case IP packets may be encapsulated in Ethernet frames which are exchanged between the wireless devices. Each wireless device uses IP addresses for exchanging IP packets and MAC addresses for exchanging Ethernet frames. Each IP packet includes a source IP address for the sending wireless device and a destination IP address for the recipient wireless device. Similarly each Ethernet frame includes a source MAC address for the sending wireless device and a destination MAC address for the recipient wireless device.

A wireless device may store the IP address and MAC address of each wireless device included in the PTP list. The wireless device may communicate with another wireless device in the PTP list using the IP address and MAC address stored in the PTP list.

A wireless device may not know the IP address and or the MAC address of another wireless device. The wireless device may obtain the IP address and or MAC address in various manners e.g. after completing the discovery and security phases.

In one design which may be used when the WLAN is present the wireless devices register with the WLAN and provide their user specific identifiers e.g. phone numbers as well as IP addresses. A server such as a domain name system DNS server or a dynamic host configuration protocol DHCP server may store the user specific identifiers and IP addresses of the registered wireless devices. When an inquiring wireless device desires the IP address of a target wireless device the inquiring wireless device queries the server with the user specific identifier for the target wireless device. The server would then return the IP address of the target wireless device. The inquiring wireless device may then obtain the MAC address of the target wireless device if needed using Address Resolution Protocol ARP . For ARP the inquiring wireless device broadcasts an ARP packet with the IP address of the target wireless device. Other wireless devices receive the ARP packet. Each wireless device determines whether the IP address included in the ARP packet is its IP address and if so responds with its MAC address.

In another design which may be used even when the WLAN is not present the inquiring wireless device uses reverse ARP R ARP to obtain the IP address of the target wireless device. In this design the inquiring wireless device broadcasts an R ARP packet containing the user specific identifier e.g. phone number for the target wireless device. The R ARP packet may be sent in a multi cast mode so that it is not restricted to the sub net in which the inquiring wireless device is located. Other wireless devices receive the R ARP packet. Each wireless device determines whether the user specific identifier included in the R ARP packet is its user specific identifier and if so responds by sending its IP address in a uni cast IP packet to the inquiring wireless device.

Once security is established for a peer to peer call and the IP and MAC addresses are resolved the wireless device may exchange signaling for call setup using SIP or some other suitable protocol. SIP is a signaling protocol for initiating modifying and terminating interactive user sessions based on IP e.g. a VoIP call . Most SIP implementations assume that there is centralized control. The peer to peer call may be set up in an ad hoc mode between the wireless devices. In the ad hoc mode SIP is supported without centralized control and enhancements for peer to peer signaling may be used.

When the WWAN is present signaling for call setup and teardown may be sent via the WWAN. When the WLAN is present discovering security data connectivity etc. may be performed via the WLAN. When the WWAN and WLAN are both present information may be exchanged between the WWAN and WLAN e.g. through a combined network management system. The exchanged information may include location information timing information etc. and may be used for call setup handoff etc.

When the WWAN is present a wireless device may initiate a call to another wireless device via the WWAN. The WWAN may be aware of the locations of the two wireless devices and may determine that the call can be placed on the WLAN or via peer to peer. The WWAN may then direct the two wireless devices to set up the call on the WLAN or peer to peer and may be able to save air link resources for other calls that cannot be placed on the WLAN or via peer to peer. The WWAN may thus off load calls when possible.

Different types of call may have different data and QoS requirements. For example a VoIP call may have certain requirements on delay. A higher layer application that is responsible for call setup may be aware of the requirements of the call being placed and can determine how traffic data for the call should be handled. The higher layer application may convey traffic handling information to lower layers that are responsible for transmission and reception of the traffic data.

In one design the higher layer application marks packets using one or more fields of a packet header. IP version 4 IPv4 includes an 8 bit type of service TOS field that may be used to convey the desired QoS. The TOS field includes a 3 bit precedence subfield used to indicate the precedence or importance of the traffic data and three 1 bit subfields used to indicate the desired delay throughput and reliability. IPv4 is described in RFC 791. IP version 6 IPv6 includes an 8 bit traffic class field that may be used to identify and distinguish between different classes or priorities of packets. IPv6 is described in RFC 2460. The TOS field in IPv4 and the traffic class field in IPv6 may be replaced with an 8 bit differentiated services DS field described in RFC 2474. The DS field includes a 6 bit differentiated services code point DSCP subfield that carries a code point that defines the per hop behavior PHB for an IP packet. The higher layer application may also mark packets in other manners using other fields.

At call setup a table may be created with one or more values for each subfield to be marked and for each value the corresponding handling for packets marked with that value. Thereafter packet filtering may be performed based on the table. Packets matching the filtering criteria are handled as specified by the table.

In another design application programming interfaces APIs are used to achieve the desired handling of the traffic data for the call. The higher layer application may call APIs which are drivers that process the traffic data passing between the higher and lower layers. The APIs may perform traffic classification by looking at portions of IP header and or headers of higher layer protocols such as Transmission Control Protocol TCP User Datagram Protocol UDP etc.

In yet another design operating system OS functions are used to achieve the desired handling of the traffic data for the call. The traffic data may be stored in a buffer having a control section. The control section indicates how the traffic data in the buffer should be handled by the lower layers and may be appropriately marked via the OS functions. Different operating systems may have different implementations for marking the buffer. The buffer may thus be marked in accordance with the operating system used for the wireless device.

Some examples of how the different phases of a peer to peer call may be performed in the four scenarios are given below.

The wireless device may perform background discovery and may periodically send and receive frames for discovery of other wireless devices. Each frame may include an identifier for the sending wireless device. The wireless device may also perform active discovery and may periodically listen for frames but send frames only to discover a target wireless device e.g. at the start of a call . Each transmitted frame may include an identifier for the target wireless device. For both background and active discoveries the wireless device may send and or receive frames during a pseudo randomly selected time intervals or b time intervals determined based on timing obtained from a wireless communication network e.g. a cellular network or a broadcast network.

On the receive path antenna receives signals transmitted by base stations in the WWAN access points in the WLAN and or other wireless devices. A receiver RCVR conditions e.g. filters amplifies downconverts and digitizes a received signal from antenna and provides samples. A demodulator Demod processes e.g. descrambles channelizes and demodulates the samples and provides symbol estimates. A decoder further processes e.g. deinterleaves and decodes the symbol estimates and provides decoded data. Encoder modulator demodulator and decoder may be implemented by a modem processor . These units perform processing in accordance with the radio technology or technologies used for communication.

A controller processor controls the operation at wireless device . A memory store data and program codes for wireless device . Controller processor may implement process in process in process in process in process in process in process in and or other processes for peer to peer communication. Controller processor may also implement timers that indicate when to sleep when to send and receive frames for discovery etc. Memory may store various types of information such as the PTP list shown in .

The techniques described herein may be implemented by various means. For example the techniques may be implemented in hardware firmware software or a combination thereof. For a hardware implementation the processing units at a wireless device may be implemented within one or more application specific integrated circuits ASICs digital signal processors DSPs digital signal processing devices DSPDs programmable logic devices PLDs field programmable gate arrays FPGAs processors controllers micro controllers microprocessors electronic devices other electronic units designed to perform the functions described herein or a combination thereof.

For a firmware and or software implementation the techniques may be implemented with instructions e.g. procedures functions and so on that may be used by one or more processors to perform the functions described herein. The instructions may be firmware and or software codes may be stored in a memory e.g. memory in and executed by one or more processors e.g. processor . The memory may be implemented within the processor or external to the processor stored in an external memory in a computer program product e.g. a cd rom or other media be in a memory at an external server or the like.

Headings are included herein for reference and to aid in locating certain sections. These headings are not intended to limit the scope of the concepts described therein under and these concepts may have applicability in other sections throughout the entire specification.

The previous description of the disclosure is provided to enable any person skilled in the art to make or use the disclosure. Various modifications to the disclosure will be readily apparent to those skilled in the art and the generic principles defined herein may be applied to other variations without departing from the spirit or scope of the disclosure. Thus the disclosure is not intended to be limited to the examples described herein but is to be accorded the widest scope consistent with the principles and novel features disclosed herein.

