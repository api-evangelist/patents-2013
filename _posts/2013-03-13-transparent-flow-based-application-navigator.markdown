---

title: Transparent flow based application navigator
abstract: In one embodiment, a network frame is received at flow aware navigator between a client computer and a server computer. The flow aware navigator is configured to determine whether the network frame should be forwarded to one or more network services for processing before forwarding the network frame to the server computer. If the flow aware navigator determines that the network frame should be forwarded to one or more network services for processing before forwarding the network frame to the server computer, the flow aware navigator forwards the network frame to the one or more network services for processing. In response to receiving the processed network frame from the network services, the flow aware navigator then forwards the processed network frame to the server computer.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09130866&OS=09130866&RS=09130866
owner: Cisco Technology, Inc.
number: 09130866
owner_city: San Jose
owner_country: US
publication_date: 20130313
---
The present disclosure relates generally to computer networks and more specifically relates to intercepting and forwarding network flows that are traversing networks.

The approaches described in this section could be pursued but are not necessarily approaches that have been previously conceived or pursued. Therefore unless otherwise indicated herein the approaches described in this section are not prior art to the claims in this application and are not admitted to be prior art by inclusion in this section.

In data processing networks routers switches servers and other network elements process network frames. A network flow comprises of one or more network frames typically having the same five tuple of source address destination address source port number destination port number and protocol identifier. A network flow can be established between two networking devices associated with a client computer and a server computer.

Adding services to a network in a transparent fashion is not easily accomplished with current technology. Routers in present networks typically route packets based on the network address of a destination computer and there is no simple technique to add in the middle of the packet flow between client and server or other endpoint devices computers to perform services. Routers and switches forward packets individually rather than making decisions based upon characteristics of a connection and forwarding decisions are primarily driven by the value of the destination address. Consequently if a network administrator wishes to configure the network to route or switch a frame through a service device before the frame reaches the endpoint destination address few techniques are available.

Filters or policy based routing do not implement decision making based upon flows. Certain firewalls or load balancers such as the ACE device commercially available from Cisco Systems Inc. San Jose Calif. focus on the destination address of a server computer and do not perform selection of a next hop based upon flow characteristics.

Techniques for automatically routing network frames toward one or more network services based upon flow characteristics are described. In the following descriptions for the purposes of explanation numerous specific details are set forth in order to provide a thorough understanding of the present invention. It will be apparent however to one skilled in the art that the present invention may be practiced without these specific details. In other instances well known structures and devices are shown in block diagram form in order to avoid unnecessarily obscuring the present invention.

Several features are described hereafter that can each be used independently of one another or with any combination of other features. However any individual feature may not address any of the problems discussed above or might only address one of the problems discussed above. Some of the problems discussed above might not be fully addressed by any of the features described herein. Although headings are provided information related to a particular heading but not found in the section having that heading may also be found elsewhere in the specification.

In one embodiment a network frame originating from a first endpoint and directed to a second endpoint is received at a flow aware navigator that is interposed between the first endpoint and the second endpoint. For purposes of convenience the term flow aware navigator is used to identify a computing device that implements certain techniques herein but use of the label flow aware navigator is not required for embodiments. In response to receiving a network frame from the first endpoint the flow aware navigator may extract or otherwise obtain information from the network frame. The extracted information is then matched against entries within a flow database. The flow database may comprise information indicating one or more network services to which a network frame should be forwarded for processing before the processed network frame is forwarded to the second endpoint. If the information associated with the network frame is found within the flow database the flow aware navigator forwards the network frame to the one or more network services instead of toward the second endpoint. After the one or more network services process the network frame the network services forward the processed network frame back to the flow aware navigator. In response to receiving the processed network frame the flow aware navigator forwards the processed network frame toward the second endpoint.

In another embodiment the extracted information that is associated with the network frame is not found within the flow database the flow aware navigator may interact with one or more other flow aware navigators within a cluster of flow aware navigators to seek information associated with the network frame. If the information associated with the network frame is found via another flow aware navigator and the information indicates that one or more network services should process the network frame before forwarding the processed network frame toward the second endpoint the flow aware navigator that received the network frame updates its flow database with the information associated with the network frame. The flow aware navigator then forwards the network frame to the one or more network services for processing. The one or more network services process the network frame and forward the processed network frame back to the first flow aware navigator. In response to receiving the processed network frame the flow aware navigator forwards the processed network frame toward the second endpoint.

In another embodiment the information associated with the network frame is not found via any of the other flow aware navigators. The first flow aware navigator may determine from a predefined or user selected set of network policies one or more network services to which the network frame should be forwarded for processing before forwarding the processed network frame toward the second endpoint.

In one embodiment the network services are configured to process the network frame in a serial chain. In an alternative embodiment the network services are configured to process the network frame in one or more parallel chains.

In one embodiment the network services may process the network frames sent from the client to the server as well as the network frames sent from the server to the client. In another embodiment the network services may process the network frames sent only by the client to the server but not the network frames sent by the server to the client.

In one embodiment a flow aware navigator cluster is communicatively coupled to one or more client computers one or more server computers one or more network services and a network service policy which may be implemented on a separate computer. In one embodiment one or more of the client computers may transfer messages as part of a network frame to the one or more of the server computers . The network frames from the one or more of the client computers pass through the flow aware navigator cluster as a hop along a routing path between the one or more of the client computers and the one or more of the server computers . In one embodiment cluster comprises one or more flow aware navigators that are interposed between one or more of the client computers one or more of the server computers one or more of the network services and the network service policy . In another embodiment one or more of the flow aware navigators are configured to intercept and forward the network frames transmitted between the one or more of the client computers the one or more of the server computers and the one or more of the network services .

In one embodiment the one or more flow aware navigators may be logically or physically located at network entrance and exit points of the one or more of the client computers the one or more of the server computers or the one or more of the network services . In one approach every network entrance point and every network exit point could be configured in this manner.

In one embodiment flow aware navigator cluster is communicatively coupled to one or more of the client computers one or more of the server computers one or more of the network services and network service policy by any combination of one or more local area networks LAN wide area networks WAN internetworks or a portion of the Internet. Network frames exchanged between the flow navigator cluster one or more of the client computers one or more of the server computers one or more of the network services and the network service policy may be transferred using any number of datagram layer or network layer protocols such as Internet Protocol IP Transmission Control Protocol TCP User Datagram Protocol UDP Multiprotocol Label Switching MPLS Asynchronous Transfer Mode ATM and Frame Relay. Furthermore in an embodiment different network layer protocols may be used at each of the underlying networks.

In one embodiment one or more of the flow aware navigators are part of an internetworking infrastructure element such as a switch router or gateway configured for forwarding network packets. In another embodiment one or more of the flow aware navigators are standalone network devices or other computing devices that have been configured to intercept and forward network frames. For example one or more of the flow aware navigators may comprise a network device equipped with Wide Area Application Services commercially available from Cisco Systems Inc. San Jose Calif.

In one embodiment network service policy comprises a list of network policies indicating a set of one or more network services that should process a particular network frame. In one embodiment network service policy may specify or determine network services that should process a particular network frame based on the type of network traffic in the particular network frame. Examples of network traffic may include voice over Internet Protocol VoIP multimedia FTP HTTP or others. In an alternative embodiment network service policy may determine network services that should process a particular network frame based on geographical origination of the network frame. For example network service policy may determine that one or more of the flow aware navigators should redirect a particular network frame to a network service located in Europe based on the fact that the network frame originated from a client computer in Europe. In another embodiment network service policy may determine that network services that should be applied to a particular network frame based on the port of the connection. For example a network connection on port commonly indicates that the network connection is a secure Hypertext Transfer Protocol HTTPS connection. Network policy may determine that the network frame established on port should be forwarded to the one or more network services that can process the HTTPS connection. In another embodiment network service policy may determine that network services that should process a particular network frame based on destination address. In an alternative embodiment network service policy may determine that network services that should process a particular network frame based a combination of the above criteria.

In one embodiment network service policy comprises a set of preset network policies that indicate one or more network services that should process a particular network frame. In another embodiment an administrator of the network service policy or an administrator of the network may modify the network policies within the network service policy .

In one embodiment the one or more of the network services may be configured to process a network frame in serial. In a serial chain the network frames are transferred and processed to multiple services in a particular order an example of an order is from the network service to network service . When network service receives a network frame from one or more of the flow aware navigators for processing the network service sends the processed network frame back to the particular flow aware navigator after which the received network frame is then forwarded to network service for processing. In one embodiment the network service can process the network frame and then send the processed network frame directly to network service without forwarding the network frame back to the flow aware navigators .

In one embodiment the flow aware navigators and the one or more of the network services may be configured to process a network frame in parallel. With a parallel chain the network frame is copied at one of the flow aware navigators and copies of the network frames are sent to two or more of the network services at the same time. In one embodiment a network service may consume the network frame without returning the network frame to the flow aware navigator . For example a network service that collects network statistics may consume the received network frame without returning the processed network frame back to the flow aware navigator . In an alternative embodiment the network frame is copied and sent to two or more of the network services at the same time where both of the network services will process the network frame and send the processed network frames back to the flow aware navigator .

In one embodiment the one or more of the network services may issue commands to the one or more of the flow aware navigators . The network services may command the flow aware navigators to stop forwarding network frames of a particular network flow to the network services. In another embodiment the network services may send network service load balance information to the flow aware navigators . The flow aware navigators may use that information to determine that the network frame should be send to another of the network services with less network load.

In one embodiment one or more of the network services encrypts or decrypts the received network frames before forwarding the processed network frame back to the flow aware navigator . In another embodiment the network service compresses the received network frame before forwarding the compressed network frame back to the flow aware navigator . In another embodiment the network service is configured to process Messaging Application Programming Interface MAPI related network frames. In another embodiment the network service may be configured to perform network analysis or statistics collection.

In particular embodiments flow aware navigator is implemented in one or more computer programs other software elements components of hardware or embedded logic in a general purpose computer or a special purpose computer or a combination of two or more such components residing at one or more network devices. In example embodiments the flow aware navigator forms part of a switch a router or any other suitable device that is capable of forwarding network traffic. In particular embodiments flow aware navigator includes or has access to one or more databases file systems or storage devices capable of storing data. Although particular arrangements of the elements above are described and illustrated in for purposes of illustrating a clear example any suitable arrangement of the above modules may be used.

In one embodiment flow aware navigator includes a detection unit . In particular embodiments an incoming network frame from ingress interface is detected by the detection unit . In response to detecting an incoming network frame or packet the detected network frame is sent to the extraction unit which extracts or obtains the relevant network information from the packet or frame. For example information such as source address destination address port and or any identifying information regarding the frame or packet payload may be extracted by the extraction unit .

In one embodiment the extracted information is matched against the information stored in the flow database . In particular embodiments flow database may be in a permanent storage unit residing on a switch router or any other suitable device configured to forward network traffic. In another embodiment the flow database may be located on a remote server or a removable storage device that is communicatively coupled to the flow aware navigator . In certain embodiments flow database may be a hash table a register an array or any other suitable data storage. Flow database may be part of the detection unit extraction unit encapsulating unit or decision unit .

In one embodiment the flow database contains information indicating one or more network services to which a particular network frame should be forwarded for processing. In one embodiment whenever a new network frame is received by the flow aware navigator the flow aware navigator adds a new entry to the flow database . In one embodiment the flow aware navigator may actively update the other flow aware navigators in the cluster of flow aware navigators with the new flow database entry. The update may be transmitted by a multicast layer 2 frame if the other flow aware navigators are layer 2 adjacent.

In another embodiment the update may be transmitted by a multicast layer 3 frame. In an alternative embodiment the update may be transmitted by a unicast layer 3 frame. In one embodiment the flow aware navigator may periodically update the other flow aware navigators within the same cluster of the flow database .

In one embodiment whenever a new network frame is received the flow aware navigator may query other flow aware navigators in the cluster for information that matches the received network frame. If another flow aware navigator responds with information that indicates the new network frame matches an entry in its flow database the flow database of the flow aware navigator is updated with the information from the other flow aware navigator.

In one embodiment flow aware navigator includes an encapsulating unit . Encapsulating unit may be configured to encapsulate the received network frame with a new network frame wherein the new network frame destination address is the same as the network address of the flow aware navigator . In another embodiment the encapsulating unit may be configured to encapsulate the received network frame with a new network frame wherein the new network frame destination address is the same as the original received network frame destination address.

In one embodiment flow aware navigator includes a decision unit that may be configured to determine whether a network frame should be forwarded to one or more of the network services for processing. In one embodiment decision unit may query the network service policy and determine from the one or more network policies in the network service policy whether a network frame should be forwarded to one or more network services for processing before forwarding it to the final destination.

At block the flow aware navigator detects a network frame between one or more of the client computers and one or more of the server computers . Since flow aware navigator is a hop along the routing path between one or more of the client computers and one or more of the server computers and thus the flow aware navigator is interposed between the one or more of the client computers and one or more of the server computers flow aware navigator is able to intercept network frame before forwarding the network frame to the next hop.

At block flow aware navigator extracts the network connection information from the network frame detected at block . In one embodiment flow aware navigator extracts information such as the source network address the destination network address and the network connection port from the network frame. In another embodiment flow aware navigator may also extract the payload information from the network frame.

At block flow aware navigator searches the flow database for an entry in that matches the extracted network connection information from block .

At block if flow aware navigator determines that the extracted network connection information from block matches an entry within the flow database such embodiment proceeds to block . If the flow aware navigator determines that the extracted network connection information from block does not match any entry within the flow database such embodiment proceeds directly to .

At block flow aware navigator identifies from the entry found within the flow database one or more network services to process the network frame before the processed network frame is sent to the server.

At block flow aware navigator forwards the network frame to the one or more network services for processing rather than forwarding the network frame to the server. In one embodiment the network service is configured to compress encrypt process the network frame before forwarding the processed network frame back to the flow aware navigator . In an alternative embodiment the network service forwards the processed network frame directly to the server in block rather than forwarding the network frame to the flow aware navigator .

In one embodiment if two or more network services are identified from the entry found within the flow database the flow aware navigator may forward the network frame in a serial chain to the two or more network services. For example the flow aware navigator may forward the network frame to a first network service for processing after the processed network frame is received at the flow aware navigator from the first network service the flow aware navigator forwards the processed network frame to the second network service for processing. When the flow aware navigator determines that the received network frame no longer needs to be processed by any other network services control proceeds to . In an alternative embodiment the flow aware navigator may forward the network frame in a parallel chain by making copies of the network frame and forwarding the copied network frame to two or more network services at the same time. In one embodiment the network service may consume the received network frame without forwarding a processed network frame back to the flow aware navigator . For example a network service may consume the network frame for the purpose of network traffic data collection.

At block in response to receiving the processed network frame flow aware navigator forwards the processed network frame to the server.

At block the flow aware navigator fails to match the extracted network connection information from block to an entry within the flow database . In response to failing to find a match in the flow database flow aware navigator queries other flow aware navigators in the cluster of flow aware navigators for an entry that matches the extracted network connection information from block .

In one embodiment the flow aware navigator receives a reply from one of the other flow aware navigators that indicate the extract network connection information from block matches an entry from another flow aware navigator and control proceeds directly to block . Flow aware navigator then identifies from the reply one or more network services that should process the network frame before forwarding the network frame to the server.

In an alternative embodiment the flow aware navigator receives a reply that indicates the extracted network connection information from block does not match any other entries in any of the other flow aware navigators and control proceeds directly to block .

At block the flow aware navigator forwards the network frame to the network services for processing rather than forwarding the network frame toward the server.

At block in response to receiving the processed network frame flow aware navigator forwards the processed network frames toward the server.

At block the flow aware navigator determines one or more network services that should process the network frame before forwarding the network frame toward the server.

In one embodiment the determination is based on one or more network policies. The network policies may indicate that the determination is based on the network address of the client computer sending the network frame the network address of the server computer receiving the network frame or the network port on which the network frame is established. In an alternative embodiment the determination is based on a type of message payload carried within the network frame. For example in response to determining that the network frame carries VoIP data the flow aware navigator may determine that the network frame should be forwarded directly toward the server without forwarding the network frame to any network services. In another example in response to determining that the network frame carries a particular type of compressed data the flow aware navigator may determine that the network frame should be forwarded to a network service capable of uncompressing the data within the network frame before forwarding the uncompressed network frame toward the server. In one embodiment the flow aware navigator determines that the network frame should be forwarded to a network service for processing before forwarding the network frame to the server and control proceeds directly to block . In another embodiment the flow aware navigator updates all of the other flow aware navigators with the information that the network frame should be forwarded to a network service before forwarding the network frame toward the server.

If the flow aware navigator determines that the network frame should not be forwarded to any network services for processing before forwarding the network frame toward the server control proceeds directly to block . At block the flow aware navigator forwards the unprocessed network frame toward the server.

According to one embodiment the techniques described herein are implemented by one or more special purpose computing devices. The special purpose computing devices may be hard wired to perform the techniques or may include digital electronic devices such as one or more application specific integrated circuits ASICs or field programmable gate arrays FPGAs that are persistently programmed to perform the techniques or may include one or more general purpose hardware processors programmed to perform the techniques pursuant to program instructions in firmware memory other storage or a combination. Such special purpose computing devices may also combine custom hard wired logic ASICs or FPGAs with custom programming to accomplish the techniques. The special purpose computing devices may be desktop computer systems portable computer systems handheld devices networking devices or any other device that incorporates hard wired and or program logic to implement the techniques.

For example is a block diagram that illustrates a computer system upon which an embodiment of the invention may be implemented. Computer system includes a bus or other communication mechanism for communicating information and a hardware processor coupled with bus for processing information. Hardware processor may be for example a general purpose microprocessor.

Computer system also includes a main memory such as a random access memory RAM or other dynamic storage device coupled to bus for storing information and instructions to be executed by processor . Main memory also may be used for storing temporary variables or other intermediate information during execution of instructions to be executed by processor . Such instructions when stored in non transitory storage media accessible to processor render computer system into a special purpose machine that is customized to perform the operations specified in the instructions.

Computer system further includes a read only memory ROM or other static storage device coupled to bus for storing static information and instructions for processor . A storage device such as a magnetic disk or optical disk is provided and coupled to bus for storing information and instructions.

Computer system may be coupled via bus to a display such as a cathode ray tube CRT for displaying information to a computer user. An input device including alphanumeric and other keys is coupled to bus for communicating information and command selections to processor . Another type of user input device is cursor control such as a mouse a trackball or cursor direction keys for communicating direction information and command selections to processor and for controlling cursor movement on display . This input device typically has two degrees of freedom in two axes a first axis e.g. x and a second axis e.g. y that allows the device to specify positions in a plane.

Computer system may implement the techniques described herein using customized hard wired logic one or more ASICs or FPGAs firmware and or program logic which in combination with the computer system causes or programs computer system to be a special purpose machine. According to one embodiment the techniques herein are performed by computer system in response to processor executing one or more sequences of one or more instructions contained in main memory . Such instructions may be read into main memory from another storage medium such as storage device . Execution of the sequences of instructions contained in main memory causes processor to perform the process steps described herein. In alternative embodiments hard wired circuitry may be used in place of or in combination with software instructions.

The term storage media as used herein refers to any non transitory media that store data and or instructions that cause a machine to operation in a specific fashion. Such storage media may comprise non volatile media and or volatile media. Non volatile media includes for example optical or magnetic disks such as storage device . Volatile media includes dynamic memory such as main memory . Common forms of storage media include for example a floppy disk a flexible disk hard disk solid state drive magnetic tape or any other magnetic data storage medium a CD ROM any other optical data storage medium any physical medium with patterns of holes a RAM a PROM and EPROM a FLASH EPROM NVRAM any other memory chip or cartridge.

Storage media is distinct from but may be used in conjunction with transmission media. Transmission media participates in transferring information between storage media. For example transmission media includes coaxial cables copper wire and fiber optics including the wires that comprise bus . Transmission media can also take the form of acoustic or light waves such as those generated during radio wave and infra red data communications.

Various forms of media may be involved in carrying one or more sequences of one or more instructions to processor for execution. For example the instructions may initially be carried on a magnetic disk or solid state drive of a remote computer. The remote computer can load the instructions into its dynamic memory and send the instructions over a telephone line using a modem. A modem local to computer system can receive the data on the telephone line and use an infra red transmitter to convert the data to an infra red signal. An infra red detector can receive the data carried in the infra red signal and appropriate circuitry can place the data on bus . Bus carries the data to main memory from which processor retrieves and executes the instructions. The instructions received by main memory may optionally be stored on storage device either before or after execution by processor .

Computer system also includes a communication interface coupled to bus . Communication interface provides a two way data communication coupling to a network link that is connected to a local network . For example communication interface may be an integrated services digital network ISDN card cable modem satellite modem or a modem to provide a data communication connection to a corresponding type of telephone line. As another example communication interface may be a local area network LAN card to provide a data communication connection to a compatible LAN. Wireless links may also be implemented. In any such implementation communication interface sends and receives electrical electromagnetic or optical signals that carry digital data streams representing various types of information.

Network link typically provides data communication through one or more networks to other data devices. For example network link may provide a connection through local network to a host computer or to data equipment operated by an Internet Service Provider ISP . ISP in turn provides data communication services through the world wide packet data communication network now commonly referred to as the Internet . Local network and Internet both use electrical electromagnetic or optical signals that carry digital data streams. The signals through the various networks and the signals on network link and through communication interface which carry the digital data to and from computer system are example forms of transmission media.

Computer system can send messages and receive data including program code through the network s network link and communication interface . In the Internet example a server might transmit a requested code for an application program through Internet ISP local network and communication interface .

The received code may be executed by processor as it is received and or stored in storage device or other non volatile storage for later execution.

In the foregoing specification embodiments of the invention have been described with reference to numerous specific details that may vary from implementation to implementation. Thus the sole and exclusive indicator of what is the invention and is intended by the applicants to be the invention is the set of claims that issue from this application in the specific form in which such claims issue including any subsequent correction. Any definitions expressly set forth herein for terms contained in such claims shall govern the meaning of such terms as used in the claims. Hence no limitation element property feature advantage or attribute that is not expressly recited in a claim should limit the scope of such claim in any way. The specification and drawings are accordingly to be regarded in an illustrative rather than a restrictive sense.

