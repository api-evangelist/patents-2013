---

title: Position specifying server, position specifying method, and recording medium recording position specifying program
abstract: A position specifying server includes a storage unit, a communication unit, an estimation unit, and a specifying unit. The storage unit stores GMMs corresponding to base stations of radio waves receivable by a terminal device on each floor. The communication unit receives measured values of the radio wave strengths of the radio waves which the terminal device receives from the base stations. The estimation unit estimates a position of the terminal device for each floor based on the received measured values of the radio wave strengths and the GMMs. The specifying unit calculates the estimated values of the radio wave strengths at the estimated position of the terminal device on each floor based on the GMMs and specifies the floor on which the terminal device is present based on the calculated estimated values of the radio wave strengths and the measured values of the radio wave strengths.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09344853&OS=09344853&RS=09344853
owner: YAHOO JAPAN CORPORATION
number: 09344853
owner_city: Tokyo
owner_country: JP
publication_date: 20130910
---
The present application claims priority to and incorporates by reference the entire contents of Japanese Patent Application No. 2013 176130 filed in Japan on Aug. 27 2013.

The present invention relates to a position specifying server a position specifying method and a recording medium recording a position specifying program.

In the related art using radio waves of base stations of a wireless local area network LAN has been suggested for a person or the like carrying a terminal device to perform positioning in an indoor place or the like where radio waves of the global positioning system GPS do not reach. The positioning using a wireless LAN can be realized for example by comparing radio wave strengths from respective base stations with measured values of the radio wave strengths in a terminal device that uses a database storing the radio wave strengths from the respective base stations measured in advance at each place within a building. To specify a floor of a building the device having the database stores the radio wave strengths and identification information of the base stations measured in advance in each floor in a storage unit and retrieves the radio wave strengths and the identification information of the base stations received by a terminal device performing the positioning from the storage unit. Based on the retrieval result the device having the database selects a floor which is matched with a number of pieces of identification information of the same base station for example Japanese Patent No. 4840395 .

In the measured value data of the radio wave strength measured in each place in a building however it is necessary to finely set meshes of the measurement points to improve accuracy of the positioning. Therefore the database may be enlarged thereby increasing a load. To determine the floor in the building using the number of floors matched with the same base station data of all of the base stations in the building is necessary. Therefore the database may be also enlarged.

It is an object of the present invention to at least partially solve the problems in the conventional technology.

According to one aspect of an embodiment a position specifying server includes a storage unit that stores GMMs corresponding to base stations of radio waves receivable by a terminal device and indicating radio wave strengths on each floor a communication unit that receives measured values of the radio wave strengths of the radio waves which the terminal device receives from the base stations an estimation unit that estimates a position of the terminal device for each floor based on the received measured values of the radio wave strengths and the GMMs and a specifying unit that calculates the estimated values of the radio wave strengths at the estimated position of the terminal device on each floor based on the GMMs corresponding to the base stations and specifies the floor on which the terminal device is present based on the calculated estimated values of the radio wave strengths and the measured values of the radio wave strengths.

The above and other objects features advantages and technical and industrial significance of this invention will be better understood by reading the following detailed description of presently preferred embodiments of the invention when considered in connection with the accompanying drawings.

Hereinafter modes hereinafter referred to as embodiments for carrying out a position specifying server a position specifying method and a recording medium recording a position specifying program according to the present disclosure will be described in detail with reference to the drawings. The position specifying server the position specifying method and the recording medium recording the position specifying program according to the embodiments of the present disclosure are not limited. Same reference numerals are given to the same constituent elements of the embodiments to be described below and the description thereof will not be repeated.

Firstly an example of a position specifying process according to an embodiment will be described with reference to . is a diagram illustrating an example of the position specifying process according to the embodiment. In the example of a terminal device receives radio waves of base stations A to C and transmits basic service set identifiers BSSIDs which are unique IDs of the base stations A to C and radio wave strengths also referred to as received signal strength indicators RSSIs to a position specifying server . The position specifying server performs a position specifying process based on the received BSSIDs and the radio wave strengths. When it is not necessary to distinguish the base stations A to C the base stations A to C are referred to as the base stations .

The terminal device first receives the radio waves of the base stations A to C inside a building . The terminal device detects the BSSIDs of the base stations A to C from the received radio waves and acquires a measured value of the radio wave strength of the received radio wave for each BSSID. The terminal device matches the BSSIDs with the measured values of the radio wave strengths and transmits the BSSIDs and the measured values to the position specifying server via a network N step S indicated by an arrow in .

The position specifying server estimates the position of the terminal device for each floor of the building based on the received BSSIDs the received measured values of the radio wave strengths and a Gaussian Mixture Model GMM stored in a GMM storage unit step S . Here the GMM expresses a radio wave strength of a base station in each floor as superposition of a plurality of Gaussian distribution functions. For example with regard to a floor F3 a GMM A of the base station A a GMM B of the base station B and a GMM G of the base station C are stored in the GMM storage unit . For example with regard to a floor F2 a GMM A of the base station A a GMM B of the base station B and a GMM of the base station C are stored in the GMM storage unit .

For example the position specifying server is assumed to estimate the position of the terminal device on the floor F3 and the floor F2. The position specifying server estimates the position of the terminal device by performing comprehensive evaluation on the position of the terminal device located on the floor F3 using a particle filter based on the measured values of the radio wave strengths the GMM A the GMM B and the GMM C. The particle filter is one of the time series filtering methods and is a method of assuming multiple subsequent states as particles and performing tracking while predicting a weighted average as a subsequent state based on likelihood of all particles.

The position specifying server estimates the position of the terminal device located on the floor F3 using the particle filter. The position specifying server calculates estimated values of the radio wave strengths of the base stations A to C at an estimated position of the terminal device . The estimated value of the radio wave strength of the base station A can be calculated as an estimated value A from the GMM A. Likewise the estimated value of the radio wave strength of the base station B can be calculated as an estimated value B from the GMM B and the estimated value of the radio wave strength of the base station C can be calculated as an estimated value C from the GMM C.

The position specifying server calculates an existence probability of the terminal device on the floor F3 based on the calculated estimated values A to C of the radio wave strengths of the base stations A to C and the measured values of the radio wave strengths of the base stations A to C. For example the existence probability of the terminal device on the floor F3 can be calculated according to a difference between the estimated values and the measured values of the radio wave strengths. With the other floors such as the floor F2 the position specifying server also calculates an existence probability of the terminal device on each floor such as the floor F2. Here for example the existence probabilities of the terminal device on the floors are assumed to be 50 for the floor F3 and 10 for the floor F2.

The position specifying server compares the existence probabilities of the terminal device on the floors with each other. When the terminal device is present at the floor with the highest probability that is the floor F3 the position specifying server performs specifying. That is the position specifying server specifies the estimated position and the floor F3 of the terminal device .

The position specifying server transmits the specified estimated position and the specified floor of the terminal device as positional information to the terminal device step S . When the terminal device receives the positional information the terminal device informs a user of the terminal device of the current floor and position for example by displaying the position and floor on a map of the building displayed on a screen.

Thus in the position specifying process according to the embodiment the position specifying server estimates the position of the terminal device for each floor of the building based on the measured values of the radio wave strengths of the base stations R to C and the GMMs. When the position specifying server estimates the position of the terminal device for each floor the position specifying server calculates the existence probability of the terminal device on the floor by comparing the measured values of the radio wave strengths at the reception position with the estimated values of the radio wave strengths calculated based on the GMMs and specifies the floor on which the terminal device is present. Therefore the user of the terminal device can be informed of the current floor and position. Hereinafter the terminal device the base stations the position specifying server performing such a position specifying process will be described in detail.

Next a position specifying system according to the embodiment will be described with reference to . is a diagram illustrating an example of the configuration of the position specifying system according to the embodiment. As illustrated in the position specifying system includes the terminal device the base stations and the position specifying server . The terminal device and the position specifying server are connected via the base stations and the network N so as to perform wired or wireless communication. Although not illustrated the terminal device and the position specifying server may be connected via an another base station for example an antenna base station of a cellular phone independent from the base stations and the network N. In the example in which the position specifying system includes one terminal device and three base stations has been described. However the position specifying system may include more terminal devices and more base stations .

Next the configuration of the terminal device will be described. The terminal device is an information processing device used by a user. The terminal device corresponds to for example a cellular phone for example a smart phone or a personal digital assistant PDA . As illustrated in the terminal device includes a communication unit a control unit and a display unit .

The communication unit is connected to the base stations to transmit and receive information to and from the position specifying server via the network N. The communication unit is connected to the base stations according to a wireless method. The communication unit can use a wireless LAN or the like as the wireless method. The communication unit detects the BSSID from the receivable radio waves from each base station and acquires the measured value of the radio wave strength of the received radio waves for each BSSID.

For example the control unit is realized by for example a central processing unit CPU or a micro processing unit MPU by executing a program stored in an internal storage device on a RAM serving as a working area. Further for example the control unit is realized by an integrated circuit such as an application specific integrated circuit ASIC or a field programmable gate array FPGA .

The control unit matches the BSSIDs of the base stations acquired by the communication unit with the measured values of the radio wave strengths and transmits the BSSIDs and the measured values to the position specifying server via the communication unit and the network N. For example the control unit maps the positional information received from the position specifying server on the map and displays the positional information on the display unit . The control unit performs various kinds of information processing by controlling the entire terminal device .

The display unit is a display device that displays various kinds of information. For example the display unit is realized by a liquid crystal display or the like. When a touch panel is utilized as an input unit not illustrated the display unit and the input unit are integrated.

Next the configuration of the base station will be described. The base station is for example a wireless base station of a wireless LAN is connected to the terminal device according to a wireless method and is connected to the position specifying server via the network N. The base station conforms to for example IEEE 802.11a b g n standards.

Next the configuration of the position specifying server will be described. The position specifying server is a server device that estimates the position of the terminal device for each floor based on the BSSID and the radio wave strength received from the terminal device and the GMM stored in the GMM storage unit to be described below. As illustrated in the position specifying server includes a communication unit a storage unit and a control unit . The position specifying server may include an input unit for example a keyboard or a mouse that receives various operations from a manager or the like of the position specifying server or a display unit for example a liquid crystal display that displays various kinds of information.

The communication unit is realized by for example a network interface card NIC . The communication unit transmits and receives information to and from the terminal device via the network N and the base stations .

The storage unit is realized by for example a semiconductor memory device such as a RAM or a flash memory or a storage device such as a hard disk or an optical disc. The storage unit includes a base station storage unit a floor storage unit and the GMM storage unit The storage unit stores an operating system OS various programs executed by the control unit and various kinds of data.

The base station storage unit stores the BSSIDs or the like of the base stations received by the terminal device . is a diagram illustrating an example of the base station storage unit according to the embodiment. As illustrated in the base station storage unit has items such as BSSID representative latitude representative longitude MaxRSSI GMMFlag and receivable floor ID. 

The BSSID is the BSSID detected from the received radio wave of the base station and is used to identify the base station . The representative latitude and the representative longitude indicate the latitude and the longitude of a position at which the radio wave strength is the strongest although the radio wave strengths are measured in advance at a plurality of locations to derive a GMM parameter the details will be described below . The MaxRSSI indicates the maximum measured value among the measured values of the radio wave strengths of the BSSID at the representative latitude and the representative longitude. An example of the first row in for example indicates that 75.0 dBm is measured as the radio wave strength. The GMMFlag indicates whether the GMM parameter used for position estimation is already derived. For example indicates that the GMM parameter is derived and 0 indicates that the GMM parameter is not derived. The receivable floor ID indicates the floor ID of a floor on which the radio wave of the base station having the BSSID can be received.

The floor storage unit stores information or the like regarding the floors in the building in which positioning is performed. is a diagram illustrating an example of the floor storage unit according to the embodiment. As illustrated in the floor storage unit has items such as floor ID file name of floor drawing width of floor drawing height of floor drawing latitude and longitude of floor and floor number. 

The floor ID is used to identify a floor. As the floor IDs unique ID may be allocated so as to correspond to a plurality of buildings for example. The file name of the floor drawing indicates a file of a floor drawing. The floor drawing is for example a drawing in which pillars walls and the like are drawn. The width of floor drawing and the height of floor drawing are the number of pixels of the floor drawing in the horizontal and vertical directions. The latitude and longitude of the floor is used to confirm an area of the floor and indicates for example the latitudes and longitudes of an upper left a lower left and an upper right of the floor. The floor number indicates which floor the floor is in the building. Based on such information the pixel coordinates of the floor drawing and the latitude and longitude of the floor can be mutually converted.

The GMM storage unit stores for example the BSSID and the corresponding GMM of each floor. is a diagram illustrating an example of the GMM storage unit according to the embodiment. As illustrated in the GMM storage unit has items such as floor ID number of BSSIDs BSSID K and . 

The floor ID is used to identify a floor. The number of BSSIDs indicates the number of base stations receivable on the floor that is the number of BSSIDs. The BSSID is used to identify the base station . The K is a GMM parameter and indicates a mixture number of normal distributions. The is a GMM parameter and indicates a mixture coefficient indicating a weight of each normal distribution. A sum of all of the mixture coefficients is 1. The and are GMM parameters and indicate averages of the normal distributions in the x and y directions. The and are GMM parameters and indicate a variance covariance matrix of the normal distributions. Here a GMM used to calculate the GMM parameters is expressed in Equation 1 . Equation 1 is an equation that is expressed by superimposing the normal distributions even in consideration of normalization and the GMM parameters are derived based on this equation. Equation 2 expresses a conversion expression between the radio wave strength RSSI and the GMM. Coefficients and can be calculated according to the method of least squares not illustrated . 1 RSSI 2 

The shape of a two dimensional GMM is determined by an average a variance covariance matrix and a mixture coefficient of an individual normal distribution. In the position specifying server a distribution of the radio wave strengths of a floor is shown using the GMM.

Here calculation of the GMM will be described. The calculation of the GMM is based on a paper A Wireless LAN Location Estimation Method Based on Gaussian Mixture Model SUSUMU FUJITA KATSUHIKO KAJI and NOBUO KAWAGUCHI Journal of Information Processing Society of Japan Vol. 52 No. 3 1069 to 1081 March 2011 .

First an administrator of the position specifying server measures the radio wave strengths of the base stations on a given floor using the terminal device or another measurement device. The measurement points of the radio wave strengths are set for example in interval of a few meters or the like. The administrator performs the measurement a plurality of times at each measurement point and sets the average of the measurements as the radio wave strengths at the measurement point. The administrator performs conversion into a two dimensional point distribution based on data regarding the radio wave strengths at the plurality of measurement points. The conversion into the two dimensional point distribution is performed by dividing a region at each measurement point and distributing the number of points according to the radio wave strength to each region. In the division of the region Voronoi division can be used.

Subsequently the point distribution is converted into a GMM using an EM algorithm. In the EM algorithm there are two update procedures an E step and an M step. The E step and the M step are repeated until a convergence criterion is satisfied by calculating a log likelihood function. An example of the GMM calculated in this way is illustrated in . is a diagram illustrating an example of the GMM according to the embodiment. The GMM is a combination of Gaussian functions bell type functions and can be expressed as a so called heat map with a shape of mountains. In contours of the heat map that is the values of the same radio wave strengths or portions within predetermined ranges are illustrated by the same hatching.

Referring back to the control unit is realized for example by a CPU or an MPU by executing a program stored in an internal storage device on a RAM serving as a working area. Further the control unit is realized by for example an integrated circuit such as an ASIC or an FPGA.

As illustrated in the control unit includes a determination unit an estimation unit a calculation unit and a specifying unit . The control unit realizes or performs an information processing function or operation to be described below. An internal configuration of the control unit is not limited to the configuration illustrated in but another configuration may be realized as long as the configuration is a configuration for performing information processing to be described below.

When the determination unit receives the BSSIDs and the measured values of the radio wave strengths from the terminal device the determination unit counts the number of the unique BSSIDs for each floor ID that is each floor of the building. That is the determination unit extracts the number of BSSIDs of the base stations receivable only on a given floor among the received BSSIDs with reference to the base station storage unit . When there is no unique BSSID the determination unit extracts a receivable floor as a feasible floor with reference to the base station storage unit and outputs the floor ID and the measured value of the radio wave strength of the extracted floor to the estimation unit .

When there are the unique BSSIDs the determination unit determines the floor on which the number of unique BSSIDs is the maximum. When there is only one floor on which the number of unique BSSIDs is the maximum the determination unit specifies the determined floor as the floor on which the terminal device is present. When there is a plurality of floors in which the number of unique BSSIDs is the maximum the determination unit specifies the floor to which the BSSID matched with the maximum measured value of the radio wave strength belongs among the unique BSSIDs as the floor on which the terminal device is present.

The determination unit extracts the BSSID for which the measured value of the radio wave strength is larger than a predetermined threshold value. When the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value is extractable the determination unit outputs the extracted BSSID to the estimation unit . When the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value is not extractable for example the determination unit lowers the predetermined threshold value by 10 dBm and extracts the BSSID again. When the BSSID for which the measured value of the radio wave strength is larger than the lowered threshold value is extractable the determination unit outputs the extracted BSSID to the estimation unit . When the BSSID for which the measured value of the radio wave strength is larger than the lowered threshold value is not extractable for example the determination unit lowers the predetermined threshold value by 10 dBm and extracts the BSSID further again. When the BSSID for which the measured value of the radio wave strength is larger than the threshold value lowered twice is extractable the determination unit outputs the extracted BSSID the floor ID of the specified floor and the measured value of the radio wave strength to the estimation unit . When the BSSID for which the measured value of the radio wave strength is larger than the threshold value lowered twice is not extractable the determination unit performs an error process. Further the determination unit outputs the measured value of the radio wave strength to the calculation unit .

The estimation unit receives the floor IDs the BSSIDs and the measured values of the radio wave strengths of the feasible floors or the specified floors from the determination unit . When the floor IDs of the feasible floors are input for example the estimation unit selects one floor ID in an ascending order of the floor IDs. With regard to the floor of the input floor ID the estimation unit determines whether the BSSID for which the measured value of the radio wave strength is larger than the threshold value is extracted. When the BSSID for which the measured value of the radio wave strength is larger than the threshold value is not extracted that is the floor ID of the feasible floor is input the estimation unit extracts the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value. When the BSSID for which the measured value of the radio wave strength is larger than the threshold value is extracted and the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value is extractable the estimation unit reads the GMM parameters of the extracted BSSID on the floor from the GMM storage unit and sets the GMM parameters in the particle filter.

When the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value is not extractable or the GMM parameters cannot be set in the particle filter for example the estimation unit lowers the predetermined threshold value by 10 dBm and extracts the BSSID again. The estimation unit attempts to extract the BSSID by lowering the threshold values twice as in the determination unit . When the threshold value is lowered twice and the BSSID is not extractable the estimation unit performs an error process. When the GMM parameters can be set in the particle filter the estimation unit estimates the position of the terminal device using the particle filter. When the floor ID of the feasible floor is input from the determination unit the estimation unit outputs the estimated position of the terminal device and the floor ID used in the estimation to the calculation unit . When the floor ID of the specified floor is input from the determination unit the estimation unit transmits information regarding the estimated position of the terminal device the floor ID of the specified floor the drawing of the specified floor read from the floor storage unit and the like as positional information to the terminal device via the communication unit .

Here estimation of the position using the particle filter will be described. is a diagram illustrating an example of an initial arrangement of particles in a position estimation process according to the embodiment. In the example of particles are arranged evenly on the floor F2. Each particle moves according to an existence probability in the GMM of the base stations . That is each particle performs weighting according to the existence probability and performs re sampling in addition to random walk. When a weight of each particle is treated as a probability of a place to which other particles moves subsequently most of the other particles in the periphery of the particle with a large weight are rearranged. is a diagram illustrating an example after the rearrangement of the particles in the position estimation process according to the embodiment. In the example of for example the other particles gather together in the periphery of the particle with the large weight. That is an estimated position of the terminal device can be estimated to be near the particle with the large weight.

The calculation unit receives the estimated position of the terminal device and the floor ID from the estimation unit . The calculation unit also receives the measured value of the radio wave strengths from the determination unit . The calculation unit extracts the BSSID base station receivable on the floor indicated by the floor ID based on the floor ID with reference to the base station storage unit . The calculation unit reads the GMM of the extracted BSSID from the GMM storage unit calculates the radio wave strength of the BSSID at the estimated position of the terminal device and sets the calculated value as an estimated value of the radio wave strength.

Here the calculation of the estimated value of the radio wave strength of the BSSID at the estimated position of the terminal device will be described. is a diagram illustrating an example of an estimated value calculation process according to the embodiment. For example the estimated position of the terminal device is assumed to be the estimated position the floor ID is assumed to be F3 the base stations receivable on the floor F3 are assumed to be the base stations A to C and the GMMs corresponding to the base stations A to C are assumed to be the GMMs A to C. At this time the calculation unit calculates the estimated value A of the radio wave strength from the GMM A at the estimated position . Likewise the calculation unit calculates the estimated value B of the radio wave strength from the GMM E at the estimated position and calculates the estimated value C of the radio wave strength from the GMM C at the estimated position .

The calculation unit calculates the existence probabilities of the terminal device on the floor based on the normal distributions from the received measured values of the radio wave strengths and the estimated values of the radio wave strengths of the respective BSSIDs at the estimated position . The existence probability of the terminal device on the floor can be calculated for example according to a difference between the estimated value and the measured value of the radio wave strength. Here in the example of the measured values of the radio wave strengths are assumed to be measured values A to C. At this time the measured values A to C are assumed to correspond to a portion with a circular shape on the GMM as illustrated in a horizontal plane of . Here there are portions in which the estimated values A to C of the radio wave strengths and the measured values A to C of the radio wave strengths overlap each other. That is it can be said that there are rarely differences between the estimated values A to C of the radio wave strengths and the measured values A to C of the radio wave strengths. Here the probability can be expressed as a one dimensional normal distribution expressed in Equation 3 for each BSSID. For example the existence probability of the terminal device on the floor can be set to an average value of the probabilities of the BSSIDs as expressed in Equation 4 in the case of a floor A in which three BSSIDs are extractable. For example in the case of a floor B in which two BSSIDs are extractable the probability can be set to an average value of the probabilities of the BSSIDs as expressed in Equation 5 .

Here as another example the floor F2 is illustrated in . is a diagram illustrating an example of an estimated value calculation process according to the embodiment. In the example of an estimated position of the terminal device is assumed to be an estimated position and measured values of the radio wave strengths are indicated by marks and are assumed to be measured values A to C. The GMMs corresponding to the base stations A to C are assumed to be the GMMs A to C. At this time since there is no corresponding value on the GMM A the measured value A is the nearest value that is a value of a summit point of a mountain of the GMM A as illustrated on a horizontal plane of . A position corresponding to the measured value B has a circular shape as illustrated on the horizontal plane of on the GMM. Further with regard to the measured value C a corresponding value on the GMM C is assumed to be exactly a summit point of the mountain.

The calculation unit calculates an estimated value A of the radio wave strength from the GMM A at the estimated position . Likewise the calculation unit calculates an estimated value B of the radio wave strength from the GMM B at the estimated position and calculates an estimated value C of the radio wave strength from the GMM C at the estimated position . At the estimated position however the radio wave strength is equal to or less than an estimation limit with regard to the GMM . Therefore for example the calculation unit sets 120 dBm as the estimated value C.

In the example of when differences between the estimated values A to C of the radio wave strengths and the measured values A to C of the radio wave strengths are evaluated the measured value A is larger between the estimated value A and the measured value A. Further the estimated value and the measured value B are close values but the measured value B is larger. Furthermore the measured value C is larger between the estimated value C and the measured value C. That is when the existence probability of the terminal device on the floor is calculated from the estimated values A to C of the radio wave strengths and the measured values A to C of the radio wave strengths using Equation 3 to Equation 5 the probability is smaller than in the example of .

The calculation unit determines whether the position of the terminal device is estimated for all of the floor IDs of the feasible floors. When the feasible floor remains the calculation unit instructs the estimation unit to perform the position estimation process and the calculation process on the subsequent floor ID. When the position of the terminal device is estimated for all of the feasible floors the calculation unit matches the floor ID of each floor with the calculated estimated position and the calculated existence probability of the terminal device on each floor and outputs the floor ID the estimated position and the existence probability to the specifying unit .

When the estimated position and the existence probability of the terminal device on each floor are input from the calculation unit the specifying unit compares the existence probabilities of the terminal device on the floors with each other. The specifying unit specifies the floor with the highest existence probability of the terminal device among the compared floors as the floor on which the terminal device is present. The specifying unit transmits information regarding the estimated position of the terminal device the floor ID of the specified floor the drawing of the specified floor read from the floor storage unit and the like as positional information to the terminal device via the communication unit .

Next a position specifying process performed by the position specifying system according to the embodiment will be described. is a flowchart illustrating the position specifying process performed by the position specifying server according to the embodiment.

First the terminal device receives radio waves of the base stations A to within the building . The terminal device detects the BSSIDs of the base stations A to from the received radio waves and acquires measured values of the radio wave strengths of the radio waves received for each BSSID. The terminal device matches the BSSIDs with the measured values of the radio wave strengths and transmits the BSSIDs and the measured values to the position specifying server via the network N.

The determination unit of the position specifying server receives the BSSIDs and the measured values of the radio wave strengths from the terminal device step S . The determination unit extracts and counts the number of BSSIDs unique BSSIDs of base stations receivable on only a given floor among the received BSSIDs with reference to the base station storage unit step S . The determination unit determines whether there are the unique BSSIDs step S . When there is no unique BSSID No in step S the determination unit extracts the receivable floor as feasible floor from the received BSSIDs with reference to the base station storage unit and outputs the floor ID of the extracted floor and the measured value of the radio wave strength to the estimation unit step S . When there are the unique BSSIDs Yes in step S the determination unit performs a determination process step S .

Here the determination process will be described with reference to . is a flowchart illustrating the determination process performed by the position specifying server according to the embodiment. The determination unit determines the floors in which the number of unique BSSIDs is the maximum step S . The determination unit determines whether the number of floors in which the number of unique BSSIDs is the maximum is one step S . When the number of floors in which the number of unique BSSIDs is the maximum is one Yes in step S the determination unit specifies the determined floor as the floor on which the terminal device is present step S . When the number of floors in which the number of unique BSSIDs is the maximum is two or more No in step S the determination unit specifies the floor to which the BSSID matched with the maximum measured value of the radio wave strength belongs among the unique BSSIDs as the floor on which the terminal device is present step S .

The determination unit sets 1 as an initial value of the number of times n that the BSSID in which the radio wave strength is larger than a threshold value is attempted to be extracted step S . The determination unit extracts the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value. The determination unit determines whether the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value is extractable step S . When the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value is extractable Yes in step S the determination unit outputs the extracted BSSID to the estimation unit and performs the position estimation process step S .

When the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value is not extractable No in step S the determination unit determines whether the number of times n is larger than 2 step S . When the number of times n is equal to or less than 2 No in step S the determination unit lowers the predetermined threshold value by 10 dBm step S adds 1 to the number of times n step S and causes the process to return to step S to extract the BSSID again. When the number times n is larger than 2 Yes in step S the determination unit performs the error process and ends the process step S .

The determination unit repeats the processes of step S to step S to attempt to extract the BSSID by lowering the predetermined threshold value twice. At this time when the BSSID for which the measured value is larger than the lowered threshold value is extractable Yes in step S the determination unit outputs the extracted BSSID to the estimation unit and performs the position estimation process step S .

Here the position estimation process will be described with reference to . is a flowchart illustrating the position estimation process performed by the position specifying server according to the embodiment. When the floor ID of the feasible floor is input from the determination unit that is the BSSID for which the measured value of the radio wave strength is larger than the threshold value is not extracted the estimation unit performs the same process as the determination process. Therefore the estimation unit sets 1 as the initial value of the number of times n that the BSSID for which the radio wave strength is larger than the threshold value is attempted to be extracted step S . When the floor ID of the feasible floor is input for example the estimation unit selects one floor ID in an ascending order of the floor IDs. When the floor ID of the specified floor is input the estimation unit selects this floor ID. With regard to the floor of the selected floor ID the estimation unit determines whether the BSSID for which the measured value of the radio wave strength is larger than threshold value is extracted step S .

When the BSSID for which the measured value of the radio wave strength is larger than the threshold value is not extracted No in step S the estimation unit extracts the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value. The estimation unit determines whether the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value is extractable step S . When the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value is extractable Yes in step S the estimation unit reads the GMM parameters of the extracted BSSID on the floor from the GMM storage unit and sets the GMM parameters in the particle filter step S .

When the BSSID for which the measured value of the radio wave strength is larger than the predetermined threshold value is not extractable No in step S the estimation unit determines whether the number of times n is larger than 2 step S . When the number of times n is equal to or less than 2 No in step S the estimation unit lowers the predetermined threshold value by 10 dBm step S adds 1 to the number of times n step S causes the process to return to steps S and S and extracts the BSSID again. When the number of times n is larger than 2 Yes in step S the estimation unit performs the error process and ends the process step S .

When the BSSID for which the measured value of the radio wave strength is larger than the threshold value is not extracted the estimation unit repeats the processes of step S to step S lowers the predetermined threshold value twice and attempts to extract the BSSID. At this time when the BSSID for which the measured value of the radio wave strength is larger than the lowered threshold value is extractable Yes in step S the estimation unit reads the GMM parameters of the extracted BSSID on the floor from the GMM storage unit and sets the GMM parameters in the particle filter step S .

The estimation unit determines whether the GMM parameters can be set in the particle filter step S . When the GMM parameters can be set in the particle filter Yes in step S the estimation unit estimates the position of the terminal device using the particle filter step S . When the GMM parameters cannot be set in the particle filter No in step S the estimation unit allows the process to proceed to step S lowers the threshold value used to extract the BSSID again and attempts to extract the BSSID for which the measured value of the radio wave strength is larger than the threshold value.

The estimation unit determines whether to estimate the position of the terminal device using the particle filter step S . When the estimation unit can estimate the position of the terminal device using the particle filter Yes in step S the estimation unit ends the position estimation process and the process returns to the original process. When the estimation unit cannot estimate the position of the terminal device using the particle filter No in step S the estimation unit performs the error process and ends the process step S .

After the process of step S in ends referring back to for description the estimation unit transmits the information regarding the estimated position of the terminal device the floor ID of the specified floor the drawing of the specified floor read from the floor storage unit and the like as the positional information to the terminal device via the communication unit step S . The control unit of the terminal device maps the positional information received from the position specifying server on for example a map and displays the positional information on the display unit .

Subsequently processes will be described after the floor ID of the receivable floor and the measured value of the radio wave strength are output to the estimation unit in step S when there is no unique BSSID in step S. When the floor ID of the feasible floor is input for example the estimation unit selects one floor ID in the ascending order of the floor IDs. The estimation unit performs the position estimation process with regard to the floor with the selected floor ID step S . Since the position estimation process of step S is the same as the position estimation process of step S the description thereof will not be repeated.

When the position estimation process ends with regard to one of the floor IDs of the feasible floors the estimation unit outputs the estimated position of the terminal device and the floor ID used for the estimation to the calculation unit .

When the position of the terminal device estimated by the estimation unit and the floor ID are input the calculation unit performs the calculation process step S . Here the calculation process will be described with reference to . is a flowchart illustrating the calculation process performed by the position specifying server according to the embodiment.

The calculation unit extracts the BSSIDs base stations receivable on the floor indicated by the floor ID based on the floor ID with reference to the base station storage unit step S . The calculation unit reads the GMMs of the extracted BSSIDs from the GMM storage unit step S calculates the radio wave strengths of the BSSIDs at the estimated position of the terminal device and sets the calculation results as estimated values of the radio wave strengths step S .

The calculation unit calculates the existence probability of the terminal device on the floor based on the normal distributions from the measured values of the radio wave strengths input from the determination unit and the estimated values of the radio wave strengths for the respective BSSIDs at the estimated position of the terminal device step S .

Referring back to for the description the calculation unit determines whether the position of the terminal device is estimated for all of the floor IDs of the feasible floors step S . When the position of the terminal device is not estimated for all of the floor IDs of the feasible floors No in step S the process returns to step S and the calculation unit performs the processes of step S and step S on the subsequent floor ID. When the position of the terminal device is estimated for all of the floor IDs of the feasible floors Yes in step S the calculation unit associates the floor ID of each floor with the estimated position and the calculated existence probability of the terminal device on each floor and outputs the floor ID the estimated position and the existence probability to the specifying unit .

When the estimated position and the existence probability of the terminal device on each floor are input from the calculation unit the specifying unit compares the existence probabilities of the terminal device on each of the floors. The specifying unit specifies the floor on which the existence probability of the terminal device is the highest among the compared floors as the floor on which the terminal device is present step S . The specifying unit transmits the information regarding the estimated position of the terminal device the floor ID of the specified floor the drawing of the specified floor read from the floor storage unit and the like as positional information to the terminal device via the communication unit step S . The control unit of the terminal device maps the positional information received from the position specifying server on for example a map and displays the positional information on the display unit .

In this way the position specifying server stores the GMMs corresponding to the base stations receivable by the terminal device and indicating the radio wave strengths on each floor in the storage unit receives the measured values of the radio wave strengths of the radio waves which the terminal device receives from the base stations and estimates the position of the terminal device for each floor based on the received measured values of the radio wave strengths and the GMMs. Further the position specifying server calculates the estimated values of the radio wave strengths at the estimated position of the terminal device on each floor based on the GMMs corresponding to the base stations and specifies the floor on which the terminal device is present based on the calculated estimated values of the radio wave strengths and the measured values of the radio wave strengths. Thus the position specifying server can specify the floor with high accuracy using a small database.

The position specifying server calculates a difference between the calculated estimated value of the radio wave strength and the measured value of the radio wave strength for each base station calculates an existence probability of the terminal device on each floor for each of the base stations according to the calculated difference in the radio wave strength and specifies the floor on which the terminal device is present based on the calculated existence probability for each base station . Thus the position specifying server can specify the floor with high accuracy based on the existence probability of the terminal device on each floor.

The position specifying server calculates the difference between the calculated estimated value of the radio wave strength and the measured value of the radio wave strength for each of the base stations calculates an average value of probabilities for each base station for which the difference in the radio wave strength is calculated on each floor as an existence probability of the terminal device on each floor according to the calculated difference in the radio wave strength and specifies the floor on which the terminal device is present based on the calculated existence probability. Thus the position specifying server can set the average value of the existence probabilities of the terminal device on each floor for each base station as the existence probability of the terminal device on each floor and thus can specify the floor with high accuracy.

The position specifying server stores floor unique base station information in which floor unique base stations BSSID received in advance on one floor are associated with the floor in the storage unit. The determination unit determines the floor on which the number of received floor unique base stations is the largest as the floor on which the terminal device is present. When the determination unit is not able to specify the floor on which the terminal device is present the position specifying server specifies the floor on which the terminal device is present. Thus the position specifying server can specify the floor with high accuracy through a lighter process when there are the floor unique base stations.

The position specifying server stores floor unique base station information in which floor unique base stations BSSID received in advance on one floor are associated with the floor in the storage unit. The determination unit determines the floor to which the floor unique base station of the maximum radio wave strength of the received floor unique base station belongs as the floor on which the terminal device is present when there is a plurality of floors in which the number of received floor unique base stations is the largest. When the determination unit is not able to specify the floor on which the terminal device is present the position specifying server specifies the floor on which the terminal device is present. Thus the position specifying server can specify the floor with high accuracy through a lighter process even when there are the plurality of floor unique base stations.

The embodiments of the present disclosure have been described above in detail with reference to the drawings. The embodiments are merely examples and should be apparent to those skilled in the art that the aspects described in the summary of the invention and various modifications and corrections can be realized as other embodiments.

In the above described embodiments the calculation unit uses the average value of the probabilities for each base station as the existence probability of the terminal device on each floor but the invention is not limited thereto. For example instead of the average value of the probabilities for each base station the calculation unit may set a value which is obtained by dividing a sum of the probabilities for the base stations by the number of base stations on the floor on which the number of base stations for which the difference in the radio wave strength is calculated is the largest among the floors as the existence probability of the terminal device on each floor. That is the position specifying server calculates the difference between the calculated estimated value of the radio wave strength and the measured value of the radio wave strength for each base station calculates the value which is obtained by dividing the sum of probabilities for the base stations for which the difference in the radio wave strength is calculated on each floor by the number of base stations on the floor on which the number of base stations for which the difference in the radio wave strength is calculated is the largest among the floors as the existence probability of the terminal device on each floor according to the calculated difference in the radio wave strength and specifies the floor on which the terminal device is present based on the calculated existence probability. Thus the position specifying server can perform weighting the floor on which the number of base stations for which the difference in the radio wave strength is calculated is the largest and can specify the floor with high accuracy.

In the above described embodiments the determination unit specifies the floor to which the BSSID for which the measured value of the radio wave strength is the maximum belongs among the unique BSSIDs as the floor on which the terminal device is present but the invention is not limited thereto. For example when the maximum radio wave strength of the received floor unique BSSID base station exceeds the maximum radio wave strength of the corresponding floor unique BSSID stored in the base station storage unit the determination unit can exclude the floor to which the floor unique BSSID belongs from the specifying candidates. That is the position specifying server stores floor unique base station information in which floor unique base stations received in advance on one floor are associated with the floor and the maximum radio wave strength of each of the floor unique base stations in the storage unit. The determination unit excludes the floor to which the floor unique base stations belong from the specifying candidates when the maximum radio wave strength of the received floor unique bases station exceeds the maximum radio wave strength of the corresponding floor unique base station stored in the storage unit and determines the floor on which the number of received floor unique base stations is the largest as the floor on which the terminal device is present. When the determination unit is not able to specify the floor on which the terminal device is present the position specifying server specifies the floor on which the terminal device is present. Thus the position specifying server can exclude the floor to which the base station with the maximum radio wave strength exceeding the radio wave strength measured in advance belongs from the candidates and thus can specify the floor with high accuracy with a light process.

In the above described embodiments the floor on which the terminal device is present is specified based on the estimated value and the measured value of the radio wave strength but the invention is not limited thereto. For example the floor may be specified based on a measured value R of the radio wave strength measured by the terminal device and the maximum radio wave strength Rimax in each floor i. First the administrator of the position specifying system calculates a difference dji Rj Rimax for each measurement point j of each floor i in advance. Based on the difference dji the administrator calculates the maximum value of the difference dji as a parameter x1 the number of positive values of the difference dji as a parameter x2 that is indicates another floor the average value of the difference dji as a parameter x3 and the average of positive values of the difference dji as a parameter x4. Further the administrator acquires the number of BSSIDs measured in each floor i that is the number of base stations . Next coefficients k1 to k5 are specified through discriminant analysis of multivariable analysis using Equation 6 . Here Equation 6 is 1 in a correct case and is 0 in an error case. Next when the terminal device actually performs positioning and the measured value of the measured radio wave strength measured by the terminal device is assumed to be R the position specifying server can calculate a difference di R Rimax calculate the parameters x1 to x5 and specify the floor on which Equation 6 is the maximum as the floor on which the terminal device is present. Thus the position specifying server can specify the floor on which the terminal device is present based on the maximum radio wave strength of each floor. 1122334455 6 

The above described position specifying server may be realized by a plurality of server computers or may be realized by a single server computer. Further an external platform is called by an application programming interface API network computing or the like to be realized depending on the functions. In this way the configuration can be flexibly changed.

The position specifying server according to the above described embodiment is realized by for example a computer that has a configuration illustrated in . is a diagram illustrating an example of a hardware configuration of a computer realizing the functions of the position specifying server. The computer includes a central processing unit CPU a random access memory RAM a read only memory ROM a hard disk drive HDD a communication interface I F an input output interface I F and a media interface I F .

The CPU operates based on a program stored in the ROM or the HDD and controls each unit. The ROM stores for example a boot program performed by the CPU at the time of activation of the computer or a program dependent on hardware of the computer .

The HDD stores for example a program executed by the CPU and data used by the program. The communication interface receives data from another device via a communication line transmits the data to the CPU and transmits data generated by the CPU to another device via the communication line .

The CPU controls an output device such as a display or a printer or an input device such as a keyboard or a mouse via the input output interface . The CPU acquires data from the input device via the input output interface . The CPU outputs generated data to the output device via the input output interface .

The media interface reads a program or data stored in a recording medium and supplies the program or the data to the CPU via the RAM . The CPU loads the program on the RAM from the recording medium via the media interface and executes the loaded program. The recording medium is for example an optical recording medium such as a digital versatile disc DVD or a phase change rewritable disk PD a magneto optical recording medium such as a magneto optical disk MO a tape medium a magnetic recording medium or a semiconductor memory.

When the computer functions as the position specifying server according to the embodiment the CPU of the computer realizes the functions of the determination unit the estimation unit the calculation unit and the specifying unit by executing the program loaded on the RAM . The HDD stores data stored in the base station storage unit the floor storage unit and the GMM storage unit .

The CPU of the computer reads the program from the recording medium and executes the program. As another example the CPU may acquire the programs from another device via the communication line .

The position specifying server according to the present disclosure is capable of specifying a floor with high accuracy even using a small database.

Although the invention has been described with respect to specific embodiments for a complete and clear disclosure the appended claims are not to be thus limited but are to be construed as embodying all modifications and alternative constructions that may occur to one skilled in the art that fairly fall within the basic teaching herein set forth.

