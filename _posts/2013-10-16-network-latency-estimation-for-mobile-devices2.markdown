---

title: Network latency estimation for mobile devices
abstract: Embodiments calculate an estimated latency between computing devices. A latency service aggregates latency records defining latency measurements and corresponding latency factors from a plurality of computing devices. From the aggregated latency records, the latency service defines relationships between the latency measurements and the corresponding latency factors. Responsive to a request for an estimated latency from a mobile computing device, the latency service applies the defined relationships to estimate the latency based on the latency factors associated with the received request. In some embodiments, the estimated latency includes three portions: a first latency value representing the latency from the mobile computing device to a cell site, a second latency value representing the latency from the cell site to an access point, and a third latency value representing the latency from the access point to a destination computing device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09602377&OS=09602377&RS=09602377
owner: Microsoft Technology Licensing, LLC
number: 09602377
owner_city: Redmond
owner_country: US
publication_date: 20131016
---
This application is a continuation of commonly owned co pending U.S. patent application Ser. No. 12 951 781 filed Nov. 22 2010 the entire disclosure of which is hereby incorporated by reference herein for all purposes.

Computing devices may be connected to each other via various network elements. The computing devices experience latencies that are dependent on the specific network elements included in the connection. The experienced latencies can directly affect the user experience on the computing devices. Some existing systems measure the latencies for computing devices in fixed locations such as a personal computer connected to the Internet. Such measurements are specific to each of the computing devices and typically have high time and data traffic costs.

Other systems use geo location databases to convert the Internet Protocol IP addresses of each computing device to latitude longitude values to estimate latency between the computing devices based on geographic distance. Such systems are typically fast but inaccurate at least because latitude longitude values for many IP addresses are missing or misplaced. Additionally the correlation between geographic distance and latency is poor with the existing systems. Further for mobile devices there is often no correlation between IP addresses and latitude longitude values. Even for mobile devices that have a correlation between IP address and latitude longitude values the geographic locations of mobile devices do not correlate well to latency e.g. due to the effect of factors such as congestion and signaling .

Embodiments of the disclosure receive a request for a latency estimation for sending data from a first computing device to a second computing device. The request identifies latency factors of the first computing device including at least a cell site identifier a signal strength an access proxy and the destination computing device. The latency factors and latency measurements aggregated from a plurality of computing devices are accessed. Relationships between the accessed latency factors and the accessed latency measurements are defined. The latency estimation is calculated based on the defined relationships and the latency factors of the first computing device. The calculated latency estimation includes a sum of a first latency value from the first computing device to a cell site identified by the cell site identifier a second latency value from the cell site to an access point identified by the access proxy and a third latency value from the access point to the second computing device. The calculated latency estimation is provided to the first computing device.

This Summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This Summary is not intended to identify key features or essential features of the claimed subject matter nor is it intended to be used as an aid in determining the scope of the claimed subject matter.

Referring to the figures embodiments of the disclosure enable network latency estimation for communication between computing devices. In some embodiments latency is estimated for communication between a mobile computing device and a destination computing device . In such embodiments the latency estimation includes three portions a first latency value corresponding to a latency between the mobile computing device and a cell site e.g. a cellular tower a second latency value corresponding to a latency between the cell site and an access point and a third latency value corresponding to a latency between the access point and the destination computing device .

Estimating the latency enables applications executing on mobile computing devices to adjust operations to maintain or enhance the user experience on the mobile computing devices . The user experience for some applications such as video streaming applications or web browsers is heavily dependent on network latency. The network latency is dependent on connections that for mobile computing devices are dynamic and may change frequently. Aspects of the disclosure enable applications to select a particular network connection or server that is estimated to provide the least latency. Aspects of the disclosure also enable mobile computing devices to determine when to communicate with other computing devices. For example a high estimated latency may indicate to an application that communication should not even be attempted e.g. during voice over IP or video conferencing connection attempts or when selecting players in an multiplayer online game .

Referring again to an exemplary block diagram illustrates a plurality of computing devices communicating with one or more destination computing devices and a latency service . The computing devices include computing device 1 through computing device M. The computing device however represents any device executing instructions e.g. as application programs operating system functionality or both to implement the operations and functionality associated with the computing device . The computing device may include a mobile computing device such as mobile computing device or any other portable device. In some embodiments the mobile computing device includes a mobile telephone laptop netbook gaming device and or portable media player. The computing device may also include less portable devices such as desktop personal computers kiosks and tabletop devices. Additionally the computing device may represent a group of processing units or other computing devices.

The computing device has at least one processor and a memory area . The processor includes any quantity of processing units and is programmed to execute computer executable instructions for implementing aspects of the disclosure. The instructions may be performed by the processor or by multiple processors executing within the computing device or performed by a processor external to the computing device . In some embodiments the processor is programmed to execute instructions such as those illustrated in the figures e.g. .

The computing device further has one or more computer readable media such as the memory area . The memory area includes any quantity of media associated with or accessible by the computing device . The memory area may be internal to the computing device as shown in external to the computing device not shown or both not shown .

The memory area stores among other data one or more applications . The applications when executed by the processor operate to perform functionality on the computing device . Exemplary applications include mail application programs web browsers calendar application programs address book application programs messaging programs media applications location based services search programs and the like. The applications may communicate with counterpart applications or services such as web services accessible via a network such as network . For example the applications may represent downloaded client side applications that correspond to server side services executing in a cloud.

When executed one or more of the applications may communicate with other devices such as the destination computing devices . Latency may occur during the communications. The memory area further stores one or more latency records such as latency record 1 through latency record N. Each of the latency records has one or more latency factors. In some embodiments the latency factors identify one or more of the following a latency measurement a cell site identifier a location of the computing device a signal strength an access point name APN and one of the destination computing devices . The latency measurement corresponds to a latency experienced by the computing device when sending data from the computing device to one of the destination computing devices via network . The cell site identifier identifies a cell site to which the computing device is connected during the latency measurement. The cell site represents a network element connecting the computing device to other network elements. The cell site may include for example a cellular tower a base station a base transceiver station a base station site or any other network element supporting any quantity and type of communication modes. Aspects of the disclosure are operable with any cell site supporting any quantity and type of wireless and or wired communication modes including cellular divisional multiple access CDMA Global System for Mobile Communications GSM and the like.

The signal strength signal to noise ratio error rate and or stability of the connection represents the strength of the connection between the computing device and the cell site. The APN identifies a particular network used by the computing device during the latency measurement. The network includes any wired and or wireless network and may further support client server and peer to peer communications. The destination computing devices include any computing devices configured to communicate with the computing devices .

Exemplary latency records may include the latency factors or parameters shown in Table 1. In some embodiments the latency record is represented as .

While the parameters above constitute the latency records in some embodiments latency records having additional or fewer latency factors are contemplated. For example in other embodiments the set of latency factors identifies a cell site identifier a signal strength an access proxy e.g. APN and one of the destination computing devices . Those skilled in the art however will note that any one of the latency factors can be used to estimate latency. In such embodiments however the accuracy of the latency estimation is affected by the quantity of latency factors involved in the estimation. For example signal strength has a small effect on latency except when the signal strength is very low. In contrast the cell site identifier has a significant effect on latency. In some embodiments the cell site identifier has two portions one portion identifies the cell tower and the other portion e.g. the location area code identifies the radio network controller. Knowing either portion of the cell site identifier can aid in estimating latency. In another example if only the access proxy is known the accuracy of the latency estimation is low e.g. off by as much as 100 ms or more . In another example knowing the destination may have little effect on the latency as the majority of the latency may be on the side of the mobile computing device in some embodiments.

The computing devices provide the latency records to the latency service . The latency records may be provided upon creation of each of the latency records or periodically e.g. batched nightly or sent after a pre defined quantity of the latency records have been created etc. . Creating and providing the records are described next with reference to .

Referring next to an exemplary flow chart illustrates operation of the computing device to create latency records and provide the latency records to the latency service . At one of the computing devices measures a latency of data transmitted from the computing device to one of the destination computing devices . For example one or more of the applications executed by the computing device each performs latency measurements. In another example an operating system associated with the computing device performs the latency measurement. The computing device may measure the latency while connected to other computing devices by for example performing operations to periodically send and receive test packets during the connection. The test packets may be piggy backed on other data packets being sent during the connection or may be dedicated test packets to particular destination computing devices such as landmark servers scattered across the network e.g. if the data traffic volume during the connection is low .

At for each measured latency the computing device defines values for each of the latency factors. In some embodiments the latency factors represent at least the measured latency a cell site identifier a location of the computing device a signal strength an APN and one of the destination computing devices . The set of values for the latency factors corresponds to the measured latency and generally describes the conditions context and or environment in which the latency was measured. At the latency record is created with the defined set of latency factor values. The latency record is stored for example in the memory area of the computing device .

At the latency record stored in the memory area is sent to the latency service . In some embodiments the computing device sends each latency record upon creation. In other embodiments the computing device sends available latency records periodically. For example the computing device may accumulate a threshold quantity of the latency records before transmitting the latency records . In another example the computing device may transmit the created latency records periodically such as nightly weekly etc.

Referring next to an exemplary block diagram illustrates latencies in communication between the mobile computing device and destination computing devices . The communication may take the form of packet communication data streaming and or any other form of communication between the mobile computing device and the destination computing devices . Each connection between the mobile computing device and one of the destination computing devices includes at least a cell site and an access point . The latency experienced between the mobile computing device and the destination computing device is dependent on the cell site and access point associated with the connection. The mobile computing device communicates with the cell site . The cell site may include for example a cellular tower a base station a base transceiver station a base station site or any other network element supporting any quantity and type of communication modes. The cell site communicates with a network such as the Internet via the access point . The access point identifies the connection to the network .

Communication from the mobile computing device to the destination computing device experiences latency that may be divided into three portions. While the latency is described in the embodiment of as being divided into three portions other embodiments contemplate additional or fewer portions. For example one or more of the portions illustrated in may be subdivided into additional portions or the portions illustrated in may be combined.

In the example of a first latency occurs between the mobile computing device and the cell site . The first latency may be dependent at least on signal strength experienced by the mobile computing device and congestion of the cell site e.g. based on the quantity of devices connected to the cell site . Additionally the first latency is dependent on the particular cell site as each cell site may cover different region sizes have different transmit power and or different loss characteristics.

A second latency occurs between the cell site and an access point . The second latency may be dependent at least on a mobile operator network associated with the access point and congestion of the mobile operator network . In some embodiments the second latency is common to mobile computing devices connected to the cell site and using the same access point . A third latency occurs between the access point identified by the access point and the destination computing device .

Using the exemplary latency factors from Table 1 the first latency second latency and third latency may be expressed in the following Equation 1 below where p corresponds to phone t corresponds to tower b corresponds to backhaul and d corresponds to destination. 

In some embodiments values for each of the first latency second latency and third latency are calculated as next described with reference to .

Referring next to an exemplary flow chart illustrates operation of the latency service to calculate latency estimations based on input latency factors. The latency service represents any computing device programmed to perform the operations illustrated in . For example the latency service may represent a web service network operations center cloud computing service server computing device or other functionality external to the computing device . In additional examples the latency service may execute on the mobile computing device a computing device associated with a mobile operator a vendor computing device and or one of the destination computing devices e.g. a game program attempting to evaluate connections to the computing devices . The latency service may include an application programming interface API allowing computing devices to query for latency estimations.

In some embodiments each of the operations illustrated in are performed by the latency service . In other embodiments one or more of the operations are performed by other computing devices such as the computing device or the mobile computing device .

As illustrated in the latency service aggregates the latency records from the plurality of the computing devices . The latency service may receive a request for a latency estimation from one or more of the computing devices e.g. from applications or operating systems executing on the computing devices . The request identifies one or more of the latency factors. For example the request identifies a cell site identifier a signal strength an APN and one of the destination computing devices . The request may be received for example via an application programming interface. If the request for a latency estimation for sending data from a first computing device to a second computing device is received at the latency service analyzes aggregated latency records at to define relationships between the latency measurements and the corresponding latency factors. In some embodiments the latency service defines a relationship between the signal strength and the corresponding latency measurements for each cell site. A low signal strength for example may correspond to an increased latency. In further embodiments the latency service determines congestion e.g. utilization associated with each cell site by analyzing a quantity of computing devices such as computing devices currently connected to each cell site. A high number of devices connected to a cell site may correspond for example to an increased latency.

The relationships between the signal strength and latency as well as between the congestion and latency may be represented as histograms. Further the relationships may be defined off line in a batch processing mode or by a separate service.

Based on the exemplary latency factors illustrated in Table 1 the congestion for each cell site may be calculated as shown in Equation 2 below.

Based on the exemplary latency factors illustrated in Table 1 the congestion for each APN may be expressed as shown in Equation 3 below.

In some embodiments the latency service analyzes the aggregated latency records to maintain an estimation of the latency between each computing device and cell site to which the computing device is connected an estimation of the congestion at each cell site e.g. based on the quantity of connected computing devices an estimation of the latency between each cell site and APN and an estimation of the congestion associated with each APN .

Based on the defined relationships the latency service calculates at a latency estimation for the latency factors associated with the first computing device provided in the received request. The latency service applies the defined relationships to the latency factors in the request from the first computing device. In some embodiments the latency service may filter the aggregated latency records based on cell site identifier or APN and calculate the latency estimation based on the filtered latency records.

In some embodiments the calculated latency estimation includes a single value a histogram of values a cumulative distribution function or the like that represents the estimated latency based on the aggregated latency records . In other embodiments the calculated latency estimation includes a combination of latency values corresponding to the first latency second latency and third latency illustrated in . A first latency value represents the first latency from the first computing device to the cell site identified by the cell site identifier in the request. The second latency value represents the second latency from the cell site to the access point identified by the APN in the request. The third latency value represents the third latency from the access point to the second computing device.

At the latency service provides the calculated latency estimation to the first computing device. The first computing device may adjust performance of operations of execution of the applications executing on the first computing device based on the calculated latency estimation. For example some operations may be postponed or execution of some applications may be suspended if the latency estimation exceeds a pre defined threshold.

Alternatively or in addition the operations illustrated in may be executed periodically for identified e.g. subscribed computing devices absent an explicit request. In such embodiments the identified computing devices keep the latency service informed of current latency factors e.g. location cell site etc. . The latency service calculates and provides the latency estimations periodically e.g. every five minutes . The calculated latency estimations are cached by the identified computing devices for use by applications executing on the identified computing devices.

The latency service may also provide additional information or recommendations to the first computing device along with the calculated latency estimation. For example the latency service may receive data indicating movement of the first computing device. The data may include accelerometer data location information e.g. global positioning system data and or other data indicating a current movement of the first computing device. Based on the received data and knowledge of locations of cell sites the latency service may compute a time value e.g. absolute or relative during which the calculated latency estimation will remain valid. For example the latency service may determine that the first computing device will change cell sites in three minutes after which the latency estimation will change because of the different cell site. In a further embodiment the latency estimation determines that the different cell site will increase or decrease the latency estimation and provides that expected adjustment to the first computing device. The first computing device is then able to intelligently adjust execution of applications based on the current latency estimation and the expected adjustment. For example the first computing device may decide to stay connected to the cell site until the latency is expected to decrease or may decide to switch to another cell site immediately. In another example the user is warned of the impending degradation of performance.

In further embodiments the latency service calculates an accuracy value confidence factor or other measurement of accuracy associated with the latency estimation.

The latency service may further provide recommendations to the first computing device based on the latency estimation. For example the latency service may select one or more alternative cell sites based on the relationships defined at and the calculated latency estimation. In such an example the latency service may filter the defined relationships to identify first latency values associated with cell sites near the cell site to which the first computing device is currently connected e.g. determined from the cell site identifier in the request . The latency service selects the nearby cell sites having first latency values lower than the first latency value calculated as part of the latency estimation at . The selected nearby cell sites are recommended to the first computing device as the alternative cell sites. Alternatively or in addition the latency service may recommend one or more physical locations for the first computing device to move to where the first computing device automatically switches to at least one of the selected nearby cell sites upon arriving at the physical locations.

In further embodiments the latency service selects one or more wireless fidelity Wi Fi access locations or other connection modalities such as BLUETOOTH brand communication systems based on the location of the first computing device as identified in the request. The latency service selects the wireless fidelity access locations having latencies less than the calculated latency estimation. The latency service then recommends the selected wireless fidelity access locations to the first computing device as alternative connections to yield a latency that is less than the calculated latency estimation. In embodiments where the destination computing device is associated with a multiplayer online game the latency service may recommend network access locations at which other players of the multiplayer online game are connected and or provide a heat map indicating the same.

Referring next to an exemplary block diagram illustrates the latency service storing computer executable components for calculating and providing latency estimations. The latency service includes or has access to one or more computer readable media such as a memory area . The memory area stores the aggregated latency records e.g. aggregated from the plurality of computing devices . The memory area also stores one or more computer executable components. Exemplary components include an interface component a measurement filter component an estimator component and a recommendation component . The interface component when executed by at least one processor of the latency service causes the processor to receive a request for a latency estimation for sending data from a first computing device to a second computing device. In some embodiments the interface component includes a network interface card and or computer executable instructions e.g. a driver for operating the network interface card. Alternatively or in addition the interface component includes a graphics card for displaying data to the user and receiving data from the user. The interface component may also include computer executable instructions e.g. a driver for operating the graphics card. Further the interface component may include a display e.g. a touch screen display and or computer executable instructions e.g. a driver for operating the display. The interface component may also include one or more of the following to provide data to the user or receive data from the user speakers a sound card a camera a microphone a vibration motor and one or more accelerometers. For example the user may input commands or manipulate data by moving the computing device in a particular way.

The measurement filter component when executed by the processor of the latency service causes the processor to access relationships derived from the latency factors and latency measurements aggregated from a plurality of computing devices . The estimator component when executed by the processor of the latency service causes the processor to calculate the latency estimation based on the relationships accessed by the measurement filter and the latency factors of the first computing device received by the interface component . The calculated latency estimation may include a sum of a first latency value from the first computing device to a cell site identified by the cell site identifier a second latency value from the cell site to an access point identified by the APN and a third latency value from the access point to the second computing device. The interface component further executes to provide the calculated latency estimation to the first computing device.

In some embodiments the estimator component calculates the second latency value by determining a latency from the first computing device to the access point identified by the APN from the request received by the interface component . For example the first computing device pings the access point to determine this latency e.g. performs trace routes using Internet Control Message Protocol packets . Using the exemplary latency factors from Table 1 the latency between the first computing device and the APN may be expressed as shown in Equation 4 below. latency tower APN histogram latency where tower tower APN APN 4 

Other embodiments may conclude that the minimum latency measurement observed in the aggregated latency records involving the cell site APN and signal strength specified in the request represents the inherent latency between the first computing device and the APN . In such embodiments the latency between the first computing device and the APN may be expressed as shown in Equation 5 below. latency tower APN minimum latency where tower tower APN APN 5 

The first latency value is then subtracted from the determined latency between the first computing device and the access point to obtain the second latency value. In some embodiments a set of third latency values is maintained by a third party service. In such embodiments the estimator component accesses the third party service to retrieve the third latency value for the particular set of latency factor values from the received request. The third party service may include for example a network coordinate system that builds virtual coordinates of Internet nodes or elements to predict latencies between the nodes.

Using the exemplary latency factors from Table 1 the latency between the APN and the destination computing device may be expressed as shown in Equation 6 below. latency APN destination t 6 

Some embodiments include the recommendation component . The recommendation component when executed by the processor of the latency service causes the processor to compare the latency estimation calculated by the estimator component with a pre defined threshold. Based on the comparison the recommendation component selects one or more alternative cell sites. For example if the calculated latency estimation exceeds the pre defined threshold the recommendation component selects the alternative cell sites having latencies that will reduce the calculated latency estimation to less than the pre defined threshold. The selected alternative cell sites are identified to the first computing device. The first computing device then may connect to one of the selected cell sites to experience reduced latency.

Referring next to an exemplary block diagram illustrates network elements involved in communication between mobile computing devices and destination computing devices . The mobile computing devices connect to cell sites. The cell sites connect to mobile operator networks such as mobile operator network 1 and mobile operator network 2. Exemplary mobile operator networks include one or more radio network controllers RNC serving general packet radio service GPRS support nodes SGSN gateway GPRS support nodes GGSN and APNs . Each mobile operator network may have multiple APNs where each APN corresponds to a particular type of class of service.

The first latency value second latency value and third latency value for each of the mobile computing devices are dependent at least on the particular cell sites and mobile operator networks to which each of the mobile computing devices is connected.

In some embodiments the set of exemplary latency factors describing the context of a latency measurement includes additional or fewer factors. For example the set of latency factors associated with one of the latency records may include an Internet Protocol IP address or a mobile operator name associated with the computing device performing the measurement instead of including the APN . In such an example the IP address acts as a replacement for the APN . The latency service may be able to identify the APN from the IP address and or the mobile operator name.

While aspects of the disclosure have been described with reference to an APN such as APN other embodiments are operable with other network configurations. In general the APN is an access proxy representing the last point on the mobile operator network before traffic goes to the Internet. The access proxy is also the last point that is visible to the computing device as part of the configuration of the computing device . Aspects of the disclosure are operable with any such access proxy.

At least a portion of the functionality of the various elements in may be performed by other elements in or an entity e.g. processor web service server application program computing device etc. not shown in .

In some embodiments the operations illustrated in and may be implemented as software instructions encoded on a computer readable medium in hardware programmed or designed to perform the operations or both. For example aspects of the disclosure may be implemented as a system on a chip.

While no personally identifiable information is tracked by aspects of the disclosure embodiments may have been described with reference to data monitored and or collected from users. In such embodiments notice is provided to the users of the collection of the data e.g. via a dialog box or preference setting and users are given the opportunity to give or deny consent for the monitoring and or collection. The consent may take the form of opt in consent or opt out consent.

Exemplary computer readable media include flash memory drives digital versatile discs DVDs compact discs CDs floppy disks and tape cassettes. By way of example and not limitation computer readable media comprise computer storage media and communication media. Computer storage media store information such as computer readable instructions data structures program modules or other data. Communication media typically embody computer readable instructions data structures program modules or other data in a modulated data signal such as a carrier wave or other transport mechanism and include any information delivery media. Combinations of any of the above are also included within the scope of computer readable media.

Although described in connection with an exemplary computing system environment embodiments of the invention are operational with numerous other general purpose or special purpose computing system environments or configurations. Examples of well known computing systems environments and or configurations that may be suitable for use with aspects of the invention include but are not limited to mobile computing devices personal computers server computers hand held or laptop devices multiprocessor systems gaming consoles microprocessor based systems set top boxes programmable consumer electronics mobile telephones network PCs minicomputers mainframe computers distributed computing environments that include any of the above systems or devices and the like.

Embodiments of the invention may be described in the general context of computer executable instructions such as program modules executed by one or more computers or other devices. The computer executable instructions may be organized into one or more computer executable components or modules. Generally program modules include but are not limited to routines programs objects components and data structures that perform particular tasks or implement particular abstract data types. Aspects of the invention may be implemented with any number and organization of such components or modules. For example aspects of the invention are not limited to the specific computer executable instructions or the specific components or modules illustrated in the figures and described herein. Other embodiments of the invention may include different computer executable instructions or components having more or less functionality than illustrated and described herein.

Aspects of the invention transform a general purpose computer into a special purpose computing device when configured to execute the instructions described herein.

The embodiments illustrated and described herein as well as embodiments not specifically described herein but within the scope of aspects of the invention constitute exemplary means for estimating the latency between the first computing device and the second computing device.

The order of execution or performance of the operations in embodiments of the invention illustrated and described herein is not essential unless otherwise specified. That is the operations may be performed in any order unless otherwise specified and embodiments of the invention may include additional or fewer operations than those disclosed herein. For example it is contemplated that executing or performing a particular operation before contemporaneously with or after another operation is within the scope of aspects of the invention.

When introducing elements of aspects of the invention or the embodiments thereof the articles a an the and said are intended to mean that there are one or more of the elements. The terms comprising including and having are intended to be inclusive and mean that there may be additional elements other than the listed elements.

Having described aspects of the invention in detail it will be apparent that modifications and variations are possible without departing from the scope of aspects of the invention as defined in the appended claims. As various changes could be made in the above constructions products and methods without departing from the scope of aspects of the invention it is intended that all matter contained in the above description and shown in the accompanying drawings shall be interpreted as illustrative and not in a limiting sense.

