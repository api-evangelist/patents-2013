---

title: Handling session initiation protocol messages in a wireless telecommunications device
abstract: A wireless telecommunications device configured to use Session Initiation Protocol in communication with other telecommunications devices comprises a modem subsystem configured to deploy Internet Protocol Multimedia Subsystem services using Session Initiation Protocol and comprising a Session Initiation Protocol stack; and an application processing engine configured to deploy Internet Protocol Multimedia Subsystem services using Session Initiation Protocol and comprising a Session Initiation Protocol stack. The device comprises a logical element configured to capture Session Initiation Protocol messages from Internet Protocol Multimedia Subsystem services to an external Session Initiation Protocol proxy server and to function as a Session Initiation Protocol Back-to-Back User Agent; and send to the external Session Initiation Protocol proxy server Session Initiation Protocol messages based on the captured messages. The need for special Application Programming Interface between the two subsystems is avoided, and multiple SIP request messages need no longer be sent.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09509724&OS=09509724&RS=09509724
owner: TELEFONAKTIEBOLAGET LM ERICSSON (PUBL)
number: 09509724
owner_city: Stockholm
owner_country: SE
publication_date: 20130220
---
The invention relates to handling Session Initiation Protocol messages in a wireless telecommunications device configured to use Session Initiation Protocol in communication with at least one other telecommunications device.

Session Initiation Protocol SIP is a signalling protocol used e.g. for controlling communication sessions such as voice or video calls over Internet Protocol IP . The protocol is used for creating modifying and terminating two party or multiparty sessions. SIP applications also include video conferencing streaming multimedia distribution instant messaging file transfers and online games. A SIP telecommunications device e.g. a SIP phone is a SIP user agent that provides traditional call functions of a telephone such as dial answer reject hold unhold and call transfer. SIP is increasingly implemented as a standard telephony platform.

One application using SIP is Internet Protocol Multimedia Subsystem IMS services. IMS is an architectural framework for delivering Internet Protocol IP multimedia services and it uses a protocol such as the SIP protocol.

The major parts of a mobile phone using SIP consist of a modem subsystem and an Application Processing Engine APE . In many cases IMS services are deployed both on the modem subsystem and the APE. A telephony oriented IMS service e.g. Voice over Long Term Evolution LTE or multimedia telephony IMS service is naturally deployed on the modem subsystem as a counterpart to the circuit switched telephony service. A rich communication IMS service e.g. Rich Communication Suite RCS presence and file transfer is naturally deployed on the APE close to deployment of phone book and file system.

The APE and the modem subsystem cannot communicate directly without the use of special Application Programming Interface API between them. It is intricate to define such an Application Programming Interface since the two subsystems belong to different administrative domains.

Both the modem subsystem and the APE may have its own SIP stack so that the IMS services are sending their SIP registrations to the SIP registrar completely independent of each other. The problem with this is that since every IMS service performs its own SIP registration multiple SIP request messages are sent from the mobile phone to the SIP registrar. This means wasting of both network resources and processing and storage resources at the SIP registrar.

One way to avoid this could be to have only one common SIP stack deployed on the modem subsystem and to let all IMS services make use of this common SIP stack. However a problem with this is that a common SIP stack used by both IMS services on the APE and IMS services on the modem subsystem requires new APIs between the APE and the modem subsystem. This is disadvantageous due to the fact that the APE and the modem subsystem belong to different administrative domains. Furthermore no standardized or de facto API exists for this purpose.

US 2009 0245233 shows a system in which an application uses a Session Initiation Protocol SIP user agent and a third party SIP stack to establish connection and manage sessions and call states. The SIP user agent comprises special application interface needed to enable the application to interface with the third party SIP stack while the third party SIP stack enabled the SIP user agent to manage SIP services associated with the application and a session.

Therefore it is an object of embodiments of the invention to obviate at least some of the above disadvantages and provide an improved method of handling Session Initiation Protocol messages in a wireless telecommunications device.

According to embodiments of the invention the object is achieved in a method of handling Session Initiation Protocol messages in a wireless telecommunications device configured to use Session Initiation Protocol in communication with at least one other telecommunications device wherein the device comprises a modem subsystem configured to deploy Internet Protocol Multimedia Subsystem services using Session Initiation Protocol and comprising a Session Initiation Protocol stack for exchanging Session Initiation Protocol messages between Internet Protocol Multimedia Subsystem services on the modem subsystem and an external Session Initiation Protocol proxy server and an application processing engine configured to deploy Internet Protocol Multimedia Subsystem services using Session Initiation Protocol and comprising a Session Initiation Protocol stack for exchanging Session Initiation Protocol messages between Internet Protocol Multimedia Subsystem services on the application processing engine and the external Session Initiation Protocol proxy server. The object is achieved when the method comprises the steps of capturing Session Initiation Protocol messages from Internet Protocol Multimedia Subsystem services to the external Session Initiation Protocol proxy server in a logical element configured to function as a Session Initiation Protocol Back to Back User Agent with a Session Initiation Protocol stack connected to the Session Initiation Protocol stacks of the modem subsystem and the application processing engine and to the external Session Initiation Protocol proxy server and sending from said logical element to the external Session Initiation Protocol proxy server Session Initiation Protocol messages based on said captured Session Initiation Protocol messages.

When Session Initiation Protocol messages from Internet Protocol Multimedia Subsystem services to the external Session Initiation Protocol proxy server are captured in a logical element that is configured to function as a Session Initiation Protocol Back to Back User Agent the need for special Application Programming Interface API between the two subsystems is avoided and multiple SIP request messages need no longer be sent from the mobile phone to the SIP registrar because the Initiation Protocol Back to Back User Agent can now merge SIP messages from the IMS services of the two subsystems.

In one embodiment the method further comprises the steps of storing in said logical element when an outgoing SIP REGISTER request message is received from a not registered Internet Protocol Multimedia Subsystem service deployed in the modem subsystem or the application processing engine parameters specific for that Internet Protocol Multimedia Subsystem service merging if parameters for other previously registered Internet Protocol Multimedia Subsystem services are already stored the parameters for the not registered Internet Protocol Multimedia Subsystem service with the parameters for the previously registered Internet Protocol Multimedia Subsystem services and sending a SIP REGISTER request message with the merged parameters to the external Session Initiation Protocol proxy server. Merging parameters from several IMS services greatly reduces the number of SIP registration and re registration requests sent from the device to the external proxy server.

In such embodiment the method may further comprise the step of sending when a SIP REGISTER response message is received from the external Session Initiation Protocol proxy server a SIP REGISTER response message to the not registered Internet Protocol Multimedia Subsystem service from which the outgoing SIP REGISTER request message was received.

In some embodiments the method further comprises the steps of storing in said logical element when a first outgoing SIP SUBSCRIBE request message is received from an Internet Protocol Multimedia Subsystem service deployed in the modem subsystem or the application processing engine that Internet Protocol Multimedia Subsystem service as a subscriber sending a SIP SUBSCRIBE request message to the external Session Initiation Protocol proxy server and sending when a SIP SUBSCRIBE response message is received from the external Session Initiation Protocol proxy server a SIP SUBSCRIBE response message to that Internet Protocol Multimedia Subsystem service.

In such embodiments the method may further comprise the step of storing when a further outgoing SIP SUBSCRIBE request message is received from an Internet Protocol Multimedia Subsystem service deployed in the modem subsystem or the application processing engine that Internet Protocol Multimedia Subsystem service as a subscriber sending a SIP SUBSCRIBE response message to that Internet Protocol Multimedia Subsystem service and sending a SIP NOTIFY request message to that Internet Protocol Multimedia Subsystem service with information from a SIP NOTIFY request message previously received from the external Session Initiation Protocol proxy server. In this way also the number of SIP SUBSCRIBE request messages can be considerably reduced.

Some embodiments of the invention also relate to a wireless telecommunications device configured to use Session Initiation Protocol for controlling communication sessions with at least one other telecommunications device the device comprising a modem subsystem configured to deploy Internet Protocol Multimedia Subsystem services using Session Initiation Protocol and comprising a Session Initiation Protocol stack for exchanging Session Initiation Protocol messages between Internet Protocol Multimedia Subsystem services on the modem subsystem and an external Session Initiation Protocol proxy server and an application processing engine configured to deploy Internet Protocol Multimedia Subsystem services using Session Initiation Protocol and comprising a Session Initiation Protocol stack for exchanging Session Initiation Protocol messages between Internet Protocol Multimedia Subsystem services on the application processing engine and the external Session Initiation Protocol proxy server. The device further comprises a logical element configured to capture Session Initiation Protocol messages from Internet Protocol Multimedia Subsystem services to the external Session Initiation Protocol proxy server and to function as a Session Initiation Protocol Back to Back User Agent with a Session Initiation Protocol stack connected to the Session Initiation Protocol stacks of the modem subsystem and the application processing engine and to the external Session Initiation Protocol proxy server and send to the external Session Initiation Protocol proxy server Session Initiation Protocol messages based on said captured Session Initiation Protocol messages.

Embodiments corresponding to those mentioned above for the method also apply for the wireless telecommunications device.

In some embodiments the device further comprises a packet filter with the Internet Protocol address and port number of the external Session Initiation Protocol proxy server said packet filter being configured to forward packets matching the filter to said logical element.

The logical element may further be configured to send when an incoming SIP OPTIONS request message is received a SIP OPTIONS request message to all registered Internet Protocol Multimedia Subsystem services in the modem subsystem and the application processing engine collect SIP OPTIONS response messages from the registered Internet Protocol Multimedia Subsystem services merge received SIP OPTIONS response messages into a common SIP OPTIONS response message and send the merged SIP OPTIONS response message back to the originator of the incoming SIP OPTIONS request message. This gives a common SIP OPTIONS response for all Internet Protocol Multimedia Subsystem services in the device.

In some embodiments the logical element is further configured to act as a Session Initiation Protocol proxy server for Session Initiation Protocol messages that are not handled by the Session Initiation Protocol Back to Back User Agent.

Some embodiments of the invention relate to a computer program and a computer readable medium with program code means for performing the method described above.

A SIP telecommunications device e.g. a SIP phone is a SIP user agent that provides traditional call functions of a telephone such as dial answer reject hold unhold and call transfer. SIP is increasingly implemented as a standard telephony platform. These functions are implemented on a modem subsystem of the telecommunications device

One type of application using SIP is Internet Protocol Multimedia Subsystem IMS services. IMS is an architectural framework for delivering Internet Protocol IP multimedia services and it uses a protocol such as the SIP protocol. Thus a number of telephony oriented IMS services such as Voice over Long Term Evolution LTE or multimedia telephony IMS service is naturally deployed on the modem subsystem as a counterpart to the circuit switched telephony service. This is illustrated with the IMS service in . The IMS service has a SIP stack used for communication with corresponding SIP stacks in other SIP network elements.

In the IMS service communicates with a SIP proxy server with the SIP stack . The SIP proxy server can be a Proxy Call Session Control Function P CSCF which is the first point of contact for an IMS terminal i.e. the telecommunications device . The SIP proxy server again communicates with another SIP proxy server with the SIP stack . The SIP proxy server can be a Serving Call Session Control Function S CSCF which is a central SIP proxy server in the network.

SIP makes use of transactions and messages. There are two different types of SIP messages i.e. request messages and response messages and a transaction consists of e.g. a client request that invokes a particular function on a server and results in a response that is sent back to the client. A transaction can also be a server request that should be responded to by a client.

As mentioned above the major parts of a mobile phone using SIP consists of two subsystems i.e. a modem subsystem and an Application Processing Engine APE and in many cases IMS services are deployed both on the modem subsystem and the APE. While a telephony oriented IMS service e.g. Voice over Long Term Evolution LTE or multimedia telephony IMS service is naturally deployed on the modem subsystem as a counterpart to the circuit switched telephony service a rich communication IMS service e.g. Rich Communication Suite RCS presence and file transfer is naturally deployed on the APE close to deployment of phone book and file system. This is illustrated in with the IMS service deployed on the APE . The IMS service has a SIP stack used for communication with corresponding SIP stacks in other SIP network elements such as the SIP proxy server .

The APE and the modem subsystem cannot communicate directly without the use of special Application Programming Interface API between them. Thus in both the modem subsystem and the APE have their own SIP stack I.e. the SIP stack in the modem subsystem and the SIP stack in the APE so that the IMS services are sending their SIP registrations to the SIP registrar a server that accepts SIP REGISTER requests from a SIP client e.g. an IMS service completely independent of each other. This means that since every IMS service performs its own SIP registration multiple SIP request messages are sent from the mobile phone to the SIP registrar. This means wasting of both network resources and processing and storage resources at the SIP registrar.

As illustrated in this can be avoided by having only one common SIP stack deployed on the modem subsystem and to let all IMS services and make use of this common SIP stack . However a problem with this is that the common SIP stack used by both IMS services on the APE and IMS services on the modem subsystem as mentioned above requires new Application Programming Interfaces between the APE and the modem subsystem. This is disadvantageous due to the fact that the APE and the modem subsystem belong to different administrative domains. Furthermore no standardized or de facto Application Programming Interface exists for this purpose.

In a new entity or logical element with its own SIP stack is arranged in the modem subsystem . The SIP stack is connected to the SIP stacks and of the modem subsystem and the APE respectively and also to the SIP stack of the external SIP proxy server P CSCF . The logical element is in the following also designated as SBP because as described below the logical element is configured to function as a SIP Back to Back User Agent SIP B2BUA and possibly also as a SIP proxy server.

The logical element SBP is capturing all SIP messages from the IMS services and with destination to the outbound SIP proxy server P CSCF . This is described in more detail in . The outgoing SIP messages from the IMS service of the modem subsystem go from the SIP stack to the SIP stack of the SBP via an IP stack as indicated by the dashed arrows in . A packet filter with the IP address and port number of the P CSCF is installed in the modem subsystem and all packets from IMS services on the APE matching the filter are forwarded to the SBP via the IP stack as indicated by the dotted arrows in . The SIP stack on the APE is not aware of the SBP. The SIP stack on the APE behaves as if it is sending and receiving SIP messages directly to and from the P CSCF. Based on the SIP messages captured by the logical element SBP SIP messages are then sent from the SIP stack via the IP stack and the cellular access to the external SIP proxy server P CSCF as indicated by the full line arrows in . These SIP messages may either be the captured SIP messages substantially unchanged or they may be merged with other captured SIP messages depending on the type of the captured SIP messages as it will be described in more detail below.

This is also illustrated in the flow chart of . First in step the SIP messages from IMS services on the modem subsystem and or the APE are captured in the logical element SBP . Then in step SIP messages based on the captured SIP messages are sent to the external SIP proxy server P CSCF.

The SBP may act as a SIP B2BUA for SIP registration related transactions. SIP registration related transactions are SIP REGISTER transactions and SIP SUBSCRIBE and SIP NOTIFY transactions for reg events. SBP is merging SIP REGISTER messages from all running IMS services so that one single SIP REGISTER message carries information about all running IMS services to the SIP registrar. This is illustrated in . Furthermore the SBP may be handling authentication and the Security Association SA to the outbound SIP proxy server P CSCF . Each of these transactions are described in more detail below.

For SIP registration related transactions the SBP is acting as a SIP B2BUA. Acting as a SIP B2BUA SBP has different behaviour towards different entities. From any IMS service point of view either on the modem subsystem or the APE SBP is handling SIP registration related transactions as if the IMS service was the only IMS service running in the mobile phone. From P CSCF and S CFCF point of view SBP is handling SIP registration related transactions on behalf of all IMS services running in the mobile phone.

When the SBP receives the first outgoing SIP REGISTER request message in step from any IMS service the SBP will handle the message in following way. In step all parameters in the SIP REGISTER message that are specific to this IMS service e.g. feature tags in the Contact header are stored. If it is detected in step that the received SIP REGISTER request message is a first one a new SIP REGISTER request message is sent in step to the P CSCF with parameters specific for this IMS service. When SIP REGISTER response is received from the P CSCF in step SBP will in step send a SIP REGISTER response back to the originating IMS service.

When the SBP receives another outgoing SIP REGISTER request message in step from any other IMS service the SBP will handle the message in following way. In step all parameters in the SIP REGISTER message that are specific to this IMS service e.g. feature tags in the Contact header are stored. If it is detected in step that the received SIP REGISTER request message is not a first one all parameters specific for this IMS service are merged in step with all parameters specific for all other registered IMS services. In step a SIP re REGISTER request message is then sent to the P CSCF with the merged parameters for all registered IMS services. When SIP REGISTER response is received from the P CSCF in step SBP will in step send a SIP REGISTER response back to the originating IMS service.

In order to avoid frequent transmissions of re registration e.g. after power on of the mobile phone the SBP may delay transmission of the registration message from the first IMS service in order to await possible registration message from any other IMS service.

The handling of SIP SUBSCRIBE and SIP NOTIFY Transactions for reg Events is illustrated in the flow chart shown in .

When the SBP receives the first outgoing SIP SUBSCRIBE request message for reg events in step from any IMS service the SBP will handle the message in following way. In step this IMS service is stored as subscriber for reg events. If it is detected in step that the received SIP SUBSCRIBE request message is a first one a new SIP SUBSCRIBE request message for reg events is sent in step to the P CSCF. When SIP SUBSCRIBE response is received in step from the P CSCF SBP will send a SIP SUBSCRIBE response back to the originating IMS service in step .

When the SBP receives another outgoing SIP SUBSCRIBE request message for reg events in step from any other IMS service the SBP will handle the message in following way. In step this IMS service is stored as subscriber for reg events. If it is detected in step that the received SIP SUBSCRIBE request message is not a first one a SIP SUBSCRIBE response is sent back to the originating IMS service in step and a SIP NOTIFY request message is sent to the originating IMS service in step with the information from the last received SIP NOTIFY request message from the P CSCF.

When SBP in step receives a SIP NOTIFY request for reg event from the P CSCF the SBP sends in step a SIP NOTIFY request to all IMS services that are subscribers for reg events and sends in step SIP NOTIFY response back to the P CSCF.

The SBP is furthermore handling authentication and the Security Association SA to the outbound SIP proxy server P CSCF . The SBP will thus autonomously handle SIP response messages with response code and . This means that there is a trusted relationship between the SBP and the IMS services both on the modem subsystem and the APE.

The handling of Incoming SIP OPTIONS Transactions is described below with reference to the flow chart in .

When a mobile phone in step receives a SIP OPTIONS request message without any Accept Contact or Reject Contact headers it is expected to take all IMS services in the mobile phone into account when constructing the SIP OPTIONS response message.

The SBP may handle incoming SIP OPTIONS request as a B2BUA in following way. In step the SIP OPTIONS request is sent further on to all registered IMS services in the mobile phone. In step all SIP OPTIONS responses from the registered IMS services are collected and all received SIP OPTIONS responses are merged in step into one common SIP OPTIONS response representing all registered IMS services. Finally in step the merged SIP OPTIONS response is sent back to the originator of the SIP OPTIONS request.

Other SIP Transactions i.e. SIP transactions besides the SIP registration related transactions and incoming SIP OPTIONS transactions may be handled by SBP in any of following ways 

These three methods have different level of complexity to implement and different memory requirements. The SIP B2BUA is the most complex method and has highest memory requirement. The SBP may thus be configured to act as a SIP proxy server instead of a SIP B2BUA for other SIP transactions.

With the solution described above there is neither wasting of network resources nor wasting of processing and storage resources at the SIP registrar. Further there is no requirement on new Application Programming Interfaces between the APE and the modem subsystem. Finally there are no dependencies between different IMS services. Every IMS service is developed as if it is the only IMS service on the mobile phone. This is important since IMS services may be developed by 3party developers.

Although various embodiments of the present invention have been described and shown the invention is not restricted thereto but may also be embodied in other ways within the scope of the subject matter defined in the following claims.

