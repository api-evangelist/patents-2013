---

title: Image forming apparatus, method for controlling image forming apparatus, and storage medium with deciding unit for orientation of image to be printed
abstract: A system comprises a conveying unit configured to convey an original, a reading unit configured to read the original that is being conveyed by the conveying unit, a printing unit configured to print an image on a paper based on an image of the original read by the reading unit, a determination unit configured to determine an orientation of the original according to the image obtained by reading the original with the reading unit, and a deciding unit configured to decide an orientation of an image that is to be printed on the original, according to the orientation of the original determined by the determination unit, wherein the printing unit prints the image on the original, in the orientation of the image decided by the deciding unit.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09016688&OS=09016688&RS=09016688
owner: Canon Kabushiki Kaisha
number: 09016688
owner_city: Tokyo
owner_country: JP
publication_date: 20130426
---
The present invention relates to an image forming apparatus a method for controlling an image forming apparatus and a storage medium.

Recently image forming apparatuses provided with hardware resources such as a scanner and a printer are installed at offices homes and the like and processing such as copying printing facsimile transmission and the like is performed on a daily basis. Such image forming apparatuses can perform printing on various sheets and for example may perform printing on paper such as a postcard having front and back surfaces or upper and lower orientations. If a user feeds a postcard in a wrong orientation at the time of printing the printed paper becomes upside down or its front and back are reversed with respect to the intended content.

Japanese Patent Laid Open No. 2002 226084 discloses a technique in which a mark detection sensor for detecting the front and back of a postcard is disposed in a paper feed tray of a printing apparatus or on a conveying path from the paper feed tray to an image forming unit. Furthermore it is described that the printing apparatus uses the mark detection sensor to detect the front and back or upper and lower orientations of a postcard and performs printing after reversing as necessary the front and back surfaces or upper and lower orientations of an image that is to be printed on the paper according to the detection result.

However according to the above described conventional technique a dedicated mark detection sensor has to be provided in order to determine the orientation of a paper for printing.

The present invention enables realization of a system that determines the orientation of an image of an original read by a reading unit configured to read an image of an original and prints an image in the same orientation as the determined orientation of the image.

One aspect of the present invention provides an image forming apparatus comprising a conveying unit configured to convey an original a reading unit configured to read the original that is being conveyed by the conveying unit a printing unit configured to print a print image on a paper based on a read image of the original read by the reading unit a determination unit configured to determine an orientation of the original according to the read image obtained by reading the original with the reading unit and a deciding unit configured to decide an orientation of the print image that is to be printed on the original according to the orientation of the original determined by the determination unit wherein the printing unit prints the print image on the original in the orientation of the print image decided by the deciding unit.

Further features of the present invention will be apparent from the following description of exemplary embodiments with reference to the attached drawings.

Embodiments of the present invention will now be described in detail with reference to the drawings. It should be noted that the relative arrangement of the components the numerical expressions and numerical values set forth in these embodiments do not limit the scope of the present invention unless it is specifically stated otherwise.

Hereinafter reading processing and printing processing of an image using a printing apparatus image forming apparatus will be described with reference to . In this example operations will be described in which both surfaces of an original G fed from a second paper feeding unit are read and the images read from the original G are formed on both surfaces of a sheet S fed from a first paper feeding unit . First an example of the configuration of a printing apparatus will be described with reference to . At the center of a printing apparatus a rotatable photosensitive drum that functions as an image carrier and a development roller that is disposed adjacent to the photosensitive drum and rotates while carrying toner are arranged. Upon receiving a print signal a light emitting unit included in an optical unit emits laser light toward the surface of the photosensitive drum that is rotating. A latent image is formed by electric charge on the surface of the photosensitive drum toward which the laser light has been emitted. The development roller rotates and supplies toner carried thereby to the latent image on the surface of the photosensitive drum . Accordingly a toner image is formed on the surface of the photosensitive drum .

Meanwhile the sheets S accommodated in the first paper feeding unit are conveyed sheet by sheet by a CST pickup roller and a separating unit toward conveying rollers . The conveying rollers convey the sheet S to a transfer unit so as to match the timing of the toner image on the surface of the photosensitive drum and the leading edge of the sheet S. In this example the sheet refers to a medium on which the printing apparatus can print an image and examples thereof include media made of various materials such as paper OHP sheet and the like.

The toner image that has been conveyed to the transfer unit by the rotation of the photosensitive drum is transferred to the sheet S with application of bias and pressure to the transfer unit . Furthermore the transfer unit conveys the sheet S to a fixing unit . In the fixing unit heat from a rotatable heat roller and pressure from a rotatable pressure roller that opposes the heat roller cause the toner image to be fixed onto the sheet S. The sheet S onto which the toner image has been fixed is conveyed to paper discharge rollers . In the case of simplex printing the paper discharge rollers convey the sheet S out of the apparatus without any further processing and the sheet S is stacked in a first paper discharge unit first discharge unit . Furthermore constituent components of the printing apparatus are controlled by an electrical component which will be described later with reference to . Note that a conveying path on which a sheet fed from the first paper feeding unit is printed and is discharged to the first paper discharge unit is referred to as a first conveying path.

Next duplex printing processing will be described with reference to . After passage of the trailing edge of the sheet S a duplex flapper switches the conveying path. Subsequently the paper discharge rollers rotate in reverse and convey the sheet S to a duplex conveying path second conveying path . The sheet S that has been switched back is conveyed via conveying rollers to an image reading unit . As shown in the image reading unit is disposed near the duplex conveying path . Subsequently the sheet S is conveyed to conveying rollers and and again to the transfer unit in which a toner image is transferred to the back surface of the sheet S a surface that is different from the transfer surface described with reference to and after fixing the sheet is stacked in the first paper discharge unit .

Next processing that reads the information of an original and performs duplex printing on a sheet will be described with reference to . The originals G accommodated in the second paper feeding unit are conveyed sheet by sheet by a CIS pickup roller and a separating unit toward the conveying rollers . Meanwhile the image reading unit emits light toward a white reference member and performs white reference value correction and then rotates to a position at which it faces the duplex conveying path the position shown in before start of reading a first surface which is the front surface of the original G fed from the second paper feeding unit . That is to say the image reading unit rotates to a position at which it reads an image of the original G that is being conveyed on the duplex conveying path . The conveying rollers convey the original G to the image reading unit . The image reading unit has been already put on standby at a position at which it faces the duplex conveying path and information read by the image reading unit is stored as information on the first surface of the original in an image memory which will be described later with reference to . Note that the white reference member is arranged downward in consideration of attachment of dust.

Next an operation performed at the time of end of reading a first surface which is the front surface of the original will be described with reference to . The original G that has passed by the image reading unit is conveyed to the conveying rollers . The conveying rollers stop when the trailing edge of the original G has passed by a switch back flapper . At that time the original G has stopped in a state where it is held between the conveying rollers . After the elapse of a predetermined time the conveying rollers rotate in reverse and convey the original G to an original dedicated conveying path third conveying path . At that time the original G may be conveyed to the conveying rollers without being stopped at the conveying rollers so as to be subjected to the image formation process described with reference to after the reading process on the first surface.

Next an operation performed at the time of start of reading a second surface which is the back surface of the first surface will be described with reference to . At the same time as the switch back flapper switches the conveying path from the duplex conveying path to the original conveying path the image reading unit rotates to a position at which it faces the original conveying path . That is to say the image reading unit rotates to a position at which it reads an image of the sheet that is being conveyed on the original conveying path . When the conveying rollers rotate in reverse the original G is conveyed along the original conveying path to the image reading unit . When the original G is conveyed to and passes by the image reading unit information on a second surface which is the back surface of the original is read and stored in the image memory as information on the second surface of the original. In this manner the image reading unit is disposed between the duplex conveying path and the original conveying path and can move so as to read images of a sheet conveyed on both the conveying paths.

When the reading of the second surface of the original G starts the sheets S fed from the first paper feeding unit are conveyed sheet by sheet to the conveying rollers . At substantially the same time based on an image read from the second surface which is the back surface of the original stored in the image memory a latent image of this image information is formed by the light emitting unit on the photosensitive drum . Next a toner image formed based on the latent image is transferred by the transfer unit to the sheet S after which the sheet is conveyed to the fixing unit and thus image formation of the second surface of the original is completed. Note that in feeding of the sheet S is started when reading of information on the second surface which is the back surface of the original is started but the sheet S may be conveyed after information on the second surface has been read.

Next an operation performed at the time of end of reading the back surface of the original will be described with reference to . The original G from which an image has been read is conveyed to conveying rollers and and is stacked in a second paper discharge unit second discharge unit . The switch back flapper detects that the trailing edge of the original G has passed thereby using a sensor not shown that is provided upstream of the switch back flapper in the conveying direction. Subsequently the conveying path is switched from the original conveying path to the duplex conveying path such that the sheet S that has been subjected to duplex printing is conveyed toward the conveying rollers . The sheet S on which formation of the image read from the second surface of the original G is completed is conveyed by the reverse rotation of the paper discharge rollers toward the duplex conveying path to which the conveying path has been switched by the duplex flapper in order to perform image formation on the back surface.

Next an operation performed at the time of image formation on the sheet S based on the image read from the first surface of the original will be described with reference to . The sheet S that has been conveyed to the duplex conveying path passes by the image reading unit facing the other side and is conveyed via the conveying rollers to the conveying rollers that is conveyed again to the transfer unit as the sheet S indicated by the broken line. On the sheet S the image formation of the second surface of the original has ended and an image of the first surface of the original is formed based on image information on the first surface of the original stored in the image memory . Specifically the toner image is transferred and fixed onto the sheet S by the image forming unit configured by the optical unit the photosensitive drum the development roller the transfer unit and the fixing unit after which the sheet is discharged and stacked in the first paper discharge unit .

As described above in the printing apparatus according to this embodiment part of the conveying path for the original G and part of the conveying path for the sheet S are configured as a common path. Specifically the conveying path for reading the first surface of the original G and the conveying path for performing duplex printing on the sheet S are configured as a common path. Accordingly the apparatus can be made smaller.

Next an operation of a control CPU and an ASIC of a printer described later in image formation of this embodiment will be described with reference to . shows the configuration of units that are controlled by the control CPU . As shown in the control CPU is connected via the ASIC to the light emitting unit including a polygon mirror a motor a laser light emitting element and the like. In order to form a desired latent image by performing scanning with laser light on the photosensitive drum the control CPU outputs a control signal to the ASIC and controls the optical unit . In a similar manner in order to convey the sheet S the control CPU controls a main motor for driving the CST pickup roller the conveying rollers the photosensitive drum the transfer unit the heat roller and the pressure roller . Furthermore the control CPU controls a CST paper feed solenoid that is turned on when starting to drive the paper feed rollers for feeding the sheet S and that drives the CST pickup roller . Moreover the control CPU controls for example a duplex drive motor for driving the CIS pickup roller and the conveying rollers to .

Moreover the control CPU controls a high voltage power source the fixing unit and a low voltage power source for controlling primary charging development primary transfer and secondary transfer bias necessary for electrophotographic processing. Moreover the control CPU monitors the temperature using a thermistor not shown disposed at the fixing unit and performs control such that the fixing temperature is kept constant. Furthermore the control CPU is connected via a bus or the like not shown to a program memory . The program memory stores programs and data for executing part or the whole of the above described control operations and processes performed by the control CPU in the embodiments described in this specification. That is to say the control CPU performs the operations of the embodiments of the present invention using the programs and data stored in the program memory .

Based on the instruction from the control CPU the ASIC controls the velocity of a motor inside the light emitting unit the main motor and the duplex drive motor . The motor velocity is controlled by detecting a TAC signal a pulse signal that is output from a motor each time the motor rotates from the motor and outputting an acceleration or deceleration signal to the motor such that intervals between the detected TAC signals match a predetermined interval. If the control circuit is configured by a hardware circuit of the ASIC in this manner the control load of the control CPU can be reduced.

Upon receiving a print command instructed from a client PC the control CPU drives the main motor the duplex drive motor and the CST paper feed solenoid thereby conveying the sheet S. The toner image formed on the surface of the photosensitive drum is transferred by the transfer unit to the sheet S and is fixed onto the sheet by the fixing unit after which the sheet is discharged by the paper discharge rollers to the first paper discharge unit that functions as a sheet stacking unit. In order to improve the alignment of sheets on which images have been formed the first paper discharge unit is provided with a gentle upward slope from a point near the paper discharge opening in the sheet discharge direction. In this example the control CPU supplies predetermined electrical power via the low voltage power source to the fixing unit and thus a desired amount of heat is generated and applied to the sheet S so that the toner image on the sheet S is fused and fixed thereonto.

Next an operation that reads an original will be described. Upon receiving a scan command instructed from a client PC the control CPU drives a duplex flapper solenoid and the duplex drive motor . Moreover the control CPU operates a CIS paper feed solenoid thereby transmitting the torque of the duplex drive motor to the CIS pickup roller and conveying the original G. The image reading unit is connected to the ASIC with various control signals CISLED CISSTART SYSCLK Sl in Sl select and Sl out which will be described later. The control CPU stores images read by the image reading unit through various types of control via the ASIC in the image memory that is connected to the ASIC . Subsequently the control CPU moves the switch back flapper toward the original dedicated conveying path by operating a switch back solenoid and rotates the duplex drive motor in reverse thereby conveying the original G to the second paper discharge unit .

Next the image reading unit will be described in detail with reference to . shows the circuit block of a CIS sensor contact image sensor . Reference numeral denotes a contact image sensor portion in which for example photodiodes corresponding to 10368 pixels are arranged in an array at a given main scanning density e.g. 1200 dpi . Reference numerals and respectively denote a start pulse CISSTART signal and a transfer clock CISCLK that are given to the CIS sensor. Reference numeral denotes a system clock SYSCLK that decides the operation speed of the CIS sensor. Reference numeral denotes an A D converter. Reference numeral denotes a CIS sampling clock ADCLK that decides a sampling speed of the A D converter . Reference numeral denotes a timing generator. Reference numeral denotes an output buffer. Reference numeral denotes a shift register. Reference numeral denotes a light emitting element control signal CISLED. Reference numeral denotes a current amplifying unit. Reference numeral denotes a light emitting element that emits light uniformly onto the original G.

Next an operation of the image reading unit will be described. When the CISSTART signal is activated the CIS sensor unit starts accumulation of electric charge based on received light and sequentially sets data in the output buffer . Next when the transfer clock CISCLK e.g. approximately 500 kHz to 1 MHz is given the data set in the output buffer is transferred as a CISSNS signal by the shift register to the A D converter . Since the CISSNS signal includes a predetermined data assurance area the sampling has to be performed after the elapse of a predetermined time after the transfer clock CISCLK rises. Furthermore the CISSNS signal is output in synchronization with both rising and falling edges of the transfer clock CISCLK . Accordingly the frequency of the CIS sampling clock ADCLK is set so as to be twice the frequency of the transfer clock CISCLK and the CISSNS signal is sampled at a rising edge of the CIS sampling clock ADCLK .

The timing generator divides the system clock SYSCLK into the CIS sampling clock ADCLK and the transfer clock CISCLK . The phase of the CIS sampling clock ADCLK is delayed by an amount corresponding to the data assurance area with respect to the transfer clock CISCLK .

The CISSNS signal that has been converted by the A D converter into a digital signal is output as serial data to an Sl out signal at a predetermined timing under the control of an output interface circuit . At that time an analog output reference voltage is output to a predetermined number of pixels from the start pulse CISSTART in the CISSNS signal and these pixels cannot be used as effective pixels. Meanwhile a control circuit can perform control such that the A D conversion gain of the A D converter is changed according to an Sl in signal and an Sl select signal . For example if a sufficient contrast of a read image cannot be obtained the control CPU increases the contrast by increasing the A D conversion gain of the A D converter so that images can be read always at a best contrast.

In this example a system has been described in which all pixels are output as the CISSNS signal which is a single output signal but in order to realize high speed reading the pixels may be divided into a plurality of areas and A D conversion may be performed simultaneously in these areas. Furthermore the description above has been given using a CIS sensor as the image reading unit but the present invention is not limited to this and a CMOS sensor a CCD sensor and the like may be applied.

Next the configuration of a document processing system according to this embodiment will be described with reference to . The document processing system is configured by for example a client PC and a multi function digital peripheral MFP multi function peripheral which is a type of printing apparatus image forming apparatus . Note that the present invention is not limited to this system configuration. For example the present invention can be applied also to printing systems including other apparatuses a plurality of client PCs or a plurality of MFPs. The MFP is an apparatus having a copier function a printer function a facsimile function and the like and its configuration will be described later in detail. The apparatuses shown in are communicably connected to each other via a network such as Ethernet registered trademark . The client PC has various applications installed thereon and can give a print instruction for example via a printer driver to the MFP .

The MFP corresponds to the printing apparatus described with reference to . The MFP according to this embodiment reduces useless printing processing using the configuration of the printing apparatus described with reference to in particular the configuration that enables printing processing and scanning processing to be performed on a sheet or an original fed from the first paper feeding unit or the second paper feeding unit . Specifically if a sheet to be printed has an orientation and the user sets the sheet in a wrong orientation on a paper feed cassette or a manual feed tray the first paper feeding unit or the second paper feeding unit or the like the configuration prevents an image from being printed upside down on the sheet and the sheet from being uselessly printed and output.

Next an exemplary hardware configuration for controlling the software of the MFP the printing apparatus will be described with reference to . A control unit is connected to a scanner having the image reading unit that reads an image and the printer that prints an image on a sheet using the transfer unit and the photosensitive drum . Furthermore the control unit is connected to the network and a public line through which the control unit inputs and outputs image information or device information.

The CPU is a processor that comprehensively controls the entire MFP . For example the CPU controls image processing of image data that is to be printed and networks and further controls printing processing by giving a print instruction to the CPU of the printer . A RAM is a system work memory for allowing the CPU to operate and is an image memory for temporarily storing image data. Furthermore the MFP can communicate via a network interface with the client PC according to an instruction from the CPU . For example the MFP receives print data from the client PC .

The RAM functions as a main memory or a work area for the CPU . The RAM stores setting information in the MFP a job log and an operation log during processing and the like. A ROM is a boot ROM that stores a system boot program. An HDD is a hard disk drive that stores system software applications and image data. Furthermore the HDD stores programs for executing the flowcharts in which will be described later. Note that the steps in these flowcharts are executed by the CPU . However the steps in the flowcharts may be executed by a processor other than the CPU or may be executed by the CPU and another processor in cooperation with each other.

An operation unit interface is an interface that controls display on a display screen key input from a touch panel attached on a display screen key input from hardware keys or the like and outputs to an operation unit image data that is to be displayed on the operation unit . Furthermore this interface transmits information input by the user of this system from the operation unit to the CPU . The network interface is connected to the network through which input and output of information are performed. A MODEM modem is connected to a public line through which input and output of information are performed. An SRAM is a non volatile storage medium that can operate at high speed. An RTC is a real time clock that continuously counts the current time even when the control unit is off. In this embodiment the RTC is used when storing the time regarding a job log an operation log and the like described later in a storage device. These devices are arranged on a system bus .

An Image Bus I F is a bus bridge that connects the system bus and an image bus that transfers image data at high speed and converts the data structure. The image bus is configured by a PCI bus or an IEEE1394. Devices arranged on the image bus are as follows. A RIP unit is a raster image processor that expands PDL data into a bitmap image. A device I F connects the scanner and the printer to the control unit and synchronously or asynchronously converts image data. A scanner image processing unit corrects processes and edits image data that has been input. A printer image processing unit performs for example printer correction resolution conversion and the like on image data that is to be output by printing. An encryption processing unit performs encryption processing on data including image data that has been input. A decryption processing unit performs decryption processing on encrypted data.

Next an exemplary hardware configuration of the client PC will be described with reference to . In a CPU a RAM a ROM an input device a network I F a hard disk drive HDD and a display device are communicably connected to each other via a system bus .

The ROM or the HDD stores a program for controlling an operating system an application and the like. The CPU functions as a computer by reading and executing this control program as necessary from the ROM or the HDD into the RAM . Furthermore the CPU communicates with other devices on the network connected via the network I F . The input device is a keyboard a mouse or the like and receives input from a user using this system. The display device is a display screen or the like and displays an input screen or the like for a user using this system.

Next the software configuration of the system according to this embodiment will be described with reference to . The blocks in show functions that are realized by executing software programs processed by the apparatuses in . Note that the software configuration described below may be realized as hardware or as a combination of hardware and software.

First the software configuration of the client PC will be described. The client PC notifies the MFP via a printer driver of an application data print instruction generated by a document preparation application installed on the client PC . The printer driver that has received a print instruction from each application the print instruction from the document preparation application in this example converts the instruction into a print command that can be interpreted by the MFP and transmits it to the MFP . In this example a case is described in which a print command is acquired from the client PC external apparatus but the present invention is not limited to this and a print command that has been input via an user operation using the operation unit or the like may be acquired.

Next the software configuration of the MFP will be described. The MFP analyzes a print command that has been received from the client PC executes the analyzed information as a print job and prints an image based on the received image data on the original G or the sheet S. Hereinafter the software configuration of the MFP will be described following processing at the time of printing.

The print command transmitted from the client PC is received by a print command receiving unit of the MFP . The print command receiving unit passes the received print command to a print job control unit . The print job control unit that has accepted the print command analyzes the print command generates a print job that can be interpreted by the software in the MFP and performs comprehensive control. The print command is configured by page data indicating page contents such as image data font vector data and the like and print setting information such as paper size printing method simplex printing or duplex printing and the like. These aspects will be described later in detail. Hereinafter a sheet also may be referred to as a paper.

The print job control unit is realized mainly by the CPU and the CPU executing various programs. The print job control unit requests a printing processing unit a scanning processing unit and a paper orientation determination unit to perform processing based on the print setting information of the print command so that the print job is executed. The printing processing unit is realized mainly by the CPU and the printer image processing unit executing various programs. The printing processing unit converts the print job accepted from the print job control unit into image data and controls the devices shown in to print the data on a sheet or an original. The scanning processing unit is realized mainly by the CPU and the scanner image processing unit executing various programs. Upon receiving the request from the print job control unit the scanning processing unit controls the devices shown in to scan an original. Then the generated scan image is returned to the print job control unit .

Upon receiving the request from the print job control unit the paper orientation determination unit determines the orientation of a paper sheet using the scan image and the print command accepted together with the request and image data and calculation formulae managed by a paper determination condition management unit and used for the determination. Furthermore as necessary the content of the print command is corrected such that the orientation matches the sheet orientation determined by the paper orientation determination unit . Furthermore instead of correcting the print command it is also possible to perform correction such that the orientation of an image at the time of printing after print command analysis and expansion matches the sheet orientation determined by the paper orientation determination unit .

Next an example of print setting information contained in a print command will be described with reference to . As shown in one set item and one set value form a pair and a set value is held in association with a set item. Examples of set items include paper size paper orientation printing method binding direction paper orientation determination paper orientation determination method and the like. A character string uniquely indicating a vertical and horizontal size of a paper is held as the paper size. For example if a postcard is set a size of height 148 mm and width 100 mm is indicated and if an A sheet is set a size of height 297 mm and width 210 mm is indicated.

The paper orientation indicates a portrait or landscape orientation of a paper and has portrait and landscape as the set values. In the case of portrait the size is the same as the size of a paper and in the case of landscape the size is obtained by switching the height and width of the size of a paper. The printing method includes simplex and duplex methods as the set values. In the case of simplex printing data of all pages is printed on front surfaces of papers and in the case of duplex printing data of odd numbered pages is printed on front surfaces of papers and data of even numbered pages is printed on the back surfaces of the papers. The binding direction indicates the orientation of an image that is to be printed on a back surface in duplex printing and has long edge binding and short edge binding as the set values. In the case of long edge binding printing is performed such that the upper side of a front surface and the upper side of a back surface form the same side of the papers. In the case of short edge binding printing is performed such that the upper side of a front surface and the lower side of a back surface form the same side of the papers.

The paper orientation determination indicates whether or not to scan a paper sheet that is to be printed using the image reading unit in the MFP before printing determine the top and the bottom of the paper using the scan data and correct the page data. If ON is set a scan is performed and the top and the bottom are determined before printing and if OFF is set a scan is not performed and the top and the bottom are not determined before printing. As the paper orientation determination method determination information is set indicating which determination method is to be used if the paper orientation determination is ON. As the set value a character string indicating one determination method stored in advance in the MFP is set. The determination method will be described later in detail with reference to .

Next a list of values and determination methods set as a paper orientation determination method will be described with reference to . The information on this list is managed by the paper determination condition management unit . The paper determination condition management unit manages the character strings shown in the column of determination object in . Furthermore this character string is defined in the paper orientation determination method in the print setting information of the print command. Furthermore as the paper orientation determination method a plurality of determination methods may be set.

The determination method indicates a determination method of a paper in association with each determination object. For example in the case of a Japanese postcard the determination method is to check whether or not there are seven rectangles arranged side by side in the upper right of an image read image obtained by a scan performed before printing. In addition to this there is a determination method to check whether or not the characters a predetermined character string POSTCARD are present by performing analysis using an OCR optical character recognition on the upper portion of an image obtained by a scan performed before printing. Furthermore methods other than the above also may be used such as a method to compare an image held in advance and a similar image and determine whether or not the similarity is a predetermined degree or more. The paper determination condition management unit manages these determination methods as paper determination pattern data. The paper determination pattern data indicates processing for determining the determination object. The determination method may be such that processing of the program branches according to the name and processing corresponding to the name is provided in hard coding or such that the processing is expressed by an individual determination formula and the determination logic is customized with a program for analyzing the determination formula. Furthermore a plug in structure is also possible in which a determination method can be additionally installed from an external terminal that is connected later to the network.

Next a processing procedure will be described with reference to in which the MFP receives a print command from the client PC and performs printing processing. The processing described below is realized by the CPU reading and executing a control program stored in the ROM or the HDD into the RAM .

First in S the print command receiving unit receives a print command from the outside. For example it is detected that a print command from an external apparatus such as the client PC connected via the network has been received. Next in S the print job control unit accepts the received print command from the print command receiving unit and analyzes the print command. The print job control unit analyzes the print command thereby determining the orientation upward downward rightward or leftward of an image that is to be printed based on the print command.

Next in S the print job control unit determines whether or not the set item paper orientation determination in print setting information contained in the print command is present. If the paper orientation determination is present the print job control unit checks the set value. If the set value is ON the procedure advances to S where the paper orientation determination unit performs the paper orientation determination processing after which the procedure advances to S. The paper orientation determination processing will be described later in detail with reference to . In this embodiment the set item regarding whether or not to perform the determination is independently provided but this may be realized as a condition that the determination is performed in the case where the paper size is a given set value e.g. postcard for example. On the other hand if the paper orientation determination has not been set or is OFF in S the procedure directly advances to S. In S the print job control unit converts the print command into a print job and passes the print job to the printing processing unit thereby causing said unit to perform the printing processing.

Next the paper orientation determination processing in S will be described in detail with reference to . The processing described below is realized by the CPU reading and executing a control program stored in the ROM or the HDD into the RAM .

First in S the print job control unit that has accepted the print command gives a scan instruction to the scanning processing unit thereby causing said unit to scan a front surface of a paper that is to be printed. At that time if a paper is placed on the second paper feeding unit the paper on the second paper feeding unit is fed and its front surface is scanned. Specifically as shown in the print job control unit feeds a paper placed on the second paper feeding unit and causes the image reading unit to read a first surface front surface of the original that has been fed. On the other hand if no paper is placed on the second paper feeding unit a paper is fed from the first paper feeding unit and its front surface is scanned. In that case the print job control unit feeds a paper that has been set in the first paper feeding unit with its surface having an image being oriented downward in and causes the image reading unit to read the paper while the paper is being conveyed on the duplex conveying path . Note that at that time the heat roller and the pressure roller of the fixing unit are preferably spaced away from each other by a spacer mechanism not shown such that too much heat is not applied to the paper.

Next in S the print job control unit passes the scan image and the print command to the paper orientation determination unit so that the orientation of the paper is detected using a determination method whose determination object is the same as the set value of the paper orientation determination method in the print setting information of the print command. That is to say if the set value is postcard for example it is determined whether or not there are seven rectangles arranged side by side in the upper right in a paper scan image read by the scanning processing unit . Note that the upper right refers to an upper right region obtained by dividing a scan image into four regions by evenly dividing the image in the vertical and horizontal directions. If there are seven rectangles arranged side by side in the upper right without rotation of the image the print job control unit determines from the scan image that the paper is oriented upward. For example if it is determined from the scan image that the paper is oriented sideways the scan image is rotated clockwise by 90 degrees and it is determined whether or not there are seven rectangles arranged side by side in the upper right of the scan image that has been rotated. If there are seven rectangles arranged side by side in the upper right the print job control unit determines from the scan image that the paper is oriented leftward. On the other hand if there are not seven rectangles arranged side by side in the upper right the print job control unit rotates the original scan image counterclockwise by 90 degrees and it is determined whether or not there are seven rectangles arranged side by side in the upper right of the scan image that has been rotated. If there are seven rectangles arranged side by side in the upper right the print job control unit determines from the scan image that the paper is oriented rightward. On the other hand if there are not seven rectangles arranged side by side in the upper right the paper may be oriented downward and thus the print job control unit rotates the original scan image by 180 degrees and it is determined whether or not there are seven rectangles arranged side by side in the upper right of the scan image that has been rotated. If there are seven rectangles arranged side by side in the upper right the print job control unit determines from the scan image that the paper is oriented downward. In this manner it is determined whether the paper that is being conveyed is oriented upward downward rightward or leftward for example depending on when seven rectangles become arranged side by side in the upper right while rotating the scan image. If without rotating the image it is possible to detect the target corresponding to each case where the paper is oriented sideways or upside down the scan image does not have to be rotated and the print job control unit may detect the orientation of the paper by detecting which region of the scanner image includes the target. For example if there are seven rectangles arranged side by side in the upper right it may be determined that the paper is oriented upward and if there are seven rectangles arranged side by side in the upper left it may be determined that the paper is oriented leftward. Furthermore if there are seven rectangles arranged side by side in the lower right it may be determined that the paper is oriented rightward and if there are seven rectangles arranged side by side in the lower left it may be determined that the paper is oriented downward.

Next in S the print job control unit acquires the detection result of the paper orientation from the paper orientation determination unit and determines whether or not the paper orientation has been specified. If the paper orientation has not been specified the procedure advances to S and if the paper orientation has been specified the procedure advances to S. If the paper orientation has not been specified the surface that has been scanned up until then may be a back surface on which there are not seven rectangles of the postcard and thus in S the print job control unit determines whether or not the back surface second surface of the paper has been scanned. If the back surface second surface of the paper has not been scanned the procedure advances to S where the print job control unit gives the scanning processing unit an instruction to scan the back surface second surface of the paper. The scanning processing unit that has accepted the scan instruction controls the conveying rollers scans the back surface second surface of the paper and passes the scan image to the print job control unit . The back surface of the paper is scanned following the procedure as sequentially illustrated in after which the procedure advances to S where the print job control unit again performs the paper orientation detection processing on the scan image of the back surface second surface of the paper. If the paper orientation cannot be specified on the back surface second surface of the paper that is if it is determined in S that the back surface second surface has been scanned the paper orientation determination processing ends without any further processing. Note that in order to perform the scanning processing on the back surface the scanning processing unit conveys the sheet S as described with reference to .

On the other hand if the paper orientation has been specified in the paper orientation detection processing on the front surface or the back surface of the paper the procedure advances to S where the print job control unit changes as necessary the print command according to the specified orientation. In this processing the print command is changed such that the paper orientation upward downward leftward or rightward matches the print request of the print command as appropriate. For example if it is detected that the front surface is oriented upward this processing ends without particularly changing the print command. If it is detected that the front surface is oriented downward i.e. the paper is upside down the entire page data is rotated by 180 degrees. In a similar manner if the front surface is oriented leftward the upper edge is positioned on the left side the entire page data is rotated by 90 degrees and if the front surface is oriented rightward the upper edge is positioned on the right side the entire page data is rotated by 90 degrees. With this processing adjustment is performed such that the paper orientation matches the orientation of image data that is to be printed. Then as described with reference to in S the printing processing unit performs the printing processing using the changed print command.

If the print command is for a plurality of pages of paper basically the paper orientation is determined for each page and the printing is performed. When performing printing on the second page the paper orientation is determined again and the printing is performed. However control is also possible in which the paper orientation of only the first page of paper is determined and the processing is performing on the following pages assuming that they are in the same orientation as the first page. In this case the time for the determination can be reduced.

In this embodiment an example has been described in which the received print command is changed according to the determination result of the paper orientation. However the present invention is not limited to this control and control is also possible in which the image data obtained after print command analysis and expansion is processed so that the orientation of an image at the time of printing is changed. This control can be realized for example by changing the output order of a print signal that is to be output to the optical unit .

Furthermore if the paper orientation has not been detected on either the front surface or the back surface the printing is performed without any particular image correction according to the flowchart in but the printing may be stopped and an error message may be displayed. In the processing that changes the print command in S it is also possible to perform additional processing such as positional correction further using the scan image and the page data. For example when performing printing on a postcard it is possible to displace the numbers of a zip code so as to be accommodated inside the respective rectangles or to reduce the font size when the size is too large. Furthermore when using an already printed paper it is possible to detect a blank portion of the paper and perform processing such as positional correction size enlargement or reduction and the like such that the page data is located in said portion. That is to say when it is determined that an image is already present correction may be performed such that an image that is to be printed does not overlap said image.

In the foregoing embodiment an example has been described in which processing such as correction of page data is performed inside the MFP . However the present invention may be embodied such that an RPC remote procedure call SOAP REST etc. is used to give a processing request to the client PC a server on the network or the like. For example a method may be employed in which the MFP scans both surfaces of a paper transmits the scan images of the two surfaces and the print setting information using an RPC to a terminal that performs the paper orientation determination processing receives the corrected images and performs the printing processing using the images.

As described above the printing apparatus according to the present invention detects the orientation e.g. upward downward leftward or rightward and front or back of a sheet that is to be printed and determines whether or not the detected orientation of the sheet matches the orientation of an image that is to be printed based on the print command. If the orientations do not match each other the printing apparatus corrects the print command or the image so that the image orientation matches the sheet orientation. Accordingly this printing apparatus can prevent printing on a sheet to be performed in an orientation not intended by a user when the user places the sheet in a wrong orientation on a paper feed cassette or a manual feed tray. Accordingly useless printing can be prevented and ink and sheets are prevented from being wasted.

In the foregoing embodiments for the sake of convenience of this description the MFP has been described that performs printing using one photosensitive drum but the present invention can be applied also to an MFP that performs printing using photosensitive drums respectively corresponding to four colors of C M Y and K. Furthermore although a case has been described in which an image obtained by analyzing a print command that has been received from a host computer is printed on a paper this processing may be performed on an image that has been read by the scanner and stored in advance in the HDD .

Furthermore after an image is printed on a paper through the processing described with reference to the CPU may perform control such that the image printed on the paper is read by the image reading unit and the reading result is displayed on the operation unit .

Specifically after an image is printed on a paper through the processing described with reference to the CPU conveys the paper to the paper discharge rollers . Then the paper discharge rollers are rotated clockwise in and the paper is conveyed until its trailing edge reaches the paper discharge rollers . When the trailing edge of the paper becomes held between the paper discharge rollers the CPU lowers the flapper and rotates the paper discharge rollers in reverse. Then the CPU conveys the original on the duplex conveying path as shown in to the paper position shown in . Subsequently the CPU rotates the image reading unit toward the original dedicated conveying path and rotates the conveying rollers in reverse thereby conveying the original as shown in . In this example the CPU causes the image reading unit to read the image image printed by the printing unit of the original that is being conveyed on the original dedicated conveying path stores the read image in the HDD and displays the image stored in the HDD on the operation unit . This operation is repeated each time an image is printed on a paper and thus the user can easily check with the image displayed on the operation unit whether or not the printed image is as intended without picking up and checking a printed sheet each time a printed sheet is discharged. Note that the read image may be displayed on the PC that is communicable via the network .

Aspects of the present invention can also be realized by a computer of a system or apparatus or devices such as a CPU or MPU that reads out and executes a program recorded on a memory device to perform the functions of the above described embodiments and by a method the steps of which are performed by a computer of a system or apparatus by for example reading out and executing a program recorded on a memory device to perform the functions of the above described embodiments. For this purpose the program is provided to the computer for example via a network or from recording media of various types serving as the memory device e.g. computer readable medium .

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

This application claims the benefit of Japanese Patent Application No. 2012 106313 filed on May 7 2012 which is hereby incorporated by reference herein in its entirety.

