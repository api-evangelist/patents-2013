---

title: Video disparity estimate space-time refinement method and codec
abstract: A method for disparity estimation of stereo video data receives a sequence of frames of stereo video data. Image-based disparity estimation is initially conducted on a frame-by-frame basis to produce initial disparity estimates. A plurality of initial disparity estimates is grouped into a space-time volume. Disparity error is reduced in the space-time volume to refine the initial disparity estimates.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09659372&OS=09659372&RS=09659372
owner: The Regents of the University of California
number: 09659372
owner_city: Oakland
owner_country: US
publication_date: 20130514
---
This invention was made with government support under grant no. CCF 1065305 awarded by the National Science Foundation. The government has certain rights in the invention.

A field of the invention is video encoding and decoding. Example applications of the invention include the encoding storage transmission decoding and stereo video data including 3D video processing.

Disparity estimation is a necessary component in stereo video processing and 3D video processing. Video disparity is used for 3D video processing. In a two camera imaging system disparity is defined as the vector difference between the imaged object points in each image relative to the focal point. It is this disparity that allows for depth estimation of objects in the scene via triangulation of the point in each image. In rectified stereo where both camera images are in the same plane only horizontal disparity exists. In this case multiview geometry shows that disparity is inversely proportional to actual depth in the scene.

Estimating disparity has been extensively studied for images. The existing image based methods are ill suited to video disparity estimation on a frame by frame basis because temporal consistency is not guaranteed. Using these methods for video disparity estimation often leads to poor spatial and temporal consistency. Temporal consistency is the smoothness of the disparity in time. If a video disparity is temporally consistent then an observer will see flickering artifacts. Temporally inconsistent disparity degrades the performance of view synthesis and 3D video coding.

Existing disparity estimation methods are also tuned for specific datasets such as Middlebury stereo database. See D. Scharstein and R. Szeliski A Taxonomy and Evaluation of Dense Two Frame Stereo Correspondence Algorithms International Journal of Computer Vision vol 47 pp. 7 42 April 2002 . Such methods tend to perform poorly when applied to real video sequences. Many common real video sequences have lighting conditions color distributions and object shapes that can be very different from the images on Middlebury stereo database. For methods that require training applying such methods to real videos is almost impossible and at least is highly impractical from a perspective of speed of execution and complexity of computation.

Existing image based disparity estimation techniques may be categorized into one of two groups local or global methods. Local methods treat each pixel or an aggregated region of pixels in the reference image independently and seek to infer the optimal horizontal displacement to match it with the corresponding pixel region. Global methods incorporate assumptions about depth discontinuities and estimate disparity values by minimizing an energy function over all pixels using techniques such as Graph Cuts or Hierarchical Belief Propagation. Y. Boykov et al Fast Approximate Energy Minimization via Graph Cuts IEEE Transactions on Pattern Analysis and Machine Intelligence vol. 23 no. 11 pp. 1222 1239 February 2004 V. Kolmogorov and R. Zabih Computing Visual Correspondence with Occlusions via Graph Cuts International Conference on Computer Vision Proceedings pp. 508 515 2001 . Local methods tend to be very fast but global methods tend to be more accurate. Most implementations of global methods tend to be unacceptably slow. See D. Scharstein and R. Szeliski A Taxonomy and Evaluation of Dense Two Frame Stereo Correspondence Algorithms International Journal of Computer Vision vol. 47 pp. 7 42 April 2002 .

Attempts to solve stereo matching problems for video have had limited success. Difficulties encountered have included the computational bottleneck of dealing with multidimensional data lack of any real datasets with ground truth and the unclear relationship between optimal spatial and temporal processing for correspondence matching. Most have attempted to extend existing image methods to video and have produced computational burdens that are impractical for most applications.

One attempt to extend the Hierarchical Belief Propagation method to video extends the matching cost representation to video by a 3 dimensional Markov Random Field MRF . O. Williams M. Isard and J. MacCormick Estimating Disparity and Occlusions in Stereo Video Sequences in Computer Vision and Pattern Recognition Proceedings 2005 . Reported algorithmic run times were as high as 947.5 seconds for a single 320 240 frame on a powerful computer which is highly impractical.

Other approaches have used motion flow fields to attempt to enforce temporal coherence. One motion flow field technique makes use of a motion vector field. F. Huguet and F. Devernay A Variational Method for Scene Flow Estimation from Stereo Sequences in International Conference on Computer Vision Proceedings pp. 1 7 2007 . Another makes use of See M. Bleyer and M. Gelautz Temporally Consistent Disparity Maps from Uncalibrated Stereo Videos in Proceedings of the 6International Symposium on Image and Signal Processing 2009 .

One computationally practical method is a graphics processing unit GPU implementation of Hierarchical Belief Propagation that relies upon locally adaptive support weights. See C. Richardt et al Realtime Spatiotemporal Stereo Matching Using the Dual Cross Bilateral Grid in European Conference on Computer Vision Proceedings 2010 K. J. Yoon and I. S. Kweon Locally Adaptive Support Weight Approach for Visual Correspondence Search in Computer Vision and Pattern Recognition Proceedings 2005 . This method integrates temporal coherence in a similar way to Williams et al. O. Williams M. Isard and J. MacCormick Estimating Disparity and Occlusions in Stereo Video Sequences in Computer Vision and Pattern Recognition Proceedings 2005 and also provides a synthetic dataset with ground truth disparity maps. Other methods that are practical require specific hardware or place data constraints. See J. Zhu et al Fusion of Time of Flight Depth and Stereo for High Accuracy Depth Maps in Computer Vision and Pattern Recognition Proceedings 2008 pp. 1 8 G. Zhang J. Jia T. T. Wong and H. Bao Consistent Depth Maps Recovery from a Video Sequence PAMI vol. 31 no. 6 pp. 974 988 2009 .

An embodiment of the invention is a method for disparity estimation of stereo video data receives a sequence of frames of stereo video data. Image based disparity estimation is initially conducted on a frame by frame basis to produce initial disparity estimates. A plurality of initial disparity estimates is grouped into a space time volume. Disparity error is reduced in the space time volume to refine the initial disparity estimates.

An embodiment of the invention is a method that can provide disparity estimation in real time. Left and right stereo views are received from a stereo sensor system or other stereo video source. The method conducts an initial image based disparity estimation followed by a refinement to reduce error in the initial disparity estimation in a space time volume. The spatio temporal refinement of the invention can be used with any existing image disparity estimation technique. The method can be implemented as a post processing step to refine noisy estimates or can be extended to videos. Testing shows superior speed accuracy and consistency compared to state of the art algorithms. Testing shows resilience to high levels of noise.

Preferred methods of the invention leverage the strength of current state of the art image based techniques but also explicitly enforce consistency of estimates in both space and time by treating the video as a space time volume corrupted by noise. Methods of the invention have the capability of refining arbitrary image based disparity estimation techniques and at the same time extending the utility of such techniques to the video domain.

A preferred embodiment codec of the invention can be implemented with standard graphics processors. A preferred method has be tested and demonstrated to be fast. The total variation minimization problem is non differentiable and so existing methods such as interior point methods are slow. Preferred methods of the invention apply a Douglas Rachford splitting method to split the non differentiable and differentiable parts of the minimization problem. Efficient techniques are applied to handle the non differentiable and differentiable parts individually. Typical run time of the method on a 300 400 gray scaled video is 2 seconds per frame on MATLAB Windows using an Intel Qual Core 2.8 GHz 4GB DDR3 RAM PC. Software and system optimization will readily improve this time. Porting the method to C and GPU is expected to provide a 10 times speed improvement compared to the MATLAB version. Speed can be improved also by providing some pre processing to correct light balance and rectify stereo video input date.

Advantageously methods of the invention can be used as a refinement or a post processing method Therefore under the present framework ANY existing image based disparity estimation algorithm can be used to generate initial disparity estimates. The present algorithm is tested to be able to reduce the error for all 99 top ranking image based disparity estimation algorithms in Middlebury. In addition the present algorithm does not require significant parameter tuning from video to video. Even by using the default settings the algorithm is able to generate reasonable results for a wide range of videos.

Preferred methods of the invention provide video disparity estimation that addresses many 3D related video processing problems. Preferred methods can provide multiview synthesis which requires accurate disparity maps for high quality multiview synthesis.

Preferred methods of the invention can also provide 3D object detection. Identifying that an object in a scene is located in a particular depth layer with method of the invention permits disparity to be accurately estimated so that objects in the video can be extracted easily including identifying partially occluded objects more accurately.

Preferred methods also improved accuracy and efficiency in existing multiview coding MVC methods that encode the two stereo videos independently. Methods of the invention provide an accurate disparity map that permits encoding of only one view e.g. the left view the disparity and the residue. On the decoder side a view synthesis algorithm can then be used to reconstruct the right view. This clearly permits bit rate to be reduced significantly using this approach because coding a disparity requires a much lower bit rate than an image.

Preferred methods can for that reason and for additional reasons can also improved 3D video transmission. Wireless transmission process packets will be lost due to distortion in the channel. Methods of the invention can be used to impair corrupted disparity in the receiver end because a corrupted disparity is less spatio temporally consistent.

Preferred methods of the invention can also be used to detect salient objects. Accurate disparity measurement can identify salient objects that are typically in the foreground. With accurate disparity estimates locating salient objects is easier. Also preferred methods can correct video blur which consists of both motion blur and out of focus blur. With accurate disparity estimates it is possible to infer the depth layer and handle out of focus blur more efficiently.

Preferred embodiments of the invention will now be discussed with respect to the drawings. The drawings may include schematic representations which will be understood by artisans in view of the general knowledge in the art and the description that follows. Features may be exaggerated in the drawings for emphasis and features may not be to scale.

A preferred method of the invention will be discussed with respect to . The method can be implemented for example via computer code stored on a non transient medium. It can be implemented in hardware or firmware and as a codec in various video capture and processing devices. Example devices include augmented reality systems human computer interaction devices and gaming or entertaining devices such as Microsoft Kinect. In the method of FIG. a stereo video left sequence and right sequence is input to an image based disparity estimation algorithm . Subsequent steps in the method are independent of the image based disparity estimation so the image based disparity estimation can be any existing or yet to be developed image based disparity estimation method. The only requirement is that the image based disparity estimation generates an initial disparity on a frame by frame basis.

In a preferred embodiment a Hierarchical Belief Propagation HBP method is used for image based disparity estimation . This rivals local methods in computational time while being more accurate. Let P be the set of pixels in an image and be a finite set of labels. The labels correspond to quantities that we want to estimate at each pixel i.e. the disparity . A labeling assigns a label to each pixel p P. As with traditional global methods an energy function is designated for each pixel. The energy function indicates how well that label fits 

D is the data cost and is generally known in the art as the smoothness cost however a more accurate characterization would be the discontinuity cost. Intuitively the data cost captures how well the labeling fits the node how well the disparity estimate matches the stereo information . The discontinuity cost enforces the assumption that labels should vary slowly almost everywhere except for drastic changes along object boundaries. Neighboring pixels in neighborhood N are penalized according to how large the difference is between their labels.

In a preferred embodiment of the invention the data cost is computed over a large window for each pixel using Yoon and Kweon s locally adaptive support weights so that only points with a high probability of belonging to the same object contribute significantly to the cost calculation. Yoon et al Locally Adaptive Support Weight Approach for Visual Correspondence Search in Computer Vision and Pattern Recognition 2005 . The window typically in the range of 8 8 to 64 64 is set to balance computational demands and capture appropriate information around a pixel being evaluated. The larger the window used the more information captured from the pixels surrounding the central pixel being evaluated. At some point however increasing the window size does not add more power of discernment to the problem. For the discontinuity cost a preferred method of the invention uses known truncated weighted linear min 2 

To this point disparity maps have been computed individually in a frame by frame basis. Disparity error is then reduced in a space time volume . In the preferred embodiment a space time minimization is applied to refine the image based disparity estimation. This minimization is based upon the recognition by the present inventors that disparity maps should generally be a piecewise smooth function in time except for discontinuities at object borders in which case the value will drastically change . This is valid for actual video because objects do not simply disappear from one frame to the next. However this smoothness assumption is normally violated in most initial disparity maps that characterize video as there are inevitable estimation errors.

In the space time minimization the initial disparity estimates are grouped to form a three dimensional data creating a space time volume. The space time volume includes a sequence of frames. The number of frames depends on the capacity of the computer memory available. More frames are generally better for the refinement. As an example with 4GB RAM and frames sized at 300 400 pixels 20 frames can be used. The space time volume consists of three coordinates x y in space and t in time. The problem can be defined as the minimization of two terms 

The term f g is a measurement of the residue between the optimization variable f and the input data g. The measurement can be accomplished using the vector one norm which is the absolute sum of the entries of a vector. The optimization variable refers to the quantity being changed in solving 3 which is f.

Since g is typically noisy minimizing the residue f g is equivalent to finding a best fitting data f that preserve as much information in g as possible while at the same time eliminate outliers in g. The second term Df is the total variation regularization. It is used to regularize the solution f so that f is spatially and temporally smooth while edges are preserved. Unlike conventional total variation the total variation presented in the present method is implemented for a space time volume. Specifically the operator D consists of three forward difference operators D D and D. With scaling parameters the total variation norm of f is

This constrained minimization problem can be solved determining the saddle point of the augmented Lagrangian function defined as

The augmented Lagrangian consists of five parts. The first part r u is the objective the second part z r g is the Lagrange multiplier for the equality constraint r f g the third part

The saddle point of the augmented Lagrangian function can be determined by solving a sequence of subproblems iteratively. Given the initial values g u D y 0 r g z 0 the iterative method solves

The complexity of the present method is in the order of nlogn where n is the number of variables in the space time volume. This number is the number of operations required for a three dimensional Fourier Transform for calculating . Other operations in the present algorithm are inexpensive compared to the Fourier Transform For example in calculating u only the elementwise maximum operator and the sign operator are needed.

A specific solution to Eq. 3 can be considered as follows with the particular image based disparity map initial step described above. Devine f as the unknown disparity map vectorized version of x y t and g is the disparity map from the image based disparity method. D D D D represents the forward difference operators along the horizontal vertical and temporal directions. The parameters control relative emphasis being put on the spatial and temporal terms. Generally if the video has a lot of temporal noise then should be larger than and . On the other hand if the video has little temporal noise then should be small because excessive amount of would oversmooth the resultant video. Inadequate would not denoise the video. As starting point that can be adjusted and are typically fixed as 1 and for heavily noised video 10 is an appropriate defauly stting.

An l norm is chosen for the objective function g because the target solution is ideally piecewise smooth. The regulization term Df is the total variation norm on f  TV . Eq. 3 can then be solved as described above with the intermediate variables r g and D continuing to transform the unconstrained problem into an equivalent constrained minimization problem. Then an augmented Lagrangian method is used to handle the constraints and an alternating direction method ADM can be used to solve the sub problems iteratively. Details for this technique can be found in S. H. Chan et al. An Augmented Lagrangian Method for Total Variation Video Restoration in IEEE International Conference on Acoustics Speech and Signal Processing May 2011 .

Artisans will appreciate that the invention provides disparity maps as a space time volume instead of individual frames. This enables methods of the invention to simultaneously handle both spatial and temporal consistency by tuning the parameters . Also unlike most existing methods that try to enhance temporal consistency by heuristic means the present method is guaranteed to find the global minimum of Eq. 3 because it is convex Methods of the invention have also been demonstrated to operate quickly. Typical run time for a 300 400 resolution sequence is approximately 2 seconds per frame on MATLAB Windows which implies the real time processing capability with a compiled language.

Qualitative results on video sequences showed that a preferred method of the invention with the IMP image based pre processing reduced spatial noise and temporal inconsistencies. The method was also tested on synthetic video sequences and qualitative measurements shows good performance compared to state of the art techniques. The method is HBP TV in the table below 

The present method is compared to different methods in Richardt et al. on the same synthetic video sequences used in C. Richardt et al Realtime Spatiotemporal Stereo Matching Using the Dual Cross Bilateral Grid in European Conference on. Computer Vision Proceedings 2010 . Improved results were also shown over a wide range of noise levels with the present method in most all instances producing better results.

The method of the invention was also tested with different initial image based disparity methods. The post processing of the invention improves performance as indicated in Table 2 where the pre processing of C. Richardt et al were used 

While specific embodiments of the present invention have been shown and described it should be understood that other modifications substitutions and alternatives are apparent to one of ordinary skill in the art. Such modifications substitutions and alternatives can be made without departing from the spirit and scope of the invention which should be determined from the appended claims.

