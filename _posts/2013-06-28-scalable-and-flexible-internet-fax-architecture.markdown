---

title: Scalable and flexible internet fax architecture
abstract: Methods and systems for processing inbound fax messages in an efficient and scalable manner are provided. According to one embodiment, an inbound fax call is received by an Internet fax system. The fax call has a source address, a destination address and a fax signal. The Internet fax system is coupled to a circuit-switched network and a packet-switched network and includes multiple fax processing resources having different configurations, features, capabilities or capacities. One or more desired fax protocol technical call processing capabilities are determined for processing the fax signal based on one or more of the source address, the destination address, the type of network through which the fax call was received and a service provider through which the fax call was received. Then, a fax processing resource that has the desired fax protocol technical processing capabilities is dynamically selected to translate the fax signal into a digital representation.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09042532&OS=09042532&RS=09042532
owner: Advanced Messaging Technologies, Inc.
number: 09042532
owner_city: Los Angeles
owner_country: US
publication_date: 20130628
---
This application is a continuation of U.S. patent application Ser. No. 13 533 049 filed Jun. 26 2012 which is a continuation of U.S. patent application Ser. No. 13 346 456 filed on Jan. 9 2012 now U.S. Pat. No. 8 249 230 both of which are hereby incorporated by reference in their entirety for all purposes.

Contained herein is material that is subject to copyright protection. The copyright owner has no objection to the facsimile reproduction of the patent disclosure by any person as it appears in the Patent and Trademark Office patent files or records but otherwise reserves all rights to the copyright whatsoever. Copyright 2012 2013 EC Data Systems Inc.

Embodiments of the present invention generally relate to receiving inbound facsimile messages via email website and or custom application programming interface API integration. In particular embodiments of the present invention relate to an improved Internet fax architecture designed for scalability flexibility and efficient inbound facsimile processing that among other things allows multiple inbound addresses to be associated with a single user account of a subscriber performs load balancing among facsimile processing resources dynamically selects appropriate facsimile processing resources based on various factors and accommodates facsimile processing resources having different configurations and or differing capabilities or capacities.

Existing Internet fax systems have numerous limitations in terms of the scalability and flexibility of their architectures and user facing flexibility. The user facing inflexibility exhibited by existing Internet fax systems results in part from an underlying assumption that a subscriber is an individual user rather than a company having multiple users. As such attempting to use such Internet fax systems in a multi user environment typically requires compromise in terms of one or more of expense features and security. For example in existing Internet fax systems the destination address i.e. the dialed fax number is assumed to have a one to one relationship with a particular end user. This assumption is inconsistent with a typical desired usage model in which multiple members of a project team may all wish to have access to faxes received on a particular inbound fax number. Similarly administrative staff that support multiple project teams may need to have access to faxes received on multiple inbound fax numbers. While companies have found workarounds to deal with some of the limitations of existing Internet fax systems by sharing user accounts and or subscribing to more fax numbers than desired for example a more flexible architecture that better suits the needs of corporate users is needed.

Methods and systems are described for processing inbound fax messages in an efficient and scalable manner. According to one embodiment an inbound fax call is received by an Internet fax system. The inbound fax call has a source address a destination address and a fax signal. The Internet fax system is coupled in communication with a circuit switched network and a packet switched network and includes multiple fax processing resources having different configurations features capabilities or capacities. One or more desired fax protocol technical call processing capabilities are determined for processing the fax signal based on one or more of the source address the destination address whether the inbound fax call was received via the circuit switched network or the packet switched network and a service provider through which the inbound fax call was received. Then a fax processing resource that has the one or more desired fax protocol technical processing capabilities is dynamically selected to translate the fax signal into a digital representation.

Other features of embodiments of the present invention will be apparent from the accompanying drawings and from the detailed description that follows.

Methods and systems are described for processing inbound fax messages in an efficient and scalable manner. According to embodiments of the present invention an Internet fax system architecture is provided that among other novel features performs round robin load balancing among available facsimile processing resources determined to have appropriate technical call processing capabilities for processing a particular inbound fax call. Embodiments of the present invention also include the notion of one or more intermediate call mediation systems interposed between one or more telecommunications systems and the facsimile processing resources identifying and selecting an appropriate facsimile processing resource from among those available based on a combination of two or more of i the source address e.g. automatic number identification ANI or caller identification caller ID CID of the facsimile call and the source s known capabilities limitations ii whether the facsimile call arrives over a packet switched or circuit switched connection iii the service provider through which the facsimile call arrives and iv the destination address e.g. Direct Inward Dialing DID Dialed Number Identification System DNIS or Calling Identification . In some embodiments the Internet fax system architecture includes a combination of digital and analog devices and can accommodate facsimile processing resources having different configurations and or having different capabilities or capacities.

a. One or more switches connected to either or both of circuit and packet switched networks for receiving incoming call signals wherein each incoming call signal includes a destination address and a source address. The destination address may be associated with zero to many user accounts and each user account may be associated with zero to many destination addresses. And wherein each switch redirects the incoming call signal including the destination and source addresses to one of one or more call mediation systems coupled to the switch via circuit or packet switched connections b. The call mediation system accepts or rejects the call and if accepted selects an appropriate message processing resource to process the call and c. The message processing resource processes the audio contained within the incoming call signal into a digital representation d. The message processing resource consults a centralized data store to determine delivery mechanism e. The message processing resource delivers and or makes available the digital representation of the audio in the incoming call signal based upon the delivery mechanism determined.

In the context of the aforementioned embodiment the call mediation system may further be operable to 

a. Upon receiving the incoming call signal based upon one or more of the source address destination address and or the specific circuit or packet switched connection on which the incoming call signal was received either reject or accept the call after consulting a centralized data store to determine whether to accept or reject based on one or more of the source address the destination address and or the specific circuit or packet switched connection sending a busy signal to the source address if rejected and terminating the call b. If the call is accepted select a subset of message processing resources the appropriate message processing resources which have technical capabilities matching the desired technical capabilities to process the incoming call signal after consulting a centralized data store to determine the desired technical capabilities based upon a combination of two or more of the source address destination address and or the specific circuit or packet switched connection on which the incoming call signal was received and c. Query each message processing resource within the appropriate messaging processing resources to determine a specific available processing resource within a given appropriate message processing resource and d. Store the original destination address in the name portion of the calling presentation ANI and overwrites the destination address with a fixed destination address that identifies the specific available processing resource for the call to be routed to e. Redirect the incoming call signal to a digital access cross connect system DACS coupled to the call mediation system via a circuit switched connection and coupled to each specific processing resource on the message processing resource via a circuit switched connection f. The DACS redirects the incoming call signal along with the source and destination addresses to the specific available message processing resource as specified in the destination address specified by the call mediation system to the message processing resource via a circuit switched connection translating the ANI into caller ID name containing the original destination address and number containing the source address fields g. The call mediation system implements storage of the specific available message processing resource selected so as to load balance incoming calls by preferring not to select the same specific available message processing resource until other specific message processing resources within the appropriate message processing resources have been subsequently selected for subsequent incoming call signals and h. The call mediation system will select a second specific available message processing resource if the first selected specific available messaging processing resource does not answer within a configured timeout period re write the destination address to accommodate the new selection and redirect the incoming call signal to said second specific available message processing resource through a DACS as specified in f g above i. The call mediation system remains in the call path after redirecting the message processing resource such that it records the start and stop time specific resource selected and result normal hangup problem etc. of the incoming call signal for both billing and accounting and troubleshooting purposes 

In the context of one or more of the aforementioned embodiments the message processing resource may be operable to 

a. Upon completion of the reception of the audio of the incoming call signal and converting said audio to a digital representation retrieve the original source and destination addresses of the call signal from the caller ID fields consult a centralized data store to determine the preferred digital representation format based upon first the destination address alone then the preferences of any user accounts that may be associated with the destination address and convert the digital representation to the appropriate format with the possibility to store and subsequently present multiple differing formats to different user accounts b. Upon completion of reception of the audio of the incoming call signal and converting said audio to a digital representation and potentially converting said digital representation to a different digital format consult a centralized data store to determine the delivery mechanism which may be one or more of 

In the following description numerous specific details are set forth in order to provide a thorough understanding of embodiments of the present invention. It will be apparent however to one skilled in the art that embodiments of the present invention may be practiced without some of these specific details. In other instances well known structures and devices are shown in block diagram form.

Embodiments of the present invention include various steps which will be described below. The steps may be performed by hardware components or may be embodied in machine executable instructions which may be used to cause a general purpose or special purpose processor programmed with the instructions to perform the steps. Alternatively the steps may be performed by a combination of hardware software firmware and or by human operators.

Embodiments of the present invention may be provided as a computer program product which may include a machine readable storage medium tangibly embodying thereon instructions which may be used to program a computer or other electronic devices to perform a process. The machine readable medium may include but is not limited to fixed hard drives magnetic tape floppy diskettes optical disks compact disc read only memories CD ROMs and magneto optical disks semiconductor memories such as ROMs PROMs random access memories RAMs programmable read only memories PROMs erasable PROMs EPROMs electrically erasable PROMs EEPROMs flash memory magnetic or optical cards or other type of media machine readable medium suitable for storing electronic instructions e.g. computer programming code such as software or firmware . Moreover embodiments of the present invention may also be downloaded as one or more computer program products wherein the program may be transferred from a remote computer to a requesting computer by way of data signals embodied in a carrier wave or other propagation medium via a communication link e.g. a modem or network connection .

In various embodiments the article s of manufacture e.g. the computer program products containing the computer programming code may be used by executing the code directly from the machine readable storage medium or by copying the code from the machine readable storage medium into another machine readable storage medium e.g. a hard disk RAM etc. or by transmitting the code on a network for remote execution. Various methods described herein may be practiced by combining one or more machine readable storage media containing the code according to the present invention with appropriate standard computer hardware to execute the code contained therein. An apparatus for practicing various embodiments of the present invention may involve one or more computers or one or more processors within a single computer and storage systems containing or having network access to computer program s coded in accordance with various methods described herein and the method steps of the invention could be accomplished by modules routines subroutines or subparts of a computer program product.

For simplicity and sake of brevity various embodiments described herein focus on inbound fax processing and delivery of received faxes to subscribers however it is to be noted that the Internet fax system may also be capable of facilitating sending of outbound fax messages on behalf of subscribers as well.

Notably while embodiments of the present invention may be described using modular programming terminology the code implementing various embodiments of the present invention is not so limited. For example the code may reflect other programming paradigms and or styles including but not limited to object oriented programming OOP agent oriented programming aspect oriented programming attribute oriented programming OP automatic programming dataflow programming declarative programming functional programming event driven programming feature oriented programming imperative programming semantic oriented programming functional programming genetic programming logic programming pattern matching programming and the like.

The terms connected or coupled and related terms are used in an operational sense and are not necessarily limited to a direct connection or coupling.

The phrases facsimile call or fax call generally refer to a call carried over a circuit switched network e.g. the public switched telephone network PSTN or a VoIP call carried over a packet switched network e.g. the Internet from a device intending to transmit a facsimile to a particular destination phone number.

The phrases facsimile processing resource and fax processing resource generally refer to a device capable of answering a facsimile call establishing a facsimile protocol communication with the caller receiving facsimile data in an audio format and translating the received audio into a digital representation. A non limiting example of a facsimile processing resource is a fax server or a subset of resources associated with a fax server. According to embodiments of the present invention there is no requirement that all fax processing resources be configured the same and or have the same capabilities or capacity. In one embodiment such flexibility is enabled by the fact that an appropriate fax processing resource of a set of available fax processing resources may be determined on the fly responsive to receipt of an incoming fax call.

The phrases facsimile signal or fax signal generally refer to a digital representation of audio information encoding a facsimile message. According to embodiments of the present invention incoming fax signals may be received over a circuit switched network e.g. the public telephone network or a packet switched network e.g. the Internet via Voice over Internet Protocol VoIP and delivery of the fax may be to a packet switched network e.g. an internal network connected to the Internet . In one embodiment incoming fax signals contain information regarding the type of network e.g. packet switched or circuit switched the service provider a source address and a destination address thereby allowing processing of the incoming fax signals to be influenced by configuration and or preference information associated with one or a combination of the source address the destination addresses the network and the service provider. For example the source address and its known capabilities and or whether the facsimile call arrived over a packet switched or circuit switched connection may be used to assign the facsimile call to a particular facsimile processing resource to compensate for the presence or absence of packet delays and jitter. Similarly the particular source address and destination address combination may have been configured to deliberately use a given type of facsimile processing resource based on known limitations and or preferences of both the source and destination.

The phrases in one embodiment according to one embodiment and the like generally mean the particular feature structure or characteristic following the phrase is included in at least one embodiment of the present invention and may be included in more than one embodiment of the present invention. Importantly such phases do not necessarily refer to the same embodiment.

If the specification states a component or feature may can could or might be included or have a characteristic that particular component or feature is not required to be included or have the characteristic.

Each subscriber account may have one or more users and one or more associated fax numbers. According to one embodiment flexible user configuration settings allow security options delivery preferences and access privileges to be established with finer resolution than existing fax services. For example any inbound fax number associated with a subscriber account can be set up to deliver received faxes to any or no user account associated with the subscriber account. As such multiple inbound fax numbers can be associated with a single user or multiple user accounts rather than being constrained to a one to one relationship. For purposes of efficiency defaults may be established at an account level and overridden if desired at the user level. For example by default all faxes received by a subscribing enterprise may be stored as portable document format PDF files however a particular user may specify that faxes delivered to him her be stored in another file format e.g. tagged image file format TIFF .

Internet fax system receives and processes inbound fax calls on behalf of subscribers and stores fax images for later retrieval by subscribers and or forwards the fax images to one or more email addresses designated by the subscribers. Anyone with a fax machine subscriber or non subscriber can dial a subscriber s fax number and Internet fax system will receive the fax convert store the fax in a configurable format for later retrieval via the web and or email the fax to one or more email addresses that can be configured on a per fax number basis. As described further below embodiments of the present invention also allow for data store queries via an API over Hypertext Transport Protocol HTTP or HTTP secure HTTPS that allows programmers to build fax receive capabilities into their applications.

According to the present example Internet fax system interfaces with Internet fax system APIs such as Internet fax system API Internet fax system users associated with a subscriber account such as Internet fax system user and fax senders such as fax sender .

Internet fax system user may receive inbound fax messages directed to one or more fax numbers associated with an Internet fax subscription via any Internet connected device such as computer a smartphone not shown or the like. As described further below Internet fax system user may receive faxes as email attachments as secure download links embedded within email messages or download them from a web site associated with Internet fax system . To the extent he she is authorized to do so Internet fax system user may also make administrative changes to account settings via the web site including but not limited to associating email addresses with fax numbers specifying fax delivery preferences designating user access permissions and the like.

Fax sender may send faxes to subscribers of Internet fax system via a dedicated fax machine computer multifunction all in one printer not shown or other fax capable device not shown just as he she would send faxes to non subscribers. Fax sender need not be a subscriber of Internet fax system to send faxes to a subscriber such as Internet fax system user .

Internet fax system API may represent a standardized API associated with Internet fax system or a custom API developed to API specifications established by the owner operator of Internet fax system . Internet fax system API may provide capabilities that an application programmer can use to integrate fax capabilities into their applications utilizing Internet fax system as a backend for example. In one embodiment the integration is accomplished via HTTP or HTTPS POST operations.

Depending upon the particular implementation Internet fax system API may provide operations to support fax sending and receiving call detail record collection and automated number provisioning and de provisioning. Additional details regarding an exemplary set of operations and related variables for an internet fax system API are described in Appendix.

In the exemplary simplified architecture depicted Internet fax system includes one or more telecommunications systems one or more call mediation systems fax processing resources an email gateway a web services interface a web site a file store and a data store interconnected via an appropriate telecommunications signaling network and an Internet Protocol IP network.

According to one embodiment telecommunications system s are operable to receive incoming fax calls and pass accepted fax calls to a call mediation system of call mediation system s . In one embodiment telecommunications system s perform round robin load balancing among the call mediation system s . Upon call completion telecommunications system s may record telephony ISDN information and call accounting information in data store for billing purposes and or troubleshooting.

In one embodiment call mediation system s are logically interposed between telecommunications system s and fax processing resources . Call mediation system s receive incoming call information e.g. caller ID and called number determine custom call handling based thereon select an appropriate fax processing resource of those available within fax processing resources and redirect inbound fax calls to the selected fax processing resource. As described further below load leveling may also be performed at the call mediation layer by preferring not to select the same specific available fax processing resource until all other available and appropriate fax processing resources of fax processing resources have been selected to process an inbound fax call. In some embodiments call mediation system s sit in the path of inbound fax calls and wait for call completion to allow call mediation system s to record call accounting for billing in a separate database not shown . To the extent not performed at the telecommunications system layer call mediation system s may also record telephony ISDN information and call accounting information in data store to facilitate troubleshooting.

Fax processing resources are operable to receive incoming call information from call mediation system s set custom parameters based on information passed such as speed protocol capabilities etc. receive inbound fax signals convert audio fax signals to appropriate digital image form and deliver or otherwise make available the resulting fax messages to one or more users associated with the subscribers to which the inbound faxes are directed e.g. by storing the fax messages in a destination address specific storage area within file store for subsequent web retrieval and or by creating an email message directed to one or more users according to the subscriber s administrative account settings .

According to one embodiment email gateway is a simple relay operable to receive and send email messages created by fax processing resources . In such an embodiment before sending an email message to email gateway that is to be relayed to a subscriber fax processing resources may apply custom messaging to the email. For example fax processing resource may make the email message appear to be from a customer s service provider that operates as a reseller of the Internet fax service or fax processing resource may reformat data in the notification based on customer defined preferences. In alternative embodiments email gateway may include more intelligence and perform some portion of email creation customization and or reformatting.

Web services supports API based receiving of fax messages wherein the interaction can be with a program on a user system as opposed to manual downloading of fax messages by an individual using a web browser as required by existing Internet fax systems such as that described in U.S. Pat. No. 6 350 066 and its progeny. According to one embodiment web services is operable to receive request for download of received faxes e.g. by unique fax ID recorded in data store by fax processing resources via an API call and return fax images to the requesting system. For example web services may retrieve the fax image location from data store retrieve the fax image from file store and send the fax image to the requesting system over a secure sockets layer SSL connection. Further details regarding an exemplary set of operations that may be automated via web services are provided in Appendix.

Web site is operable to receive and process user requests relating to received faxes. For example responsive to a user logging into web site and navigating to the receive faxes page web site may query data store and present the user with an interface per receiving fax number within the subscriber account with which the logged in user is associated to which the user has access that lists received faxes. The user may then select a fax to download and cause web site to retrieve the corresponding fax image from file store for download to the user s client system via SSL. In some embodiments web site may further support the capability for users to rename received faxes to something meaningful to them and or to create logical folders and move faxes storage presentation from the destination to the logical folder.

File store represents a shared storage resource accessible by fax processing resources email gateway web services interface and web site for storing and accessing digital representations of fax messages. According to one embodiment file store is simply a disk with no processing other than storage access logic. According to one embodiment file store is a fax image database implemented within a network attached storage NAS device such as a NetApp NAS filer available from NetApp Inc.

Data store represents storage for accounting billing features and metadata associated with received fax messages. According to one embodiment data store is a Solaris x86 based workstation running an open source database such as MySQL.

The centralization of configuration and user information in the manner described above eliminates duplication of such information among inbound fax servers as suggested by prior Internet fax system architectures such as the architecture described in U.S. Pat. No. 6 208 638. The centralization of storage on a network shared storage device also eliminates the need for redirecting requests for faxes to a system or program separate and apart from the one e.g. the web server the user is communicating with initially to make the request as suggested by prior Internet fax system architectures such as the architecture described in U.S. Pat. No. 6 350 066. This enhances scalability flexibility and reliability of the Internet fax system by among other things removing the possibility to redirect a request to a server having a problem and in general results in fewer moving parts and fewer opportunities for failure.

In the present example as in the example architecture discussed with reference to Internet fax system architecture includes one or more telecommunications systems one or more call mediation systems and fax processing resources coupled to one or more networks .

According to the architecture depicted network s may include both a packet switched network such as the Internet and a circuit switched network such as the public switched telephone network PSTN . As such Internet fax system architecture may receive inbound fax calls over packet switched or circuit switched connections.

According to the present example telecommunications system s include one or more switches . Switches may be connected to the Internet via Ethernet and connected to the PSTN via dedicated high bandwidth circuits e.g. DS3 and or DS1 lines . In one embodiment switches are high capacity access servers providing both packet and time division multiplexing TDM switching.

Examples of suitable switches include but are not limited to the Cisco AS5850 Universal Gateway the Cisco AS5800 Access Server the Cisco AS5400 Universal Gateway the Cisco AS5350 Universal Gateway and the Cisco AS5300 Universal Access Server. Depending upon the particular implementation telecommunications system s may comprise a single switch or multiple redundant switches in which one of the switches is an active primary switch and the others are active standby switches which can take over for the primary in the event of a failure. In alternative embodiments it is also possible to have an active active redundant switch architecture in which multiple circuits from PSTN and or Internet provide the same services and the circuits are split between multiple switches that are interconnected in a mesh for redundancy and or increased capacity.

Call mediation system s may include one or more PBXs . In one embodiment analog fax processing resources are supported by providing associated digital access cross connects DACS . PBXs may be implemented by installing and running an open source PBX software package on a server. For example a non limiting example of a suitable PBX is a Linux server running Asterisk. Alternatively PBXs available from Cisco or Avaya may be used. According to one embodiment DACS provide DS1 DS0 0 1 cross connect functionality and may be one of Adtran s ATLAS series of enterprise integrated access devices such as the ATLAS 550 series ATLAS 800 series Tellabs Titan series DACS or the like.

As described in further detail below in various embodiments of the present invention the destination address associated with an inbound fax call may be remapped in a novel manner to force it to be routed to a particular selected analog modem on a fax server where the destination DID is changed by the call mediation system to a fixed DID that represents the modem to a DACS in front of the fax server. The destination address is moved into the caller ID name field while the caller ID number remains the source address.

According to the present example fax processing resources include one or more fax servers . Each of the fax servers may include one or more analog fax modems digital fax boards and or soft modems modems implemented in software . According to one embodiment fax servers each have 24 ports and those ports are connected to the 24 ports of a single DACS of DACS . Those of ordinary skill in the art will appreciate there are a variety of possible combinations of DACS to fax server connections configurations. For example in alternative configurations each DACS may support multiple fax servers theoretically as many fax servers as it has ports by connecting each port of the DACS to a single port of a fax server. According to one embodiment fax servers include Linux servers running open source fax server software such as HylaFAX. As described further below embodiments of the present invention accommodate facsimile processing resources having different configurations and or differing capabilities or capacities by dynamically selecting at the call mediation layer appropriate facsimile processing resources based on various factors e.g. i the source address e.g. automatic number identification ANI or caller identification caller ID CID of the inbound fax call and the source s known capabilities limitations ii whether the inbound fax call arrived over a packet switched or circuit switched connection iii the telecommunications service provider through which the inbound fax call arrived and iv the destination address e.g. Direct Inward Dialing DID Dialed Number Identification System DNIS or Calling Identification . As such an Internet fax system architecture in accordance with embodiments of the present invention allows for selection of differing capabilities for inbound modems.

According to one embodiment switching module is responsible under control of dial plan module for out dialing on a particular circuit or channel to a destination then bridging the source call with the destination when the destination answers. Switching module is also typically responsible for reporting the event that the destination answers and or does not answer to dial plan module for further processing when such event occurs.

Dial plan module is generally responsible for choosing whether to accept or reject a particular inbound fax call based on source destination carrier received on etc. If the call is accepted the dial plan module asks extension daemon for an appropriate destination extension to which to switch the call and requests that switching module switch the call to the destination received from extension daemon . If switching module indicates that the destination does not answer then the dial plan module may request extension daemon to identify an alternative destination and attempt to switch the call to the alternative destination until the selected destination answers. Dial plan module may also record call accounting information at call completion for billing purposes.

Extension daemon is responsible for receiving a request for a fax call to be switched from dial plan module . The request may include the source address the destination address and information regarding the carrier technology from which the call originated. Based on the source destination carrier technology the call comes in on etc. extension daemon selects a subset of appropriate fax call resources with the right or desired capabilities from all fax call resources. As such an Internet fax system architecture implemented in accordance with embodiments of the present invention allows for selection of differing capabilities for inbound modems. In any event from the appropriate fax call resources extension daemon selects the next according to a round robin algorithm for example fax processing resource that should be tried used. Extension daemon then returns an extension associated with the selected fax call resource to dial plan module .

According to the present example the computer system includes a bus one or more processors one or more communication ports a main memory a removable storage media a read only memory and a mass storage .

Processor s can be any future or existing processor including but not limited to an Intel Itanium or Itanium 2 processor s or AMD Opteron or Athlon MP processor s or Motorola lines of processors. Communication port s can be any of an RS 232 port for use with a modem based dialup connection a 10 100 Ethernet port a Gigabit port using copper or fiber or other existing or future ports. Communication port s may be chosen depending on a network such as a Local Area Network LAN Wide Area Network WAN or any other network to which the computer system connects. For example in the context of a PBX communication port s may include communication cards supporting Ethernet or DS1 DS3 types of connections and in the context of a fax server such as one of fax servers communication port s may include Ethernet DS0 T1 DS1 such as ISDN PRI or fractional T1 DS1 or digital DS0 such as ISDN BRI .

Main memory can be Random Access Memory RAM or any other dynamic storage device s commonly known in the art. Read only memory can be any static storage device s such as Programmable Read Only Memory PROM chips for storing static information such as start up or BIOS instructions for processor .

Mass storage may be any current or future mass storage solution which can be used to store information and or instructions. Exemplary mass storage solutions include but are not limited to Parallel Advanced Technology Attachment PATA or Serial Advanced Technology Attachment SATA hard disk drives or solid state drives internal or external e.g. having Universal Serial Bus USB and or Firewire interfaces such as those available from Seagate e.g. the Seagate Barracuda family or Hitachi e.g. the Hitachi Deskstar 7K1000 one or more optical discs Redundant Array of Independent Disks RAID storage such as an array of disks e.g. SATA arrays available from various vendors including Dot Hill Systems Corp. LaCie Nexsan Technologies Inc. and Enhance Technology Inc.

Bus communicatively couples processor s with the other memory storage and communication blocks. Bus can include a bus such as a Peripheral Component Interconnect PCI PCI Extended PCI X Small Computer System Interface SCSI USB or the like for connecting expansion cards drives and other subsystems as well as other buses such as front side bus FSB which connects the processor s to system memory.

Optionally operator and administrative interfaces such as a display keyboard and a cursor control device may also be coupled to bus to support direct operator interaction with computer system . Other operator and administrative interfaces can be provided through network connections connected through communication ports .

Removable storage media can be any kind of external hard drives floppy drives IOMEGA Zip Drives Compact Disc Read Only Memory CD ROM Compact Disc Re Writable CD RW Digital Video Disk Read Only Memory DVD ROM .

In some embodiments a computer system such as computer system is configured to operate as one or more of PBXs . For example as described above any or all of PBXs may be implemented as a Linux server running an open source PBX software package such as Asterisk. In some embodiments a computer system such as computer system is configured to operate as one or more of fax servers . For example as described above any or all of fax servers may be implemented as a Linux server running open source fax server software such as HylaFAX. In some embodiments a computer system such as computer system is configured to support one or more databases such as a billing database and or data store . For example as described above any or all of the databases described herein may be implemented within a Solaris x86 based workstation running an open source database such as MySQL. As those of ordinary skill in the art will appreciate the computer system components described above are meant only to exemplify various possibilities. In no way should the aforementioned exemplary computer system limit the scope of the invention.

At block the inbound fax call is assigned to a call mediation system. In one embodiment a switch such as switch performs round robin load balancing among multiple PBXs such as PBX . In such an embodiment the switch is stateful as it keeps state regarding which PBX to use next for example. Those skilled in the art will appreciate that various other load distribution techniques are available. For example in alternative embodiments the inbound fax call may be assigned to the least recently used PBX a randomly selected PBX or PBX having the most available capacity. If guaranteed or differentiated quality of service is offered to subscribers weighted round robin or weighted fair queuing may be implemented.

At block device configuration features required for processing the inbound fax call are determined. According to one embodiment the PBX to which the inbound fax call has been assigned performs a source address and subscriber account lookup based on the destination address in data store to identify configurations or known capabilities limitations associated with the source and or the destination of the inbound fax call. For example the fax transmission source of the inbound call may be known to be capable of high speed transmission and therefor indicate a preference for a higher speed fax server. Alternatively the fax transmission source may be known for producing higher than average transmission errors or known to be using an older fax standard thus indicating a preference for a lower speed fax server.

The PBX may also use information regarding the service provider and or whether the inbound fax call arrived over a packet switched or circuit switched connection to determine configuration features required for processing the inbound fax call. Based on the various factors it may be determined for example that a fax server that is more tolerant of delays is a feature desirable for processing the particular inbound fax call. Those skilled in the art will appreciate an appropriate data structure can be created and maintained to store and prioritize configuration feature information based on the above referenced factors and or others. For example a configuration feature preference associated with a particular network connection e.g. packet switched connection may override and take precedence over a configuration feature preference associated with one or both of the source address and the destination address of the inbound fax call at issue.

In some embodiments an inbound fax call may be accepted or rejected by the PBX without performing any further processing based on various factors. For example the PBX may reject an inbound fax call according to the subscriber s subscribed capacity and how many calls are currently in progress to one or more destination addresses associated with the subscriber. Calls can also be rejected based on the subscriber configuring source addresses e.g. known fax spammers from which calls are not to be accepted.

According to one embodiment as a precondition to performing configuration feature determination the PBX may check whether the subscriber to which the inbound fax call is directed is within its subscribed capacity limits e.g. number of received faxes total faxes number of concurrent inbound fax calls number of received fax pages and or total fax pages within a predetermined time frame long distance fees bandwidth storage etc. . If the subscriber is determined to be at capacity then a busy signal can be returned to the caller. Alternatively or additionally an inbound fax call may be blocked by sending a busy signal at the PBX without passing the call to a fax server based on the source address the destination address or a combination of the two addresses. Source address only blocking may be performed system wide for all subscribers and all destinations. In one embodiment an inbound fax call may be blocked based on a combination of the source address and the subscriber. That is subscribers of the Internet fax system may be provided with the capability to block a source to just one of their numbers or to all of their numbers including numbers to which they subscribe in the future the block being based on source subscriber combination accomplishes this. In one embodiment the PBX remains in the path of the call and waits for the call to be completed so it can record call accounting for billing in a billing database. In one embodiment at the time of the inbound call event and prior to call completion source and destination address configurations are checked but the centralized resource for user account information is not.

At block to the extent the inbound fax call is to be passed to a fax processing resource an appropriate fax processing resource is selected. According to one embodiment appropriate fax processing resource selection proceeds as described with reference to .

At block the source and destination addresses associated with the inbound fax call are translated and the appropriate DACS is called. According to one embodiment the PBX places the DNIS into the calling name and changes the DNIS to the extension of the selected fax processing resource prior to calling the DACS. Those skilled in the art will be familiar with various conventions schemes for assigning extensions to DACS and fax servers in the exemplary architecture depicted in . In one embodiment each PBX is associated with one or more DACS each having 24 fax ports and the extensions have the following format 

At block the inbound fax call is translated to analog and redirected to the selected fax processing resource. In one embodiment the DACS redirects the incoming call signal along with the source and destination addresses to the selected fax processing resource as specified in the destination address specified by the call mediation system to the message processing resource via a circuit switched connection translating the ANI into caller ID name containing the original destination address and number containing the source address fields. According to one embodiment the DACS redirects the inbound fax call to the port number represented by the last two digits of the DNIS of the inbound fax call.

At decision block it is determined whether the selected fax processing resource answered the call. If so then fax call processing continues with block otherwise fax call processing loops back to block and a different fax processing resource is selected.

At block the inbound fax signal is converted to a fax image and delivered and fax call processing is complete. According to one embodiment conversion and delivery of the fax proceeds as described with reference to .

At block available fax processing resources are identified. According to one embodiment a database exists within the Internet fax system that maintains information identifying i all fax processing resources within the Internet fax system ii the DACS and port number with which each fax processing resource is associated and iii features of each fax processing resource. The PBX may identify the universe of fax processing resources available to it by obtaining information from the database relating to fax processing resources associated with one or more DACS connected to the PBX.

In some embodiments the PBX may maintain information regarding those fax processing resources that are ready to accept a call based on device status information periodically provided to the PBX by its associated fax processing resources. In other embodiments the PBX may request device status information as needed from its associated fax processing resources or query the status from a database that maintains such information. In an environment in which device status is available to the PBX the PBX may retrieve from the database feature information for only those fax processing resources known to currently be ready to accept a call.

At block those of the available fax processing resources that can meet the needs of the inbound fax call are identified. According to one embodiment the list of available fax processing resources generated in block is pruned to produce a list of qualified fax processing resources by excluding those fax processing resources that are incapable of handling the fax speed and or other capabilities deemed to be required to processing the fax signal associated with the inbound fax call.

At block an appropriate fax processing resource is selected from the list of qualified fax processing resources. According to one embodiment load balancing is performed among those of the qualified fax processing resources by performing a least recently used selection algorithm or the like. For example the PBX may avoid selection of a previously selected fax processing resource until all other fax processing resources on the list of qualified fax processing resources have been subsequently selected to process an inbound fax call.

At decision block a determination is made regarding whether the fax signal associated with the inbound fax call was successfully received. According to one embodiment successful receipt means receipt of all pages encoded within the fax signal and proper completion of all phases of the fax protocol. If it is determined that fax signal has been successfully received then conversion and delivery processing continue with block otherwise conversion and delivery processing branch to block .

At block detailed information regarding the inbound fax call and the associated fax signal can be stored in a log to facilitate subsequent troubleshooting.

At block subscriber account information is retrieved to obtain delivery preferences configuration for the fax based on the fax number dialed. In embodiments of the present invention each subscriber may have one or more fax numbers and each fax number may have zero or more authorized users.

At block based on the subscriber s established preferences the received fax may be converted from TIFF format to PDF format and stored for retrieval via the web or API. According to one embodiment received faxes are stored based on their destination address not by user thereby supporting the notion of a truly multi user system in which the subscriber is not an individual user but rather is an organization having multiple users. In this manner multiple users may be authorized to access and or delete faxes received on a particular fax number.

At decision block the delivery method is determined. According to one embodiment various configurable delivery preferences include one or more of a preferred image file format e.g. TIFF or PDF delivery method and zero or more authorized users and associated access rights e.g. read only read delete . Exemplary delivery methods include retrieval via a web site associated with the Internet fax server retrieval via API delivery of an email notification with an embedded link from which the fax can be retrieved or delivery of the fax as an email attachment with or without password protection or PGP encryption .

Depending upon the particular implementation the delivery method may be established at the subscriber level the fax number level and or the user level. For sake of brevity and simplicity in the present example it is assumed that a delivery method is established at the subscriber level or the fax number level. As such in accordance with the present example each user designated to receive a copy of faxes received on the particular fax number will receive the fax in the same form and via the same delivery method. If the delivery method is email then conversion and delivery processing continues with block . If the delivery method is web then processing continues with block . If the delivery method is API conversion and delivery processing continues with block . Those skilled in the art will recognize various other delivery methods including but not limited to text message notification instant message notification pager notification notification via automated voice call and the like.

At block the fax message is delivered via email to the designated users. Depending upon the particular implementation a copy of the fax image may or may not also be stored within the Internet fax system. According to one embodiment email delivery proceeds as described with reference to . Upon completion of the email delivery conversion and delivery processing is complete.

At block the fax image is stored within the Internet fax system to make it available for access to authorized users. According to one embodiment fax image storage proceeds as described with reference to .

At block delivery of the fax image is performed via a web delivery mechanism. According to one embodiment fax image storage proceeds as described with reference to . Upon completion of the web delivery conversion and delivery processing is complete.

At block the fax image is stored within the Internet fax system to make it available for access to authorized users. According to one embodiment fax image storage proceeds as described with reference to .

At block delivery of the fax image is performed via an API delivery mechanism. According to one embodiment fax image storage proceeds as described with reference to . Upon completion of the API delivery conversion and delivery processing is complete.

While in the context of the present example fax image storage is shown as taking place for only the web and API delivery methods in one embodiment fax image storage may take place for all delivery methods.

For simplicity shows the delivery method determination being performed only once however it is to be understood that decision block may be placed within a loop to allow a delivery method determination to be made for each user to which a received fax is to be delivered. For example embodiments of the present invention may provide highly customizable delivery options. According to one embodiment delivery preferences can be configured at one or more levels of the hierarchy e.g. the subscriber level the fax number level and or the user level with preferences defined at lower levels of the hierarchy overriding preferences defaults established at higher levels of the hierarchy. As such a received fax may be delivered to multiple users via different delivery methods. For example a subscriber s default delivery preferences may be web delivery e.g. retrieval via a web site associated with the Internet fax system in PDF form with delivery to users A B C and D. Meanwhile a particular fax number associated with the subscriber may be configured via delivery preferences to deliver a copy of all received faxes to users A B and C but not D. Furthermore users A and B may have individually established delivery preferences such as email notification and email delivery via password protected PDF respectively. In such a configuration all faxes received on the particular fax number will be delivered to users A B and C but not user D by causing an email notification to be sent to user A causing an email with a password protected PDF containing an image of the received fax to be sent to user B and causing a copy of the received fax to be stored e.g. in file store that is accessible via the web site by user C.

While for simplicity treats the successful receipt determination i.e. decision block as an all or nothing proposition i.e. either the entire fax is received successfully or it is considered a failure in other embodiments partial fax receipt may be accommodated via an associated delivery preference specifying whether partial faxes should be delivered and if so by logging the partial receipt and treating the partial receipt as a successful receipt for purposes of decision block . In some embodiments the partial delivery on or off preference may be supported only as a per destination preference not per subscriber or per user . Similarly partial delivery may be supported for only a limited number of the delivery methods e.g. email and API delivery but not web delivery .

At block one or more email messages are created directed to the users designated to receive a copy of received faxes for the fax number at issue. Depending upon the particular implementation a single email message can be created directed to all users designated to receive a copy of received faxes for the fax number at issue. Alternatively flexibility can be enhanced by creating separate email messages for each designated user in accordance with their specific delivery preferences. In some embodiments the fax server or email gateway may apply custom messaging to the email message to make the email message appear to be from a customer s service provider that operates as a reseller of the Internet fax service for example. Alternatively the email message may be otherwise reformatted based on customer defined preferences.

According to one embodiment post processing custom messaging email capabilities may be provided on a per subscriber and per user within the subscriber basis in order to support among other things re sale of the fax service and custom parsing requirements the user s system if they parse email with a program may have such as subject line sorting in a way that works for the user in their email client e.g. putting the number from which the fax was received at the beginning of the subject line or the date and time or the page count or whatever so the user can sort and find faxes in the context of their email client e.g. Microsoft Outlook or the like easily by subject line 

At block a preview of the first page of the fax may be embedded inline within the email message. According to one embodiment the preview may be embedded in the form of a reduced size thumbnail image of the first page of the fax. In some embodiments the preview may include more than one page.

At decision block the specific email delivery method is ascertained. Numerous email delivery and notification methods are contemplated. For purposes of simplicity the present example illustrates processing relating to unencrypted email attachment email notification encrypted email attachment and password protected email attachment. If the email delivery method is attachment the email delivery processing continues with block . If the email delivery method is notification then email delivery processing continues with block . If the email delivery method is encrypted processing continues with block . If the email delivery method is password then email delivery processing continues with block .

At block the one or more generated email messages are sent with an attachment in the previously determined desired image file format.

At block the one or more generated email messages are sent with a link from which the fax image can be retrieved. According to one embodiment the link is a secure link that uses SSL to transmit the fax image.

At block the one or more generated email messages are sent with an attachment in the form of an image file encrypted with PGP.

At block the one or more generated email messages are sent with an attachment in the form of a password protected image file such as a password protected PDF.

For simplicity shows the email delivery method determination being performed only once however it is to be understood that decision block may be placed within a loop to allow an email delivery method determination to be made for each user to which a received fax is to be delivered in a manner similar to that described with reference to . As such each user designated to receive an email delivery notification may have such email delivery notification delivered in accordance with their particular preferences.

At block skeleton metadata is inserted into data store . According to one embodiment the skeleton metadata is a subset of the metadata e.g. excluding the associated directory path as it has yet to be determined associated with the received fax and is inserted by the fax server. In one embodiment responsive to the insertion data store returns to the fax server a unique ID e.g. a fax ID of 1 to n digits to be associated with this particular fax received event. According to one embodiment the fax ID is based on an auto incremented unique primary key.

At block the fax image is stored. According to one embodiment the fax image is stored within the file store in a directory path that is based at least in part on the fax ID. In one embodiment if an appropriate directory has not already been created logic implemented within the fax server may create a directory on the file store in accordance with the following convention for example 

At block metadata regarding the received fax is updated for example to include the now known directory path. According to one embodiment the metadata includes 

At block a customer logs in via a web site e.g. web site associated with the Internet fax system. According to one embodiment each user associated with a subscriber is assigned a user name and password.

Assuming the user is logging into the web site to view and or retrieve received faxes at block a request for the receive page is received from the user.

Concurrently with displaying of the receive page at block a list of fax numbers to which the user has access is displayed which might be a subset of all fax numbers associated with the subscriber or even none .

At block the user selects a fax number from the list of fax numbers and the fax number selection is received by a web server associated with the Internet fax system.

At block responsive to the fax number selection a list of received faxes for the selected fax number is displayed. Depending upon the particular implementation received faxes may be selectively displayed in ascending or descending order according to the time and date received. Received faxes may also be sorted based on the source address and or based on whether the received fax has already been viewed or downloaded.

At block the user selects a fax from the list of received faxes and the fax selection is received by the web server.

At block the selected fax is downloaded to the client system being used by the user. Various other interactions relating to administrative settings and receiving sending and or organizing faxes may be supported by the web site interface. For example as described above web site may support the renaming of faxes and the creation and use of logical folders to organize sent and or received faxes.

At block a subscriber application posts a Listfax request to the Internet fax system web services interface e.g. web services via HTTP or HTTPS. According to one embodiment the Listfax request allows for programmatic listing of currently received faxes. For purposes of maintaining security consistent with access via the web site the Listfax request may require among other information the company credential associated with the subscriber as assigned by the Internet fax system a user name associated with the subscriber as assigned by the Internet fax system and the password associated with the user making the request. Various other POST variables include but are not limited to a begin variable which allows the subscriber application to retrieve faxes received after the specified date time. Further details regarding an exemplary Listfax operation are provided in the attached Appendix.

Responsive to the Listfax request at block a list of received faxes including corresponding fax IDs are returned to the subscriber application based on the variables associated with the Listfax request.

At block the subscriber application posts a Getfax request to the Internet fax system web services interface via HTTP or HTTPS. According to one embodiment the Getfax request allows for programmatic downloading of a received fax. As above for purposes of maintaining security consistent with access via the web site the Getfax request may require among other information the company credential a user name and the password associated with the user making the request. In one embodiment the fax ID of the desired fax is a required POST variable. Further details regarding an exemplary Getfax operation are provided in the attached Appendix.

While embodiments of the invention have been illustrated and described it will be clear that the invention is not limited to these embodiments only. Numerous modifications changes variations substitutions and equivalents will be apparent to those skilled in the art without departing from the spirit and scope of the invention as described in the claims.

