---

title: System and method for sharing indoor location information with one or more application program modules within a portable computing device
abstract: A method and system for sharing indoor location information with one or more application program modules within a portable computing device (“PCD”) includes receiving an indoor location data request and determining if a location service is currently being executed by the PCD. If the location service is not being executed, it is determined if a location engine of the PCD has been installed. If the location engine of the portable computing device has not been installed, then the code for the location engine is downloaded from a communications network. Next, the location service may be executed once the location engine has been installed. It is determined if the indoor location data being requested is present in a memory element of the PCD. If the indoor location data being requested is not present in the memory element of the PCD, then the indoor location data is downloaded from the communications network.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09031577&OS=09031577&RS=09031577
owner: QUALCOMM Incorporated
number: 09031577
owner_city: San Diego
owner_country: US
publication_date: 20130608
---
Portable computing devices PCDs are becoming necessities for people on personal and professional levels. These devices may include cellular telephones portable digital assistants PDAs portable game consoles palmtop computers and other portable electronic devices.

Often PCDs may help people navigate within indoor locations. Currently PCDs may download individual application programs that may provide indoor location and navigation information. However one problem with conventional application programs is that they typically require separate and distinct instances of indoor location data such as indoor maps and received signal strength indicator RSSI data. That is each individual application program usually downloads or has part of its internal infrastructure separate indoor location data which is not shared with any other application program.

Such a design becomes problematic since separate indoor location data in the aggregate across multiple application programs may consume significant amounts of limited memory space within a PCD. Accordingly there is a need in the art to solve this problem of multiple instances of separate indoor location data for each individual application program running on a PCD.

A method and system for sharing indoor location information with one or more application program modules within a portable computing device PCD includes receiving an indoor location data request and determining if a location service is currently being executed by the PCD. If the location service is not being executed it is determined if a location engine of the PCD has been installed. If the location engine of the portable computing device has not been installed then the code for the location engine is downloaded from a communications network. Next the location service may be executed once the location engine has been installed. It is determined if the indoor location data being requested is present in a memory element of the PCD. If the indoor location data being requested is not present in the memory element of the PCD then the indoor location data is downloaded from the communications network.

If the indoor location data being requested is present in the memory element of the portable computing device then the indoor location data request may be directed to the location service and to the memory element containing the indoor location data.

The memory element within the PCD may have a venue specific region and a general resource region. The venue specific region of the memory element may have at least one of a venue identifier assistance data indoor maps points of interest crowd sourced data and self sourced data.

The word exemplary is used herein to mean serving as an example instance or illustration. Any aspect described herein as exemplary is not necessarily to be construed as preferred or advantageous over other aspects.

In this description the term application may also include files having executable content such as object code scripts byte code markup language files and patches. In addition an application referred to herein may also include files that are not executable in nature such as documents that may need to be opened or other data files that need to be accessed.

The term content may also include files having executable content such as object code scripts byte code markup language files and patches. In addition content referred to herein may also include files that are not executable in nature such as documents that may need to be opened or other data files that need to be accessed.

As used in this description the terms component database module system and the like are intended to refer to a computer related entity either hardware firmware a combination of hardware and software software or software in execution. For example a component may be but is not limited to being a process running on a processor a processor an object an executable a thread of execution a program and or a computer. By way of illustration both an application running on a computing device and the computing device may be a component.

One or more components may reside within a process and or thread of execution and a component may be localized on one computer and or distributed between two or more computers. In addition these components may execute from various computer readable media having various data structures stored thereon. The components may communicate by way of local and or remote processes such as in accordance with a signal having one or more data packets e.g. data from one component interacting with another component in a local system distributed system and or across a network such as the Internet with other systems by way of the signal .

In this description the terms communication device wireless device wireless telephone wireless communication device and wireless handset are used interchangeably. With the advent of third generation 3G wireless technology and four generation 4G greater bandwidth availability has enabled more portable computing devices with a greater variety of wireless capabilities. Therefore a portable computing device PCD may include a cellular telephone a pager a personal digital assistant PDA a smartphone a navigation device or a hand held computer with a wireless connection or link.

As understood by one of ordinary skill the art an application program for a particular retail location or merchant may generate receive and or generate offers to an operator of a PCD when the PCD physically enters into the retail location. Such application programs may enhance the shopping experience for the operator the PCD because the application programs may check in with the server associated with the retail location or merchant. These application programs use location data described in further detail below in order to determine if a PCD is physically present within a space or retail location operated by a particular merchant.

A power management integrated circuit PMIC may be responsible for distributing power to the various hardware components present on the chip . also shows that the PCD may include a compass module and a location positioning system LPS module .

The LPS module may receive and transmit signals including location parameters from satellites including satellites that are part of the Global Positioning System GPS Galileo GLONASS NAVSTAR GNSS any system that uses satellites from a combination of these systems or any satellite positioning system subsequently developed. The LPS module may also use other network information such as an Internet Protocol IP address WiFi service set identifiers SSIDs from wireless local area networks LANs telecom signal identification and or triangulation from sources other than satellites collectively referred to as a Location Positioning System LPS in this disclosure.

As understood by one of ordinary skill in the art however the technology of all LPS systems is constantly being improved. New as yet unknown technologies for location determination and for determining location parameters of use with this system may be used and are included in the meaning of LPS as described above.

In a particular aspect one or more of the method steps described herein may be implemented by executable instructions and parameters stored in the memory cache that form the shim layer module . These instructions that form the shim layer module may be executed by a CPU A an analog signal processor or any other processor to perform the computer implemented methods described herein.

Further all processors the memory the instructions stored therein or a combination thereof residing within the PCD as described in this disclosure may serve as a means for performing one or more of the computer implemented method steps described herein. As will be described below the shim layer may comprise software and or hardware for sharing indoor location information across a plurality of application program modules within a PCD .

As illustrated in a display controller and a touchscreen controller are coupled to the CPU A. A touchscreen display external to the on chip system is coupled to the display controller and the touchscreen controller .

Memory cache and a subscriber identity module SIM card may also be coupled to the CPU A. Further as shown in a digital camera may be coupled to the CPU A. In an exemplary aspect the digital camera is a charge coupled device CCD camera or a complementary metal oxide semiconductor CMOS camera.

As further illustrated in a stereo audio CODEC may be coupled to the analog signal processor . Moreover an audio amplifier may be coupled to the stereo audio CODEC . In an exemplary aspect a first stereo speaker and a second stereo speaker are coupled to the audio amplifier . shows that a microphone amplifier may be also coupled to the stereo audio CODEC . Additionally a microphone may be coupled to the microphone amplifier . In a particular aspect a frequency modulation FM radio tuner may be coupled to the stereo audio CODEC . Also an FM antenna is coupled to the FM radio tuner . Further stereo headphones may be coupled to the stereo audio CODEC .

As depicted in the touchscreen display the video port the USB port A the camera the first stereo speaker the second stereo speaker the microphone the FM antenna the stereo headphones the RF switch the RF antenna the keypad the mono headset the vibrator and the power supply are external to the on chip system .

The shim layer module functions as an intermediary or balance between application programs and their need for indoor location data hence the use of the term shim as understood by one of ordinary skill the art. The application programs may include a navigational application A in indoor gaming application B a check in application C and a casino guest application D. The inventive system is not limited to these application program modules and may include others not specifically mentioned in this disclosure but are understood as within the scope of this disclosure by one of ordinary skill in the art.

The shim layer module may also communicate and coordinate information gathering by a location engine . The location engine may use the indoor location information from the venue specific cache A and the general cache B in order to determine the current location of the PCD as understood by one of ordinary skill the art. The location engine may work with the LPS module . The location engine may be downloadable from the server . The shim layer may relay information between the application programs and the location resource cache which includes the venue specific cache A and the general cache B as will be described in more detail below.

The location engine may support a location service . The location service may utilize various particle filtering libraries which may need access to the assistance data . The location service may be responsible for providing the latest location. The location service may comprise a daemon. As understood by one of ordinary skill in the art a daemon is a computer program that runs as a background process rather than being under the direct control of an interactive user.

Meanwhile the location engine is usually located on a lower level of code relative to the daemon or location service . The location engine is periodically run and or called periodically by a scheduler not illustrated to perform the computations for updating location information of the PCD . In contrast to the location engine the location service or daemon is usually running once it is called and it does not usually perform any computations and relies on the latest data provided by the location engine .

The shim layer may facilitate exchange of information among the venue specific cache A the general cache B and the location engine as understood by one of ordinary skill the art. The location resource cache may comprise a venue specific cache A and a general cache B.

The venue specific cache A may comprise a table of data such as but not limited to a table that has at least the following columns a venue identifier column an assistance data column an indoor map column a points of interest column and a crowd sourced and self sourced parameter column . Other venue specific data may be included within this venue specific cache A as understood by one of ordinary skill the art.

The venue identifier column may comprise a listing of identifiers for different locations that may have indoor location data. In the exemplary embodiment illustrated in the exemplary venue identifiers comprise a shopping mall I shopping mall II medical office I in an airport I. The venue identifiers may comprise alphanumeric text. The alphanumeric text may or may not comprise human readable or human decipherable identifiers. Other types of venues besides shopping malls medical offices and airports are included within the scope of this disclosure. Any type of indoor location which has corresponding indoor location data may be identified in the venue identifier .

Meanwhile the assistance data column in the venue specific cache A may comprise a set of weights for different locations. Additionally or in an alternate exemplary embodiments the assistance data may comprise expected received signal strength indicator RSSI data associated with wireless fidelity WiFi or wireless local area networks WLANs . The assistance data may have high resolution data settings as well as low resolution data settings.

This means that for high resolution data settings a grid map may have a dense set of coordinates for RSSI data. For low resolution data settings a grid map used for determining an location of the portable computing device may have a dispersed or less dense set of coordinates for RSSI data relative to the high resolution data settings.

The assistance data may comprise unique grid maps for each indoor location associated with a venue identifier . For example if the venue identifier is associated with a building having multiple floors or stories then the assistance data associated with that identifier may have unique grid maps for each floor of the building.

The shim layer may be responsible for downloading and updating the data within the venue specific cache and the general cache . For example the shim layer may update the assistance data as application programming interface API calls are received from each respective application program running on the portable computing device .

The indoor maps may comprise graphical files used to display maps on a display device. The graphical files may comprise JPEG type files as well as PNG files as understood by one of ordinary skill in the art. The points of interest may comprise text names of locations as well as indoor coordinates such as RSSI data that may be searched by a user of the portable computing device .

The crowd sourced and self sourced parameters may comprise various types of data. For example self sourced parameters may include location context identification LCI disambiguation data which allows floor detection to be executed by the portable computing device as understood by one of ordinary skill in the art. The self sourced parameters also comprise the number of particles used in a particle filter as well as the amount of noise used in such a particle filter.

As understood by one of ordinary skill the art a particle filter is a mathematical algorithm used by the portable computing device in order to process the assistance data and any crowd sourced and self sourced parameters . A particle filter assumes that a portable computing device as it traverses two dimensional map behaves like a random variable. The particle filter may compare received RSSI data with expected values for the RSSI data which are stored in one or more tables contained within the memory of the portable computing device . Such particle filtering techniques are known to one of ordinary skill in the art and will not be discussed further in this disclosure.

The crowd sourced parameters may comprise configuration data which is typically relayed from the portable computing device back to the remote server . Such configuration data may include but is not limited to media access control MAC addresses and or threshold values for the RSSI data.

The shim layer may monitor the amount of memory storage available in each respective cache A B. If memory storage of a respective cache A B is running low then the shim layer may jettison or erase data from a respective cache A B as needed when the shim layer needs to download certain data which was requested by a particular application .

The general cache B may comprise icons and graphics as well as filtering libraries and check in libraries . The icons and graphics stored in the general cache B may be accessed in retrieved from the indoor maps and points of interest data of the venue specific cache A.

Similarly the filtering libraries stored in the general cache A may access the assistance data and crowd sourced and self sourced parameters which are assigned to specific venue identifiers . The check in libraries of the general cache B may be responsible for managing the check in operations for the different individual application programs .

For example the check in libraries may be responsible for specific check in applications C that relate to merchant specific or building specific check ins. Each check in library may comprise geo fencing data and or MAC address look up data which are part of various types of checking algorithms as understood by one of ordinary skill the art. Other types of data which may be stored in the general cache may include but is not limited to math libraries machine learning libraries statistics libraries communication and serialization libraries serialization schemas database access libraries compression and decompression data and algorithm parameters.

The data stored in each cache A B may be referenced by the shim layer as shared objects. The shim layer may be responsible for determining if a shared object has been downloaded and if a shared object should remain within a specific cache A B because of the likelihood that another application program may need it for its operations.

The communications network may be established by broadcast RF transceiver towers not illustrated . However one of ordinary skill in the art recognizes that other types of communication devices besides broadcast RF transceiver towers are included within the scope of the system for establishing the communications network . The exemplary communication network of may employ wireless communications towers not shown which couple to the antennas of the portable computing device PCD .

The system may comprise a three tier architecture which has a computer server the communications network and the PCD . The computer server may store various information that includes but is not limited to the assistance data and the crowd sourced and self sourced data . In the exemplary embodiment illustrated in the assistance data may comprise a JPEG map for mall I and RSSI values for mall I. The crowd sourced and self sourced data may comprise LCI data for mall I and LCI data for mall II.

The PCD may request the server to provide any of the indoor location data maintained by or at the server . The PCD may request the server to provide indoor location information in response to the shim layer discovering that certain indoor location data is not present within the location resource cache . The server may receive requests from the PCD over the communications network and the server may transmit the indoor location data that it has over the communications network back to the PCD .

If the inquiry to decision block is negative then the NO branch is followed to decision block . If the inquiry to decision block is positive then the YES branch is followed to decision block .

In decision block the shim layer determines if the location engine has been installed. The location engine was described above in connection with .

If the inquiry to decision block is negative then the NO branch is followed to block in which the shim layer downloads the software code from the server for the location engine . If the inquiry to decision block is positive then the YES branch is followed to block .

In block the shim layer issues a command to the location engine to run the location service . Subsequently in decision block the shim layer determines if the venues specific resources corresponding to the indoor location request received from the application program are present within the location resource cache .

If the inquiry to decision block is negative then the NO branch is followed to block in which the shim layer issues a request for the required indoor location resources from the server over the communications network . If the inquiry to decision block is positive then the YES branch is followed to block in which the indoor location request is redirected to the location service by the shim layer . The shim layer in this block may also relay or pull from the location resource cache the requested indoor location data and transfer it to the location service as appropriate. The method then returns.

Certain steps in the processes or process flows described in this specification naturally precede others for the invention to function as described. However the invention is not limited to the order of the steps described if such order or sequence does not alter the functionality of the invention. That is it is recognized that some steps may performed before after or parallel substantially simultaneously with other steps without departing from the scope and spirit of the disclosure. In some instances certain steps may be omitted or not performed without departing from the invention. Further words such as thereafter then next etc. are not intended to limit the order of the steps. These words are simply used to guide the reader through the description of the exemplary method.

Additionally one of ordinary skill in programming is able to write computer code or identify appropriate hardware and or circuits to implement the disclosed invention without difficulty based on the flow charts and associated description in this specification for example.

Therefore disclosure of a particular set of program code instructions or detailed hardware devices is not considered necessary for an adequate understanding of how to make and use the invention. The inventive functionality of the claimed computer implemented processes is explained in more detail in the above description and in conjunction with the Figures which may illustrate various process flows.

In one or more exemplary aspects the functions described may be implemented in hardware software firmware or any combination thereof. If implemented in software the functions may be stored on or transmitted as one or more instructions or code on a computer readable medium. Computer readable media include both computer storage media and communication media including any medium that facilitates transfer of a computer program from one place to another. A storage media may be any available media that may be accessed by a computer. By way of example and not limitation such computer readable media may comprise RAM ROM EEPROM CD ROM or other optical disk storage magnetic disk storage or other magnetic storage devices or any other medium that may be used to carry or store desired program code in the form of instructions or data structures and that may be accessed by a computer.

Also any connection is properly termed a computer readable medium. For example if the software is transmitted from a website server or other remote source using a coaxial cable fiber optic cable twisted pair digital subscriber line DSL or wireless technologies such as infrared radio and microwave then the coaxial cable fiber optic cable twisted pair DSL or wireless technologies such as infrared radio and microwave are included in the definition of medium.

Disk and disc as used herein includes compact disc CD laser disc optical disc digital versatile disc DVD floppy disk and blu ray disc where disks usually reproduce data magnetically while discs reproduce data optically with lasers. Combinations of the above should also be included within the scope of computer readable media.

Therefore although selected aspects have been illustrated and described in detail it will be understood that various substitutions and alterations may be made therein without departing from the spirit and scope of the present invention as defined by the following claims.

