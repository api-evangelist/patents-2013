---

title: Cloud-based firmware distribution service
abstract: According to one embodiment of the invention, a method for altering stored firmware within a network device comprises receiving, by a first network device, information to download firmware. This information is provided from the first network device to at least a second network device, which is communicatively coupled to the first network device. The information enables the second network device to access a second version of firmware different than a first version of firmware installed on the second network device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09015694&OS=09015694&RS=09015694
owner: Aruba Networks, Inc
number: 09015694
owner_city: Sunnyvale
owner_country: US
publication_date: 20130314
---
This application claims the benefit of priority on U.S. Provisional Application No. 61 720 871 filed Oct. 31 2012 the entire contents of which are incorporated by reference.

Embodiments of the disclosure relate to the field of communications and in particular to a system and method directed to automated firmware updates of network devices.

Over the last decade or so access points normally are provisions by Information Technology IT personnel. For instance according to a conventional deployment scenario manufacturers are responsible for providing access points to a service provider. Thereafter the service provider provisions the access points for a particular customer and then re labels and re ships these access points to that customer for deployment. For firmware updates the service provider normally send technicians to a site to upload or provide necessary firmware to IT personnel who would be responsible for controlling firmware upgrades to network devices. Overall these upgrade schemes are costly and sometimes may compromise security especially when upgrades are delayed for a prolonged period of time.

Embodiments of the disclosure are directed to a cloud based firmware distribution service supporting multiple platforms on multiple network devices including hierarchical network devices operating as virtual control devices and subordinate network devices . The cloud based firmware distribution service is adapted to provide firmware checking operations and or upgrade downgrade services to subscribed network devices and or their subordinate network devices. This firmware distribution service may be set to automatically activate after a predetermined period of time has elapsed in order to determine whether firmware updates are necessary and update the firmware accordingly. Alternatively the firmware update may be prompted by onsite Information Technology IT .

In general according to one embodiment of the disclosure a network device posts a message to a specific uniform resource locator URL e.g. devices.companyA.com firmware . The message contains one or more of the following elements within the header i an identifier of the current version of the firmware and ii device information. The uploaded device information includes one or more of the following 1 Media Access Control MAC address for the network device 2 serial number for the network device and or 3 type part number of the network device.

Where the network device is a particular type of device identified by a mode of operation such as an Independent Access Point IAP type keying material related to a particular version of the firmware may be provided in the header of the message. This keying material enables the network device to get access to legacy firmware images with respect to a specific OEM and version number s . Hence the network device is able to obtain upgrades and downgrades of non current versions of the firmware. An illustrative process in the usage of keying material for firmware updates is shown below 

If the network device is determined to be a subscriber to the cloud based service the cloud server may be adapted to conduct an authentication scheme to verify the authenticity of the network device. As an example a challenge response exchange may be performed in which the cloud server provides a response message with data challenge that is signed with a private key securely contained within the network device. The signed challenge and a pre stored digital certificate are returned to the cloud server. Once the digital certificate is validated by the cloud server the server validates the signed challenge by determining whether the signed challenge matches the original challenge using the certificate included in the body of the response message.

Alternatively in lieu of a challenge response exchange for authentication described above the firmware check and firmware update messages could be facilitated in a single message where the server validates the network device s certificate within Secure Socket Layer SSL negotiations.

Upon successful validation the network device may receive a validation response message indicating that a successful firmware post and response as to whether the current firmware version is the updated version. Other validation response messages may include successful firmware post and response with an URL to a current firmware update having intermediary versions of the updates or without intermediary versions of the firmware update.

Where the network device and subordinate downstream network devices have the same device and or platform type and run the same firmware version the network device operating as a virtual control device may download the firmware and provide the same to the subordinate network devices. However for subordinate network devices of different device and or platform types the network device provides the URLs for the subordinate network device to use to obtain the updated firmware. One reason that URLs may be provided to the subordinate network device in lieu of firmware images themselves is based on the network device having limited storage capacity. This limited storage capacity precludes the network device from storing multiple firmware images needed by the subordinate network devices.

Herein certain terminology is used to describe features of the disclosure. For example the term network device generally represents electronics that support the receipt and or transmission of wireless communications including but not limited or restricted to an Access Point AP server a base station a data transfer device e.g. switch router bridge brouter etc. communication management device or any device that operates as a conduit for information traveling over a network.

It is contemplated that a network device may include hardware logic including one or more of the following i processing circuitry ii one or more communication interfaces such as radios e.g. one or more components that handle the wireless data transmission reception and or physical connectors to support wired connectivity and or iii a non transitory computer readable storage media e.g. a programmable circuit a semiconductor memory such as a volatile memory such as random access memory RAM or non volatile memory such as read only memory power backed RAM flash memory phase change memory or the like a hard disk drive an optical disc drive etc. or any connector for receiving a portable memory device such as a Universal Serial Bus USB flash drive portable hard disk drive or the like.

Additionally the term logic is generally defined as hardware and or software. As hardware logic may include a processor e.g. processing circuitry such as a controller a microprocessor digital signal processor a programmable gate array an application specific integrated circuit combinatorial logic etc . As software logic may be one or more software modules such as executable code in the form of an executable application an application programming interface API a subroutine a function a procedure an object method implementation an applet a servlet a routine a source code an object code a shared library dynamic load library or one or more instructions. These software modules may be stored in any type of a suitable non transitory storage medium described above or transitory computer readable transmission media e.g. electrical optical acoustical or other form of propagated signals such as carrier waves infrared signals digital signals .

 Firmware denotes software that controls functionality of the network device. Examples of firmware include software pertaining to an operating system or Basic Input Output System BIOS e.g. boot block .

An interconnect is generally defined as a communication pathway established over an information carrying medium. This information carrying medium may be a physical medium e.g. electrical wire optical fiber cable bus traces etc. a wireless medium e.g. air in combination with wireless signaling technology or a combination thereof. The data transferred over the interconnect may be in accordance with a variety of communication protocols including but not limited or restricted to those protocols in accordance with WIFi various IEEE 802.11 standards e.g. IEEE 802.11ac 802.11n etc. or the like.

Lastly the terms or and and or as used herein are to be interpreted as inclusive or meaning any one or any combination. Therefore X Y or Z or X Y and or Z mean any of the following X Y Z X and Y X and Z Y and Z X Y and Z. An exception to this definition will occur only when a combination of elements functions steps or acts are in some way inherently mutually exclusive.

Certain details are set forth below in order to provide a thorough understanding of various embodiments of the disclosure albeit the invention may be practiced through many embodiments other that those illustrated. Well known logic and operations are not set forth in detail in order to avoid unnecessarily obscuring this description.

Referring to an exemplary embodiment of a network utilizing a cloud based firmware update distribution service is shown. Herein network comprises a cloud based service that is adapted for receiving communications from one or more network devices .

Herein cloud based service comprises one or more servers that collectively operate to manage firmware updates. In particular cloud based service is configured to receive firmware updates from network device manufacturers sellers and or network service providers and coordinate seamless firmware updates for network device . The distribution of these firmware updates is managed as response messages to periodic firmware check messages initiated from the network devices .

For instance one or more servers within cloud based service hereinafter referred to as cloud server are adapted to receive firmware check messages from network device . Each firmware check message causes cloud server to determine i if network device is authenticated as a device that may utilize this service and ii whether network device is loaded with current firmware or whether a firmware update is needed. The message flow for the firmware update is described in .

Referring now to an exemplary embodiment of network device operating in combination with cloud based service is shown. In accordance with one embodiment of the disclosure network device comprises processor logic a memory and a communication interface that is adapted to communicate with other devices supporting wired and or wireless connectivity. For instance memory may be a type of non volatile memory adapted to store firmware update logic which controls the firmware requests and distribution as well as firmware for different device platforms and or different versions of firmware for the same device platform as shown in . Although in order to reduce costs memory may be sized to only store a single version of the firmware. Communication interface may comprise a wired port and or one or more radios tuners and or antenna s that support wireless communications.

Optionally network device may include a trusted platform module TPM in communication with processor and memory over an interconnect . The TPM comprises a digital certificate that includes a serial number and or MAC address of network device . Certificate may be used to verify to cloud server of that a firmware check message is from an authenticated network device.

As shown in a display of firmware file parameters that can be created or modified is shown. To determine an appropriate firmware version for a network device cloud based service applies the following rules 

Referring now to an exemplary embodiment of a dashboard display produced by cloud based service and accessible for firmware downloads is shown. Herein different firmware for different platforms namely different types of network devices is shown. For instance as shown in entries and of dashboard firmware version is available for platforms P and P. Other firmware parameters may include file name version platform OEM size and or checksum .

As optional features dashboard display may feature a device summary that features an organized layout of the parameters for firmware associated with entry . Also dashboard display may also feature an area that lists all of the types of devices that may be implemented with the firmware set forth in device summary .

Referring to an exemplary embodiment of the cloud based firmware update scheme utilized by network device is shown. Initially network device is activated and operational on a network . In response to a triggering event network device operating in accordance with firmware update logic posts a message to a cloud server of cloud based service . Examples of different types of triggering events include but are not limited or restricted to i a time based event in which a predetermined amount of time has elapsed e.g. multiple days such as a week or ii a change in responsibilities for network device e.g. assignment to be a virtual control device joining of one or more additional subordinate network devices when network device operates as a virtual control device etc. .

According to one embodiment of the disclosure message comprises information that identifies i message type firmware check ii a current firmware version loaded on network device iii device information associated with network device . Device information may include 1 a Media Access Control MAC address for network device 2 a serial number for network device 3 a device type identifier for network device and or 4 a hexadecimal string value related to a particular version of the firmware. Normally the hexadecimal string value is generated by the cloud server of cloud based service when a particular firmware image is uploaded so as to pair the value to the firmware image.

Upon receipt of message and verification that network device subscribes to firmware update distribution service cloud based service initiates one or more challenge response exchanges in order verify that message originated from network device . A challenge message comprises a random or pseudo random value that is subsequently operated upon by network device and returned as part of response message . Challenge message may further solicit transmission of digital certificate from a trusted platform module TPM deployed within network device . This challenge response exchange may be used to prevent man in the middle attacks.

Upon receipt of information with response message and successful authentication of network device cloud based service returns a validation response message providing desired version of firmware for network device and or URLs to firmware updates for multiple device types in the event that network device is operating as a virtual control device for other network devices.

As a virtual control device network device only needs to send a single line for all subordinate network devices such as access points controllers switches etc. because it is typically assumed that all subordinate network devices are running the same version of software as the virtual control device. In this implementation as a virtual control device network device receives a list of URLs with links to download a firmware image corresponding to a particular firmware version for various device types. Hence firmware update logic of network device can download the firmware image for itself and allow its subordinate network device s to retrieve the firmware image from itself instead of through the link thereby reducing the network traffic load. A subordinate network device only needs to access the URL to download the firmware if its device type is different from network device or if it changes its virtual control device. During the firmware update process if it is revealed that the MAC address and serial number combination of subordinate network device is new or is associated with a different virtual control device then that subordinate device s record should be updated to the new network device.

Thereafter firmware update logic of network device loads the firmware update and according to this illustrative embodiment resets a timer counter that will prompt network device to post another firmware check message to cloud server after another predetermined amount of time has elapsed.

Referring now to a more detailed embodiment of the cloud based firmware update distribution scheme of utilized by network device is shown. In general the cloud or dedicated firmware server can provide for both firmware upgrades and downgrades. Also while providing firmware upgrade downgrade services the cloud or dedicated firmware server may require a match of the OEM information if the firmware request by the network device requests an OEM version.

Network device may be adapted to post to the URL device.companyA.com firmware with a keep alive connection specification containing one or more of the following elements contained within a header of firmware check message 

FW Key is an optional element and it is contemplated that FW Key may only sent by IAPB namely APs without need of controller connectivity unlike Remote APs RAPs which are network devices in a controller based operating mode. This element provides a method for IAPB to get access to images with a specific OEM version . Hence customers that have subscribed for firmware update support are able to upgrade or downgrade to non current versions. The key or keying material is a SHA 1 hashed value which makes it very difficult for a customer without support to guess the key.

Cloud server may be configured to determine the device s authentication state by evaluating the session id element provided in the posted firmware check message. Cloud server may be further adapted to respond with a challenge message with a keep alive connection specification timeout 15 and max 100 containing one or more of the following elements in header 

Cloud server may respond with an HTTP Status code of 200 indicating the request succeeded. Furthermore cloud server may record the network device s last contacted information in a device table. Other elements in a device table may be updated also if information received from network device is different than stored first seen mode of operation controller accessed by network device OS version boot block version and or source IP address obtained from post message itself .

Network device may be adapted to post message to the URL device.companyA.com firmware with a close connection specification containing one or more of the following elements within header and body of message 

Cloud server may validate the digital certificate and thereafter server may validate that the signed challenge matches the original challenge using the certificate included in the body of the response message.

Cloud server may respond with validation response message that comprises a header and body with one or more of the following elements 

Related to Firmware Invalid the cloud server does not understand or know about the current firmware version.

If authentication is successful cloud server returns the desired or latest version of firmware and URLs to those firmware files within the body of validation response message.

Cloud server may respond with an HTTP Status code of 200 indicating the request succeeded. Error conditions related to the firmware check API may be contained within the Status Code element.

Cloud server may terminate the SSL session immediately after successful response to the provision update response. Network device may log errors from Status Code and errors encountered obtaining and applying firmware appropriately in syslog or the Web UI.

Network device is configured to retrieve the firmware updates using HTTP and the URL ascertained in the firmware check described above. This URL may be related to device.company.com namely OEM retailer software manufacturer responsible for the firmware. Alternatively this URL may relate to fwfiles.company.com namely a dedicated firmware server to which firmware updates have been offloaded.

It is contemplated that the retrieval of firmware features only one header element. This information is needed for cloud server to understand which device is retrieving the firmware.

It is further contemplated that network device normally issues firmware check message that is adapted to obtain the latest version of the firmware. However where network device operates as a virtual control device firmware check message may request a specific version of the firmware that is different from the latest version where the selected version is based on the version of firmware supported by a cluster e.g. one or more of subordinate network devices controlled by network device . For instance if the cluster of subordinate network devices are all running version 1.2 and a new subordinate network device operating with version 1.3 attempts to join the cluster network device issues firmware check message for version 1.2 in order to downgrade the new subordinate network device that version of firmware.

In addition the cloud based firmware distribution service displays one or more of the followings to the administrator 

Additional advantages and modifications will readily occur to those skilled in the art. Therefore the invention in its broader aspects is not limited to the specific details and representative embodiments shown and described herein. Accordingly various modifications may be made without departing from the spirit or scope of the general inventive concept as determined by the foregoing claims and their equivalents. The descriptions are thus to be regarded as illustrative instead of limiting.

