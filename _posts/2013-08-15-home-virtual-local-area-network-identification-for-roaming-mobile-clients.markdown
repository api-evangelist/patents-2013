---

title: Home virtual local area network identification for roaming mobile clients
abstract: The present disclosure discloses a method and network device for home VLAN identification for roaming mobile clients. Specifically, the disclosed method and system detects that the mobile client has roamed away from a first network to a second network, maintains a mapping between a virtual local area network (VLAN) corresponding to the mobile client and a tunnel corresponding to a foreign agent in the second network, and forwards packets to or from the mobile client on the VLAN based on the mapping between the VLAN and the tunnel via which the packets are received. Therefore, the disclosed method and system allows for identification of home VLANs for roaming mobile clients without merging VLAN policy configurations at the home agent and the foreign agent.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09060331&OS=09060331&RS=09060331
owner: ARUBA NETWORKS, INC.
number: 09060331
owner_city: Sunnyvale
owner_country: US
publication_date: 20130815
---
This application is a Continuation of U.S. patent application Ser. No. 13 664 330 filed on Oct. 30 2012 the entire content of which is hereby incorporated by reference.

The present disclosure relates to wireless mobility. In particular the present disclosure relates to home virtual local area network VLAN identification for roaming mobile clients in wireless networks.

Mobile IP protocol is an Internet Engineering Task Force IETF standard communications protocol. Mobile IP protocol allows mobile clients to move from one network to another network while maintaining the same Internet Protocol IP address. Usually each mobile client is identified by its home address regardless of its current location. While away from its home network the mobile client is associated with a care of address which identifies its current location and its home address is associated with the local endpoint of a tunnel to its home agent. Thus Mobile IP protocol specifies how a mobile client registers with its home agent and how the home agent routes datagrams to the mobile client through the tunnel.

Conventionally mobility in the network layer has been achieved with Internet Protocol in Internet Protocol IPIP tunnels which carry only the Internet Protocol IP payload between a home agent and a foreign agent in a wireless network. Original physical layer headers are not carried across the tunnel. Thus the only means of identifying the client will be based on the IP address.

Also the traffic has to be routed once the packets reach the home agent. Such routing by the home agent introduces at least the following issues First it requires routing to be enabled by the home agent where the mobile client was initially associated with on its home virtual local area network VLAN . Second when packets are routed using the best route on the home agent the routed traffic could leave the home agent on a different VLAN than the home VLAN of the home agent. Third when network layer broadcast or multicast traffic from a roaming mobile client is received by the home agent the VLAN used to forward the traffic has to be decided implicitly based on reverse route lookup by the source IP address or client IP address of the packet.

On the home agent if the traffic is routed on a different VLAN than the home VLAN it may potentially allow guest traffic on a different VLAN that is not the home VLAN of the home agent. This can cause traffic to be black holed due to the following reasons First the receiving router can have anti spoofing access control lists ACLs that are configured to determine which packets are to be dropped based on whether the source IP corresponds to the incoming VLAN subnet.

Second the receiving router has virtual routing and forwarding VRF configured and thus could prevent guest traffic from being forwarded outside a specific VRF path. Home VLAN has been configured to perform source NAT on the traffic forwarded out of the vlan. If the traffic is not forwarded from the Home Vlan the home agent may fail to source NAT the packet.

Moreover conventional mobility implementations trap DHCP messages from the mobile client and play them back on the home VLAN on behalf of the mobile client. This also ensures that DHCP transaction does not get transmitted on a foreign VLAN because transmitting DHCP transaction on a foreign VLAN would result in the mobile client changing its IP address. When implemented in control plane the conventional mobility implementations do not scale when a high density of mobile clients roam during the same time period. When a mobile client roams away from its home agent the DHCP packets are relayed from the foreign agent to the home agent. Therefore the relay process introduces undesirable latency since the same packets have to travel multiple hops before making to their final destination.

In the following description several specific details are presented to provide a thorough understanding. While the context of the disclosure is directed to home VLAN identification for roaming clients one skilled in the relevant art will recognize however that the concepts and techniques disclosed herein can be practiced without one or more of the specific details or in combination with other components etc. In other instances well known implementations or operations are not shown or described in details to avoid obscuring aspects of various examples disclosed herein. It should be understood that this disclosure covers all modifications equivalents and alternatives falling within the spirit and scope of the present disclosure.

Embodiments of the present disclosure relate to wireless mobility. In particular the present disclosure relates to home virtual local area network VLAN identification for roaming mobile clients.

According to embodiments of the present disclosure a disclosed network device detects that the mobile client has roamed away from a first network to a second network maintains a mapping between a virtual local area network VLAN corresponding to the mobile client and a tunnel corresponding to a foreign agent in the second network and forwards packets to or from the mobile client on the VLAN based on the mapping between the VLAN and the tunnel via which the packets are received. Therefore the disclosed method and system allows for identification of home VLANs for roaming mobile clients without merging VLAN policy configurations at the home agent and the foreign agent.

Network switch is a computer networking device that connects network segments or network devices. Network switch or may include a multi port network bridge that processes and routes data at the data link layer e.g. layer 2 of the OSI model or switches that additionally process data at the network layer e.g. layer 3 of the OSI model .

Furthermore switch can be connected to router which can forward traffic to and receive traffic from Internet . Router generally is a network device that forwards data packets between different networks and thus creating an overlay internetwork. A router is typically connected to two or more data lines from different networks. When a data packet comes in one of the data lines the router reads the address information in the packet to determine its destination. Then using information in its routing table or routing policy the router directs the packet to the next different network. A data packet is typically forwarded from one router to another router through the Internet until the packet gets to its destination.

Firewall can optionally be configured to police traffic to from Internet . In some embodiments security policies can be configured at firewall to dictate the network access protocols and applications that are permitted or denied as well as levels of network services that are provided. Such security policies can be actively enforced in a mobile environment with policies enforced upon mobile clients as they roam within one or more mobility domains in wireless networks.

Moreover assuming that home access point is interconnected with home control device and foreign access point is interconnected with foreign control device . In this example for illustration purposes only assuming that client initially is associated with home access point and later roams to associate with foreign access point . Access point or generally refers to a network device that allows wireless clients to connect to a wired network. Access points usually connect to a router via a wired network or can be a part of a router in itself.

Also router maybe connected directly or indirectly with a Dynamic Host Configuration Protocol DHCP server . DHCP server maintains a database of available IP addresses and configuration information. When DHCP server receives a request from a client e.g. client DHCP server determines the network to which the DHCP client is connected and then allocates an IP address or prefix that is appropriate for the DHCP client and sends configuration information appropriate for that client.

As an example assuming that client is in communication with workstation when client roams from its home access point to foreign access point . In order to maintain network layer connectivity client shall keep the same IP address after it roams to foreign access point . On the other hand for each layer 3 packet destined to client from workstation received by switch switch shall be able to 1 identify the right VLAN for client to forward the layer 3 packet to and 2 determine where to forward the layer 3 packet to by performing a route lookup. Note that in some embodiments the home agent e.g. home access point and the foreign agent e.g. foreign access point are managed by different master control device and thus the foreign agent may e.g. foreign access point not know the VLAN settings and or configurations at the home agent e.g. home access point .

In order to forward the layer 3 packet according to one embodiment after foreign access point receives the packet from workstation foreign access point can encapsulate the layer 3 packet with a layer 3 header and send the packet through an IP IP tunnel between control device which is connected to foreign agent and control device which is connected to home agent . Home agent e.g. home access point then de capsulates and forwards the layer 3 packet. Note that home agent need to determine the VLAN associated with the incoming layer 3 packet prior to forwarding the packet.

In some embodiments home agent can determine the corresponding VLAN by performing a route lookup on source IP address of the incoming layer 3 packet to determine the VLAN on which the packet shall be forwarded. This typically requires a network administrator to configure the VLAN mapping between mobile client s identifier and its corresponding VLAN identifier. In some embodiments home agent can snoop DHCP packets in order to determine the VLAN identifier. In other embodiments home agent may cache the VLAN information so that it can determine the VLAN identifier later. These solutions necessarily encompass network administration and complicated configurations.

Because IP IP tunnel does not carry original layer 2 headers from the client while client roams to associate with foreign access point . Also the datapath and or fastpath at the home agent are not aware of client s home VLAN. Hence the home agent will be routing traffic from client using its own default gateway. The IP IP tunnel based design has the following limitations 

If client s default gateway is not same as the home agent s default gateway VRF may be used in the upstream router. For example VRF forwarding tables could prevent traffic from guest user e.g. client while associated with access point being forwarded outside a specific VRF path leading to loss of connectivity.

In addition if the default gateway for the home agent has anti spoofing access control lists ACLs configured it will drop packets whose source IP address do not match incoming interface subnet. If VLAN based network address translation NAT is configured for the home VLAN guest traffic cannot be source network address translated at the home agent because datapath is not aware of the home VLAN.

Furthermore in case of inter controller IP mobility authentication process usually can set of ACE ACL entries for each mobile client to redirect network layer traffic to the IP IP tunnel. Scalability limitations may arise when then number of guest clients increases.

Intrusion detection systems relying on ARP poisoning to quarantine a mobile client at a foreign agent will fail. This is because IPIP tunnels cannot carry ARP packets. Last but not least existing model cannot be used for IPv6 mobility.

Furthermore switch can be connected to router which can forward traffic to and receive traffic from Internet . Router generally is a network device that forwards data packets between different networks. Firewall can optionally be configured to police traffic to from Internet . Moreover in this example it is assumed that home access point is interconnected with home control device and foreign access point is interconnected with foreign control device . In this example for illustration purposes only assuming that client initially is associated with home access point and later roams to associate with foreign access point .

Also router maybe connected directly or indirectly with a Dynamic Host Configuration Protocol DHCP server . DHCP server can receive a request from a client e.g. client determine the network to which the DHCP client is connected and then allocate an IP address or prefix that is appropriate for the DHCP client.

For illustration purposes only assuming that mobile client is configured with an IP address of 10.16.23.10 MAC address of 00 18 DE 65 E1 2D and a default gateway of 10.16.23.254. Furthermore assuming that control device is configured with an IP address of 10.16.28.10 and supports VLAN . Moreover control device is configured with IP address of 10.16.28.20 and supports VLAN . Here VLAN is configured as 10.16.23.1 24 and VLAN is configured as 10.16.24.1 24. Also assuming that VLAN is the VLAN configured on home access point and VLAN is the VLAN configured on foreign access point .

Initially mobile client associates to home access point . Upon association mobile client will be assigned an IP address e.g. 10.16.23.10 by DHCP server . VLAN e.g. 10.16.23.1 24 becomes the home VLAN for mobile client .

Assuming that client is in communication with workstation when client roams from its home access point to foreign access point . In order to maintain network layer connectivity client shall keep the same IP address e.g. 10.16.28.10 after it roams to foreign access point .

According to some embodiments a layer 2 Generic Routing Encapsulation GRE tunnel is established between home agent and foreign agent. GRE tunnel preserves physical layer headers in the packets transmitted from mobile client associated with a foreign agent to its home agent. The home agent can then bridge traffic from the layer 2 GRE tunnel to the correct home VLAN for the mobile client. Moreover layer 2 GRE tunnel can optionally be used for carrying other packets between the home agent and the foreign agent for example IPv6 packets ARP packets DHCP packets etc.

In one example after mobile client roams from home access point to access point foreign control device can determine that mobile client initiated an inter control device and inter VLAN move. In other words mobile client is determined to be corresponding to a home agent at a different control device whereas the home agent VLAN e.g. VLAN associated with access point is different from the foreign agent VLAN e.g. VLAN associated with access point . Foreign control device may determine so based on one or more of home agent discovery request agent discovery request response mobile IP registration request response etc. Furthermore foreign control device can learn the home VLAN for mobile client from such messages e.g. the mobile IP registration response message in which the home VLAN is included as a vendor specific extension. Then foreign control device creates a layer 2 GRE tunnel using the home agent s and foreign agent s respective switch IP addresses as the endpoints for the layer 2 GRE tunnel. Note that packets transmitted over layer 2 GRE tunnel will not have a VLAN tag. Rather switch will assign a VLAN identifier e.g. zero or 4095 after decapsulating packets received from layer 2 GRE tunnel .

Here DA indicates destination Media Access Control MAC address of the packet SA indicates source MAC address of the packet. Furthermore outer IP includes a source IP address of the foreign agent and a destination IP address of the home agent. The field GRE is configured with a custom type e.g. 0x9010 and or a flag that is used to differentiate trusted versus untrusted packets. Furthermore DA indicates the MAC address of the default gateway for the mobile client or MAC address of a peer in the home VLAN or broadcast MAC and SA indicates the MAC address of the mobile client at the foreign agent. Payload indicates user data of the packet.

A packet received from the roaming mobile client includes at least control information such as DA and SA in the header and user data information such as payload . The foreign agent can then add GRE header outer IP SA and DA to the packet whereas the portion of the packet including at least DA SA and payload is encapsulated as visitor payload .

In addition the home agent and or foreign agent will add or change its bridge entries accordingly upon various events e.g. when the home agent receives a home agent discovery request or when the foreign agent receives a registration response message etc.

Furthermore VLAN indicates the VLAN of the port and or tunnel from which the packet is received whereas assigned VLAN indicates the home VLAN assignment. Note that the home VLAN will be stored in assigned VLAN field of the bridge entry. Assigned VLAN field will be used to overwrite the default VLAN of a packet during source MAC bridge lookup in the datapath. This is not an issue even if VLAN is derived from authentication server and or roles because the home agent would delete the mobile client in derived VLAN when changing the bridge table. With this change in the bridge table datapath is aware of the mobile clients home VLANs and thus can direct the traffic accordingly.

After the mobile client roams to a foreign access point the disclosed system would determine that this is an inter controller inter VLAN move based on one or more of a home agent discovery an agent discovery request or response message a mobile IP registration request or response etc. For example the foreign agent can learn the roaming mobile client s home VLAN from the mobile IP registration response message because the home VLAN is included in the registration response as a vendor specific extension. Thereafter the foreign agent can create a layer 2 GRE tunnel using the home agent and the foreign agent s corresponding switch IP addresses as the tunnel endpoints. Packets traversing the tunnel will have their VLAN tag removed. Moreover datapath will always assign a VLAN identifier e.g. zero or 4095 after decapsulating packet from the L2 GRE tunnel.

In the example illustrated in assuming that two mobile clients of the home agent have roamed to the same foreign agent. Different layer 2 GRE tunnels may be established for the two mobile clients. However all of the layer 2 GRE tunnels will be associated with a dedicated VLAN e.g. VLAN .

In this example the first two entries in the first and second rows of the bridge table correspond to a first mobile client having MAC address 00 18 DE 65 E1 2D. The first entry would be used to bridge packets from the layer 2 GRE tunnel on to tunnel . The second entry will be used to bridge packets from VLAN with destination MAC address corresponding to the first mobile client s MAC address.

Likewise the next two entries in the third and fourth rows correspond to a second mobile client having MAC address 00 18 65 E1 3E etc. The third entry would be used to bridge packets from the layer 2 GRE tunnel on to tunnel . The fourth entry will be used to bridge packets from VLAN with destination MAC address corresponding to the second mobile client s MAC address.

In addition to the bridge entries ACL ACE entries would be also changed at the foreign agent to redirect Address Resolution Protocol ARP and layer 3 packets from the mobile client through the layer 2 GRE tunnel. The changed ACL ACE entries will be made as a part of a new role and all visitors at the foreign agent destined to a particular layer 2 GRE tunnel may be assigned this new role.

When the home agent detects that the first mobile client has roamed away from the home agent the home agent would add and or change the first two entries of the bridge table. Specifically the first entry would be used to bridge packets from VLAN with destination MAC as client MAC. The second entry will be used to overwrite the VLAN of packets from the tunnel with the assigned VLAN.

In some embodiments home agent can determine the corresponding VLAN by performing a route lookup on source IP address of the incoming layer 3 packet to determine the VLAN on which the packet shall be forwarded. This typically requires a network administrator to configure the VLAN mapping between mobile client s identifier and its corresponding VLAN identifier. In some embodiments home agent can snoop DHCP packets in order to determine the VLAN identifier. In other embodiments home agent may cache the VLAN information so that it can determine the VLAN identifier later.

Traffic that flows over the layer 2 GRE tunnel after the mobile client initiates the inter controller roam typically include Address Resolution Protocol ARP messages unicast data packets Dynamic Host Configuration Protocol DHCP messages multicast Internet Group Management Protocol IGMP messages multicast data packets etc. The handling of each type of traffic flows is described in details below.

ARP request from the roamed mobile client at the foreign agent will get redirected by role based ACL through the layer 2 GRE tunnel. At the home agent these packets will be decapsulated assigned to a dedicated VLAN e.g. VLAN and send to bridge LEARN code. The source based MAC lookup will overwrite VLAN with VLAN . Thus the packet will be transmitted on VLAN and its corresponding port based on the destination MAC lookup.

The home agent will serve as a proxy ARP using the actual roamed mobile client s MAC address for any ARP broadcast request sent by peer clients in VLAN e.g. a default gateway at the home agent attempting to resolve the roamed mobile client s MAC address.

In addition peer clients in VLAN at the home agent attempting to resolve the roamed mobile client s MAC address and sending out an ARP request destined to the roamed mobile client s MAC address will succeed destination bridge lookup at the home agent. Thus the ARP request will be transmitted over the layer 2 GRE tunnel to the foreign agent.

At the foreign agent the received ARP packets will be assigned to a dedicated VLAN e.g. VLAN after decapsulation from the tunnel and sent to bridging code. Destination MAC address lookup process at the foreign agent will send the ARP packet to the roamed mobile client over tunnel .

Unicast packets from the roamed mobile client on VLAN will either have the gateway MAC address or the peer client MAC address as the destination MAC address. Therefore these packets will be managed by the role based dynamic ACLs that are configured for the user. As a result these unicast packets will be redirected through the layer 2 GRE tunnel to the roamed mobile client at the foreign agent.

At the home agent these packets will be assigned to a dedicated VLAN e.g. VLAN and sent to bridge LEARN. Source based MAC lookup will overwrite VLAN with VLAN . Then the packet will be transmitted on VLAN and its corresponding port based on outcome of the destination MAC address lookup.

Broadcast DHCP packets destined to the roamed mobile client will be converted to unicast before a destination bridge lookup at the home agent. In some embodiments instead of exchanging DHCP packets for the visitor between the home agent and foreign agent over the layer 2 GRE tunnel these messages can be changed by the home agent and foreign agent using User Datagram Protocol UDP messages instead.

After the roam the mobile IP process at the foreign agent will notify Protocol Independent Multicast PIM process at the foreign agent about active multicast groups for the visitor. The mobile IP process at the foreign agent learns about the MCG s at the home agent through for example a mobile IP registration reply message. Also PIM at the foreign agent will send out an unsolicited report for the group if the roamed mobile client is the only member for the group.

Client IGMP control messages e.g. IGMP report and leave from the roamed mobile client in the foreign VLAN will be managed by the role based dynamic ACLs that are configured for the user. Thus these IGMP control message will be redirected through the layer 2 GRE tunnel. A copy of the IGMP control message will be sent to the PIM at the foreign agent for proxy join leave.

Downstream multicast traffic for the roamed mobile client will directly reach the foreign agent because the PIM at the foreign agent would have proxy joined on the roamed mobile client s MCGs.

Upstream multicast traffic from the roamed mobile client will follow the unicast model and will get redirect through the L2 GRE tunnel by role ACLs.

In some embodiments authentication process creates one dynamic role and inserts three dynamic redirect ACL ACE entries for each home agent and foreign agent pair. The dynamic role and the ACL entries will be flagged as system defined. Therefore the dynamic role and the ACL entries will not be editable or saved in configuration. Furthermore the eth type ACL will be used to redirect ARP traffic and programmed as a standard acl in datapath. Roaming mobile client at the foreign agent will be assigned the corresponding dynamic role to redirect ARP and network layer L3 traffic through the data link layer L2 GRE tunnel. For example the following ACLs may be created for a roaming mobile client 

Also note that all traffic through the layer 2 GRE tunnel from the home agent to the foreign agent is marked as trusted. By contrast all traffic from the foreign agent to the home agent is marked as untrusted. Whether a packet is trusted or untrusted is encoded in each packet by setting bits in the GRE header.

The layer 2 GRE tunnel used inter controller IP mobility is not a part of any multicast group or VLAN flooding. Traffic is redirected through the layer 2 GRE tunnel only through explicit destination MAC address match based on bridge entries at the home agent and or role based ACLs at the foreign agent. Therefore the mechanism disclosed herein will prevent loops the same way as if a layer 3 IP IP tunnel is established.

Router generally is a network device that forwards data packets between different networks. Here router can forward traffic to and receive traffic from Internet . Firewall can optionally be configured to police traffic to from Internet . Also router maybe connected directly or indirectly with a Dynamic Host Configuration Protocol DHCP server . DHCP server can receive a request from a client e.g. client determine the network to which the DHCP client is connected and then allocate an IP address or prefix that is appropriate for the DHCP client.

For illustration purposes only assuming that mobile client is configured with an IP address of 10.16.23.10 MAC address of 00 18 DE 65 E1 2D and a default gateway of 10.16.23.254. Furthermore assuming that control device is configured with an IP address of 10.16.28.10 and supports two VLAN interfaces VLAN is configured as 10.16.23.1 24 and VLAN is configured as 10.16.24.1 24. Also assuming that VLAN is the VLAN configured on home access point and VLAN is the VLAN configured on foreign access point .

Initially mobile client associates to home access point . Upon association mobile client will be assigned an IP address e.g. 10.16.23.10 by DHCP server . VLAN e.g. 10.16.23.1 24 becomes the home VLAN for mobile client .

After mobile client roams to foreign access point control device will determine that mobile client initiates an intra controller inter VLAN move based on one or more of the DHCP transaction home agent discovery message and or mobile IP registration request and or response messages etc. Control device will next insert or change two bridge entries as shown in . Subsequent DHCP request and or response messages for mobile client will be transmitted over the appropriate VLAN.

Traffic that needs to be bridged after mobile client initiates the intra controller roaming typically includes but is not limited to Address Resolution Protocol ARP messages unicast data packets Dynamic Host Configuration Protocol DHCP messages multicast Internet Group Management Protocol IGMP messages multicast data packets etc. The handling of each type of traffic flows is described in details below.

ARP request from the roamed mobile client e.g. on VLAN will succeed a source MAC address bridge lookup. The assigned VLAN in the bridge entry e.g. VLAN will overwrite the incoming VLAN in the ARP request e.g. VLAN . Therefore the ARP request will be transmitted out on VLAN and its corresponding port based on the results of destination MAC address lookup.

Peer mobile clients in home VLAN of the client e.g. the default gateway in VLAN which attempts to resolve the roamed mobile client s MAC address and sends out an ARP broadcast request message will be transmitted by the controller via an ARP proxy with the actual roamed client s MAC address.

Note that proxy Address Resolution Protocol proxy ARP is a technique by which a device on a given network answers the ARP queries for a network address that is not on that network. The ARP Proxy is aware of the location of the traffic s destination and offers its own MAC address in reply. The captured traffic typically is routed by the ARP proxy to the intended destination via another interface or via a tunnel.

Unicast packets from the roamed mobile client on foreign VLAN e.g. VLAN will either have the gateway MAC address or the peer client MAC address as the destination MAC address. The source MAC address bridge lookup will overwrite the VLAN information in the packet e.g. VLAN with the assigned VLAN e.g. VLAN in the bridge entry.

Unicast packets from the home VLAN e.g. VLAN destined to the client s MAC address will succeed destination address bridge lookup and therefore be transmitted over tunnel to the roamed mobile client. Broadcast packets in the home VLAN of the mobile client e.g. VLAN will not reach the roamed mobile client because tunnel is not a part of the home VLAN e.g. VLAN multicast group.

Broadcast DHCP packets destined to the roamed mobile client will be converted to unicast before performing a destination address bridge lookup at the control device. Alternatively DHCP packets can be transmitted to mobile IP process by datapath and forwarded on the right VLAN when network layer L3 mobility is enabled.

After the mobile client roams mobile IP will notify PIM process at control device so that it can locate the mobile client and update destination to new egress e.g. tunnel instead of tunnel . Client IGMP control messages e.g. IGMP report message IGMP leave message etc. from the mobile client in the foreign VLAN will succeed a source MAC address bridge lookup. Therefore the assigned VLAN e.g. VLAN will overwrite the VLAN information carried in the packet e.g. VLAN . Subsequently the PIM process at the control device will receive the client IGMP messages on the home VLAN e.g. VLAN and perform a proxy join and or a proxy leave action accordingly.

Downstream multicast traffic for the roamed client will reach the client as PIM would have registered AP2 WIFI tunnel as part of VLAN multicast group. Upstream multicast traffic from the roamed client will follow the unicast model where in the packet VLAN will be overwritten by the assigned VLAN in bridge entry.

During operations the disclosed network device serving as the home agent for a mobile client first detects that the mobile client has roamed away from a first network to a second network operation . Also the network device maintains a mapping between a VLAN corresponding to the mobile client and a tunnel corresponding to a foreign agent in the second network operation . In some embodiments the network device receives from the foreign agent a home agent discovery request including the MAC address of the mobile client. In response to the home agent discovery request the network device modifies the bridge table to include the mapping between the VLAN corresponding to the mobile client and the tunnel corresponding to a foreign agent in the second network.

Then the network device establishes a physical layer secure tunnel e.g. a layer 2 GRE tunnel between the home agent and the foreign agent for transmitting packets to or from the mobile client operation . Furthermore the network device decapsulates packets received from the physical layer secure tunnel operation and assigns a dedicated VLAN to packets transmitted via the physical layer secure tunnel operation . Note that in some embodiments traffic to and from different mobile clients associated with the same foreign agent may be transmitted via the same physical layer secure tunnel. In order to assign the dedicated VLAN the network device identifies the VLAN which was assigned to the mobile client at the home agent prior to the mobile client roamed away from the home agent based on the mapping between the VLAN and the tunnel via which the packets are received. The mapping may be stored in a bridge table at the home agent. The network device then overwrites the VLAN identifier value in the packet received via the physical layer secure tunnel with a VLAN identifier value corresponding to the identified VLAN.

Subsequently the network device forwards the packets to or from the mobile client on the VLAN based on the mapping between the VLAN and the tunnel via which the packets are received.

Network device includes at least a network interface capable of communicating to a wired or wireless network a processor capable of processing computing instructions a memory capable of storing instructions and data and optionally one or more radio antennas capable of either transmitting or receiving radio signals or both. Moreover network device further includes a receiving mechanism a transmitting mechanism and a controlling mechanism all of which are coupled to processor and memory in network device . Network device may be used as a client system or a server system or may serve as node in a distributed or a cloud computing environment.

Radio antenna may be any combination of known or conventional electrical components for receipt of signaling including but not limited to transistors capacitors resistors multiplexers wiring registers diodes or any other electrical components known or later become known.

Network interface can be any communication interface which includes but is not limited to a modem token ring interface Ethernet interface wireless IEEE 802.11 interface e.g. IEEE 802.11n IEEE 802.11ac etc cellular wireless interface satellite transmission interface or any other interface for coupling network devices. In some embodiments network interface may be software defined and programmable for example via an Application Programming Interface API and thus allowing for remote control of the network device .

Processor can include one or more microprocessors and or network processors. Memory can include storage components such as Dynamic Random Access Memory DRAM Static Random Access Memory SRAM etc.

Receiving mechanism generally receives one or more network messages via network interface from a distribution system or radio antenna from a wireless client over a wireless communication channel. The received network messages may include but are not limited to requests and or responses beacon frames management frames control path frames and so on. Each message may comprise one or more data packets for example in the form of IP packets. In some embodiments receiving mechanism receives from the foreign agent a home agent discovery request including the Media Access Control MAC address of the mobile client.

Transmitting mechanism generally transmits messages which include but are not limited to requests and or responses beacon frames management frames control path frames and so on.

Controlling mechanism generally generates statistical information of packet transmission data. Specifically controlling mechanism detects that the mobile client has roamed away from a first network to a second network maintains a mapping between a virtual local area network VLAN corresponding to the mobile client and a tunnel corresponding to a foreign agent in the second network and forwards packets to or from the mobile client on the VLAN based on the mapping between the VLAN and the tunnel via which the packets are received.

In some embodiments controlling mechanism establishes a physical layer secure tunnel between the home agent and the foreign agent for transmitting the packets to or from the mobile client. Note that the packets to or from the mobile client transmitted over the physical layer secure tunnel do not identify the VLAN assigned to the mobile client when the mobile client was associated with the home agent.

In some embodiments controlling mechanism decapsulates packets received from the physical layer secure tunnel and assigns a dedicated VLAN to packets transmitted via the physical layer secure tunnel. Moreover controlling mechanism may assign the dedicated VLAN by identifying the VLAN assigned to the mobile client at the home agent based on the mapping between the VLAN and the tunnel via which the packets are received and overwriting VLAN identifier values in the packets with a VLAN identifier value corresponding to the identified VLAN. In one embodiment the mapping between the VLAN and the tunnel is maintained in a bridge table at the home agent. The bridge table includes at least a Media Access Control MAC address corresponding to the mobile client a VLAN identifier and a tunnel identifier.

In some embodiments in response to receiving mechanism receiving the home agent discovery request controlling mechanism modifies the bridge table to include the mapping between the virtual local area network VLAN corresponding to the mobile client and the tunnel corresponding to a foreign agent in the second network.

Therefore receiving mechanism transmitting mechanism and controlling mechanism often collectively operate with each other to provide for home VLAN identification for roaming mobile clients. Moreover in some embodiments the home agent and the foreign agent are managed by the same control device. In other embodiments the home agent is managed by a first control device in a mobility domain and the foreign agent is managed by a second control device in the same mobility domain. The home agent and the foreign agent may be managed by the same master control device or different master control devices. When the home agent and the foreign agent are managed by different master control devices they may be configured with different VLAN policies. It is important to note that with the solution provided herein the home agent and the foreign agent do not need to change resolve or merge their VLAN policy configurations.

According to embodiments of the present disclosure network services provided by network device solely or in combination with other wireless network devices include but are not limited to an Institute of Electrical and Electronics Engineers IEEE 802.1x authentication to an internal and or external Remote Authentication Dial In User Service RADIUS server an MAC authentication to an internal and or external RADIUS server a built in Dynamic Host Configuration Protocol DHCP service to assign wireless client devices IP addresses an internal secured management interface Layer 3 forwarding Network Address Translation NAT service between the wireless network and a wired network coupled to the network device an internal and or external captive portal an external management system for managing the network devices in the wireless network etc.

The present disclosure may be realized in hardware software or a combination of hardware and software. The present disclosure may be realized in a centralized fashion in one computer system or in a distributed fashion where different elements are spread across several interconnected computer systems coupled to a network. A typical combination of hardware and software may be an access point with a computer program that when being loaded and executed controls the device such that it carries out the methods described herein.

The present disclosure also may be embedded in non transitory fashion in a computer readable storage medium e.g. a programmable circuit a semiconductor memory such as a volatile memory such as random access memory RAM or non volatile memory such as read only memory power backed RAM flash memory phase change memory or the like a hard disk drive an optical disc drive or any connector for receiving a portable memory device such as a Universal Serial Bus USB flash drive which comprises all the features enabling the implementation of the methods described herein and which when loaded in a computer system is able to carry out these methods. Computer program in the present context means any expression in any language code or notation of a set of instructions intended to cause a system having an information processing capability to perform a particular function either directly or after either or both of the following a conversion to another language code or notation b reproduction in a different material form.

As used herein digital device generally includes a device that is adapted to transmit and or receive signaling and to process information within such signaling such as a station e.g. any data processing equipment such as a computer cellular phone personal digital assistant tablet devices etc. an access point data transfer devices such as network switches routers controllers etc. or the like.

As used herein access point AP generally refers to receiving points for any known or convenient wireless access technology which may later become known. Specifically the term AP is not intended to be limited to IEEE 802.11 based APs. APs generally function as an electronic device that is adapted to allow wireless devices to connect to a wired network via various communications standards.

As used herein the term interconnect or used descriptively as interconnected is generally defined as a communication pathway established over an information carrying medium. The interconnect may be a wired interconnect wherein the medium is a physical medium e.g. electrical wire optical fiber cable bus traces etc. a wireless interconnect e.g. air in combination with wireless signaling technology or a combination of these technologies.

As used herein information is generally defined as data address control management e.g. statistics or any combination thereof. For transmission information may be transmitted as a message namely a collection of bits in a predetermined format. One type of message namely a wireless message includes a header and payload data having a predetermined number of bits of information. The wireless message may be placed in a format as one or more packets frames or cells.

As used herein wireless local area network WLAN generally refers to a communications network links two or more devices using some wireless distribution method for example spread spectrum or orthogonal frequency division multiplexing radio and usually providing a connection through an access point to the Internet and thus providing users with the mobility to move around within a local coverage area and still stay connected to the network.

As used herein the term mechanism generally refers to a component of a system or device to serve one or more functions including but not limited to software components electronic components electrical components mechanical components electro mechanical components etc.

As used herein the term embodiment generally refers an embodiment that serves to illustrate by way of example but not limitation.

It will be appreciated to those skilled in the art that the preceding examples and embodiments are exemplary and not limiting to the scope of the present disclosure. It is intended that all permutations enhancements equivalents and improvements thereto that are apparent to those skilled in the art upon a reading of the specification and a study of the drawings are included within the true spirit and scope of the present disclosure. It is therefore intended that the following appended claims include all such modifications permutations and equivalents as fall within the true spirit and scope of the present disclosure.

While the present disclosure has been described in terms of various embodiments the present disclosure should not be limited to only those embodiments described but can be practiced with modification and alteration within the spirit and scope of the appended claims. Likewise where a reference to a standard is made in the present disclosure the reference is generally made to the current version of the standard as applicable to the disclosed technology area. However the described embodiments may be practiced under subsequent development of the standard within the spirit and scope of the description and appended claims. The description is thus to be regarded as illustrative rather than limiting.

