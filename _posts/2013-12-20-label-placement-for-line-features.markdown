---

title: Label placement for line features
abstract: A computing device can identify, for a placement of a label, a first and second character of the label that have a shortest distance from one another. The placement for the label can define a position at which the label is to be placed in an interactive geographic map and a formatting for that label. The computing device can determine that the first and second identified characters do not overlap. In response to determining that the first and second characters do not overlap, the computing device can select the placement of the label for display in the interactive geographic map.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09483496&OS=09483496&RS=09483496
owner: Amazon Technologies, Inc.
number: 09483496
owner_city: Seattle
owner_country: US
publication_date: 20131220
---
Interactive geographic maps e.g. maps provided by a web map service can provide a visual representation of a geographic region. An interactive geographic map for a particular geographic region can also describe various features that appear in the particular geographic region. For example an interactive geographic map can describe line features e.g. roads and rivers area features e.g. countries parcels forests and lakes and point features e.g. villages and cities. Each feature in an interactive geographic map can be labeled e.g. annotated by positioning near the feature and in the interactive geographic map one or more labels e.g. map labels that describe the feature. For example an interactive geographic map that includes a point feature referencing the city of San Francisco can be labeled by placing a label San Francisco near the point feature.

Computerized methods can be used to automatically position respective labels near features in an interactive geographic map. Such computerized methods can be configured to label features in an interactive geographic map based on predefined rules e.g. repeat labels for roads or place labels for point features in a position that is located northwest direction of the point features. These computerized methods can also apply various algorithms e.g. simulated annealing genetic algorithms etc. to optimize the placement of labels for features in an interactive geographic map. For example various algorithms can be applied to position labels in an interactive geographic map in a manner that avoids overlap with other labels.

Computerized labeling of curved line features e.g. curved road labels can create special challenges. For example positioning a label for a curved line feature is generally done by positioning the characters in the label along a boundary of the curved line feature. In such instances characters positioned incorrectly can overlap and as a result make the label difficult to read in a geographic map. It is difficult to predetermine character overlap for a curved line feature label since most interactive mapping applications allow for maps to be viewed at different zoom levels. That is characters may need to be repositioned as a user zooms in and out of an interactive geographic map and can therefore make it difficult to predetermine whether characters in a label will overlap.

Systems and methods in accordance with various embodiments of the present disclosure overcome one or more of the above referenced and other deficiencies in conventional approaches to placing labels in an interactive geographic map. In particular various embodiments of the present disclosure can provide a method for determining an overlap between characters in a label placement in an interactive geographic map.

In various embodiments before selecting labels for display in an interactive geographic map the labels can be evaluated to determine whether characters in a label overlap with one another. As a result a label placement that has overlapping characters and thus can be difficult for a user to read is not selected for display in an interactive geographic map. Instead upon making this determination a system can select a different placement for that label.

Various methods can be used to determine whether characters in a placement of a label overlap. In some embodiments an overlap exists when respective bounding boxes for characters in a label collide. In some instances using bounding boxes to determine overlap does not take into account an orientation of the characters. Thus in some embodiments an overlap is determined by determining a distance between two characters e.g. as determined using respective center coordinates for the two characters and comparing that distance to a sum of respective radii for the two characters. As described below a radius for a character can be determined using a width and a height of the character. In some embodiments overlap detection between characters in a label placement can be performed both on a map server and on a client device that receives map data from the map server as described below.

Other advantages variations and functions are described and suggested below as may be provided in accordance with the various embodiments.

In the feature is a curved road. There may be a number of candidate placements for a label that describes the feature . For example a label for the feature may be placed in one of several different positions that conform to a curvature of the road. Further the label can be formatted differently e.g. curved depending on the position in which it is placed. For example characters in a label can be formatted to fit a particular curve or arch. This placement of a label can affect how that label will appear in an interactive geographic map. For example in the interactive geographic map displays a label e.g. Shore Dr for the feature that is positioned in one possible placement. The label is shown as being curved along a boundary of the feature . Similarly another label for the feature is placed along another boundary of the feature .

When automatically placing labels computerized methods may need to quickly determine for each feature which of the different possible placements of a label for that feature are the best placements. One of the considerations for placing a label for a line feature e.g. a road or a river is determining whether that placement would result in an overlap between characters that are in the label. For example in some instances the placement of a label along a curved segment of a road can result in an overlap between one or more characters in the label as illustrated by the label e.g. 1st St . Such overlapping can sometimes render a label unreadable in a geographic map. Thus in some embodiments before placing a label in an interactive geographic map one or more techniques as described below are used to determine an overlap between characters in the label. In such embodiments a label placement that would result in overlapping characters is no longer considered as a candidate placement.

Each frame of an interactive geographic map can describe a particular geographic region using for example a collection of map tiles. Further each map tile in the collection describes a portion of the particular geographic region at some zoom level. In general the zoom level defines a level of magnification at which a geographic map is displayed in a map viewport for example. A user can interact with the map viewport to adjust the level of magnification within some specified range e.g. between a zoom level of 1 to 20 inclusive. A zoom level of 1 e.g. a minimum zoom level can display a frame of an interactive geographic map that is generated using a first collection of map tiles that describe a fully zoomed out map. In contrast a zoom level of 20 e.g. a maximum zoom level can display a frame an interactive geographic map that is generated using a second collection of map tiles that describe a higher resolution of the map.

As a zoom level is adjusted e.g. increased or decreased different labels may be selected for placement in the interactive geographic map. For example an interactive geographic map at a minimum zoom level may describe a map of the United States that includes a label for United States and some other labels for each of the states. However as the zoom level is increased the interactive geographic map can be updated to display a more detailed geographic region e.g. the state of Kansas and can place labels that describe that particular geographic region e.g. cities within the state of Kansas. Additionally as the zoom level is adjusted different placements may be determined for labels that were already displayed in the interactive geographic map. For example a label Seine River may be placed along a particular boundary of a feature in an interactive geographic map and formatted e.g. curved to be displayed along the particular boundary of a feature. When the zoom level is increased a new placement for the label Seine River can be determined that changes the position at which the label is placed in the interactive geographic map and also changes the formatting e.g. curving of the label to be displayed along a different boundary of the feature. The example above describes adjusting the orientation of an interactive geographic map by adjusting the zoom level. Changing the zoom level is one example of how a user can change an orientation of the interactive geographic map. However the orientation of the interactive geographic map can be manipulated in other ways including for example rotating or tilting the map. As described above different labels may be selected for placement in the interactive geographic map in response to such manipulation of the interactive geographic map.

In some embodiments an overlap between characters in a label is determined by evaluating a placement of the label in an interactive geographic map at a particular zoom level. A label may appear in a frame of an interactive geographic map at different zoom levels. For example a label for the city of San Francisco may appear in map tiles that correspond to zoom levels 3 to 8 inclusive. In some embodiments an overlap between characters in a label is determined by evaluating the placement of the label at a minimum zoom level at which the label would appear in an interactive geographic map. For example if a label San Francisco appears in an interactive geographic map at zoom levels 3 to 8 inclusive then an overlap between the characters in the label San Francisco can be determined by evaluating the placement of the characters in the label San Francisco at zoom level 3 which in this example is the minimum zoom level at which the label would appear in the interactive geographic map.

In some embodiments a respective bounding box can be drawn around each of the characters and to determine an overlap between two characters as illustrated in . An overlap between two bounding boxes can be determined using generally known collision detection techniques or using an Application Programming Interface API e.g. the JTS Topology Suite. The size of each bounding box for a character can be rectangular in shape and can have dimensions that are based on the size of the character. That is the dimensions of a bounding box for a character can be determined based on a respective height and width of the character at a minimum zoom level at which the character would appear in an interactive geographic map. In some embodiments the size of the bounding box is reduced by a percentage e.g. 10 25 or 50 percent. An overlap between two characters exists when there is an overlap between respective bounding boxes for those two characters. As illustrated in an overlap exists between the respective bounding boxes for the characters and . Once an overlap is determined a different placement for the label can be selected and evaluated using the techniques described in this specification. Various automatic placement techniques can be used to determine a different placement for a label including for example rule based algorithms greedy algorithms simulated annealing evolutionary algorithms or a combination thereof.

In some embodiments an overlap between characters in a label can be any overlap between two or more characters in that label between two or more respective bounding boxes for characters in that label or between two or more respective radii for characters in that label as described in .

As described in reference to each frame of an interactive geographic map can describe a particular geographic region using for example a collection of map tiles. Further each map tile in the collection describes a portion of the particular geographic region at some zoom level. In some embodiments an overlap between characters in a label is determined by evaluating the placement of the label at a minimum zoom level at which the label would appear in an interactive geographic map as described above in reference to .

For purposes of discussion illustrates how an overlap is detected between two characters e.g. the characters and in the label . However in general this method can be applied to each character of a label. That is respective overlaps can be determined based on a pairwise comparison between each character of the label and every other character of the label.

In some embodiments to determine an overlap between the character and a respective radius is determined for each of the characters and . A radius for a character can be determined based on a width and a height of the character as that character appears in an interactive geographic map. That is the size of the character and the font in which it will be displayed can be evaluated to determine the character s height and width. The radius for the character can be determined from the height and width using for example the Pythagorean Theorem. An example formula for determining the radius is reproduced below 0.5 0.5 

A distance between respective center coordinates for each of the characters and is also determined. For example a center coordinate for a character can be determined based on the width and height of the character and describes a geometric center of the character in two dimensional space. The center coordinate for the character can be predetermined by a system e.g. the map search system and can be described using x and y pixel coordinates. For example a display screen can be treated as a two dimensional coordinate system with an x axis and a y axis. Positions within this coordinate system can be identified using a point along the x axis i.e. x pixel coordinate and a point along the y axis i.e. y pixel coordinate. Once the center coordinates for the characters and have been determined the distance between the center coordinates can be determined using the distance formula. An example formula for determining the distance between two center coordinates is reproduced below square root over 

where d is the distance xand yare the x and y coordinates for the first center point and where xand yare the x and y coordinates for the second center point.

To determine an overlap between the characters and the respective radii of the characters and are added together and compared with the distance between the respective center coordinates for the characters and . If the sum of the respective radii of the characters and is less than the distance then there is no overlap between the characters and . If the sum of the respective radii of the characters and is greater than the distance then there is overlap between the characters and . If the sum of the respective radii of the characters and equals the distance then the characters and are touching. Depending on the implementation a threshold percentage of overlap is permitted between the respective radii of the characters and . As illustrated in an overlap exists between the respective radii of the characters and . Once an overlap is determined a different placement for the label can be selected and evaluated using the techniques described in this specification.

A label placement that satisfies the techniques described in can be provided to a client device e.g. the client device as described in reference to . The client device can render an interactive geographic map using the label placement as described below.

Given the nature of interactive geographic maps there may be instances in which further evaluation is needed for label placements that were selected by a map search system e.g. the system . For example the map search system may have selected particular label placements because such placements did not have overlapping characters at a particular zoom level. However the same label placements that were selected by the map search system may have overlapping characters at a different zoom level. Thus in some embodiments when a user adjusts the zoom level for an interactive geographic map the label placements are reevaluated e.g. by the client device displaying the interactive geographic map to determine whether characters in the label placements overlap.

The client device can determine whether characters in a label placement overlap using for example the technique described in above. However determining an overlap between characters for every label placement in an interactive geographic map using a client device can cause performance issues. Thus in some embodiments before determining whether characters in a label placement overlap the client device removes from consideration e.g. filters characters in the label placement that exceed a minimum overlap threshold distance. That is the client device can iterate over each character of a label placement along the x axis and determine whether a distance between a position of a character along the x axis and a position of the character s successor character along the x axis exceeds the minimum overlap threshold distance. A position of a character along the x axis can be determined using the x value of the character s center coordinates. If the distance exceeds the minimum overlap threshold distance then that successor character is removed from further consideration in determining an overlap between the successor character and some other character of the label placement.

For example assuming a minimum overlap threshold distance of 10 units if the a position of a first character along the x axis is at position and a position of a second successor character along the x axis is at position then the distance of the second successor character from the first character is 12 units. Since 12 units exceeds the threshold distance of 10 units the second successor character can be removed from further consideration in determining an overlap between the second successor character and some other character of the label placement.

Similarly the client device can iterate over each character of a label placement along the y axis and determine whether a distance between a position of a character along the y axis and a position of the character s successor character along the y axis exceeds the minimum overlap threshold distance. A position of a character along the y axis can be determined using the y value of the character s center coordinates. If the distance exceeds the minimum overlap threshold distance then that successor character is removed from further consideration in determining an overlap between the successor character and some other character of the label placement. In some embodiments the minimum overlap threshold distance for a label placement is twice the width of the largest character of the label placement for example as determined based on the font size height and width of the characters in the label placement.

Once the filtering is complete the client device can apply a recursive divide and conquer approach on the remaining characters in the label placement to identify the two characters in the label placement that have the shortest distance from one another. After identifying the two closest characters the client device can determine whether an overlap exists between the two closest characters using for example the techniques described above. For example to determine an overlap between the two closest characters the client device can compare a sum of the respective radii of the two closest characters with the distance between the respective center coordinates for the two closest characters as described above.

If an overlap between the two closest characters exists the client device no longer displays uses that label placement and replaces it with a different label placement for that frame of the interactive geographic map. Depending on the embodiment this process is repeated for label placements in response to further user interaction e.g. zooming in or out with the interactive geographic map.

In some embodiments a curvature of a label placement is determined by a ratio of a numerator that represents a distance between a first character of the label and a last character of the label and a denominator that is the length of the label. For example in a label Shore Dr is placed along a road in an interactive geographic map. A distance between the first character e.g. S and the last character e.g. r in the label can be determined by determining a distance between the center coordinates for the first character and the center coordinates for the last character . The distance formula as described above can be used to determine the distance between the first and last characters in the label. The length of the label can be determined by measuring a width of each character of the label based on a font and font size with which the character will be rendered in an interactive geographic map. A ratio that is equal to one means that the label placement has no curvature and is considered a straight label. A ratio that is closer to zero means that the label placement is curved. In some embodiments label placements that do not satisfy a threshold curvature are no longer considered for placement in an interactive geographic map. In such embodiments label placements that satisfy the threshold curvature are further evaluated using the techniques described in .

The computing device determines that the first and second characters in the label do not overlap . For example the computing device can determine that the first and second characters do not overlap by determining that respective bounding boxes for the first and second characters do not collide. In another example the computing device can determine that the first and second characters do not overlap by determining that a sum of respective radii of the first and second characters is less than a distance between respective center coordinates for the first and second characters. The center coordinates can identify a position of a character in an interactive geographic map. In response to determining that the first and second characters in the label do not overlap the computing device selects the placement of the label for display in the interactive geographic map .

The frame is similar to the frame that was described in reference to . In some embodiments an interactive geographic map can be rotated in response to a change in the orientation of a computing device. Thus in the frame has been rotated in response to a change in the orientation of the computing device . Consequently as the interactive geographic map rotates labels that identify line features e.g. rivers roads borders between territories in the interactive geographic map are also rotated to orient the labels in a direction along their respective line features as those line features rotate about in the interactive geographic map. For example a label can be positioned at a particular location in an interactive geographic map. When the computing device rotates the label can rotate around the particular location in which it was positioned.

In such situations as the interactive geographic map is rotated it is possible for placements for labels in the interactive geographic map to become inverted e.g. upside down. This can make the interactive geographic map more difficult for a user to read.

Thus in some embodiments angles for placements of labels are tracked and aligned with respect to an orientation e.g. display screen of the computing device that is displaying the interactive geographic map. When an angle for a label that is displayed at a first orientation e.g. right way up crosses e.g. satisfies a threshold reference point the label is flipped to be displayed at a second orientation e.g. upside down. In other words the second orientation for the label can be an orientation that is rotated 180 degrees or within a threshold range from 180 degrees from the first orientation. In some embodiments the threshold reference point is defined based on a reference point e.g. 0 or radians that is offset by a constant e.g. 0.1 radians as described below.

However such rotating or changing the orientation of the computing device can result in a label flipping between a first orientation e.g. the label as described in reference to and second orientation e.g. the label as described in reference to . Such flipping of a label can be distracting to a user that is viewing the interactive geographic map.

Thus to control such flipping in some embodiments when an angle for a label that is positioned at a first orientation crosses a threshold reference point the label is flipped to its second orientation. For example in response to a rotation of the computing device the label can rotate in a counter clockwise direction at a certain angle toward a threshold reference point that is defined by a reference point of 180 degrees plus a constant of 5 degrees e.g. 185 degrees. Once the angle rotates across the threshold reference point the threshold reference point is adjusted by the same constant in the opposite e.g. clockwise direction. For example in response to a rotation of the computing device the label can rotate in a clockwise direction at a certain angle toward the adjusted threshold reference point that is defined by the reference point of 180 degrees minus the constant of 5 degrees e.g. 175 degrees.

Thus the label stays at its second orientation until in response to a rotation of the computing the angle for the label crosses the adjusted threshold reference point. Such adjusting of the threshold reference point between frames of the interactive geographic map can prevent the flipping of a label between its first and second orientations.

Since one of the goals of placing labels in the interactive geographic map is to increase readability placements of labels can be oriented with respect to the display screen of the computing device based on what direction is determined to be vertically up e.g. physically up. The orientation of the computing device may be determined using one or more accelerometers that are in the computing device . This orientation indicates a direction in which the computing device is facing. In some embodiments the orientation of the computing device is determined using one or more head tracking techniques. In such embodiments the placements of labels can be oriented with respect to a direction of the eyes or head of a user operating the computing device .

In some embodiments an angle for a label is initially determined in world space. World space represents a geographic map of the world in three dimensional space. Particular features e.g. roads can be identified in world space using their corresponding world coordinates. The angle of the label in world space can be represented using pixel coordinates to determine an angle for the label in two dimensional space. When determining the angle for the label in world space respective vectors are determined beginning from the first character in the label to each other character in the label. For example for the label Z St a first vector is determined beginning from the first character Z to the character S and a second vector is determined beginning from the first character Z to the character t . These vectors can be determined using equal weighting or width weighting depending on the implementation. The angles of the respective vectors beginning from the first character in the label to each of the other characters in the label are averaged to determine the angle for a placement for the label. In some embodiments a vector generally describes a geometric quantity that has a magnitude e.g. length and a direction that is expressed numerically for example as an ordered list of tuples e.g. x y z that describe the vector along axis components.

The angle for the placement for the label typically needs to be converted from world space to a screen coordinate system e.g. pixel coordinates so that the angle is calibrated to the display screen of the computing device . By way of example shows an angle that was determined for the label that is positioned in an up direction. In contrast shows an angle that was determined for the label that is positioned in a down direction.

In some embodiments an angle for a label in an interactive geographic map is determined in world space by a map server system e.g. by the system as described in reference to and provided with map data for a geographic region as also described in reference to . In such embodiments a computing device e.g. the device converts the angle from world space to screen coordinates e.g. pixel coordinates with respect to an orientation of the computing device.

Upon conversion to screen coordinates the angle for the label can be evaluated with respect to an orientation of the computing device . For example an angle for a label can range from 0 to 2 radians. In some embodiments 0 and radians are considered threshold reference points at which a label will flip between a first orientation and a second orientation. In some embodiments the threshold reference point for a label is defined by a reference point e.g. radians that is adjusted e.g. offset by some constant e.g. 0.1 radians in response to the label flipping from a first orientation to a second orientation.

For example for a label to flip from a first orientation to a second orientation a threshold reference point can be defined by a reference point it radians plus a constant e.g. 0.1 radians. Once the angle for the label flips to the second orientation the threshold reference point is adjusted to radians minus the constant e.g. 0.1 radians. Thus the angle for the label must rotate in the opposite direction and cross the adjusted threshold reference point to flip back to the first orientation.

In response to determining the change in the orientation of the computing device the computing device rotates a first label in an interactive geographic map displayed on a display screen of the computing device . The first label can be oriented at a first orientation in the interactive geographic map. The computing device determines that an angle for the rotated first label satisfies a threshold reference point . In response to determining that the angle for the rotated first label satisfies a threshold reference point the computing device orientates the first label at a second orientation .

When generating map tiles to send to a client device for example in response to a map search query a system e.g. the map search system determines where to place labels for line features e.g. roads that appear in the map tiles. Typically data describing the line feature e.g. the road is made up of a series of segments e.g. segments and . When generating a map tile that includes that line feature the segments and for the line feature in that map tile are joined together using generally known techniques. The system then determines placement positions for a label for the line feature in the map tile based on the length of the label e.g. the label Shore Dr and on the geometry e.g. curvature of the line feature . The system determines a number of different possible placements for that label e.g. placements and and then determines which of the possible placements are the best placements for that label as described below.

Generally when determining the number of different possible placements for a label for the line feature the system iterates over segments e.g. the segment for the line feature and identifies sub segments e.g. the sub segments and that are long enough to include the label. The number of sub segments identified can vary based on the length of the label. For example a label 1st St. requires a fewer number of sub segments than a label Martin Luther King Jr. Dr. In some embodiments to identify sub segments for a label placement the system determines a length of a label for a line feature at the zoom level at which the map tile is being generated.

The system then identifies the first segment of the line feature as a sub segment. During this identification the beginning of the first segment is identified as the start point and the end of the first segment is identified as the end point .

If the sub segment as defined by the start point and the end point is smaller than the length of the label Shore Dr then the system increments the end point to include the next segment of the line feature . This incrementing continues in a similar manner until the sub segment as defined by the start point and the end point is long enough to include the length of the label Shore Dr. Thus in this example if the label for the line feature was Martin Luther King Jr. Dr and the sub segment was defined by the start point and the end point then the system could adjust the sub segment by incrementing the end point to include the next segment so that the length of the new sub segment is long enough to include the label Martin Luther King Jr. Dr. 

However if the sub segment as defined by the start point and the end point is larger than the length of the label Shore Dr as shown in the example of then the system adjusts the start point of the sub segment along the line segment until the sub segment can no longer be reduced without becoming smaller than the length of the label Shore Dr. Once a sub segment that fits the label Shore Dr has been identified the system generates a score for the sub segment.

The sub segment score is used to identify the best placements for a label along the line feature . In some embodiments the sub segment score is based on a curvature of a label placement within the sub segment and the distance of the sub segment from the center of the line feature .

The curvature of the label placement can be determined using the method described above in reference to . In some embodiments the distance of the sub segment from the center of the line feature is determined by subtracting a center point of the sub segment from the center point of the line feature . To generate the sub segment score a first value can be determined by dividing the distance of the sub segment from the center of the line feature by a fraction e.g. one third one fourth or one half of the total length of the line feature . The first value can be adjusted e.g. multiplied by a weight. Next the curvature of the label placement can also be adjusted e.g. multiplied by a different weight. The adjusted first value and the adjusted curvature of the label placement can be added together to generate the sub segment score. Other ways of adjusting the sub segment score are possible. For example label placements that are close to road intersections can be weighted lower than those that are further away. Label placements that are more horizontal can be weighted higher than those that are more vertical. Label placements that are closer to major roads can be weighted higher than those that are not.

Additional sub segments can be identified along the line feature as described above. For example alter identifying the sub segment above the system can traverse along the line feature to the next line segment to determine the next sub segment that can fit another placement of the label Shore Dr and determine that sub segment s respective score. In instances where no sub segments in the line feature that can fit the label Shore Dr but the line feature itself is long enough to fit the label Shore Dr the system identifies the line feature as the sub segment in which the label Shore Dr can be placed.

The best sub segments for placement of the label Shore Dr along with their respective scores can be identified after determining all of the potential sub segments for the line feature . In some embodiments when determining the best sub segments from the potential sub segments for the line feature the system can first select from the list of potential sub segments the sub segment having the lowest score and add that sub segment to a list of kept sub segments.

The system can select from the list of potential sub segments the sub segment having the next lowest score and can evaluate the selected sub segment with sub segments in the list of kept sub segments. When evaluating the selected sub segment the system can determine whether the selected sub segment overlaps with other sub segments in the list of kept sub segments. If an overlap exists the selected sub segment is discarded and no longer considered as a potential sub segment. If no overlap exists the selected sub segment is added to the list of kept sub segments. This process continues for each sub segment in the list of potential sub segments.

Once the list of kept sub segments has been generated the system evaluates each sub segment in the list of kept sub segments by placing the label Shore Dr on the sub segment. If the length of the sub segment is greater than or equal to twice the length of the label Shore Dr the system splits the sub segment into as many possible smaller sub segments that can fit within the sub segment and can each fit the label Shore Dr. If the length of the sub segment is not greater than or equal to twice the length of the label then no splitting of the sub segment is performed.

Additional operations then performed on each sub segment in the list of kept sub segments including the sub segments that resulted from splitting a sub segment as described above to ensure that the sub segment will be legible. Generally a label is illegible if the line feature is so curvy that characters of the label will be drawn on top of each other. To identify the best sub segments on each sub segment in the list of kept sub segments including the sub segments that resulted from splitting a sub segment is evaluated to determine if placing the label Shore Dr in that sub segment would result in characters of the label overlapping. Character overlap can be determined using the methods described above in reference to .

If no character overlap for the sub segment is determined then the sub segment is used for placing the label Shore Dr along the line feature . The position and respective score for the sub segment is stored and can be provided to a client device when providing data describing a map tile in which the line feature appears. The score can be used by the client device for example to place labels when generating an interactive geographic map. For example when selecting a single label the client device can pick the best label based on the respective scores of the label placements that is not obscured by other labels and is closest to the center of the screen.

In some embodiments the process described above can be performed by dividing the line feature into fixed sub segments and by placing labels at a fixed spacing in those sub segments. Label placements that are illegible as determined using the methods above are discarded and do not appear in the line feature.

The example environment includes a map search system and a data plane . The map search system includes at least one web server and at least one map server as described below. The map search system is an example of an interactive geographic map retrieval system implemented as computer programs on one or more computers in one or more locations in which the systems components and techniques described below can be implemented.

A user can interact with the map search system through a client device . For example the client device can be a computer coupled to the map search system through a data communication network e.g. the Internet. In some instances the map search system can be implemented on the client device for example through a software application executing on the client device . The client device generally includes a memory e.g. a random access memory RAM for storing instructions and data and a processor for executing stored instructions. The client device can be any appropriate device operable to send and receive requests messages or other types of information over the network . The client device can also include a display screen though which a user interacting with the client device can view information e.g. interactive geographic maps. Some examples of client devices include personal computers cellular phones handheld messaging devices laptop computers set top boxes personal data assistants electronic book readers tablet devices and the like.

The network can include any appropriate network including an intranet the Internet a cellular network a local area network a wide area network or any other such network or combination thereof. Components used for such a system can depend at least in part upon the type of network the environment selected or both. Protocols and components for communicating over such a network are well known and will not be discussed herein in detail. The client device can communicate over the network using wired or wireless connections and combinations thereof.

A user can use the client device to submit a map search query to the map search system . The map search query can request an interactive geographic map for a particular geographic region that is identified by a geographic address e.g. a street address city state zip code geographic coordinates or a name of a point of interest. When the user submits the map search query the query may be transmitted through the network to a map server within the map search system . The map server responds to the query by using for example the geographic map data to identify map data describing a geographic region that satisfies the query . The map server sends the map data through the network to the client device for presentation to the user.

The map data can include data describing a map of the particular geographic region. The map data can be used for example by a client device to generate an interactive geographic map that provides a visual e.g. two dimensional or three dimensional representation of the particular geographic region.

The map data can describe the map of the particular geographic region using for example a collection of map tiles at a specified zoom level. For example in response to a map search query for the city of San Francisco the map server can identify a collection of map tiles that collectively describe a map of the city of San Francisco at a specified zoom level. Each map tile in the collection visually describes a portion of the map of San Francisco at the specified zoom level. Different types of maps of a geographic region may be provided depending on the user s selection including for example road maps satellite maps a hybrid maps e.g. a combination of normal and satellite views or physical maps based on terrain information.

Further the map data can also include a collection of labels e.g. text labels icons or both for the requested geographic region. Each label can describe a feature that is located in the requested geographic region. Some examples of features include line features e.g. roads and rivers area features e.g. countries parcels forests and lakes and point features e.g. cities and points of interest. The map data can also include for each label respective coordinates that specify a location at which the label is to be positioned in an interactive geographic map. Coordinates for labels can be specified by a user e.g. a cartographer or may be generated by the map server . For example a label San Francisco can be assigned coordinates so that the label is positioned in a centrally located map tile in a collection of map tiles for the city of San Francisco.

In some embodiments the map server generates respective popularity scores for labels that correspond to a particular geographic region. A label s popularity score generally indicates the popularity of the label for a particular geographic region. Label popularity scores can be used for example to prioritize the selection of labels to be displayed in an interactive geographic map. Generally the higher the popularity score the more relevant a label is to a particular geographic region. For example businesses ABC Inc. B2B Corp. and B2C P.C. can all be located in the same building in a particular geographic region. Each business can have a respective label that describes the business and a respective popularity score associated with the label. For example labels for the businesses ABC Inc. B2B Corp. and B2C P.C. can be respectively scored 0.7 0.4 and 0.8. When generating an interactive geographic map for the particular geographic region the client device can evaluate the respective scores associated with the labels to select labels for display in the interactive geographic map. In the example above the client device selects the label B2C P.C. for display at the building s location in the interactive geographic map since that label has the highest popularity score.

After receiving the map data from the map server and through the network a software application e.g. web browser or a map application running on the client device renders an interactive geographic map for the requested geographic region using the map data . For example a mapping engine in the map application can position map tiles in a collection of map tiles describing the requested geographic region for display on a display screen of the client device . Additionally the mapping engine can evaluate the map data to select labels to be displayed in the interactive geographic map. As described above the mapping engine can select labels for display based on the respective popularity scores for the labels.

In some embodiments the web server map server and similar components can be considered to be part of the data plane . The handling of all requests and responses as well as the delivery of content between the client device and the map server can be handled by the web server . The web server and map server are merely example components. However more or fewer components can be used as structured code can be executed on any appropriate device or host machine as discussed elsewhere herein.

The data plane includes one or more resources servers hosts instances routers switches data stores other similar components or a combination thereof. The resources of the data plane are not limited to storing and providing access to data. Indeed there may be several map servers layers or other elements processes or components which may be chained or otherwise configured and which can interact to perform tasks including for example obtaining data from an appropriate data store. In some embodiments the term data store refers to any device or combination of devices capable of storing accessing and retrieving data which may include any combination and number of data servers databases data storage devices and data storage media in any standard distributed or clustered environment.

The data stores of the data plane can include several separate data tables databases or other data storage mechanisms and media for storing data relating to a particular aspect. For example the data plane illustrated includes mechanisms for storing geographic map data and user information which can be used to serve content. The data plane is also shown to include a mechanism for storing log data which can be used for purposes such as reporting and analysis. The data plane is operable through logic associated therewith to receive instructions from the map server and to obtain update or otherwise process data instructions or other such information in response thereto as described above.

Each server typically includes an operating system that provides executable program instructions for the general administration and operation of that server and typically will include a computer readable medium storing instructions that when executed by a processor of the server enable the server to perform its intended functions. Suitable implementations for the operating system and general functionality of the servers are known or commercially available and are readily implemented by persons having ordinary skill in the art particularly in light of the disclosure herein.

The environment in one embodiment is a distributed computing environment including several computer systems and components that are interconnected through one or more communication links using one or more computer networks or direct connections. However the system described above can be configured to operate equally well using fewer or a greater number of components than are illustrated in . Thus the system in is provided merely as one example and does not limit the scope of the disclosure.

In some embodiments the computing device of can include one or more communication elements not shown such as a Wi Fi Bluetooth RF wired or wireless communication system. The device in many embodiments can communicate with a network such as the Internet and may be able to communicate with other such devices. In some embodiments the device can include at least one additional input device able to receive conventional input from a user. This conventional input can include for example a push button touch pad touch screen wheel joystick keyboard mouse keypad or any other such device or element whereby a user can input a command to the device. In some embodiments however such a device might not include any buttons at all and might be controlled only through a combination of visual and audio commands such that a user can control the device without having to be in contact with the device.

The device also can include at least one orientation or motion sensor . As discussed such a sensor can include an accelerometer or gyroscope operable to detect an orientation and or change in orientation or an electronic or digital compass which can indicate a direction in which the device is determined to be facing. The mechanism s also or alternatively can include or comprise a global positioning system GPS or similar positioning element operable to determine relative coordinates for a position of the computing device as well as information about relatively large movements of the device. The device can include other elements as well such as may enable location determinations through triangulation or another such approach. These mechanisms can communicate with the processor whereby the device can perform any of a number of actions described or suggested herein.

As an example a computing device can capture and or track various information for a user over time. This information can include any appropriate information such as location actions e.g. sending a message or creating a document user behavior e.g. how often a user performs a task the amount of time a user spends on a task the ways in which a user navigates through an interface etc. user preferences e.g. how a user likes to receive information open applications submitted requests received calls and the like. As discussed above the information can be stored in such a way that the information is linked or otherwise associated whereby a user can access the information using any appropriate dimension or group of dimensions.

The various embodiments can be implemented in a wide variety of operating environments which in some cases can include one or more user computers computing devices or processing devices which can be used to operate any of a number of applications. User or client devices can include any of a number of general purpose personal computers such as desktop or laptop computers running a standard operating system as well as cellular wireless and handheld devices running mobile software and capable of supporting a number of networking and messaging protocols. Such a system also can include a number of workstations running any of a variety of commercially available operating systems and other known applications for purposes such as development and database management. These devices also can include other electronic devices such as dummy terminals thin clients gaming systems and other devices capable of communicating via a network.

Various aspects also can be implemented as part of at least one service or Web service such as may be part of a service oriented architecture. Services such as Web services can communicate using any appropriate type of messaging such as by using messages in extensible markup language XML format and exchanged using an appropriate protocol such as SOAP derived from the Simple Object Access Protocol . Processes provided or executed by such services can be written in any appropriate language such as the Web Services Description Language WSDL . Using a language such as WSDL allows for functionality such as the automated generation of client side code in various SOAP frameworks.

Most embodiments utilize at least one network that would be familiar to those skilled in the art for supporting communications using any of a variety of commercially available protocols such as TCP IP OSI FTP UPnP NFS CIFS and AppleTalk. The network can be for example a local area network a wide area network a virtual private network the Internet an intranet an extranet a public switched telephone network an infrared network a wireless network and any combination thereof.

In embodiments utilizing a Web server the Web server can run any of a variety of server or mid tier applications including HTTP servers FTP servers CGI servers data servers Java servers and business map servers. The server s also may be capable of executing programs or scripts in response requests from user devices such as by executing one or more Web applications that may be implemented as one or more scripts or programs written in any programming language such as Java C C or C or any scripting language such as Perl Python or TCL as well as combinations thereof. The server s may also include database servers including without limitation those commercially available from Oracle Microsoft Sybase and IBM .

The environment can include a variety of data stores and other memory and storage media as discussed above. These can reside in a variety of locations such as on a storage medium local to and or resident in one or more of the computers or remote from any or all of the computers across the network. In a particular set of embodiments the information may reside in a storage area network SAN familiar to those skilled in the art. Similarly any necessary files for performing the functions attributed to the computers servers or other network devices may be stored locally and or remotely as appropriate. Where a system includes computerized devices each such device can include hardware elements that may be electrically coupled via a bus the elements including for example at least one central processing unit CPU at least one input device e.g. a mouse keyboard controller touch screen or keypad and at least one output device e.g. a display device printer or speaker . Such a system may also include one or more storage devices such as disk drives optical storage devices and solid state storage devices such as random access memory RAM or read only memory ROM as well as removable media devices memory cards flash cards etc.

Such devices also can include a computer readable storage media reader a communications device e.g. a modem a network card wireless or wired an infrared communication device etc. and working memory as described above. The computer readable storage media reader can be connected with or configured to receive a computer readable storage medium representing remote local fixed and or removable storage devices as well as storage media for temporarily and or more permanently containing storing transmitting and retrieving computer readable information. The system and various devices also typically will include a number of software applications modules services or other elements located within at least one working memory device including an operating system and application programs such as a client application or Web browser. It should be appreciated that alternate embodiments may have numerous variations from that described above. For example customized hardware might also be used and or particular elements might be implemented in hardware software including portable software such as applets or both. Further connection to other computing devices such as network input output devices may be employed.

Storage media and computer readable media for containing code or portions of code can include any appropriate media known or used in the art including storage media and communication media such as but not limited to volatile and non volatile removable and non removable media implemented in any method or technology for storage and or transmission of information such as computer readable instructions data structures program modules or other data including RAM ROM EEPROM flash memory or other memory technology CD ROM digital versatile disk DVD or other optical storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can be accessed by the a system device. Based on the disclosure and teachings provided herein a person of ordinary skill in the art will appreciate other ways and or methods to implement the various embodiments.

The specification and drawings are accordingly to be regarded in an illustrative rather than a restrictive sense. It will however be evident that various modifications and changes may be made thereunto without departing from the broader spirit and scope of the invention as set forth in the claims.

