---

title: Synchronizer circuits with failure-condition detection and correction
abstract: An input signal and a reset signal are provided to respective inputs of a resettable flip-flop. The resettable flip-flop generates an output signal. The output signal transitions from a first logic state to a second logic state in response to corresponding transitions of the input signal and transitions from the second logic state to the first logic state in response to assertion of the reset signal. A warning signal is asserted in response to transitions of the input signal from the second logic state to the first logic state. A logic gate forwards the output signal when the warning signal is de-asserted and provides a signal in the first logic state in response to assertion of the warning signal.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08847647&OS=08847647&RS=08847647
owner: Advanced Micro Devices, Inc.
number: 08847647
owner_city: Sunnyvale
owner_country: US
publication_date: 20130911
---
This invention was made with Government support under Prime Contract Number DE AC52 07NA27344 Subcontract Number B600716 awarded by DOE. The Government has certain rights in this invention.

The present embodiments relate generally to synchronizer circuits and more specifically to mitigation of metastability in synchronizer circuits.

Synchronizer circuits are used to transition data between different clock domains in an electronic device. For example a Multiple Clock Domain MCD device may use synchronizer circuits to transition data between respective clock domains. An example of an MCD device is a Globally Asynchronous Locally Synchronous GALS System on a Chip SoC in which different parts of the chip operate at different frequencies yet communicate with each other. Another example is a processor in which high clock rate processor cores communicate with slower cores and or even slower memory. Still other examples are possible.

Synchronizer circuits suffer from metastability. When a clock of a receiving clock domain rises while data in a data line between a transmitting clock domain and a synchronizer circuit in the receiving clock domain is transitioning a metastable state may potentially be generated. The metastable state causes an output value of neither high nor low effectively corrupting the data and causing any logic after the synchronizer circuit in the receiving clock domain to produce incorrect results.

In some embodiments a synchronizer circuit includes a resettable flip flop with a data input to receive an input signal a reset input to receive a reset signal and a data output to provide an output signal. The resettable flip flop produces transitions of the output signal from a first logic state to a second logic state in response to corresponding transitions of the input signal and produces transitions in the output signal from the second logic state to the first logic state in response to assertion of the reset signal. The synchronizer circuit also includes a detector circuit to assert a warning signal in response to transitions of the input signal from the second logic state to the first logic state. The synchronizer circuit further includes a logic gate to forward the output signal when the warning signal is de asserted and to provide a signal in the first logic state in response to assertion of the warning signal.

In some embodiments a method of data synchronization includes providing an input signal and a reset signal to respective inputs of a resettable flip flop. The resettable flip flop generates an output signal. The output signal transitions from a first logic state to a second logic state in response to corresponding transitions of the input signal and transitions from the second logic state to the first logic state in response to assertion of the reset signal. A warning signal is asserted in response to transitions of the input signal from the second logic state to the first logic state. A logic gate forwards the output signal when the warning signal is de asserted and provides a signal in the first logic state in response to assertion of the warning signal.

Reference will now be made in detail to various embodiments examples of which are illustrated in the accompanying drawings. In the following detailed description numerous specific details are set forth in order to provide a thorough understanding of the disclosure. However some embodiments may be practiced without these specific details. In other instances well known methods procedures components and circuits have not been described in detail so as not to unnecessarily obscure aspects of the embodiments.

A synchronizer circuit may include one or more resettable flip flops in accordance with some embodiments. As the term is used herein a resettable flip flop includes a data input clock input reset input and data output. Resettable flip flops thus are distinguishable from D flip flops which include data inputs clock inputs and data outputs but do not include reset inputs. Also a resettable flip flop as the term is used herein is configured to provide an output signal from its data output that transitions from a first logic state to a second logic state in response to corresponding transitions of an input signal applied to its data input but does not transition from the second logic state to the first logic state in response to corresponding transitions of the input signal. Instead the output signal transitions from the second logic state to the first logic state in response to assertion of the reset signal.

An inverter provides the value X stored in the master latch to the gate of the transistor . The input clock is provided to the gate of the transistor . The input of the inverter and the gate of the transistor compose the clock input of the resettable flip flop . The transistors and are arranged in series between the left side of the slave latch and ground. When the value of the master latch is 1 and the clock is asserted the transistors and both turn on and couple the left side of the slave latch to ground. Coupling the left side of the slave latch to ground drives the right side of the slave latch to 1 due to the cross coupled arrangement of the inverters . As a result a 1 is stored in the slave latch . A transition of the value stored in the master latch from 1 to 0 however causes the transistor to turn off and therefore does not change the value stored in the slave latch .

A transistor is coupled between the right side of the master latch and ground. A transistor is coupled between the right side of the slave latch and ground. The gates of the transistors and receive a reset signal and thus compose the reset input of the resettable flip flop . When the reset signal is asserted the transistor couples the right side of the master latch to ground causing a 0 to be stored in the master latch assuming the transistors and are not also on at the same time . Similarly the transistor couples the right side of the slave latch to ground when the reset signal is asserted causing a 0 to be stored in the slave latch assuming the transistors and are not also on at the same time . As a result the output signal provided by the inverter becomes 0 if it was already 0 it stays 0 . In this manner the reset signal resets the resettable flip flop .

An inverter coupled to the left side of the slave latch provides the value stored in the slave latch as the output signal Q of the resettable flip flop . The output of the inverter thus is the data output of the resettable flip flop .

As the above description indicates the output signal of the resettable flip flop transitions from a logic low state to a logic high state in response to transitions of the input signal from the logic low state to the logic high state assuming appropriate clocking. The output signal of the resettable flip flop however does not transition from the logic high state to the logic low state in response to transitions of the input signal from the logic high state to the logic low state. Instead the output signal of the resettable flip flop transitions from the logic high state to the logic low state in response to assertion of the reset signal. Therefore in the example of the resettable flip flop the first logic state as the term is used in the above definition of a resettable flip flop is a logic low state and the second logic state as the term is used in the above definition of a resettable flip flop is a logic high state. The resettable flip flop is merely one example of a resettable flip flop in which the first logic state is a logic low state and the second logic state is a logic high state other examples are possible.

Also a resettable flip flop may be designed such that the first logic state is a logic high state and the second logic state is a logic low state. For example the resettable flip flop may be modified by switching the position of the transistors and with the position of the transistor and also switching the position of the transistors and with the position of the transistor . Each of the transistors and would still receive the respective signals shown in . The transistors and thus would be respectively coupled to the inverters and . The transistor when turned on would pull down the left side of the master latch and the transistors and when both turned on would pull down the right side of the master latch . Likewise the transistor when turned on would pull down the left side of the slave latch and the transistors and when both turned on would pull down the right side of the slave latch .

Resettable flip flops such as the resettable flip flop are desirable for use in synchronizer circuits because they have low input capacitance. The data input of the resettable flip flop corresponds to the gate of a single transistor resulting in a low input capacitance. This low input capacitance results in a low minimum steady time for the resettable flip flop where the minimum steady time is the sum of the setup time and hold time for the resettable flip flop . A low minimum steady time reduces the likelihood of metastability and thus reduces the mean time between failures caused by metastability.

The synchronizer circuit receives transmit data tdata from the first clock domain as an input signal. A receive clock rclk is generated in the second clock domain and provided to the synchronizer circuit . The receive clock is said to be a local clock since it is generated in the second clock domain which is the clock domain receiving the transmit data . The transmit data is provided to a data input D of the resettable flip flop . The receive clock is provided to a clock input clk of the resettable flip flop .

A delay line inverter and pulse generator are arranged in series such that the output of the pulse generator is coupled to a reset input of the resettable flip flop . The delay line delays the receive clock thereby producing a delayed receive clock . The inverter inverts the delayed receive clock thereby producing a delayed inverted receive clock . The pulse generator generates pulses based on the delayed inverted receive clock . The pulses are provided to the reset input of the resettable flip flop as a receive signal.

A data output Q of the resettable flip flop is coupled to a data input of a D flip flop . The delayed inverted receive clock is provided to a clock input of the D flip flop . The D flip flop thus samples an output signal from the resettable flip flop in accordance with the delayed inverted receive clock and outputs aligned data . The aligned data is said to be aligned because it is aligned with the clocking for the second clock domain.

A rising edge of the delayed inverted receive clock which clocks the D flip flop occurs at a time within the clock cycle that follows the rising edge of the receive clock at time . The D flip flop therefore samples the 1 from the resettable flip flop at time and the aligned data transitions from 0 to 1 at time . This transition of the aligned data corresponds to the 0 to 1 transition i.e. low to high transition of the transmit data that occurs in the clock cycle before time . This transition of the aligned data occurs within one clock cycle after the rising edge of the receive clock at time .

The pulse generator produces a pulse that begins at time in response to the rising edge of the delayed inverted receive clock . The pulse actually begins slightly after time due to a delay associated with the pulse generator . This delay combined with the hold time of the resettable flip flop allows the D flip flop to sample the 1 output by the resettable flip flop before the output signal from the resettable flip flop transitions from 1 to 0 . The pulse at time causes the output of the resettable flip flop to transition from 1 to 0 as shown. For example if the resettable flip flop is a resettable flip flop the pulse at time turns on the transistor at a time when the transistor is off because the receive clock is low as shows . As a result a 0 is stored in the slave latch and the output of the resettable flip flop transitions from 1 to 0 at or slightly after time .

However the pulse at time occurs while the transmit data is 1 . The transmit data does not transition from 1 to 0 until time at which time the pulse has ended. As a result the output of the resettable flip flop transitions back to 1 when the rising edge of the receive clock occurs at time .

For example if the resettable flip flop is a resettable flip flop the pulse at time turns on the transistor at a time when the transistors and are also on. As a result the 1 stored in the master latch is not reset. Instead the master latch continues to store a 1 and provides this 1 to the slave latch and thus to the output of the resettable flip flop upon the rising edge of the receive clock at time .

The output of the resettable flip flop remains 1 until the next pulse occurs at time in response to which the output of the resettable flip flop transitions back to 0 . The D flip flop samples this 0 upon the next rising edge of the delayed inverted receive clock at time and the aligned data transitions from 1 to 0 at time accordingly. This transition of the aligned data corresponds to the transition of the transmit data at time . However this transition of the aligned data occurs more than one clock cycle after the rising edge of the receive clock at time that follows the transition of the transmit data at time .

The synchronizer circuit includes a delay line inverter pulse generator and first resettable flip flop arranged as described for the synchronizer circuit . The synchronizer circuit also includes a detector circuit AND gate and D flip flop . The detector circuit detects 1 to 0 transitions i.e. transitions from a logic high state to a logic low state which are also referred to as high to low transitions and asserts a warning signal in response to the detected 1 to 0 transitions.

Transmit data that either remains in the same state or transitions from 0 to 1 or more generally from the first state to the second state may be referred to as monotonic data. Transmit data that transitions from 1 to 0 or more generally from the second state to the first state may be referred to as non monotonic data. The extended latency of the synchronizer circuit as shown in is associated with non monotonic data. The warning signal when asserted indicates the presence of non monotonic data in the transmit data .

The warning signal is provided to an inverting first input of the AND gate . Alternatively an inverter coupled between the third resettable flip flop and the AND gate inverts the warning signal and provides the inverted warning signal to the AND gate . This inverter may be considered part of the detector circuit or a separate component of the synchronizer circuit . An output signal from the data output of the first resettable flip flop is provided to a non inverting second input of the AND gate . An output of the AND gate is coupled to a data input of the D flip flop which receives the delayed inverted receive clock at its clock input. The data output of the D flip flop provides aligned data .

Assertion of the warning signal forces the output of the AND gate low which in turn forces the aligned data to a logic low state. Since the warning signal is asserted in response to 1 to 0 transitions the aligned data is forced low in response to 1 to 0 transitions in a manner that avoids the extended latency associated with 1 to 0 transitions in the synchronizer circuit . When the warning signal is de asserted the AND gate passes the output signal from the data output of the first resettable flip flop through to the data input of the D flip flip .

The detector circuit includes an inverter the second resettable flip flop and the third resettable flip flop . The inverter receives the transmit data and provides inverted transmit data . The second resettable flip flop has a data input connected to a power supply VDD a clock input that receives the inverted transmit data and a reset input that receives the delayed receive clock . Connecting the data input of the resettable flip flop to VDD effectively provides a signal fixed in a logic high state to the data input. The third resettable flip flop has a data input coupled to the data output of the second resettable flip flop a clock input that receives the receive clock and a reset input that receives the pulses . The data output of the third resettable flip flop provides the warning signal .

In operation applying the delayed receive clock to the reset input of the second resettable flip flop ensures that the data output of the second resettable flip flop and thus also the data output of the third resettable flip flop provides a 0 unless a 1 to 0 transition occurs for the transmit data . A 1 to 0 transition for the transmit data results in a rising edge on the inverted transmit data which causes the second resettable flip flop to sample the 1 provided by VDD. The output signal provided by the data output of the resettable flip flop transitions from 0 to 1 accordingly which in turn causes the third resettable flip flop to transition the warning signal from 0 to 1 thereby asserting the warning signal . While the warning signal is considered to be asserted when high in this example in some embodiments a detector circuit may be designed such that the warning signal is considered to be asserted when low. 

In some embodiments the inverter is omitted resulting in a detector circuit that inserts a warning signal in response to low to high transitions instead of high to low transitions. Such a detector circuit could be used in a synchronizer circuit in which the first resettable flip flop is replaced with a resettable flip flop for which the first logic state is a logic high state and the second logic state is a logic low state.

A 0 to 1 transition of the transmit data occurs near the end of the clock cycle that precedes time . The transmit data thus is 1 at time . The first resettable flip flop samples this 1 and its output transitions from 0 to 1 accordingly. The warning signal is 0 and remains 0 throughout the clock cycle from time to time . As a result the AND gate forwards a 1 to the D flip flop and the aligned data transitions from 0 to 1 before the beginning of the next clock cycle at time . The synchronizer circuit therefore has a latency of a single clock cycle for a 0 to 1 transition the aligned data transitions by time one clock cycle after the time at which the first resettable flip flop samples the 1 for the transmit data .

A 1 to 0 transition of the transmit data occurs near the end of the clock cycle between times and . This transition does not affect the output of the first flip flop as described with respect to but causes the output of the second flip flop to transition from 0 to 1 . As a result the warning signal is asserted at time . The inverse of the warning signal becomes 0 driving the output of the AND gate and thus the input of the D flip flop to 0 . The aligned data therefore goes low upon the next rising edge of the delayed inverted receive clock before time . The synchronizer circuit therefore has a latency of a single clock cycle for a 1 to 0 transition the aligned data has transitioned from 1 to 0 by time one clock cycle after the time at which the first resettable flip flop sampled the 0 for the transmit data .

In short the values of the aligned data at times and equal the values of the transmit data at times and respectively as shown by the curved arrows in . The synchronizer circuit therefore consistently provides single cycle latency.

In some embodiments additional stages may be added to a synchronizer circuit such as the synchronizer circuit . Additional stages further reduce the likelihood of metastability and thus reduce the mean time between failures caused by metastability.

While the synchronizer circuit includes two additional stages and in other embodiments a synchronizer circuit may include one additional stage or more than two additional stages.

An input signal e.g. transmit data a clock signal e.g. receive clock and a reset signal e.g. pulses are provided to respective inputs of a first resettable flip flop e.g. first resettable flip flop . In some embodiments the clock signal is delayed e.g. by delay line the delayed clock signal e.g. delayed receive clock is inverted e.g. by inverter and pulses e.g. pulses are generated e.g. by pulse generator based on the inverted delayed clock signal e.g. delayed inverted receive clock . Because the inverted delayed clock signal is based on the clock signal the pulses thus ultimately are based on the clock signal. The pulses are provided as the reset signal.

A first output signal is generated in the first resettable flip flop e.g. first resettable flip flop . The first output signal transitions from a first logic state to a second logic state in response to corresponding transitions of the input signal and from the second logic state to the first logic state in response to assertion of the reset signal. In some embodiments the first logic state is a logic low state i.e. 0 and the second logic state is a logic high state i.e. 1 . Alternatively the first logic state is a logic high state i.e. 1 and the second logic state is a logic low state i.e. 0 .

A warning signal e.g. warning signal is generated . The warning is asserted in response to transitions of the input signal from the second logic state to the first logic state. The warning signal is de asserted in the absence of such transitions.

In some embodiments generating the warning signal includes generating a second output signal in a second resettable flip flop e.g. second resettable flip flop such that the second output signal is asserted in response to transitions of the input signal from the second logic state to the first logic state and is otherwise de asserted. The second output signal is provided to a third resettable flip flop e.g. third resettable flip flop which provides the warning signal.

For example to generate the warning signal the input signal is inverted e.g. by inverter . The inverted input signal e.g. inverted input signal is provided to a clock input of the second resettable flip flop e.g. second resettable flip flop . A signal fixed in the second logic state is provided to a data input of the second resettable flip flop. For example the data input of the second resettable flip flop is connected to VDD. The delayed clock signal e.g. delayed receive clock is provided to a reset input of the second resettable flip flop. A second output signal generated by the second resettable flip flop is provided to a data input of the third resettable flip flop e.g. third resettable flip flop . The clock signal is provided to a clock input of the third resettable flip flop. The reset signal is provided to a reset input of the third resettable flip flop. The third resettable flip flop generates the warning signal e.g. warning signal .

If the warning signal is not asserted No the first output signal is forwarded e.g. to a D flip flop . For example the AND gate forwards the first output signal to the D flip flop when the warning signal is not asserted.

If the warning signal is asserted Yes a signal is provided in the first logic state. For example the AND gate provides a 0 to the D flip flop in response to assertion of the warning signal .

In some embodiments a D flip flop e.g. D flip flop that receives the first output signal and the signal in the first logic state forwards these signals e.g. as aligned data to an additional stage e.g. stage which may forward its output to an additional stage e.g. stage in turn.

While the method includes a number of operations that appear to occur in a specific order it should be apparent that the method can include more or fewer operations which can be executed serially or in parallel. An order of two or more operations may be changed performance of two or more operations may overlap and two or more operations may be combined into a single operation. For example all of the operations of the method may be performed in parallel in an on going basis.

The foregoing description for purpose of explanation has been described with reference to specific embodiments. However the illustrative discussions above are not intended to be exhaustive or to limit all embodiments to the precise forms disclosed. Many modifications and variations are possible in view of the above teachings. The disclosed embodiments were chosen and described to best explain the underlying principles and their practical applications to thereby enable others skilled in the art to best implement various embodiments with various modifications as are suited to the particular use contemplated.

