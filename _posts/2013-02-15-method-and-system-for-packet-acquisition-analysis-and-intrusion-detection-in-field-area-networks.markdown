---

title: Method and system for packet acquisition, analysis and intrusion detection in field area networks
abstract: A system for intrusion detection in a field area network where data is transmitted via packets, includes a processor for analyzing the packets to ascertain whether the packets conform to a sets of rules indicating an intrusion, and a database for storing an alert indicating an intrusion if the packets conform to at least one rule in the sets. The sets of rules are for field network layer data, internet protocol traffic data and field area application traffic data. A method for detecting intrusion in a field area network where data is transmitted via packets, including analyzing the packets to ascertain whether the packets conform to the sets of rules, and storing an alert indicating an intrusion if the packets conform to at least one rule in the sets of rules.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09110101&OS=09110101&RS=09110101
owner: Vencore Labs, Inc.
number: 09110101
owner_city: Basking Ridge
owner_country: US
publication_date: 20130215
---
This application claims priority from U.S. provisional patent applications Ser. No. 61 600 222 filed on Feb. 17 2012 Ser. No. 61 613 663 filed on Mar. 21 2012 and Ser. No. 61 756 336 filed on Jan. 24 2013. All of these applications are incorporated herein by reference in their entireties for all purposes.

The present disclosure relates to data and control networks associated with a smart grid for electrical power distribution. More particularly it relates to a system for intercepting decoding and analyzing field area network FAN communications used by smart meters and distribution automation equipment to independently provide intrusion detection and network monitoring for a FAN.

Conventional systems for the generation transmission and distribution of electricity are well known. A power plant or other source generates electricity. The voltage is stepped up for distribution over high voltage transmission lines. The transmission lines are connected to substations which step the voltage down to some intermediate voltage level. The power at this intermediate voltage level is distributed and further stepped down to a voltage that is delivered to homes and businesses.

Smart Grid is the modernization of the national electrical system to improve efficiency integrate renewable generation sources promote conservation and better measure and manage the generation transmission distribution consumption and potentially the storage of electricity. Much of the new technology in Smart Grid is focused on the electrical distribution network.

Key enablers for Smart Grid technology are intelligent embedded systems and communications in FANs. Intelligent embedded systems are small computer systems incorporated into power components that add sensor control and monitoring capabilities. FANs enable communications among embedded system controllers and backend applications for measurements and control of Smart Grid components in the operation of the electrical system.

The Advanced Metering Infrastructure AMI is considered to be the leading edge of Smart Grid. AMI was the first large scale deployment of Smart Grid technology and involves deploying Smart Meters at every home and Communication Access Nodes or Access Points to support wireless communications among Smart Meters and backend applications. A Smart Meters is essentially a solid state computing and metering device with a network interface card. Smart Meter energy applications include remote meter reading remote disconnect connect outage management demand response such as time of use pricing and direct load control and customer engagement through home area networks HANs .

Additionally Smart Grid adds intelligent controls and sensors to distribution transformers distribution feeders and distribution substations to monitor asset state and condition energy flow and to remotely control active components such as switches circuit reclosers and capacitor banks. This portion of Smart Grid is known as Distribution Automation DA .

Wireless networking technology is a popular means to support Smart Grid FAN communications due to the distributed nature of Smart Meters and DA electrical assets. Because Smart Meters and DA electrical assets coexist in the same physical territory they may use the same or similar wireless networking technology for FAN communications.

There are a number of challenges present in managing and securing wireless FANs such as those used in AMI and DA networks. First FANs are wide area multi vendor heterogeneous networks that combine a variety of wireless and wired technologies. Second FANs constitute the largest network a utility will deploy and own. An AMI FAN can contain millions of Smart Meters that need to be managed over low bandwidth channels. Third FANs operate in an unprotected environment. Intelligent endpoints cannot be physically protected very easily and they are often vulnerable to physical and cyber attacks. Fourth significant amounts of AMI and DA wireless technology are proprietary radio systems which transport a mix of proprietary and standards based networking protocols some of which have yet to be adequately vetted from a security perspective. Fifth because field equipment hardware updates and replacements are prohibitively expensive and since software updates cannot remedy all security vulnerabilities utilities that operate FANs will ultimately have to manage multiple vintages of hardware each with a different vulnerability profile. Some security vulnerabilities are inherent in the hardware and wireless communication. They cannot be eliminated and means to detect their potential exploitation are needed as part of comprehensive security program. Sixth many of the new FANs particularly for AMI are adhoc self forming networks that are more dynamic than traditional IP networks and less understood on a large scale such as in a Smart Meter deployment. In addition FAN wireless technology is still quite immature and improvements are constantly being made to communications security network performance and routing for instance.

Given all these challenges there is a great need for network management and security tools akin to those commonly employed in IP enterprise networks to provide visibility situational awareness and security monitoring. However at present no commercial solutions are available to monitor wireless FAN traffic and detect security anomalies intrusion network performance issues or even software bugs. Furthermore there are no independent monitoring capabilities to help mitigate supply chain cyber risks in FAN components. All information about FANs is currently sourced through the application management tools provided by the Smart Grid component vendor which would be unreliable if the vendor s supply chain was compromised.

Much of Smart Grid technology is still in its infancy. AMI DA and FAN system providers are presently consumed by getting their claimed functionality to work. Little to no attention has been given to implementing network monitoring and intrusion detection systems. In addition because many FANs use proprietary radio systems and protocols none of the solutions commonly used for IP networks will work. Furthermore whereas the industry understands the vulnerabilities in IP networks from years of experience it is still in the discovery period with respect to the vulnerabilities in wide area FANs. Smart Grid FAN technology is new and no information is publically available on prior solutions. An analogy can be made to a limited extent with network monitoring and intrusion detection in Wi Fi networks. However known commercial solutions intrusion detection in Wi Fi networks do not operate via over the air captures. The geographic footprint of Wi Fi networks is small in comparison to a Smart Meter network and Wi Fi is built on a open public standard.

An objective of the present disclosure is to provide a method and system to intercept decode analyze and store the communications in FANs abstract and present information about the network and communication flows in usable form and implement distributed intrusion detection and network monitoring capabilities all through means independent of a Smart Grid vendor s products and supply chain.

The present disclosure is also directed to an interchangeable probe based method and system to intercept decode analyze and store over the air and headend communications in FANs and implement distributed intrusion detection capabilities all through means independent of a Smart Grid vendor s products and supply chain.

The disclosure is directed to an intrusion detection and network monitoring system in a field area network where packet streams from a multitude of field and headend probes are inspected and the behavior of nodes is modeled. The system includes one or more intrusion detection functions for analyzing the packets and communication flows to ascertain whether they conform to a set of rules and behaviors indicating an anomaly or sign of intrusion and a database portion for storing an alert indicating an anomaly intrusion or unexpected node if the packets or flow conform to at least one rule in the set of rules.

The intrusion detection function can be configured to analyze the physical Media Access Control MAC and layers between link and network portions of the protocol stack that support formation and maintenance of mesh networks. The intrusion detection function determines whether this content satisfies a first set of rules and stores in the database an alert indicative of the physical and low layer data satisfying at least one rule of the first set of rules. Typically the physical and low layers are proprietary in nature and require reverse engineering to understand their content.

The intrusion detection function can be configured to analyze the packets to determine whether Internet Protocol data is present in the packets and whether the Internet Protocol data satisfies a second set of rules and to store in the database an alert indicative of the Internet Protocol data satisfying at least one rule of the second set of rules. The Internet Protocol data can be IPv4 or IPv6 packets.

The intrusion detection function can be configured to analyze the packets to determine whether field area network application data is present in the packets and whether the field area network application data satisfies a third set of rules and to store in the database an alert indicative of the field area network application data satisfying at least one rule of the third set of rules.

The intrusion detection function can be distributed or centralized. It can be located in a field probe installed in the FAN in a probe placed in the headend of a field area network or in computing platforms within the data network operations center or security operations center of a field area network where traffic from the field and headend probes is routed for analysis and storage.

The FAN intrusion detection and monitoring system also includes a repository for storing the traffic intercepted by the probes for recall replay post analysis and forensics at a later time.

The FAN intrusion detection and monitoring system also includes a client service portal that provides electronic access for system users to access a set of monitoring analysis and visualization applications. The applications allow users to monitor the health and operation of the system and probes view the intrusion detection alerts generated by the system view decode analyze and filter real time and stored packet traces and analyze and visualize the FAN topology and communication flows. The system can also provide an electronic feed of alerts from the intrusion detection system to the client s security systems to deliver real time alerts.

The rules are securely stored in database including a set of keys for accessing the rules. The set of keys is retrieved based on at least one of MAC and IP addresses of a sender and receiver pair in the field area network.

The disclosure is also directed to a method for detecting intrusion in a field area network where data is transmitted via packets including analyzing packets to ascertain whether the packets conform to a set of rules or behaviors and storing in a database an alert indicating an intrusion if the packets conform to at least one rule or behavior.

The method can further include analyzing the physical Media Access Control MAC and layers between link and network portions of the protocol stack that support the formation and maintenance of mesh networks to decide if any of a first set of rules is satisfied and storing in the database an alert indicative of the physical and low layer data satisfying at least one rule of the first set of rules.

The method can further include analyzing the packets to determine whether Internet Protocol data is present in the packets and whether the Internet Protocol data satisfies a second set of rules and storing in the database an alert indicative of the Internet Protocol data satisfying the second set of rules. The Internet Protocol data can be IPv4 or IPv6 packets.

The method can further include analyzing the packets to determine whether field area network application data is present in the packets and whether the field area network application data satisfies a third set of rules and storing in the database an alert indicative of the field area network application data satisfying at least one rule of the third set of rules.

The packets can be received from a probe located in a FAN or a probe in the headend of a field area network. Other information relevant for intrusion detection such as node events can be received from an operations center of a field area network associated with a power distribution system or management system.

The disclosure is also directed to a method for storing and retrieving traffic traces intercepted by the probes.

The disclosure is also directed to a method for providing a system user access to a set of applications through a client service portal to support a hosted or managed service implementation of the invention.

The disclosure is also directed to a method to monitor the health and operation of the system and probes view the intrusion detection alerts generated by the system view decode analyze and filter real time and stored packet traces and analyze and visualize network topology and communication flows.

The disclosure is also directed to a computer readable non transitory storage medium storing instructions of a computer program which when executed by a computer system results in performance of steps of a method for detecting intrusion in a field area network where data is transmitted via packets. The steps include analyzing the packets to ascertain whether the packets conform to one or more sets of rules and storing in a database an alert indicating an intrusion if the packets conform to at least one rule in one or more sets of rules.

A component or a feature that is common to more than one drawing is indicated with the same reference number in each of the drawings. Reference numerals generally begin with the figure number of the figure in which the component or feature is first mentioned.

A multitude of probes are inserted within the FAN to intercept FAN traffic for backhaul and analysis by the FAN backend monitoring subsystem . Fixed external probes can be located on any utility asset such as poles towers substations and building or commercial and private residential structures given the permission of the property owner. Traffic from fixed probes is backhauled through commercial wireless networks e.g. 3G or LTE or existing utility tier and network facilities.

Fixed probes can also be co located or embedded into a subset of residential or commercial meters or HAN enabled or load control devices within a Smart Grid home area network. HAN enabled devices typically inform rate payers of energy usage time of use charges or demand response actions. Meter and HAN device probes provide the advantage of convenient access to power as well as a less harsh physical environment. In addition commercial meters typically have data connectivity which can be used by the probe. Although residential Smart Meters have AMI data connectivity it is preferable to use a separate network for probe communications to maintain independence of probe communications from AMI communications for supply chain integrity and to avoid overloading bandwidth limited AMI networks. Meter and HAN based probes would generally use commercial wireless service for traffic backhaul unless customers permitted use of their fixed broadband connections.

Mobile probes are installed in fleet vehicles of utilities or on any vehicle that agrees to become a host for a mobile probe. In towns where municipalities own and operate their own electrical infrastructure probes may be placed in municipal vehicles including garbage trucks police cars street sweepers and road maintenance vehicles. Mobile probes may also be placed in commercial vehicles such as taxis and delivery trucks. The main requirement is the vehicle move within the utility service territory where the FAN is located. A benefit of using utility and service trucks is that they are usually already equipped with wireless data connectivity and global positioning system tracking devices which can be used by the mobile probes.

Mobile probes backhaul traffic via commercial wireless networks or store the traffic for later upload upon the vehicle returning to its storage point at which time its traffic may be uploaded via local Wi Fi service or manually using USB memory stick transfer thereby eliminating the need for wide area network connectivity.

Headend probes are placed within the FAN headend compartment to intercept all the traffic between the access points described below and the headend management system. Headend probe traffic is transmitted to the over any convenient network with sufficient bandwidth typically a wired IP network.

The field probes receive traffic from meters and receive DA SA traffic. Real time AMI traffic from the probes is sent to FAN backend monitoring subsystem via a backhaul network to a collector disseminator . Data from collector disseminator is disseminated to an intrusion detection system IDS a FAN analyzer and a traffic trace repository which stores the traffic for a period of generally three months. A probe management system communicates with collector disseminator . IDS logs alerts and events at . Such Alerts and events are also received from a client service portal or user portal and forwarded to a dedicated cyber threat analysis team shown at who analyze threats and provide input to the FAN analyzer . Input from cyber threat analysis team and from the client service portal or user portal is also forwarded to the MeshView application described below as well as to a meter events portion of a security information and event management SIEM application within a utility that includes security engineering and operations functions These components and their functions are described below.

Data from FAN is communicated by generally medium bandwidth RF communication to backhaul network . Backhaul network can include a series of routers to facilitate moving data to a core network which may use fiber optics or microwave communication. A router routes data to a supervisory control and data acquisition SCADA equipment . The traffic is then sent to a FAN smart meter DA operations center including engineering security and network operations Probe data is transmitted to FAN backend monitoring subsystem which includes a headend management system and a headend probes interface . Data is available on a model driven monitoring system MDMS data bus .

As previously mentioned probes are inserted in various locations within the FAN HAN and headend system compartment. Probe traffic is backhauled over commercial wireless networks tier and utility networks and potentially customer broadband access to the FAN backend monitoring subsystem. The FAN backend monitoring subsystem can be located in the utility data network operations or security operations center existing in or near the headend management compartment or at another party s site such as in a hosted solution.

Fixed probes are inserted into the FAN using a variety of deployment strategies. One strategy is to deploy probes in areas of high meter density. A second strategy is deploy probes in areas where crime rates are high or where energy theft and equipment tampering has occurred historically. A third strategy is to deploy probes in areas where there is distribution automation equipment to be able to monitor over the air DA and AMI communications near sensitive equipment. A fourth strategy is to deploy probes near sensitive commercial and government facilities such as industrial centers critical infrastructure government offices and military bases. A fifth strategy is to deploy probes at the intersection of multiple access point coverage zones so as to cover the traffic for three or four access points with a single probe given sufficient line of sight range. The probes are designed with RF front ends superior to the Access Points and can reach greater distances. Finally a sixth strategy is deploy probes so that one is co located with every access point.

Fixed probes do not need to be deployed to provide full geographic coverage of the FAN. Mobile probes are used as a means to sample traffic from all over the service territory making use of fleet vehicles owned by the utility or another party such as municipal vehicles taxis or delivery trucks that agree to install probes.

Other components of probes include a local storage and an optional local intrusion detection function . A client access subsystem is represented at . Other probe components as represented at are described in more detail with respect to .

The probes implement radio front end technology to access the radio signals being transmitted in the FAN. Typically these signals are transmitted using Frequency Hopping Spread Spectrum techniques over a multitude of channels in the 900 MHz ISM band for AMI networks. U.S. Pat. No. 5 079 768 describes the operation of a frequency hopping communications network using a pseudo random pattern of frequency changes the use of communications slots arranged into epochs methods to determine the channel of the receiver and whether a node should transmit or wait for a later slot.

The probes support multiple channel capture through a combination of independent RF frontends channel scanning techniques and or digital signal processing techniques that permit capture of a wide band containing multiple channels and real time demodulation of each channel. In the preferred implementation the probe will sample FAN traffic by selecting several frequencies to monitor such that a chosen percentage of traffic is captured. For instance in an 80 channel system where FAN traffic is equally dispersed among all 80 channels a selection of 8 channels would provide a 10 sample of FAN traffic using a technique where the probe remains stationary on a set of channels. Alternatively each RF frontend in a probe can scan through a chosen set of channels with each frontend covering a portion of the total bandwidth and then lock onto a channel when a portion of the preamble sequence that precedes each message transmission is detected. In yet another implementation the entire 80 channels are intercepted using a full spectrum probe. In a typical probe there will be multiple RF frontends and some can be set to a fixed set of channels and others can be configured to scan channels. In a more sophisticated probe implementation the entire ISM band is captured and digital signal processing techniques are used to demodulate most or all channels simultaneously for full traffic capture. Yet another possible mode of operation is for a probe to target all transmission associated with a specific AMI device such as an access point or a specific meter . This requires implementation of the corresponding frequency hopping algorithm and may require input from live traffic to derive the appropriate timing to achieve this. Under typical conditions traffic sampling is sufficient to monitor for signs of intrusion as attackers will not know which channels are being monitored. Attackers may attempt to transmit on multiple channels simultaneously or remain fixed to a single channel when attempting to compromise a particular node. In either case their behavior is detectable as anomalous activity.

Probes are intended to be interchangeable and configurable devices that can accommodate different wireless technologies RF frequency ranges and performance requirements. Some aspects of the probe such as the number and type of RF front ends will be determined at the time of manufacture because they are hardware dependent. Other aspects of the probe such as but not limited to the channels to monitor the traffic sampling method the demodulation method especially in DSP based probes type of local intrusion detection logic mode of backhauling traffic e.g. continuous streaming or trigger based and packet decoding logic can be remotely configured by the probe management system .

Some probes may also contain a local intrusion detection function whereby the probe decodes and optionally descrambles all or portions of intercepted packets and applies security rules policies and heuristics that are within processing power of an embedded host to detect anomalies and signs of intrusion. The local IDS functionality can be applied to one or more received channels within a probe under the control of the probe management system .

Aside from considerations for probe configuration and processing capacity a decision to incorporate local IDS functionality could be influenced by the location and physical security of the probe. A reason to leave all IDS processing in the backend is to protect the knowledge of how to descramble and decode the intercepted traffic. If this processing is performed within the probe the knowledge may be vulnerable if an attacker can steal and successfully reverse engineer a probe. If the descrambling and decoding processes are located in the FAN backend monitoring subsystem the probes merely act as a collector of public over the air traffic and would generally pose no additional security risks beyond those already present in the equipment being monitored. In physically secure locations such as secure substations and probes mounted high atop towers and poles local IDS functionality may be deployed at low risk of attack. In locations where probes cannot be physically protected basic traffic collector probes with less decoding and intrusion detection functionality may be desirable.

Probes can operate in both receive and transmit modes. Normally probes operate in a passive promiscuous receive mode to monitor traffic. However a probe can also be instructed to transmit a particular message on a particular channel to a particular destination by backend management applications or the probe management subsystem. This capability can be used for test and diagnostic purposes or as part of a response to an identified attack to delay interfere with or deny success to an attacker.

Probe can be configured to either stream back all traffic received without processing or locally capture a time slice of the traffic in a circular buffer. In streaming mode all traffic is passed to backend applications for processing and storage. In the preferred implementation timestamps sequence numbers probe identifying information and global positioning system coordinates are applied by the probe upon receipt of each packet. Alternatively timestamps can be applied at the backend. In trigger mode the probe continually buffers a time slice of traffic in local storage and once a trigger condition is satisfied the probe generates an event back to the probe management subsystem and stores or immediately uploads the time slice of traffic to the backend monitoring subsystem. The time slice is preconfigured for duration and includes traffic that generated the trigger event. Upon receiving an event the probe management subsystem can retrieve the stored time slice for evaluation if not already uploaded and reconfigure probe for additional captures in streaming or trigger modes. Trigger mode is beneficial to reduce backhaul traffic volume and cost of transport when backhaul transport is metered.

Various triggers and filters can be used to raise an event and filter traffic collected or streamed by the probe. Some of these triggers include 

In one mode probe can be instructed to track a particular target node such as a Smart Meter or Access Point. This mode is particularly useful for monitoring a high value target to an attacker such as an Access Point because Access Points represent the passage point between the FAN and utility backend systems. Attackers attempting to penetrate backend systems from the FAN will likely target Access Points. Monitoring all traffic sent to an Access Point could aid in the detection of attacks aimed at penetrating the headend system.

Tracking a node means hopping in synchronization in both frequency and time with the pseudorandom sequence chosen by a target node in frequency hopping systems. In many AMI and DA systems for instance each node uses a different pseudorandom hopping sequence typically based on its MAC address. A probe in tracking mode listens for a synchronization broadcast packet from the target node. The synchronization broadcast contains timing information e.g. a fractional epoch tick about where the target node is currently in its hopping sequence referenced to the time the packet was received. With knowledge of a global channel array the MAC address of the node to be tracked the frequency hopping slot time and position of the target node in its hopping sequence at a reference point in time the probe can calculate the next channel where the node will be listening at future times and change its channel frequency to match that of the target node. An example pseudorandom hopping sequence is described in United States Patent Application No. 2009 0168846 which is incorporated herein by reference in its entirety by reference thereto. To maintain hopping synchronization with the target node given clock drift and situations where the target node restarts it hopping sequence the probe updates its timing information with every synchronization broadcast packet the probe receives from the target node. To improve reception of synchronization broadcast packets especially in cases where synchronization is lost the probe can be configured with one RF frontend tracking the target node on the calculated channel and one or more other RF frontends listing or scanning other channels in the system for target node s synchronization broadcasts.

Probe traffic can be backhauled through a variety of wide area networks both wired and wireless. In the preferred implementation probe traffic is backhauled via 3G or LTE commercial wireless networks. Traffic received via each hardware front end or logical RF channel in the case of a digital signal processing DSP probe implementation is aggregated by the embedded controller. Timestamps sequence numbers global positioning system coordinates and other information related to the capture are layered on each captured packet. The embedded controller maintains one or more secure communications channels with backend applications for securely transferring captured traffic and management control. The preferred methods to secure these channels are IP based Transport Layer Security TLS SSL IPsec VPN Layer 2 Tunneling Protocols with IPsec or Point to Point Tunneling and Secure Shell Tunneling. Standard compression algorithms can be applied to the packet stream to reduce backhaul bandwidth. The backend collector disseminator decompresses and decrypts the packet stream to make it available to the IDS and other backend system components.

In FAN traffic from a multiple of field and headend probes is sent to the data processor or collector disseminator over one or more types of backhaul networks typically IP networks. Each probe traffic stream is sent via TCP IP or UDP through a tunnel to a different IP port on the collector disseminator. The collector disseminator serves as an endpoint in the security association with each probe and terminates the security tunnel that protects the probe traffic while in transit over the backhaul network. The collector disseminator decrypts and decompresses each probe traffic stream. If not already performed by the probes the collector disseminator processes the probe packet streams to descramble the bits. The bit descrambling algorithm is system dependent. An example of a bit scrambling descrambling method for FANs is described in United States Patent Application No. 2009 0303972 which is incorporated herein in its entirety by reference thereto. The collector disseminator extracts GPS data from the packet probes to create a mobile probe route file adds system metadata about the probe traffic stream and creates packet trace files in PCAP format. The collector disseminator operates in a publish and subscribe mode making available traffic streams to all those application in the backend that subscribe to a particular stream. The collector disseminator publishes the processed live traffic feeds for example to the IDS network analyzer traffic repository and MeshView applications described below.

The processed live traffic feeds are sent to an IDS system for real time analysis. In the preferred implementation the IDS is a modified version of Snort an open source network based intrusion detection system NIDS that has the ability to perform real time traffic analysis and packet logging on Internet Protocol IP networks. The IDS operates 24 7 on incoming packet streams. IDS such as Snort inherently process IPv4 IPv6 traffic but they do not work with proprietary protocols commonly used in Smart Grid FANs. As such special preprocessors are constructed to look at the physical frame media access control link layers custom layers between the link and network layers and multiple embedded levels of application layer protocol and data in FAN packets. IPv4 IPv6 protocol data units that are embedded in a FAN data packet are analyzed by the IDS IPv4 IPv6 capabilities once extracted using custom rules. In addition preprocessors are used to analyze other proprietary protocols that are used exclusively in the FAN such as proprietary routing protocols broadcasts node synchronization maintenance secure associations and transaction handshake messages. Application protocols typical consist of a mix of standards based protocols such as C12.22 and proprietary protocols. United States Patent Publication No 2008 0051036 provides an example of the mesh layer protocols used in AMI i.e. the layers between the link and network layers that are required for mesh network operation.

The end to end packet flow for the IDS is shown in . Streaming probe packet traffic is received and processed by the collector disseminator and fed into the IDS through a network TAP interface using a TAP writer module. The TAP interface feeds the IDS preprocessors where a first set of rules and behavior analytics are applied. The IPv4 IPv6 and application layers are then processed by inherent IDS capabilities using a second set of rules and behavior analytics. Application layer protocols are then analyzed by a third set of rules and behavior analytics.

Each probe stream is processed by a separate IDS instance that is customized with specific rules for the probe source. For instance the source and destination addresses contained in the intercepted traffic from each fixed probe are processed against a separate whitelist for each probe. Smart meters and DA equipment have fixed geographic locations and their traffic should appear one or more probes but not in others. Address white lists are constructed to identify legitimate sources for each probe. Devices not on the whitelist are identified by the IDS instance for each probe generate an alert and are subject to further scrutiny. In addition a global IDS may be run on the composite of all probe traffic to detect aberrations that apply globally regardless of probe such as monitoring for the authorized network ID in use by the FAN system.

The IDS runs 24 7 processing the continual stream of incoming probe traffic. Alerts are generated when anomalies and behavior satisfy the rule set and behavior analytics. The alerts are logged to an Alert Events database. The Alerts Events can also be electronically transmitted in real time to security incident and event management systems operated by the utility over an electronic interface through the client service portal.

The client service portal provides utilities with secure access to the Probe Monitor a subset of the Probe Manager capabilities used by the FAN intrusion detection and monitoring system the Network Analyzer the traffic repository and the MeshView applications. The client service portal consists of web applications using Transport Layer Security and virtual private network connections. All applications accessed through the client service portal are hosted and run on platforms with the FAN backend monitoring subsystem.

Alerts Events generated by the IDS are processed by a cyber threat analysis function which is generally a team of individuals who are fluent with the operation of the FAN the behavior patterns of the nodes and traffic profiles and security weaknesses and vulnerabilities in the FAN technology and its protocols. The cyber threat analysis team reviews each alert in detail by retrieving the traffic trace from the trace repository that generated the alert. The cyber threat analysis team also sets the appropriate filters in MeshView to retrieve the communications and nodes of interest at the time of the alert. The cyber threat analysis team analyses the traffic patterns and node behavior before during and after the event and compares the behavior to known baselines. If the team validates an alert event as a sign of intruder activity or network malfunction it notifies the utility customer of the event and together they proceed to further investigate. The investigation may require mobile probes to be sent to the area and fixed probes to be reconfigured to focus on nodes or traffic of interest.

The live processed traffic feeds are also sent to one or more instances of the Network Analyzer which decodes the information fields in the incoming packets and presents a running list of packets where users can observe the real time FAN traffic activity intercepted by each probe. Much like well known network analyzers such as an application programming interface for capturing network traffic PCAP such as for example a PCAP processing tool the FAN Analyzer permits users to select a packet for decoding. Powerful packet filters that use each information field at a filterable item can also be applied to present subsets of traffic that match the filter criteria.

The live processed traffic feeds are also sent to a traffic repository. Every probe traffic feed is captured and stored in the traffic repository for a minimum of 3 months. In the preferred implementation packet capture are broken into files and stored on an hourly basis using a file naming convention and directory structure that permit quick identification of the traffic from each probe by day and time. The traffic files can be later recalled by the Network Analyzer or any of the other applications for reprocessing to support diagnostics or an investigation. They can also be reprocessed when new rules analytics or decoding capabilities have been added. Traffic recall is important to need to support diagnostics and forensics work.

The live processed traffic feeds are also sent to the network analysis and visualization tool MeshView where communication flows and higher level network routing and connectivity maps are constructed from observations in the packet captures. The processed traffic feeds are further processed by MeshView to extract topology information and imported into the MeshView applications database. Traffic statistics and traffic base lining are performed by MeshView to develop profiles of traffic for each probe by time of day and day of year.

The intrusion detection and monitoring architecture presented in can be simplified for standalone operation with a single laptop and single or small number of probe similar to the way commercially available network analyzers operate with a WiFi network card on a laptop computer. Such configuration may be useful for lab applications as well as when incorporating analyzer and IDS capabilities into diagnostic tools for field technicians.

Data packets emitted by the probe convey the captured transmissions. Other information including meta data associated the captured packet may be sent by the probe. Such information sent with the captured transmissions or perhaps separately includes 

IDS parses the packet streams based on probe location and applies both global and region specific rules to each stream. Rules policies and stateful modeling is performed at each layer of the custom protocol stack with IPv4 IPv6 processing being done using the inherent capability of Snort and all other processing being done by custom preprocessors. IDS maintains state even for transactions as requests sent by a source on one channel need to be correlated with the response typically transmitted on another channel. Some of the key rules policies and stateful operations implemented by the IDS are 

An example of a region specific rule is to check the MAC addresses of all received packets in a probe stream against a known whitelist of MAC addresses for the radio coverage area of the probe. In the case where FAN traffic is encrypted at the application layer IDS rules and policies can still be applied at all lower layers and stateful models of a transaction can still be applied even if the contents of the payload are not readable. In an alternate implementation the IDS can access the key store used for the FAN AMI system and retrieve the key material needed to decrypt each payload. Key material can be retrieved based on the MAC or IP addresses of the sender and receiver pair. Similarly encryption used at lower layers can be decrypted for analysis assuming the IDS has access to the key server.

For scalability in large FANs the FAN can be divided into multiple sets of collectors IDSs and analyzers and IDS events can be reported to a central event management system. The IDS events can be also reported to a security incident and event management SIEM system that takes event feeds from multiple sources including from systems and intelligence feeds outside the FAN and performs correlation analytics to assess whether seemingly unrelated events and conditions are actually part of a coordinated attack. In another implementation a virtual collector and IDS are provisioned on a computing platform for each probe thereby facilitating custom rules and policies for each probe location such as checking the MAC addresses in an area against a predetermined whitelist.

The Network Analyzer also referred to as the FAN Analyzer is a standalone application that decomposes FAN packets into information element. In the preferred implementation the FAN analyzer is based on a PCAP processing tool an open source packet analyzer which provides a graphical user interface GUI to present captured packets and has inherent IPv4 IPv6 capabilities in addition to supporting other standard protocols used in utility communications. Since FAN traffic uses proprietary protocols specific to each vendor custom dissectors are written and incorporated into the PCAP Processing Tool. The dissectors parse each byte of received packets and define the structure for presentation in the PCAP processing tool GUI. Similarly the dissectors make use of PCAP processing tool constructs so that each field in a packet may be used in a search or filter to highlight packets of interest. In the preferred implementation dissectors are written for the physical frame layer link layer custom layers between the link and network layers routing protocol time synchronization protocol node synchronization maintenance protocol secure application layer insecure application layer C 12.19 tables and generic meter interface protocol. The dissectors take advantage of CRC 32 libraries to perform checksums on the physical frame. In addition compression libraries such as ZLIB libraries are used to decompress application layer messages. Further the ability to dissect and filter meta data contained in packets facilitates multi dimensional filtering including time geographic location and frequency or other parameters.

The FAN analyzer is designed to run on packet traffic files streamed from the collector disseminator or recalled from the traffic repository. Traffic captures are stored in the data repository in the form of PCAP files. Typically the files will be accessed upon an investigation of events posted by IDS . Alternatively the user can select which probe packet streams that are of interest to view and the collector disseminator aggregates and sends out another traffic stream to the FAN network analyzer for live viewing. Multiple FAN network analyzers can be run simultaneously from different locations to support activities by different groups such as security operations and engineering within a utility. Access rules and privileges can be applied to each account on the client service portal to restrict the type of access to traffic by pre assigned authorizations.

The probe management system manages the configuration of the probes from remote. Using a separate secure logical channel to communicate with each probe the probe management system configures the distributed IDS rule set stored locally in each probe and the packet triggers filters RF frontend and sampling parameters as well as other system configuration parameters. Probe management system utilizes active polling of the probes as well as information transmitted by the probes to gather information about probe status their components and health and operational environment as well as the status of relevant backend server processes resources and conditions. A database is used to store information about the status of the probes providing archival information for display and analysis of historical data. Probe management system analyzes the current and historical status of each probe characterizes the status of each probe and can conduct functions such as generating alarms performing notifications of technical support staff or performing remedial or preemptive actions for trouble conditions. A web based graphical interface is among multiple interfaces and overlays such as geographic visualization that may be provided. A user interface for technical users displays operational parameters and status information provides access to collected and derived data and is one possible approach for providing user input of system configuration data. Probe management system can also instruct a probe to transmit a specific packet for test diagnostic and incident response purposes. The probe management system also manages code updates to each of the probes.

The set of conditions under which packets should be considered as having errors and thus discarded or captured and transmitted can also be configured by the probe management system. For example packets indicating transmission on a frequency different from that on which they were actually received might typically be considered as having errors. However under some circumstances this could represent anomalous behavior or potentially attacks against the utility infrastructure.

Referring to in some situations the deployment of field probes may be inconvenient or the utility may be more interested in monitoring the traffic transgressing in and out of a headend compartment to audit hosted network management services or their own users of FAN backend applications. In an alternative architecture a probe can be positioned at the FAN headend to monitor traffic between the headend management system and access points. Headend management system applications which use on web based interfaces may also be monitored in the FAN headend . In this architecture the headend probe only has access to a portion of the traffic flowing between the headend management system and access points which is generally the upper layers in the protocol stack. The physical media access control link layer custom layers between the link layer and network layer are not visible to the probe from this vantage point. In a preferred implementation one or more headend probes are positioned to intercept traffic at the IPv4 IPv6 layer in the headend management system compartment and field probes intercept traffic at each access point . As previously mentioned access to the key server will permit the FAN backend monitoring applications to decrypt encrypted traffic. A benefit of headend probes is that traffic statistics and tallies of commands and messages issued into the FAN from backend applications can be compared against headend application logs and work authorizations to identify commands or traffic for which there is no related authorization or log.

Referring to the primary function of the probe subsystem is to capture the FAN traffic and transmit this traffic to the FAN backend monitoring subsystem for processing. The probe subsystem is contained in a weatherproof housing designed with a double hull. The outer hull provides a sunshield to protect the equipment from direct radiation and mounting points for universal struts so that it can be attached to a pole building or vehicle. The inner hull houses the electronic components in a weather tight enclosure where the air has been evacuated or replaced with a dry inert gas. Desiccants are placed inside the inner housing to absorb any remaining moisture. Both enclosures are designed to withstand the physical stress of an external environment. The probe subsystem comprises several functional components including the following 

A controller board performs processing and I O tasks during the operation of the probe . Significant functions include the following 

In a preferred implementation controller board is an industrial controller board or equivalent that is rated for an extended temperature range and environmental stresses. Preferably it uses a Linux based operating system. A significant design consideration for the software and hardware of the probe is to limit the security risks should a probe be lost or stolen. Probe is designed to introduce no greater security risks than already exists in the field equipment that is it trying to monitor. The use of SSH tunneling for example protects the backhaul transmission channel that contains concentrated traffic captured from multiple over the air channels. Similarly descrambling of the traffic is not performed in probe in the preferred implementation. Instead descrambling is performed in the FAN backend monitoring subsystem to prevent an attacker from reverse engineering the hardware and software to extract the decoding logic.

While the bulk of packet and intrusion analysis is conducted in the FAN backend monitoring subsystem the architecture also supports distributed intrusion detection processing. In this case the processing capacity of the probe controller is utilized to perform intrusion analysis and upon an event immediately provide an alert to backend management systems. In the situations where traffic can be decoded without presenting additional security risks a lightweight version of the IDS system used in the backend i.e. a version of Snort with a custom and possibly more limited policy set that is not too resource intensive can be installed on each probe to perform deep packet inspection and behavioral analysis. If packet decoding cannot be performed by probe for instance due to security reasons distributed IDS processing can still be applied in the form of traffic analysis such as analyzing the characteristics of channel usage and the source and destination of packets if such information is not coded or encrypted.

Controller board dynamically sets the RF and channel parameters of RF data acquisition cards depending upon the acquisition mode. In the fixed sampling mode with a multi channel system a number of channels n that is less than the total number of channels in the system N are monitored. The choice of channels to monitor in this mode is static. In the dynamic sampled mode the monitored channels are changed during the capture depending upon policy. With a uniform policy all channels are monitored for the same period of time in sequential or random order. With a tracking policy the data acquisition card hops in synchronization with the monitored device as it moves through its epoch of channels in a frequency hopping system. This policy enables the probe to listen to all packets going to the monitored node. To remain in synchronization with the monitored node the controller needs to compute where the monitored node will be in frequency at any point in time. This can be accomplished by recording the time when a packet was received and noting the channel it was received on then calculating the frequency hopping pattern based on MAC address as in United States Patent Application No. 2009 0168846 mentioned above and then running time forward to identify the current timeslot and frequency. In the channel seizure sense mode probe listens or scans multiple channels and upon hearing the channel seizure signal typically a repeating pattern of 1 s and 0 s the controller tunes a data acquisition card to the channel. Depending upon the length of the channel seizure signal and the energy detector used multiple cards may be designated to scan for channel activity so as to identify an active channel before the start of the physical frame. Finally in the full spectrum probe all channels N in the system are simultaneously monitored.

Storage provides local nonvolatile memory. Functions include local caching of FAN data. This allows for continuity of data being collected and ultimately backhauled to the FAN backend monitoring subsystem during intervals where wireless connectivity may be interrupted or otherwise become unavailable. Storage also provides memory that is required by the operating system. In a preferred implementation storage is implemented using a solid state drive or disk on module. However any type of nonvolatile storage may be used.

Secure storage provides protected non volatile memory for security credentials such as Public Key Infrastructure PM private keys and certificates passwords shared secrets and other cryptographic keys. The Secure Storage similar to a Smart Card mobile phone SIM or trusted computing component secure FLASH is designed to resist reverse engineering snooping and physical attacks that might reveal the security credentials that its holds. In the worst case the Secure Storage destroys the information upon tampering rather than revealing it to the attacker. Secure storage can also be used to hold captured traffic traces that have not yet been transmitted to the backend. However in the preferred implementation the traffic traces are encrypted stored it in normal memory and just the cryptographic keys are stored in secure storage .

Wireless Modem provides connectivity via wireless technologies such as 3G or LTE. Other technologies such as 802.11 could be used depending upon availability. Alternative means of communication such as wired Ethernet cable etc. could also be employed depending on availability and preference. Under some circumstances the use of a private network can be employed to provide additional security including isolation of probes from all entities except the probe management system . Functions include 

The RF data acquisition section comprises an antenna an RF amplifier and an RF splitter . Antenna creates an electrical signal from the electromagnetic spectrum of interest and feeds the signal amplifier . Antenna is constructed for the frequency band in which FAN traffic being captured such as 902 928 MHz 2.4 GHz with pattern and gain matching the deployed area of coverage and location of the FAN devices being monitored. Amplifier compensates for the loss introduced by RF splitter provides additional gain as required by the selected antenna and improves the probe s range and signal strength of the FAN devices being monitored. RF splitter provides the RF signals captured by the antenna and amplified by the RF amplifier to each of the RF data acquisition devices . RF data acquisition devices demodulates FAN traffic and provides the data to controller board . Other functions of RF data acquisition devices include 

In one implementation each data acquisition device receives on a single frequency. In another implementation one or more of the RF receivers scan the spectrum by varying this frequency over time searching for the start of a transmission. Multiple devices are employed to enable capture of multiple simultaneous transmissions. Preferably such an implementation makes use of commercially available RF transceiver integrated circuits potentially in conjunction with a separate microcontroller.

In another implementation a single device acquires transmissions across a wide frequency band of interest employing digital signal processing techniques to digitally process and demodulate multiple channels. Such an implementation makes use of software defined radio technology.

Communications between the RF data acquisition devices and the controller board can be implemented using standard asynchronous serial communications protocols and UART USART devices or a USB connection.

A watchdog timer provides multiple functions including system recovery in the event that the controller board becomes unresponsive or hung up initiation of graceful shutdown and power cycling.

Watchdog timer can be a separate hardware unit implemented using analog circuitry. It is designed to receive and under normal circumstances pulses at periodic intervals from controller board or it initiates a graceful shutdown of controller board followed by a power cycle of the entire probe except for the watchdog timer itself. The controller board can be programmed to initiate this intentionally by cessation of the expected pulses in order to cause power cycling since some components can only be initialized or returned from a bad state by a power cycle.

Power supply provides power to probe . Application of power to probe components is controlled by the watchdog timer. An external source of power may include AC power from power lines available at a utility pole or from AC or DC power provided by a vehicle.

A battery backup may be provided to keep probe operational if commercial power is lost for fixed installations. In mobile installations such as a fleet truck battery backup permits probe to remain operational while the vehicle engine is not running without the risk of discharging the vehicle battery. The vehicle key switch or a similar safeguard disconnects the probe from the vehicle battery when the vehicle is not running. Additionally the mobile probe can sense the operation of the engine by monitoring the charge voltage created by the vehicle s alternator or the periodic use of the vehicle brake light that occurs under normal driving conditions.

In some deployments probe is equipped with a GPS receiver one example would include deployment on a vehicle. GPS receiver may be separate unit or this function may be provided by another existing component such as the wireless modem . GPS data is transmitted to FAN backend monitoring system along with timestamps so that the received FAN traffic can be correlated with the GPS position data. GPS receiver may also be used with fixed probes as a locator if the device is stolen or lost.

Probe contains a series of sensors that are read by the controller either through an installed program or on demand by a remote command from the probe management system . Temperature sensors not shown measure the temperature of components and air inside the enclosure. Tamper switches not shown report if the housing has been physically opened. Humidity sensors not shown report leakages in the weather tight seal of the enclosure.

Probe contains a digital Input Output capability such as a general purpose USB based I O card that permits the controller board to control relays and send signals to various boards in the assembly. Two key uses of the Digital I O capability are to periodically strobe the watchdog timer to indicate processor health and to support firmware updates on the data acquisition devices .

Referring to the probe packet acquisition process is initialized at including configuration of RF parameters e.g. frequency start word modulation parameters and gain for the RF data acquisition devices . At data acquisition devices wait until a start word is received. At data acquisition devices wait for a data byte to be received. At when a byte is received it is queued for transmission to the controller board . If parameters are available such as for example packet length these parameters are stored. At a determination is made as to whether a packet should be disqualified such as for example when certain rules are not met as described below with respect to or if data integrity is not sufficient for meaningful data to be recovered from one or more packets. At a determination is made as to whether the end of a packet has been processed. At metadata such as RF channel designation and received signal strength indication RSSI is prepended to the packet.

Referring to data caching and transmission to controller board is illustrated. At data is received from a data acquisition device . At packets are time stamped formatted and any additional metadata is appended. At the data is queued for transmission. At a determination is made as to whether a communication channel is available. If a communication channel is not available the data is cached in local storage at . When a communication channel becomes available as determined at the data is transmitted to the FAN backend monitoring system.

Referring to the periodic wakeup of the watchdog pulse generator process occurs at . At the flag set at is read by the watchdog pulse generator process. If the flag indicates that a power cycle is required no pulse is sent by the watchdog pulse generator and control goes to . If the flag indicates that a pulse should be sent to watchdog timer then control shifts to and a pulse is sent.

Referring to health and control information is received and transmitted via a private logical network between probes and probe management subsystem in the FAN backend monitoring subsystem using an SSH protocol. The probe management subsystem monitors the health of probes and make changes to the configuration of probes from a remote location. The probe management subsystem comprises several functional components and features. These include scripts that run periodically to collect data by interrogating probes collect server resident probe data from a file system and other probe data. At probe state changes based on current events and data and events and data from a database are processed. At data is processed as described below including by the use of object relational database techniques. The processed data is then stored in database along with IDS alerts as represented at and as discussed below with respect to . At based on a selected configuration in a configuration data store alerts and notifications in the form of e mail SMS or VoIP are generated. The alerts and notifications are stored in a system log database .

Referring to the overall function of the collector disseminator referred to here as the data processor subsystem is to process the incoming data stream to provide a live view of network traffic including that from probes as transmitted via backhaul network and to create feeds for the IDS and other analysis capabilities in the backend. The data processor subsystem comprises several functional components. These include a FAN data processor which processes data that is received from the probes functions include the following 

Intrusion detection system inspects network traffic for suspicious activity and generates alerts functions as further described below with respect to include the following 

An IDS rules set provides a configurable set of policies for each probe deployment at several network layers 

If there is no match with any rule concerning IPv4 v6 traffic indicative of an intrusion then logic flow is from to . At a determination is made as to whether FAN application traffic is present. If no FAN application traffic is present logic flow returns to . If FAN application traffic is present at a determination is made as to whether the traffic matches any rules indicative of a FAN application traffic intrusion using a third rule set. If no rules indicating a FAN application traffic intrusion are matched logic flow returns to . If a rule indicating a FAN application traffic intrusion is present at an alert is logged in the alert database. Logic flow returns to .

Referring to the FAN analyzer is a software tool that interprets the bits that make up a packet and transforms them into fields of information that are more convenient for human analysis. The FAN analyzer is used for multiple purposes in the FAN intrusion detection and monitoring system. First it is used to monitor incoming traffic in the management portion of the backend system to ensure that probes are properly intercepting and transmitting packet data to the backend. Second it is used as an application in the customer portal that enables customers to analyze intercepted traffic to solve security operations and engineering issues. Third the logic used to decode packets in the FAN analyzer is used in the FAN IDS to parse incoming packets so that rules and behavior analysis can be applied.

Packets are decomposed from the outer edges inward in each case removing an enveloping layer of information. At the outer most layer the physical frame processor operates on the lowest level of information. Physical frame processing extracts the synchronization word that signals the start of a packet the channel ID or seed value and the frame length. If the payload of the packet is scrambled physical frame processing may also descramble the payload in preparation for link layer processing.

The media access control and link layer processor extracts a series of information fields typically formatted as tag length value which describe link communications aspects associated with the packet passing from one node to another. Typical information extracted at the link layer includes the source and destination MAC addresses for packet timing information required to enable nodes to synchronize with each other especially in frequency hopping systems timers and priority information about the communications window packet sequence information link layer flags and information related to the fragmentation of packets at the link layer. Additionally low level messages associated with the discovery of nodes broadcasting information testing the quality of links and maintaining node connectivity tables are interpreted and decoded by the link layer processor.

A mesh layer processor extracts information from custom layers between the link and network layers used to route messages in non IP mesh networks. This includes the source and destination MAC address of the communication endpoints. These addresses differ from the physical frame MAC addresses which only identify the link source and destination i.e. one hop in a mesh network. The mesh layer MAC addresses specify nodes that may be multiple hops apart from one another. In some cases the exact path that a packet should take is explicitly listed as a source route.

Above the mesh layer processing there are a number of different message transfer units. Route processor decodes packets associated with the information transferred between nodes to establish routes within the network and to configure network nodes. This includes advertisements of network gateways directly sent by gateways and indirectly reported by nodes information about neighboring nodes configuration information such as IP prefixes addresses of backend servers e.g. DNS and Trap servers and configurable node parameters for example network IDs and timers .

A time synchronization processor decodes packets related to requests and response to configure accurate time and date on each of the nodes. An encapsulated network processor extracts entire messages from the payloads that are designed to route and transmit through networks made of different technology. Typically IPv4 IPv6 packets are completely embedded as an encapsulated packet providing a means to transport a packet designed for one network technology over another network technology. Encapsulated network processor also extracts header information added to manage the insertion and retrieval of encapsulated packets.

An IPv4 IPv6 processor decodes standards based protocols defined by the IETF that commonly are used over IP networks. Processor handles user datagram protocol UDP connectionless and Transmission Control Protocol TCP connection oriented packet streams. IPv4 IPv6 packets are transport vehicles for higher layer protocols as communication protocols that manage sessions and transactions and HAN protocols such as for example the IEEE Zigbee protocol standard.

A communications protocol processor interprets the messages that support request response and application session oriented transactions. Examples of protocols decoded in this layer include C12.22 for meter management and DNP3 for monitoring and control of supervisory control and data acquisition SCADA equipment. Custom communication protocols designed to operate more efficiently with the underlying network technology are also used. This is common in AMI networks which today are mostly proprietary closed systems. The communications protocol processor also deciphers content that is wrapped with security controls such as PKI signatures and certificates.

A HAN Processor interprets messages that are passed between backend systems and appliances in the home. The packets are carried in an embedded IP packet extracted by a smart meter and transmitted over yet another network technology to smart appliances thermostats and load control switches.

An application processor deciphers the highest level of information content generated by the software applications on the devices. Application layer processor decodes payload data units containing information such as meter register data event information and commands for remote operations such as power disconnect reconnect.

The FAN analyzer also contains logic to reassemble packets that may be fragmented at different layers in the network stack. Fragmentation can typically occur at the Link Layer IPv4 IPv6 Layer and Application Layers. Using information in headers at each layer the FAN analyzer identifies which fragmented packets are related to one another using ID values orders them and reassembles their payloads so that the upper layers can process the extracted message unit. This is represented by the term Frag meaning a fragment in .

Referring to one of the tools referred to in is the MeshView application which is a network analysis and visualization tool that abstracts information about network topology and end to end communications flow in FANs from the atomic communications and low level packet detail captured by a packet intercept system. A key feature of the MeshView application is that it constructs the logical and GIS based connectivity and routing maps of FAN subnets based on traffic observations which do not require full band capture i.e. a sampling of channels over time in a frequency hopping system can be used to render the network topology routing and connectivity diagrams. Another key feature of the MeshView application is the ability to apply powerful filters to the traffic observations to distill specific traffic of interest in the analysis and visualization. Yet another feature of the MeshView application is the ability to show a timeline of packet transmissions based on packet timestamp and to replay packets to observe the time sequence of the communication. The replay functionality is applied to the routing maps to observe how AP subnet routes form change and degrade over time in both the logical and GIS based map views. Yet another feature of the MeshView application is to create baseline traffic statistics for each probe to establish normal operation. The MeshView application also has the ability to allow users to view the route taken by a mobile probe on a GIS based map. The MeshView application also provides filters to allow users to select a geographic area as a filter to produce results based only on packets received transmitted or intercepted in that area.

The MeshView application extracts information to determine network characteristics from the physical frame link layer mesh routing layer a layer 2.5 protocol that is often a custom layer a packet encapsulation layer where IPv4 or IPv6 packets are encapsulated in mesh packets and the application layer. The physical frame provides attributes such frequency channel and virtual network ID. The link layer provides sources and destination of direct node to node communication type of packet and timing information about where nodes will hop at a future point in time among other info. Handshake packets that are linked in time and frequency are used to infer source and destination addresses when not present in packets. Layer 2.5 provides information on source routed packets and relaying of packets through one or more nodes to reach a destination within the mesh. Layer 2.5 also provides information about a node s chosen next hop. IP addresses in the encapsulation layer provides information on communication flows that typically cross between the mesh into backend networks beyond the access point gateway or cross nodes that have different access points. The application layer provides information about node configuration key network server addresses and events.

In the MeshView application parses a network configuration file by using either a Java parser or a Python parser . Data is stored in a MySQL database or a PSQL database respectively. The data is sent to Java GUI or a web GUI such as a Django server using Javascript respectively.

In some of the rules for parsing the traffic captures to valid packets and remove the normal occurrence of packet with errors are shown. Only packets with cyclic redundancy check values are accepted if the CRC in the packet matches the calculated CRC. Packets with CRC mismatches have errors and cannot be considered reliable sources of information. Additionally only packets with a valid physical channel ID where the range of channel IDs must be from zero to some predetermined number for the system are accepted in . A Channel ID outside the expected range is an indication of a packet with error even if the CRC is correct. Finally only packets with valid MAC addresses where the most significant hexadecimal digits in the MAC address match expected values are accepted in . MAC addresses with unexpected values are an indicator of packet error or a possible attack.

Referring to the MeshView application constructs both logical and GIS based connectivity and routing maps. The MeshView application constructs a predictive AP routing map by examining packets that contain source routing information SRT and next hop NH information for a node. It collects and tracks explicit routes and changes in next hop in time sequence where a new source route with a change in next hop requires analysis to determine if it impacts any previously seen routes. When a change in next hop occurs the predictive element of the MeshView application determines which nodes are affected behind the node with the next hop change and updates the route for nodes involved. The predictive AP routing map depicts the best estimate of node routes to an AP in a logical form as shown in .

If just AP routing messages are selected the connectivity map shows a logical mesh based on just AP routes. If all messages are included the mesh shows all communication to and from a particular node and the resulting fan out for each node that that the node of interest had engaged through communications

Additional features to improve usability especially with large mesh maps include a depth control that allows the user to control the number of hops to display i.e. the number of rows the ability to delete a particular node to observe the effect on the mesh i.e. the number of nodes that are without a path to the node of interest .

Advanced filtering and time playback features enable utilities to quickly focus on data of interest and playback node activity for security analysis forensics network operations network engineering and field diagnostics. Filters are applied to information extracted from captured packets with timestamps. Key filters include time span source nodes destinations node type hop count probe source customer and packet type as shown in .

In statistics about the communications and packets resulting from the filters appears on the right hand side. Statistics include the number of packets in the selection the number of sources the number destinations hop count min max and averages. Additionally channel statistics not show are extracted to show which frequency channels are used their utilization and the degree of uniformity in channel usage using Chi square statistics.

The MeshView application provides a time lapse or flip book feature that enables users to playback the communications resulting from their filters. In one mode the user selects a node of interest and observes a movie that flips through each packet that uses the nod of interest as a source destination or relay. Users can single step through the movie one frame at a time. An important feature is that nodes involved in the playback are pre determined and pre positioned so that nodes remain static on the screen and do not change positions with every frame update. This helps to highlight the changes in communication paths. Persistence can be used to leave prior communications on the screen and fade those connections slowly over time.

The MeshView application also enables filter selections to be stored and later recalled to facilitate frequent access to specific slices of data.

The MeshView Web system is comprised of hardware and software components. The hardware components are general purpose server class computing devices with solid state hard drives and substantial memory. The software is a combination of open source frameworks and custom software that performs the specific functionality of the system.

In the logical block diagram of the components for the mesh view system is illustrated. Data import logic is used to import network data from the network configuration file to a database . Filtering logic filters the data in accordance with the filters configured by user access logic . Analysis logic is used to sort and analyze the data. Presentation logic provides the GUIs that the user can use to interact with the system including settings in the user logic .

To import and normalize probe data into the database custom code receives data regarding network communications in a specific format and ensures its completeness. It then normalizes the data performs analysis on select fields and writes them to a database.

To create customize save and manage filters that restrict data analysis to a subset of packets based on selected devices packet types probes timeframes and other characteristics user input is received via a series of web based forms and constructs filters representing the user selection of packet characteristics. The filters are then used to limit the dataset for further analysis by the system. The user has the option of saving modifying adding loading or removing filters. The filters can be unique to the user account.

The system can provide dynamic near real time updates of statistics relating to the filtered data. These statistics include number of devices in the selection number of packets types of data and other data derived from the selected data such as radio frequency channel statistics and assessments of uniformity.

Filtered network data is used to create static and dynamic graphical visualizations of communications flows traffic and characteristics including predictive time based visualizations using time based playback of occurrences in network mesh formation. These visualizations are both abstract using traditional graph and mesh layout and geospatial where appropriate with accurate overlays onto geospatial software such as for example Google Earth as described above with respect to .

Statistical analysis of filtered data in the communications network is used to detect interesting or anomalous characteristics of the network communication. An example of such analysis is the distribution analysis of radio frequency communication channels which will detect non random use of specific communications channels. This is an indication of an operational or security problem. A further example includes detection of non uniform use of transmission frequencies abnormal graph characteristics and other indications of anomalous device or network behavior.

The overall system described herein has many advantages. The system can implement a robust user authentication and data access model that restricts data based on sets of permissions inherited from multiple sources. This ensures that a user only has access to data to which his organization or employer has access and that access has been explicitly granted.

The system may include logic for optimization using methods that enhancer speed of analysis and ease of use. The data models used are designed to facilitate rapid acquisition and analysis of communications and statistical data related to the data inputs.

The system architecture has been described in two parts. The low level packet processing part extracts key information from a selection of packets tracks a list of nodes and node related information and creates an output file that is passed to the higher layer analysis and visualization. The low level packet processing part has also been described in the attached figures. The higher layer analysis and visualization architecture also has been shown.

A significant aspect of the system disclosed herein is the use of probes that are separate and distinct from the AMI and DA system they monitor. A system of probes collectors and management tools as disclosed herein is custom built to work with non IP AMI and DA FANs many of which use mesh networking and frequency hopping technology. In addition the present system implements analysis on custom protocols knowledge of which can be acquired through reverse engineering efforts. A further distinction is that when monitoring WiFi networks for intrusion detection commercial implementations monitor the backend of the router as opposed to over the air traffic as in the present disclosure. Yet another distinction is the node tracking capability and channel scanning and sampling techniques used by the probes.

The system and method disclosed herein can be commercialized as services for solution development i.e. developing and integrating a custom solution for a utility managed services where an entity deploys and manages the system on behalf of a utility or produced as a product that can be sold to utilities or through partnerships with FAN AMI network providers as white label products.

It will be understood that the disclosure may be embodied in a computer readable non transitory storage medium storing instructions of a computer program which when executed by a computer system results in performance of steps of the method described herein. Such storage media may include any of those mentioned in the description above.

The techniques described herein are exemplary and should not be construed as implying any particular limitation on the present disclosure. It should be understood that various alternatives combinations and modifications could be devised by those skilled in the art. For example steps associated with the processes described herein can be performed in any order unless otherwise specified or dictated by the steps themselves.

The present disclosure is intended to embrace all such alternatives modifications and variances that fall within the scope of the appended claims.

The terms comprises or comprising are to be interpreted as specifying the presence of the stated features integers steps or components but not precluding the presence of one or more other features integers steps or components or groups thereof.

