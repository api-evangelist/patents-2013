---

title: Partially virtualizing PCR banks in mobile TPM
abstract: In accordance with the exemplary embodiments of the invention there is at least a method and apparatus to perform operations including triggering, with an entity of a device, an attestation with a trusted platform module/mobile platform module of the device; and in response to the triggering, sending information comprising a platform configuration register value towards the entity, where the platform configuration register depends on measurements of the entity triggering the attestation.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09307411&OS=09307411&RS=09307411
owner: Nokia Technologies Oy
number: 09307411
owner_city: Espoo
owner_country: FI
publication_date: 20131107
---
This patent application claims priority under 35 U.S.C. 119 e from Provisional Patent Application No. 61 723 976 filed Nov. 8 2012 the disclosure of which is incorporated by reference herein in its entirety.

The exemplary and non limiting embodiments of this invention relate generally to trusted computing security and the use of a mobile trusted module in for example a wireless communication system and specifically relate to providing platform binding for trusted applications run inside a trusted execution environment with TCG TPM mechanisms.

This section is intended to provide a background or context to the invention. The description herein may include concepts that could be pursued but are not necessarily ones that have been previously conceived or pursued. Therefore unless otherwise indicated herein what is described in this section is not prior art to the description and claims in this application and is not admitted to be prior art by inclusion in this section.

The following abbreviations that may be found in the specification and or the drawing figures are defined as follows 

In the architecture developed by the Trusted Computing Group TCG for Trusted Platform Modules TPM and Mobile Trusted Modules MTM entity authentication refers to demonstrating the claimed identity of a prover entity i.e. a person or device towards a usually remote verifier such as an internal or external verifier device. This process is referred to as attestation . The TPM can be used to ensure that each computer will report its configuration parameters in a trustworthy manner. In TPM the secure environment is able to accommodate several secure programs that can leverage the measurement and corresponding bindings.

In an exemplary aspect of the invention there is a method comprising triggering with an entity of a device an attestation with a trusted platform module mobile platform module of the device and in response to the triggering sending information comprising a platform configuration register value towards the entity where the platform configuration register depends on measurements of the entity triggering the attestation.

In another exemplary aspect of the invention there is a non transitory computer readable medium encoded with a computer program instructions executable by a processor to perform actions comprising triggering with an entity of a device an attestation with a trusted platform module mobile platform module of the device and in response to the triggering sending information comprising a platform configuration register value towards the entity where the platform configuration register depends on measurements of the entity triggering the attestation.

In another exemplary aspect of the invention there is an apparatus comprising at least one processor and at least one memory including computer program code where the at least one memory and the computer program code are configured with the at least one processor to cause the apparatus to at least trigger with an entity of a device an attestation with a trusted platform module mobile platform module of the device and in response to the triggering send information comprising a platform configuration register value towards the entity where the platform configuration register depends on measurements of the entity triggering the attestation.

In still another exemplary aspect of the invention there is an apparatus comprising means for triggering with an entity of a device an attestation with a trusted platform module mobile platform module of the device and means in response to the triggering for sending information comprising a platform configuration register value towards the entity where the platform configuration register depends on measurements of the entity triggering the attestation.

In accordance with the exemplary embodiments of the invention as described in the paragraph above the means for triggering comprises a non transitory memory including computer program code the computer program code executed by at least one processor and the means for sending comprises an interface to a communication network.

TPMs have PCRs that are reserved for measuring code. The exemplary embodiments of the invention relate to the domain Trusted Computing. A recent addition in the mechanisms for securing the computing equipment is the late launch technology such as dynamic root of trust mechanism DRTM . DRTM is a way for the operating system to temporarily halt and enter a secure execution environment where either a virtual machine can be launched a secure kernel bootstrapped or some other code is executed. This DRTM enabled secure environment can be used for example for securely executing credentials.

Presently TPMs v2 have a single PCR that is reserved for measuring code for DRTM Late Launch . The PCR is singular since in PCs only one code can be launched at a time using the late launch mechanism. If another code is launched into the same cache area a new measurement is done and any binding for the old code is lost. In TPM Mobile a similar strategy has been devised for launching programs inside the trusted execution environment. However only one code can thereby be measured inside the trusted execution environment and bound to TPM mobile functionality. Therefore at least the above described rigidity of PCRs makes these operations difficult.

In accordance with an exemplary embodiment of the invention there is at least a method to enable PCR measurements of late launched code in a virtualized environment. This will at least allows secure backwards compatible mapping of legacy and trusted software. The embodiments of the invention allow a platform to establish a virtual environment with a secure state for late launch code to be measured and or operate without interfering with existing software.

At the time of this invention a binding between this secure environment with the PCR and the trusted application that is being launched is not present. Further the PCR is singular since in computing devices e.g. personal computers PCs only one code can be launched at a time. If another code is launched such as into the same cache area in a PC a new measurement is performed and any binding for old code is lost. In TPM Mobile a similar strategy has been devised for launching programs inside the trusted execution environment. However only one launched application can thereby be measured and bound to TPM Mobile functionality. The current system is inflexible and does not properly allow for servicing concurrently running trusted applications.

The invention enables an efficient use of the platform configuration registers PCRs to provide platform binding for trusted application run under the protective context of a trusted execution environment.

A typical property based TCG attestation system may have an arbitrary number of properties to attest but only a limited number of platform configuration registers PCR available. In TCG style attestation software components are measured by the operating system as they are loaded and properties that match the measurements are accumulated into available PCRs. Since there typically are more properties to attest than PCRs available multiple properties typically need to be accumulated into a single PCR. When a remote verifier requests the attestation of one property the TPM is forced to attest all the properties accumulated into that PCR. In Mobile TPM the secure environment is able to accommodate several secure programs that can leverage the measurement and corresponding binding. However the rigidity of PCRs makes mapping such bindings cumbersome to achieve.

In accordance with a first aspect of the exemplary embodiments of the invention a single PCR bank register is virtualized so that its content depends on the entity accessing a Mobile TPM. At least in Mobile TPM arranging for such a 1 1 mapping between the presented register contents and user of the TPM Mobile for example a calling trusted application is easy to arrange since both entities are likely run inside the same trusted execution environment. In the environment an operating system or scheduler typically has at least a process context that can be used for mapping or binding and it only has to last as long as the measured program is running.

In accordance with an exemplary embodiment of the invention a single PCR bank register is in one access form when accessed e.g. from programs in the operating system aggregated. Thus its contents are only extended to and not erased. This provides clear advantages for the process of remote attestation. In addition the fact that the PCR may only contain a measurement of a single code when accessed from that code itself this makes platform binding of data to the calling program significantly easier.

In accordance with another aspect of the exemplary embodiments of the invention the TPM mobile hosts several sets of a single PCR register or a bank of PCR registers such that the PCR contents are associated with programs entities or functions executed in an operating system of a device.

Before describing in further detail the exemplary embodiments reference can be made to for showing an example of a mobile platform MP that is in wireless communication via link with an access point AP of a wireless network . The network may include a network control element NCE that may include mobile management entity MME gateway GW functionality and which can provide connectivity with a further network such as a telephone network and or a data communications network e.g. the internet . The MP includes a controller such as a computer or a data processor DP A a computer readable memory medium embodied as a memory MEM B that stores a program of computer instructions PROG C and a suitable radio frequency RF transceiver D for bidirectional wireless communications with the AP via one or more antennas. The AP also includes a controller such as a computer or a data processor DP A a computer readable memory medium embodied as a memory MEM B that stores a program of computer instructions PROG C and a suitable RF transceiver D for communication with the MP via one or more antennas. The AP is coupled via a data control path to the NCE .

For the purposes of describing the exemplary embodiments of this invention the MP may be assumed to also include a TPM PCR E that can be implemented in HW SW or as a combination of HW and SW and firmware . The program C can implement an OS as well as all or some of the functionality of the TPM PCR E. The memory can also store trusted software TS F. Also included are a set of PCRs G that can be realized as memory locations in the memory B or as HW registers or as a combination of memory locations and HW registers. The TPM PCR E is assumed to operate in accordance with the exemplary embodiments of this invention as described below.

In general the various embodiments of the MP can include but are not limited to cellular telephones personal digital assistants PDAs having wireless communication capabilities portable computers having wireless communication capabilities image capture devices such as digital cameras having wireless communication capabilities gaming devices having wireless communication capabilities music storage and playback appliances having wireless communication capabilities Internet appliances permitting wireless Internet access and browsing as well as portable units or terminals that incorporate combinations of such functions. The computer readable MEMs B and B may be of any type suitable to the local technical environment and may be implemented using any suitable data storage technology such as semiconductor based memory devices flash memory magnetic memory devices and systems optical memory devices and systems fixed memory and removable memory. The DPs A and A may be of any type suitable to the local technical environment and may include one or more of general purpose computers special purpose computers microprocessors digital signal processors DSPs and processors based on multi core processor architectures as non limiting examples. All or some of the functionality of the MP and the AP shown in can be implemented in one or more respective ASICs.

In accordance with the embodiments a device e.g. which may be implemented as the MP of is equipped with a TPM and PCR bank shown together as the TPM PCR E . The TPM PCRE includes a measurement for a specific application whenever the TPM mobile is accessed from that specific application. The TPM PCR E has available at least a process context that can be used for mapping or binding. The binding property will work as each application can have data bound to itself. Similarly the AP or for example an eNB can be configured to utilize these novel operations in accordance with the aspects of the exemplary embodiments.

The technical implementation of invention is relatively easy to achieve. The TPM mobile is intended to be a SW inside a TEE so the virtualization of a single PCR in a bank is a relatively small addition to the overall code if the calling interface can provide the identity process Id UUID of the caller. This is available is both our own environments and the GP TEE specification UUID . Since the virtualization is dynamic possibly an implementation must restrict the maximum number of trusted application served in this manner but this is no different from similar memory restrictions in trusted environments and secure elements in general.

With regards to a TPM mobile PCR is virtualized such that there is a separate virtualized PCR register entry for each trusted application. As shown by the arrows the virtualized PCR values are associated in an isolated environment by the trusted OS with the PCR of the TPM mobile PCR bank where measurements are taken. In accordance with the exemplary embodiments the virtualized PCR value will contain the measurement with each specific internal trusted application and whenever the TPM mobile is accessed from that specific application. In accordance with the exemplary embodiments the binding property will operate such that each application will have data bound to itself.

In accordance with an exemplary embodiment a key or data is bound to the TPM mobile PCR and released only on condition that a late launched program is identified as a certain one. This binding provides authorized and or secure storage facility for the late launched program being launched using virtualized values for the programs such as the late launched programs. Further in accordance with the exemplary embodiments a remote platform can identify code that has been launched and measured into the isolated environment as the history regarding measurements of the virtualized values and binding remains available from the isolated environment.

Describing now the referenced aspects of the exemplary embodiments. General reference with respect to Fundamental Trusted Platform Features can be made to the document TSG Specification Architecture Overview Specification Revision 1.4 2 Aug. 2007.

In accordance with the TCG Specification Architecture Overview fundamentals of TPM features include the expectation that a device will behave in a particular manner for a specific purpose. A trusted platform should provide at least three basic features protected capabilities integrity measurement and integrity reporting.

Protected capabilities are a set of commands with exclusive permission to access shielded locations. Shielded locations are places memory register etc. where it is safe to operate on sensitive data data locations that can be accessed only by protected capabilities. The TPM implements protected capabilities and shielded locations used to protect and report integrity measurements called Platform Configuration Registers PCRs . The TPM also stores cryptographic keys used to authenticate reported measurements. TPM protected capabilities can include additional security functionality such as cryptographic key management random number generation sealing data to system state and others as determined necessary by TCG members.

Attestation is the process of vouching for the accuracy of information. External entities can attest to shielded locations protected capabilities and Roots of Trust. A platform can attest to its description of platform characteristics that affect the integrity trustworthiness of a platform. All forms of attestation require reliable evidence of the attesting entity. Attestation can be understood along several dimensions attestation by the TPM attestation to the platform attestation of the platform and authentication of the platform. Attestation by the TPM is an operation that provides proof of data known to the TPM. This is done by digitally signing specific internal TPM data using an attestation identity key AIK . The acceptance and validity of both the integrity measurements and the AIK itself are determined by a verifier.

Authentication of the platform provides evidence of a claimed platform identity. The claimed identity may or may not be related to a user or any actions performed by the user. Platform Authentication is performed using any non migratable signing key. Certified keys i.e. signed by an AIK have the added semantic of being attestable. Since there are an unlimited number of non migratable keys associated with the TPM there are an unlimited number of identities that can be authenticated.

Integrity measurement is the process of obtaining metrics of platform characteristics that affect the integrity trustworthiness of a platform and putting digests of those metrics in PCRs. The starting point of measurement is called the root of trust for measurement. A static root of trust for measurement begins measuring from a well known starting state such as a power on self test. A dynamic root of trust for measurement transitions from an un trusted state to one that is trusted. An optional intermediate step between integrity measurement and integrity reporting is integrity logging which stores integrity metrics in a log for later use. Logging is recommended. Otherwise integrity measurements might need to be repeated in order to interpret PCR values.

Integrity reporting is the process of attesting to integrity measurements recorded in PCRs. The philosophy of integrity measurement logging and reporting is that a platform may be permitted to enter any state possible including undesirable or insecure states but that it may not be permitted to lie about states that it was or was not in. An independent process may evaluate the integrity state s and determine an appropriate response.

A measurement kernel generates measurement events. A measurement event consists of two classes of data 1 measured values a representation of embedded data or program code and 2 measurement digests a hash of those values. Data are scanned by the measurement kernel which generates a message digest. Digests are a snapshot of the machines operational state. The two data elements measured values and measurement digest are stored separately. The measurement digest is stored in the TPM using RTR and RTS functionality. The measured values may be stored virtually anywhere at the discretion of the measurement kernel. In fact it may not be stored at all but re computed whenever the serialized representation is needed.

The TPM contains a set of registers called Platform Configuration Registers PCR containing measurement digests. Algebraically updates to a PCR follows as PCR n SHA 1 PCR n measured data . PCR values are temporal and are reset at system reboot. Verification of measurement events requires recreation of the measurement digest and a simple compare of digest values using the PCR value as one of the comparators . TCG does not define data encoding rules for SML contents but recommends following appropriate standards such as Extensible Markup Language XML to ensure broad accessibility.

In accordance with the exemplary embodiments of the invention there is implementing a PCR in a TPM as in TCG Specification Architecture Overview in a way that the value of the register depends on the entity calling the TPM. In accordance with the exemplary embodiments of the invention attestation PCR is as defined above if requested through the respective trusted application. Further if the PCR is being used for example from the OS or from a trusted application that has not been late launched the non virtualized PCR value will contain the aggregated late launched measurements of all trusted programs that have been measured. These aggregated late launched measurements of all the trusted programs are placed in order of measurement and aggregated as a PCR. The PCR would indicate for example new value H old value H measurement .

In accordance with the exemplary embodiments of the invention for attestation a more complex aggregation can be used to include all measurements in an attestation snapshot. As an example and as is described above a TPM mobile may have a single PCR register dedicated to receive measurements of trusted applications as measured by the trusted OS inside the TEE. Say that this is PCR . Each caller trusted application will when accessing the TPM Mobile see the measurement of itself as the value in that register. However for device attestation the totality of these PCR values over all trusted applications that have accessed the TPM mobile may be needed to e.g. prove which trusted applications have been accessing the TPM mobile or in some implementations even which trusted applications that have been launched overall . For this one approach is to aggregate all the virtualized PCR values in a single PCR value presented to any caller that is not a trusted application but e.g. an application calling from the normal rich environment OS. The aggregated late launched PCR measurements of all the trusted programs are placed in order of measurement and aggregated as a single PCR . The PCR aggregation would for example be constructed as successive invocations of new value H old value H measurement .

In legacy TPM standards the PCR bank is static dedicated to a given TPM element and the PCR are initialized to 00000 . . . 00 or 0 at device boot. When the PCRs are virtualized per caller more memory management will be needed inside the TPM Mobile to manage that the right PCR register is presented to each individual caller. In addition the identity UUID of the caller must be stored with the virtualized PCR. Since the TPM Mobile in many implementations is another application running under the same trusted OS inside TEE as the callers that will be allocated their respective PCRs such a data structure is easy to accomplish. One simple example is to allow for a predefined maximum of callers say 16 or 256 and associated with the main PCR bank a table with say 16 rows and two columns could be initialized at boot along with the rest of the PCRs. Whenever the trusted OS would measure a new application to be launched under it it can provide to the TPM mobile application the UUID and the measurement for insertion in this table. Whenever a trusted application accesses the TPM Mobile using a remote procedure call within the trusted OS between the two applications the caller application and the TPM Mobile its UUID would be known to the TPM Mobile and the TPM Mobile could present the value in the appropriate row in the table above as the value in PCR .

The method as in further comprising binding the entity to the trusted platform module of the mobile device.

The method as in and the paragraph above where the information comprises measurement information associated with the software program.

The method as in and the paragraph above where the information comprises measurement information associated with the software program.

The exemplary embodiments of this invention also provide an apparatus that comprises a processor and a memory including computer program code where the memory and computer program code are configured to with the processor cause the apparatus at least to perform triggering with an entity of a device an attestation with a trusted platform module mobile platform module of the device. And in response to the triggering to perform sending information comprising a platform configuration registers value towards the entity where the platform configuration register depends on measurements of the entity triggering the attestation.

The exemplary embodiments of this invention also provide an apparatus that comprises means for receiving a request for access at trusted software of a mobile device from an entity of the mobile device means for triggering an attestation with a trusted platform module mobile platform module of the device. And means in response to the triggering for sending information comprising a platform configuration register value towards the entity where the platform configuration register depends on measurements of the entity triggering the attestation

In general the various exemplary embodiments may be implemented in hardware or special purpose circuits software logic or any combination thereof. For example some aspects may be implemented in hardware while other aspects may be implemented in firmware or software which may be executed by a controller microprocessor or other computing device although the invention is not limited thereto. While various aspects of the exemplary embodiments of this invention may be illustrated and described as block diagrams flow charts or using some other pictorial representation it is well understood that these blocks apparatus systems techniques or methods described herein may be implemented in as non limiting examples hardware software firmware special purpose circuits or logic general purpose hardware or controller or other computing devices or some combination thereof.

It should thus be appreciated that at least some aspects of the exemplary embodiments of the inventions may be practiced in various components such as integrated circuit chips and modules and that the exemplary embodiments of this invention may be realized in an apparatus that is embodied as an integrated circuit. The integrated circuit or circuits may comprise circuitry as well as possibly firmware for embodying at least one or more of a data processor or data processors a digital signal processor or processors baseband circuitry and radio frequency circuitry that are configurable so as to operate in accordance with the exemplary embodiments of this invention.

Various modifications and adaptations to the foregoing exemplary embodiments of this invention may become apparent to those skilled in the relevant arts in view of the foregoing description when read in conjunction with the accompanying drawings. However any and all modifications will still fall within the scope of the non limiting and exemplary embodiments of this invention.

It should be noted that the terms connected coupled or any variant thereof mean any connection or coupling either direct or indirect between two or more elements and may encompass the presence of one or more intermediate elements between two elements that are connected or coupled together. The coupling or connection between the elements can be physical logical or a combination thereof. As employed herein two elements may be considered to be connected or coupled together by the use of one or more wires cables and or printed electrical connections as well as by the use of electromagnetic energy such as electromagnetic energy having wavelengths in the radio frequency region the microwave region and the optical both visible and invisible region as several non limiting and non exhaustive examples.

Further the various names used for the described parameters are not intended to be limiting in any respect as these parameters may be identified by any suitable names. Further the formulas and expressions that use these various parameters may differ from those expressly disclosed herein. Further the various names assigned to different events e.g. challenge etc. are not intended to be limiting in any respect as these various events may be identified by any suitable names.

Furthermore some of the features of the various non limiting and exemplary embodiments of this invention may be used to advantage without the corresponding use of other features. As such the foregoing description should be considered as merely illustrative of the principles teachings and exemplary embodiments of this invention and not in limitation thereof.

