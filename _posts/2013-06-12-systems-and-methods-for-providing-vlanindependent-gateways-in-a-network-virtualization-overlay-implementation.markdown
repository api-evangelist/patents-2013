---

title: Systems and methods for providing VLAN-independent gateways in a network virtualization overlay implementation
abstract: An information handling system is provided. The information handling system includes a first hypervisor running on a first server and a second hypervisor running on a second server. The first hypervisor manages a first virtual switch and has an overlay forwarding table in memory supporting at least one virtual machine, while the second hypervisor manages a second virtual switch and also has the overlay forwarding table in memory and supports at least one other VM. The information handling system further includes a plurality of gateway devices coupled to the hypervisors. The gateway devices share a floating address and are configured to export a host route, associated with the address, into a corresponding entry in an underlay routing table to redirect network traffic from a first gateway device to a second gateway device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09471356&OS=09471356&RS=09471356
owner: DELL PRODUCTS L.P.
number: 09471356
owner_city: Round Rock
owner_country: US
publication_date: 20130612
---
The present disclosure is related to information handling systems. In particular embodiments disclosed herein are related to providing gateways for information handling systems implementing overlay networks.

As the value and use of information continues to increase individuals and businesses seek additional ways to process and store information. One option available to users is information handling systems. An information handling system generally processes compiles stores and or communicates information or data for business personal or other purposes thereby allowing users to take advantage of the value of the information. Because technology and information handling needs and requirements vary between different users or applications information handling systems may also vary regarding what information is handled how the information is handled how much information is processed stored or communicated and how quickly and efficiently the information may be processed stored or communicated. The variations in information handling systems allow for information handling systems to be general or configured for a specific user or specific use such as financial transaction processing airline reservations enterprise data storage or global communications. In addition information handling systems may include a variety of hardware and software components that may be configured to process store and communicate information and may include one or more computer systems data storage systems and networking systems.

Currently information handling systems are being developed that seek to leverage underlying hardware to support a wide variety of virtual components to create highly manipulable configurable virtual networks. One such type of virtualized network is Network Virtualization Over Layer 3 NVO3 . NVO3 provides an overlay network that creates a plurality over Internet Protocol IP tunnels that may be used to isolation traffic associated with different customers of a single data center to provide an overlay network that is completely independent from the underlying network devices or underlay network.

However currently available implementations have not been entirely satisfactory. For example while progress has been made in operating the overlay network communication between hosts and or servers connected to the overlay network and the external networks such as the Internet are still unsatisfactory. Therefore there is room for improvement in the provisioning of gateways for overlay networks.

Consistent with some embodiments there is provided an information handling system. The information handling system includes a first hypervisor running on a first server the first hypervisor manages a first virtual switch and supports at least one virtual machine VM and a second hypervisor running on a second server the second hypervisor manages a second virtual switch and supports at least one other VM. The information handling system also includes gateway devices coupled to the first and second hypervisors by an overlay network for which the first and second hypervisors and the gateway devices each provide a network virtualization edge device. The gateway devices share a floating address and are configured to export a host route associated with the floating address into a corresponding entry in an underlay routing table in response to a network event to redirect network traffic from a first gateway device of the plurality to a second gateway device.

Consistent with some embodiments there is provided a method for providing a redundant gateway system to a virtualized overlay network. The method includes a step of providing a floating address for use by a first gateway device and a second gateway device and a step of including the floating address as a default address in an overlay forwarding table present on a plurality of servers running hypervisors with virtual switches. The method further includes steps of including the floating address in a routing information base present in an underlay network and of associating the floating IP address in the routing information base with an underlay IP address of the first gateway device.

Consistent with some embodiments there is provided an information handling system. The information handling system includes a first hypervisor running on a first server and a second hypervisor running on a second server. The first hypervisor manages a first virtual switch and at least one virtual machine VM . The first virtual switch has a first overlay forwarding table in a memory associated with the first virtual switch. Similarly the second hypervisor manages a second virtual switch and at least one other VM. The second virtual switch has a second overlay forwarding table in a memory associated with the second virtual switch. The information handling system further includes a first gateway device and a second gateway device which are coupled to the first and second servers. And the information handling system includes an overlay network controller that is configured to communicate with the first and second hypervisors over an overlay network. The network controller is also configured to redirect traffic from the first gateway device to the second gateway device when a network event is detected.

These and other embodiments will be described in further detail below with respect to the following figures.

For clarity of discussion elements having the same designation in the drawings may have the same or similar functions. The drawings may be better understood by referring to the following Detailed Description.

In the following description specific details are set forth describing certain embodiments. It will be apparent however to one skilled in the art that the disclosed embodiments may be practiced without some or all of these specific details. The specific embodiments presented are meant to be illustrative but not limiting. One skilled in the art may realize other material that although not specifically described herein is within the scope and spirit of this disclosure.

For purposes of this disclosure an information handling system may include any instrumentality or aggregate of instrumentalities operable to compute classify process transmit receive retrieve originate switch store display manifest detect record reproduce handle or utilize any form of information intelligence or data for business scientific control or other purposes. For example an information handling system may be a personal computer a network storage device or any other suitable device and may vary in size shape performance functionality and price. The information handling system may include random access memory RAM one or more processing resources such as a central processing unit CPU or hardware or software control logic ROM and or other types of nonvolatile memory. Additional components of the information handling system may include one or more disk drives one or more network ports for communicating with external devices as well as various input and output I O devices such as a keyboard a mouse and a video display. The information handling system may also include one or more buses operable to transmit communications between the various hardware components.

Each of hosts and includes one or more processors that execute instructions received over a network interface or stored in a local memory. The processors may also perform operations on data. The processors of hosts and may provide a plurality of functions and or services. Host has a hypervisor which supports a plurality of virtual machines VMs . As depicted hypervisor supports two VMs virtual machine and virtual machine . In order to facilitate communication between VMs and and between VM or VM and another VM on another host such as host a virtual switch may be running on the host . The virtual switch is managed by the hypervisor and provides internal virtualized network capabilities allowing VMs within a hypervisor to communicate more directly with each other given that the communicating VMs are part of a single tenant. For example if VMs and are part of a single tenant a packet sent from VM with an address corresponding to VM as its destination address may be switched by virtual switch . However where VMs and are not in the same tenant the virtual switch may route the packet to a gateway to facilitate the transmission. Alternatively in some embodiments the virtual switch may permit the exchanges of packets between VMs even if they are not in the same tenant.

Host shares many of the features discussed above in connection with host . Thus host supports a hypervisor which in turn supports VMs and and manages a virtual switch . Both hosts and may include many more VMs than depicted. Additionally many embodiments of information handling system include many more hosts like hosts and . To provide communication between VMs on host and VMs on host the virtual switches and may be configured to encapsulate and decapsulate packets for transmission through the tunnels . These tunnels may be IP based tunnels that function by encapsulation and decapsulation of packets for transmission over the underlying network devices. In general the functions of encapsulation and decapsulation may be provided by a network virtualization edge NVE device which may be provided by the virtual switches and but may also be provided by physical switches such as top of rack switches. By encapsulating packets from VMs and the packets can be transmitted over the underlying physical devices of internal network according to the requirements of the overlay network provided in internal network .

The routing decisions are made according to one or more forwarding tables used by the overlay network. An exemplary forwarding table for a first tenant is depicted in . Embodiments of the forwarding table may use media access control MAC addresses and or IP addresses depending on whether the virtual switches are performing forwarding at Layer 2 L2 or Layer 3 L3 . When forwarding is performed with a single virtual subnet forwarding may be performed at Layer 2. When forwarding is performed across more than one virtual subnet forwarding may be performed at Layer 3. In this example traffic for any subnets that are not known to the internet network are forwarded to gate device or . Forwarding table for the first tenant includes VM  the address of VM VM  the address of VM and a default entry to handle routing when a match for a given destination address is not found.

In the forwarding table each of these overlay address entries may be paired in forwarding table with an IP address corresponding to the underlay network. In the table VM  is paired with Outer IP  VM  is paired with Outer IP  and the default entry is paired with an IP for a gateway device VIP Gateway. VIP Gateway is a virtual IP address meaning that the IP address may server as an address for more than one physical device. Copies of the forwarding table may be present in memory associated with the virtual switch the virtual switch the gateway device and a second gateway device . The copies of the forwarding table may differ in the rows that correspond to devices that are locally reachable. For example on host the entry corresponding to VM  has a local port of virtual switch over which the VM  is reachable.

As indicated by forwarding table when either of virtual switches or receives a packet from VMs or that does not have a destination address listed in the forwarding table the packet is sent to the gateway device or . Gateway devices and are configured in a virtual local area network VLAN in order to provide redundancy. The Layer 3 traffic over internal network is sent to either gateway device or gateway device over a Layer 2 network portion which provides a broadcast domain in underlying physical devices. VLAN is configured to permit traffic having VIP Gateway as its destination address to be transmitted to gateway device while it is active and in the event of a failure of gateway device to gateway device . In this way gateway devices and provide a level of redundancy in connecting the internal network to an external network .

For example at a first time VM sends a packet having an address associated with the external network . The virtual switch receives the packet and looks for a match in its forwarding table . When no match is found the packet is sent to the device having VIP Gateway as its address. At the first time the device having the VIP Gateway address is gateway device . Gateway device receives the packet as a member of VLAN and sends the packet on to the external network . After the first time an adverse network event occurs. This adverse network event may be a failure of the gateway device due to the failure of the device itself or of a physical link connecting thereto. The failure of the gateway device is communicated within VLAN such that the VLAN redirects traffic to the gateway device . The failure may be communicated by the gateway device detecting that gateway device is no longer reachable on VLAN . In response the gateway device takes ownership of the VIP Gateway address and sends out a gratuitous address resolution protocol ARP packet through VLAN to indicate its ownership of the address. After the network failure a similarly addressed packet sent by VM is sent to the external network through the gateway device rather than the gateway device .

Due to the use of the VLAN to provide a mechanism by which to redirect traffic away from a failed gateway device to a back up or redundant gateway device information handling system requires significant cooperation between the overlay network and the underlying network devices. For example the overlay network of internal network requires the deployment of the Layer 2 domain of VLAN in the underlay network.

The hosts are coupled to the internal network which has an overlay network running thereon. The overlay network provides a plurality of tunnels that permit the VMs of a tenant to communicate with each other. Each of virtual switches and has a forwarding table in associated memory. As depicted forwarding table is associated with a first tenant but other embodiments of information handling system may include a plurality of tenants which each tenant having an associated forwarding table accessible to the virtual switches to facilitate the separate isolated operation of multiple tenants in the system. The forwarding table for the first tenant maps internal overlay network addresses such as internal overlay IP addresses to external IP addresses as depicted in .

Specific network devices from the physical network devices underlying the internal network are depicted in . Four such devices are depicted including routers A B C and D. Also included in is an underlay routing information base RIB that is used by the underlying network devices of internal network . As depicted when a packet is received having an IP address falling under a prefix it is directed by the underlay routing information base to the appropriate router. For instance the RIB associates the IP addresses matching the 10 8 prefix with router A by associating addresses with an IP address of router A R  in the RIB . Thus when a packet is received in the underlay network with a destination address of 10 8 the packet is forwarded to router A. Similar handling occurs to send packets with an 11 8 prefix to router B 12 8 to router C and 13 8 to router D. Many more prefixes and corresponding routing addresses may be included in embodiments of the underlay RIB .

As discussed above the forwarding table present on virtual switches and and gateway devices and includes a floating address VIP Gateway which can be used to identify either gateway device or gateway device . In some embodiments VIP Gateway is a floating IP address. Gateways and are configured to inject the VIP Gateway address into the underlay RIB . In the underlay RIB the VIP Gateway address is a full 32 host route. Regardless of whether the particular VIP Gateway address matches a given prefix the full 32 address is used in the RIB .

The gateway devices and are both configured to communicate with the underlying network devices of internal network . This may be done by communicating with the underlying network devices according to the protocol used by the underlying network devices. As a specific example the gateway devices and may communicate with the underlying network of internal network by a link state routing protocol such as the Open Shortest Path First OSPF protocol. Other embodiments of gateway devices and may communicate with the underlying network using the Border Gateway Protocol BGP or another protocol.

As depicted in information handling system there are two gateway devices but some embodiments may include more. Gateway devices and are able to communicate by a liveness protocol. The liveness protocol allows the gateway devices and to each be aware of the status of the others as operational or not. Accordingly if gateway device fails gateway device becomes quickly aware of the failure. Gateway devices and any others present in an embodiment also conduct an election to select one gateway device as the default gateway device and the other or others as redundant devices. Multiple gateways may be active at any given time as long as there is a mechanism to ensure that for a given flow only one gateway is active. Thus it may be possible to have flow base load sharing across multiple active gateways. As discussed above the gateway devices and when active may be configured to inject an entry into the underlay RIB and are thus both shown as including a copy of underlay RIB . Gateway devices and may not actually include a copy of the RIB . Additionally the liveness protocol may be unicast or multicast. If unicast is used the network devices of the underlay network may support only unicast and the addresses of each of the gateways may be configured in all of the gateways.

In a particular example gateway device may be elected as the default device. Accordingly the gateway device injects an entry into the RIB that associates the floating VIP Gateway host route with the IP address of the gateway device Gateway . In the event that gateway device fails the liveness protocol alerts the remaining gateway devices. As depicted with only gateway and gateway gateway device becomes aware of the failure of the default gateway. Gateway device then injects an entry into the underlay RIB overwriting the entry injected by gateway device . The entry injected by gateway device associates the floating VIP Gateway address with Gateway  the underlay IP address of gateway device . Thereafter the RIB directs packets to the still functioning gateway device rather than to the failed gateway device .

Information handling system may thus be able to divert traffic between gateway devices during a failover event to provide a high availability HA scheme. Information handling system does not rely on Layer 2 networks and VLANs running thereon to provide for the redirection of traffic from a failed gateway device. Rather information handling system includes gateway devices that are configured to communicate directly with the RIB of the underlay network devices to manipulate traffic away from a failed gateway device to a redundant gateway device. Information handling system may provide fast convergence in the event of a failover.

Because information handling system does not rely on a VLAN like information handling system to provide gateway device redundancy information handling system may avoid some of the limitations that a VLAN may impose. For instance having gateway devices and in a VLAN may impose topographical restraints on the placement of the gateway devices. Typically a VLAN is limited to a single floor of a building or a single container of pod. The gateway devices of information handling system may be positioned largely independently of each other. For example gateway device may be in a different container than gateway device . Such a feature may allow gateway devices to be located closer to the compute nodes of a given tenant.

The gateway devices and may both have an operating system running thereon such as the FORCE10 OPERATING SYSTEM FTOS provided by Dell Inc. of Round Rock Tex. FTOS or another operating system may be configured to expose an application programming interface API that facilitates the handling of the floating IP address VIP Gateway as it is associated with a new gateway device in a failover event. In embodiments using FTOS SMARTSCRIPTS a Perl PHP based programmatic API may be used to provide integration between server based gateway devices and and routing protocols presenting the underlying network devices. The API exposed by the operating system or firmware may provide a mechanism to update a current owner gateway device of the floating IP address. The back end of the API instantiates a full 32 host route and distributes it via the routing protocol into the underlay RIB . The API may be further used to indicate which gateway device is that active gateway device among a plurality of gateway devices present in information handling system .

As depicted the overlay network controller includes a copy of a forwarding table in associated memory. In many respects the forwarding table is similar to the forwarding table described in relation to both information handling system and information handling system . However the overlay network controller may be configured to manipulate the forwarding table in many ways and distribute the resulting changes throughout the overlay network. Thus the overlay network controller may make changes in the forwarding table that are then propagated to each host and associated hypervisor in information handling system . This may be used to provide for the redirection of traffic away from a failed gateway device to a back up gateway device.

For example the overlay network controller may detect the failure of the gateway device . In response the overlay network may propagate a change in the forward tables present on hosts like host and and elsewhere in the internal network . Before the failure of gateway device an unrecognized destination address within the first tenant is associated with the IP address of the gateway device which has Gateway  as its IP address. In response to the failure of the gateway device the overlay network controller propagates an update to the existing forwarding tables such that an unrecognized destination address is thereafter associated with the gateway device which has Gateway  as its IP address.

By propagating the change to all copies of the first tenant forwarding table traffic is redirected away from a failed gateway device to an operational one. Because the gateway devices may be managed using L3 communication the gateway devices may be physically positioned within the information handling system in different locations. For example gateway device may be on a first floor of a building while gateway device is on another floor of the building. Where at least portions of the information handling system are configured within modular containers gateway device may be in a first container while gateway device is in a second container.

As depicted memory may be a solid state memory device or a hard disk drive and is depicted as storing a routing table and one or more forwarding tables . Each of the forwarding tables may be associated with a different tenant being supported by the computing device . Some embodiments of the computing device may not include both the routing table and forwarding tables . Thus the computing device may be configured in many different ways.

In addition to the processor and the memory the computing device includes a plurality of interfaces A B C and D. The interfaces A D provide connectivity to the computing device such that it may send and receive packets as a switch or a router. Both the hosts and as well as the routers and gateway devices of and may be provided by embodiments of the computing device .

As discussed above some embodiments of the method include additional steps. For example in some embodiments there may be a step in which an adverse network event is detected the adverse network event being associated with the first gateway device. The adverse network event may be failure of the first gateway device or a failure of one or more links connecting to the first gateway device such that the device is no longer accessible. In such a situation the method may include steps of associating the floating IP address with the second gateway device in the overlay forwarding table and associating the floating IP address in the routing information base with an underlay IP address of the second gateway.

The first and second gateway devices described above are configured to communicate with the underlying network devices according to a protocol used by those network devices. For example the protocol may be BGP or may be a link state protocol like the OSPF protocol. The floating IP address may be associated in an entry of the routing information base by communicating according to such a protocol.

As discussed above the first and second gateway devices may be server based gateway devices that have an operating system running thereon that exposes an API. The API may be used to add the floating IP address to the routing information base in the underlying network devices.

Some embodiments of information handling systems as disclosed herein include non transient tangible machine readable media that includes executable code that when run by a processor such as a computer processor of on one of hosts or or switches or may cause the processor to perform the steps of method or as described above. Some common forms of machine readable media include for example floppy disk flexible disk hard disk magnetic tape any other magnetic medium CD ROM any other optical medium punch cards paper tape any other physical medium with patterns of holes RAM PROM EPROM FLASH EPROM any other memory chip or cartridge and or any other medium from which a processor or computer is adapted to read. The machine readable media may be memory on one of hosts or or switches or .

The examples provided above are exemplary only and are not intended to be limiting. One skilled in the art may readily devise other systems consistent with the disclosed embodiments which are intended to be within the scope of this disclosure. As such the application is limited only by the following claims.

