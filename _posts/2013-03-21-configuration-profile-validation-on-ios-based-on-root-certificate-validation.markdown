---

title: Configuration profile validation on iOS based on root certificate validation
abstract: An application management agent running on a wireless communications device restricts access to device functionality (e.g., applications and device features) unless the application management agent has determined that a particular configuration profile has been installed on the device (after which the application management agent permits access to device functionality, and an operating system of the device enforces policy settings specified in the configuration profile). The application management agent confirms the presence of the configuration profile by using a validation certificate to validate against a root certificate embedded in a configuration profile installed on the device. The configuration profile is configured to be non-removable, so it cannot be remove or updated, except by another configuration profile signed by the same authority. Validation against the embedded root certificate thereby implicitly confirms the presence of the configuration profile and validates the content of the configuration profile.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09077725&OS=09077725&RS=09077725
owner: 
number: 09077725
owner_city: 
owner_country: 
publication_date: 20130321
---
The present application is related to U.S. patent application Ser. No. 13 595 881 filed 27 Aug. 2012 and entitled Method and System for Facilitating Isolated Workspace for Applications the entire contents of which are hereby incorporated by reference.

A user owning a personal mobile device e.g. smartphone tablet etc. may desire to install certain workplace mobile applications e.g. email calendar etc. relating to his work as an employee of a business on his mobile device rather than carry an additional mobile device for work purposes. In situations where an employer permits the user to utilize his personal mobile device to install and run such workspace applications the employer typically imposes certain security measures or policies on the user s personal device to ensure that enterprise data that is accessed or stored on the personal mobile device is secure.

In order to impose such security measures on personal mobile devices the employer may utilize a mobile device management MDM solution that utilizes an MDM server running on the employer s premises to remotely communicate with a user s mobile device to configure and impose security restrictions. For example certain mobile operating systems OSs such as Apple s iOS on its iPhone and iPad mobile devices include certain application programming interfaces APIs and process flows that enable an MDM server to wirelessly communicate with a mobile device in order to transmit a configuration profile to the mobile OS which in turn understands the format of the configuration profile and is thus able to load certain settings and authorization information consistent with the configuration profile. In the case of iOS a configuration profile may take the form of an XML file that contains a list of settings or properties sometimes referred to as a .plist file relating to the employer s security policies such as restrictions on device features e.g. camera use etc. Wi Fi settings VPN settings email and calendar accounts authentication credentials and the like. Once an initial configuration profile is established between a mobile device and the MDM server the MDM server may be able to remotely execute security related operations on the mobile device such as device lock device wipe to erase data on the device etc. as well as update the configuration profile with new or different security properties.

However current MDM solutions exert a high level of control on mobile devices typically as mentioned above enabling an employer to remotely lock the user s entire device or erase the entirety of the user s device. As such employees are increasingly reluctant to relinquish such control of their personal mobile devices to their employer s MDM systems. Alternative less heavy handed approaches that exert control only on the data and applications in a user s personal mobile device that are relevant to the user s employment e.g. workspace data and applications do exist. For example the approaches described in U.S. patent application Ser. No. 13 595 881 filed on Aug. 27 2012 and entitled Method and System for Facilitating Isolated Workspace for Applications which is hereby incorporated by reference and referred to herein as the 881 Application utilize a management application locally resident on the mobile device to assist in imposing security policies only around workspace data and applications. Such alternative approaches however cannot currently leverage the configuration profile capabilities i.e. to provide certain security features to a workspace environment on the mobile device supported by mobile OSs such as iOS since such capabilities are only accessible by conventional MDM servers. In particular current mobile OSs such as iOS do not provide a mechanism for a local application such as the local management application such as described in the 881 Application to test for or validate the presence of a configuration profile that may be downloaded and installed on the mobile OS. Since the local application cannot validate the existence of a configuration profile on the mobile OS it cannot ensure that certain security settings on a mobile device have been put in place by the loading of a configuration profile by the mobile OS prior to providing access to the workspace environment.

Particular embodiments of a mobile device confirm that a configuration profile has been installed on the mobile device. An application installed on the mobile device may be configured to permit or deny access to certain resources on the device. The application may receive a digital certificate from a server that has previously transmitted a configuration profile to the mobile device. The configuration profile may specify security related properties to be implemented by an operating system on the mobile device including a property specifying that the configuration profile cannot be removed from the mobile device. The configuration profile may also include a root certificate wherein the digital certificate has been signed by the root certificate. The mobile device may request the operating system to confirm that the received digital certificate is trusted by the operating system. The mobile device may receive a confirmation from the operating system that the digital certificate is trusted if the configuration profile has been installed by the operation system and the operating system has installed the root certificate as a trusted certificate thereby enabling the operating system to verify that the digital certificate was signed by a trusted certificate. The mobile device may permit by the application access to the certain resources on the device.

In particular embodiments the certain resources on the device include a plurality of business related applications that are configured to access data managed by an employer of an owner of the mobile device.

In particular embodiments the security related properties include VPN settings that enable the business related applications to securely communicate with servers managed by the employer.

In particular embodiments the operating system receives from the server an update to the configuration profile that includes an intermediate authority IA certificate signed by the root certificate and the method further comprises the step of receiving confirmation from the operating system that a second digital certificate signed by IA certificate and received by the application is trusted by the operating system.

In particular embodiments the operating system receives from the server an update to the configuration profile that includes a new root certificate and the method further comprises the step of receiving confirmation from the operating system that a second digital certificate signed by the new root certificate and received by the application is trusted by the operating system.

In particular embodiments the owner of the mobile device can request a removal of the configuration profile through the application.

In certain embodiments policy server sets a property within configuration profile to indicate to mobile OS that configuration profile should not be removable from mobile device e.g. unless the user specifically requests it removal for example through application management agent . Such an embodiment prevents possible malicious programs from spoofing configuration profile by for example accessing the root certificate in the trusted certificate chain of mobile OS in order to embed it in a different malicious configuration profile and request replacement of configuration profile . That is since configuration profile is configured to be non removable in such an embodiment its security settings cannot be replaced or removed by such a spoofing technique.

It should be recognized that above scenario of validating a validation certificate for application management agent to confirm the presence of configuration profile in mobile OS is merely one example of a situation in which the techniques disclosed herein may be utilized. Other situations may be envisioned in which any other application running on mobile device may desire to confirm the presence of configuration profile prior to permitting access to certain functionality provided for example by the application itself or otherwise. Similarly it should be recognized that in certain embodiments configuration profile may be additionally encrypted and signed as may be typical when systems such as MDM servers transmit configuration profiles to mobile devices in order to ensure data integrity and verify origin. Similarly in alternative embodiments in order to transmit changes to configuration profile policy server may generate a new root certificate to embed into any updates to configuration profile and accordingly sends a newly signed digital certificate to application management agent to validate . In an alternative embodiment policy server may embed a new intermediate certificate that is signed by the root certificate into any configuration profile updates transmitted to mobile OS thereby avoiding any requirements of the user to accept additional untrusted new root certificates.

However an embodiment utilizing computing environment of further utilizes an https server that for example is implemented as part of application management agent and a web browser that is installed as an application in mobile OS . In particular as further described below embodiments utilizing components of may leverage the pre existing capability of web browser to support and engage in certain security protocols typically used to establish secure encrypted sessions between web browser and web servers such as for example https server such as Secure Sockets Layer SSL Transport Security Layer TLS or other similar types of security protocols hereinafter generally referred to as SSL . In one embodiment for example https server may be implemented using open source packages such as OpenSSL.

When application management agent receives notification that the employee is attempting to access business workspace in step and desires to confirm that configuration profile has been installed in mobile OS application management agent in step requests mobile OS to launch web browser to initiate communication with https server for example by providing web browser an https loopback URL to mobile device where https server is listening for connections. When mobile OS launches web browser using the loopback URL in step mobile OS thereby initiates an SSL based protocol interaction between web browser and https server . As part of completing the SSL handshake in step https server sends a client certificate request to web browser and web browser presents the client SSL certificate installed on mobile OS and signed by the root certificate to https server . In step application management agent confirms that the SSL handshake was successful and then validates the client SSL certificate presented by web browser thereby implicitly confirming the presence of configuration profile in mobile OS since the client SSL certificate was provided to mobile OS as an embedded portion of configuration profile . In particular embodiments application management agent may validate the authenticity of the client SSL certificate presented by web browser by comparing it to the copy of the client SSL certificate previously received in step . In step application management agent is able to permit access to business workspace while mobile OS enforces the policy settings specified in configuration profile step . It should be recognized that in certain environment where mobile OS treats SSL certificates as secrets e.g. in contrast to allowing applications to discover the root certificate described in discussions relating to utilizing SSL certificates as opposed to root certificates to confirm the presence of configuration profile further minimizes the opportunities for malicious applications to spoof configuration profile as previously discussed above.

Particular embodiments provide device with an opportunity to install configuration profile should the SSL handshake fail. Policy server retains a copy of configuration profile with the embedded client SSL certificate signs it with the root certificate and makes signed configuration profile available at a URL for download and installation. At the time when the SSL handshake fails mobile OS initiates a redirect using web browser to the URL pointing to a location on policy server where signed configuration profile is available. The user will then be prompted to install configuration profile at which point the process can be restarted at step using the loopback URL.

Although one or more embodiments of the present invention have been described in some detail for clarity of understanding it will be apparent that certain changes and modifications may be made within the scope of the claims. For example policy server may use other techniques to securely provision configuration profile or the validation certificate to a device such as by way of example and not limitation over the air OTA email URL or by using a configuration utility such as iPCU. In another example in order to prevent tampering with or removal of configuration profile policy server may sign configuration profile with a private key assigned to a particular entity e.g. the employer or a particular policy server in this case device will only allow configuration profile to be overwritten or updated by a new configuration profile if it is signed with the same key. In another example where multiple client SSL certificates are present the https server may specify the applicable certificate authority in order to narrow down the acceptable certificate authorities to the one root CA that was used to sign the client SSL certificate and the https server certificate. In another example the https server certificate may be signed by another root CA than that which was used to sign the client SSL certificate in this case the user may have to separately confirm that the other root CA is also trusted. For example at the time when the https server certificate is installed the user may be asked to confirm that the other root CA is also trusted. In another example instead of providing the entire client certificate policy server may provide a pre computed hash of the client SSL certificate to application management agent which can then validate the client SSL certificate in step by computing a hash of the copy of the client SSL certificate obtained from web browser and comparing it with the pre computed hash received from policy server . In another example rather than comparing copies of the client SSL certificate or computing a hash application management agent may simply deem the client SSL certificate presented by web browser valid by verifying that there is a chain of trust from the client SSL certificate to a trusted root CA i.e. the client SSL certificate is directly signed by a trusted root CA or by an intermediate CA wherein the trust anchor for the intermediate CA is trusted in this example the root certificate may not need to be embedded in the configuration profile together with the client SSL certificate if the mobile OS has already established trust of the root CA .

It should be recognized that use of certain terminology that may be more commonly used with certain operating systems than others is merely exemplary not meant to limit the scope of the teachings herein to any particular operating system and that corresponding functions and components in other operating system platforms may benefit from the teachings herein.

The various embodiments described herein may employ various computer implemented operations involving data stored in computer systems. For example these operations may require physical manipulation of physical quantities usually though not necessarily these quantities may take the form of electrical or magnetic signals where they or representations of them are capable of being stored transferred combined compared or otherwise manipulated. Further such manipulations are often referred to in terms such as producing identifying determining or comparing. Any operations described herein that form part of one or more embodiments of the invention may be useful machine operations. In addition one or more embodiments of the invention also relate to a device or an apparatus for performing these operations. The apparatus may be specially constructed for specific required purposes or it may be a general purpose computer selectively activated or configured by a computer program stored in the computer. In particular various general purpose machines may be used with computer programs written in accordance with the teachings herein or it may be more convenient to construct a more specialized apparatus to perform the required operations. The various embodiments described herein may be practiced with other computer system configurations including hand held devices microprocessor systems microprocessor based or programmable consumer electronics minicomputers mainframe computers and the like.

One or more embodiments of the present invention may be implemented as one or more computer programs or as one or more computer program modules embodied in one or more computer readable media. The term computer readable medium refers to any data storage device that can store data which can thereafter be input to a computer system computer readable media may be based on any existing or subsequently developed technology for embodying computer programs in a manner that enables them to be read by a computer. Examples of a computer readable medium include a hard drive network attached storage NAS read only memory random access memory e.g. a flash memory device a CD Compact Disc CD ROM a CDR or a CD RW a DVD Digital Versatile Disc a magnetic tape and other optical and non optical data storage devices. The computer readable medium can also be distributed over a network coupled computer system so that the computer readable code is stored and executed in a distributed fashion.

Herein a computer readable non transitory storage medium or media may include one or more semiconductor based or other integrated circuits ICs such as for example field programmable gate arrays FPGAs or application specific ICs ASICs hard disk drives HDDs hybrid hard drives HHDs optical discs optical disc drives ODDs magneto optical discs magneto optical drives floppy diskettes floppy disk drives FDDs magnetic tapes solid state drives SSDs RAM drives SECURE DIGITAL cards or drives any other suitable computer readable non transitory storage media or any suitable combination of two or more of these where appropriate. A computer readable non transitory storage medium may be volatile non volatile or a combination of volatile and non volatile where appropriate.

Herein or is inclusive and not exclusive unless expressly indicated otherwise or indicated otherwise by context. Therefore herein A or B means A B or both unless expressly indicated otherwise or indicated otherwise by context. Moreover and is both joint and several unless expressly indicated otherwise or indicated otherwise by context. Therefore herein A and B means A and B jointly or severally unless expressly indicated otherwise or indicated otherwise by context.

The described embodiments are to be considered as illustrative and not restrictive and the scope of the claims is not to be limited to details given herein but may be modified within the scope and equivalents of the claims. In the claims elements and or steps do not imply any particular order of operation unless explicitly stated in the claims. The scope of this disclosure encompasses all changes substitutions variations alterations and modifications to the example embodiments described or illustrated herein that a person having ordinary skill in the art would comprehend. Moreover although this disclosure describes and illustrates respective embodiments herein as including particular components elements functions operations or steps any of these embodiments may include any combination or permutation of any of the components elements functions operations or steps described or illustrated anywhere herein that a person having ordinary skill in the art would comprehend.

