---

title: Mixer with adaptive post-filtering
abstract: A noise reduction system includes multiple transducers that generate time domain signals. A transforming device transforms the time domain signals into frequency domain signals. A signal mixing device mixes the frequency domain signals according to a mixing ratio. Frequency domain signals are rotated in phase to generate phase rotated signals. A post-processing device attenuates portions of the output based on coherence levels of the signals.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09424860&OS=09424860&RS=09424860
owner: 2236008 Ontario Inc.
number: 09424860
owner_city: Waterloo
owner_country: CA
publication_date: 20130621
---
This application is a continuation of U.S. Non Provisional application Ser. No. 13 331 753 filed Dec. 20 2011 now U.S. Pat. No. 8 494 179 which is a continuation of U.S. Non Provisional application Ser. No. 12 264 791 filed Nov. 4 2008 now U.S. Pat. No. 8 121 311 which claims the benefit of U.S. Provisional Application No. 60 985 557 filed Nov. 5 2007. The contents of U.S. Non Provisional application Ser. No. 13 331 753 now U.S. Pat. No. 8 494 179 U.S. Non Provisional application Ser. No. 12 264 791 now U.S. Pat. No. 8 121 311 and U.S. Provisional Application No. 60 985 557 are hereby incorporated by reference in their entirety.

This disclosure relates to signal processing and in particular to systems that attenuate unwanted or undesired signals that may lower the quality of a communication channel.

Noise may affect the quality or performance of a communication channel. Noise may conceal information and may cause undesirable changes in a waveform or a signal. The noise may occur naturally or by the processes that convey signals.

Some systems attempt to selectively isolate a speaker to eliminate or minimize noise. When multiple speakers engage in a conversation this form of separation may not effectively minimize noise. The system may not reduce noise or improve signal to noise ratios.

A noise reduction system includes two or more transducers that generate time domain output. A transforming device transforms the time domain output into the frequency domain. A signal mixing device mixes the frequency domain signals based on a magnitude and a signal to noise ratio. The mixing device may rotate frequency domain signals. The rotated signals may be added based on a mixing ratio. A post processing device may attenuate portions of the combined signals based on coherence levels.

Other systems methods features and advantages will be or will become apparent to one with skill in the art upon examination of the following figures and detailed description. It is intended that all such additional systems methods features and advantages be included within this description be within the scope of the invention and be protected by the following claims.

Systems reduce noise and improve the signal to noise ratio of signals conveyed through one or more communication channels. The systems may dampen unwanted perceptible and or imperceptible signals to the mind or senses that occur naturally or are generated by or near the processing technology. Some systems support two three or more inputs and may combine and adjust the sounds that originate from many sources into one or more signals that may be conveyed through a common or single channel. The systems maintain voice quality and may reduce and diffuse noise automatically to programmable levels.

In some systems the inputs are enclosed by a single or common housing in alternative systems the inputs are located in separate housings. The inputs or microphones may be directionally splayed to receive two or more targets that may be in an open space or surrounded by an enclosure. When enclosed within a vehicle optional the inputs may target a driver a passenger and or a co driver. The inputs may be positioned substantially in parallel and may receive sound from a common or a similar direction. In some systems noise suppressor and filters customized to an input or direction may reduce the noise detected from each array or microphone configuration.

The mixing system may reduce noise detected or processed by one or more arrays . A signal to noise level may be improved when a signal of interest such as a speech signal is received by two or more inputs at different times. A voice signal originating from a source such as a speaker may be received by a first input at an initial time and received by a second more distant input later in time. In some systems the propagation delay may be predictable and substantially constant.

If a first input receives a voice signal about one millisecond before a second input one or both of the signals may be delayed and summed and the two signals may add constructively. If the amplitude of each signal is about equal the resulting signal may be about twice the amplitude of either individual signal which may represent a gain of about 6 dB.

Ambient or diffused noise may be received by the inputs from different directions and at different times. If a noise signal is processed the amplitudes may add constructively in some situations and may add destructively in other situations. The result may dampen the noise. In some systems the noise signal may have an amplitude of about 1.41 square root of 2 times the amplitude of the original signal which may represent a gain in signal to noise of about 3 dB.

By tracking selected attributes of the wind noise the optional wind buffet suppression logic or circuit may eliminate or dampen wind noise. The optional wind buffet suppression logic or circuit may access a local or distributed memory that may store the selected attributes of the wind noise. In some mixing systems the optional wind buffet suppression logic or circuitry may interface or include an automatic control mechanism or device that measures wind noise and returns a portion of the output through a feedback loop . The feedback loop may convey one or more signals that may be used to modify or control a mixing ratio. An optional post filter may suppress noise by passing portion of the composite signal s that are a product of a coherent combination while blocking or dampening other portions of signals that have a low signal to noise ratio or low coherence. In the mixing system may maximize the signal to noise ratio of one or more signals of interest such as a signal from a driver or passenger by automatically selecting and in some systems adapting an optimum phase and amplitude mixing ratios and by reducing portions of the signal that may lack coherence across multiple inputs e.g. two or more .

In an acoustic environment such as a vehicle a mixing system may receive input from many sources including the driver and passengers. The mixing system may reduce or dampen the noise level that surrounds speech by increasing the signal to noise level of speech signals. In some systems the increase in signal quality occurs without knowledge of the source or the input. The mixing system may adjust and combine the signals processed by the inputs .

A first input signal a digitized signal may correspond to speech captured by a driver oriented input while a second input signal a digitized signal may correspond to the speech captured by a second driver oriented input. The domain transforming device which may comprise a Fast Fourier Transform FFT device or which may apply an FFT process may transform the first and second input signals from the time domain to the frequency domain. Each frequency bin i may be represented by a complex variable having a real Re component and an imaginary Im component.

A signal magnitude calculation or estimating device may estimate a magnitude value for each frequency bin by deriving a magnitude of the hypotenuse of the real and imaginary components as described in Equation 1 square root over Equation 1 

To reduce complexity the magnitude may be approximated by a weighted sum of the absolute values as described in Equation 2 Equation 2 

The signal to noise comparison device may compare the derived magnitudes to a noise estimate. The noise estimate may be estimated for each signal. To reduce processing complexity the magnitude of each channel may be compared to a post mix single channel noise estimate through a comparator based on an expected gain from the mixing device and the post processing device . The mixing device may improve the signal to noise ratio by a programmable or fixed amount e.g. about 3 dB and the post processing device may programmed to another or similar programmable or fixed amount e.g. may be set to about a 6 dB attenuation level . At these exemplary levels the signal to noise level may be determined by Equation 3 9 dB Equation 3 where Smay be the signal magnitude at frequency i in units of dB and where Nmay be the noise estimate at frequency i in units of dB. The signal to noise comparison device may derive or estimate the signal to noise ratio for both the first and the second input signals. The maximum of the two values may be selected as the signal to noise level for an incoming signal. The adaptation control device may adapt the mixing device based on each bin where each bin may have a corresponding signal to noise ratio greater than a predetermined threshold value for example about 10 dB to about 14 dB. The adaptation control device may provide an indication to the mixing device when the signal level is above the noise level.

The adaptation control device may adjust its adaptation rate based on the phase of the input signals. The device may generate a phase difference between the complex components of the left and right input signals at each frequency based on Equation 4 Equation 4 

The phase may comprise the arctan of the complex components or an approximation of the arctan trigonometric function shown in Equation 5 tan Equation 5 

The phase difference of Equations 4 or 5 may be stored in a local or distributed e.g. remote memory and may be processed to align a phase of one channel with the phase of another channel across a frequency band. In some systems the instantaneous phase difference may be used. In these systems the phase difference may not have been smoothed.

During adaptation the mixing control device may generate a mixing ratio of the magnitude of left channel signal to the right channel signal. A mixing ratio may ensure optimal mixing given by Equation 6 

In Lmay be the estimated or actual magnitude of the first or left channel signal at a frequency i where Rmay be the estimated or actual magnitude of the second or right channel signal at the frequency i and where may be the contribution of the first or left channel signal to be added. The contribution of the second or right channel may be given by Equation 7 1 Equation 7 

If the first and second channel signals have about equal amplitudes the mixing values may be about 0.5. If the first channel signal is equal to about 0 the mixing values may be about 0 and about 1.0 respectively. If the second channel signal is equal to about 0 the mixing values may be about 1.0 and about 0 respectively.

The mixing ratio may be smoothed in time using an infinite impulse response IIR filter or process given by Equation 8 Equation 8 

In Equation 8 may be the instantaneous mixing ratio where may be the time smoothed ratio and where may be set to a fixed value which may range from about 0.05 to about 0.25 and may depend on how fast a beam switches.

In alternative systems the magnitudes at each bin for both the first and the second channel signals may be smoothed. The mixing ratio may be based on smoothed magnitude vectors to improve stability.

The mixing control device may mix the first and second channel signals on a frame by frame basis by rotating one channel in phase with the other channel. This process may correspond to a time delay in the time domain. The mixing control device may add the rotated signals according to a mixing ratio. In some applications such as when the mixing system is used within a vehicle planar propagation of source waveforms the input signal are not assumed due to the nature of the enclosed space proximity of hard reflecting surfaces or the acoustic dynamics corresponding to the input housing.

In some applications the signals may experience different time delays at different frequencies and may have different amplitude ratios at different frequencies. For example at 2 000 Hz a first channel signal may be 6 dB greater than a second channel signal but at 2100 Hz the reverse may be true. In these applications each frequency or bin may be processed independently.

There may be periods when there is no signal component on a channel at a given frequency. In some circumstances the signal may be masked by noise. The lower amplitude signal or lower signal to noise ratio may be rotated in phase with the higher amplitude signal or higher signal to noise ratio . Rotation may occur independently at each frequency or frequency bin. For each frame each frequency bin the lower amplitude signal or lower signal to noise ratio channel may be rotated in line with the higher amplitude signal or higher signal to noise ratio channel. If the right channel signal is greater than the left channel signal the corresponding rotated left channel value may be expressed by Equations 9 and 10 cos sin Equation 9 cos sin Equation 10 

If the left channel signal is greater than the right channel signal the corresponding rotated right channel value may be expressed by Equations 11 and 12 cos sin Equation 11 cos sin Equation 12 

The mixing control device may mix the rotated channels in accordance with a smooth mixing ratio to generate the complex values expressed by Equations 13 and 14 1 Equation 13 1 Equation 14 

The adaptation and mixing process may improve the signal to noise ratio and generate a higher signal to noise ratio than some systems that splay signals that have different amplitudes. In systems using splayed inputs the amplitude of the output may degrade depending on the location of a primary source. In some systems this loss may be compensated for by multiplying the output by a predetermined constant.

The mixing device may include an optional wind buffet detection device . The wind detection device may identify noises associated with wind flow from the properties of air. While wind noise occurs naturally or may be artificially generated over a broad frequency range the wind buffet detection device is configured to analyze and detect the occurrence of wind noise and in some instances the presence of a continuous underlying noise. When wind noise is detected the spectrum may be identified and selected attributes or associated control data may be retained in a local or distributed memory. To overcome the effects of wind noise and in some instances the underlying continuous noise that may include ambient noise an optional buffest suppression device may substantially remove or dampen the wind noise and or the continuous noise from the unvoiced and mixed voice signals. In some systems the optional wind buffet detection device and optional buffet suppression device may be part of the mixing device .

In systems that include wind buffet detection speech may be detected at the inputs at about equal amplitudes. Because wind may not be an acoustic phenomenon it may be selectively received by the inputs which may result in a large low frequency artifact on one input at a time. To reduce or substantially eliminate the effects of wind buffets the mixing device may select or derive a mixing ratio that minimizes its inclusion in the combined signal.

In some systems the mixing device may select a lower amplitude channel signal at a given bin for frequencies below a predetermined frequency. The predetermined frequency may be for example about 600 Hz. This binary selector may be smoothly averaged with the longer term mixing ratio which may provide a mixing ratio that acts quickly at low frequencies to select the lower amplitude channel signal and in medium to higher frequencies to optimize for a higher signal to noise ratio signals. The wind buffet reduction device or process may be used when the speech signal has about equal amplitudes on each of the signal channels at the low frequencies.

The cross power spectral densities and the power spectral densities may be summed over a short time period otherwise the value of Cmay become equal to about 1. Such vectors may be temporally smoothed using IIR filters or devices given by Equation 16 Equation 16 

The range may permit fast recognition of good coherence but may not show high coherence long after speech occurs. A single value may range from about 0.05 to about 0.3. The IIR filter or process may adapt asymmetrically by using a smaller value for onsets and larger values for offsets. When the power at a given time and frequency is greater than the power of a last or previous frame onset may be set to a low value such as about 0.03. When the power at a given time and frequency is lower than the power of the last or previous frame offset may be set to a high value such as about 0.25. The value may minimize the measured coherence in noise before and immediately after a coherent signal has been detected. The post processing device may permit a coherent signal to pass through while suppressing or partially suppressing portions of a signal not coherent. The amount of suppression may be a predetermined or user determined amount such as between about 3 dB and about 8 dB.

The mixing system may interface or may be a unitary part of another system such as an echo cancellation system. Echo cancellation may occur before or after a signal is processed by the mixing device . If the mixing device interfaces or is part of another system such as the echo cancellation system the post processing device may represent a pre processor or post processor and the level of attenuation may be programmed or configured to desired ranges such as about 3 dB to about 12 dB.

In some systems the post processor may comprise a multi channel Wiener filter. In systems where the filter comprises the only noise reducing element an exemplary noise attenuation level may programmed within a range of about 10 dB to about 40 dB when processing more than 2 channels.

The spectral coherence or magnitude squared coherence MSC provided by the coherence calculating device may range from about 0 to about 1 and may vary relative to the distance between the inputs . The MSC value may fall off when the signal to noise ratio at a bin is very low. There may be situations where the measured coherence at some frequencies is low due to reflections and input housing characteristics. Thus the spectral coherence may be post processed. In these and other systems the systems first smooth the coherence across frequencies.

The coherence signal smoothing device may smooth the coherence across all or selected frequency ranges. The device may apply a bidirectional IIR process to smooth the coherence values across frequencies. An asymmetric IIR may bias the smoothed result to favor higher values according to Equation 17 Equation 17 

In Equation 17 may be set to a high value such as about 1.0 when coherence may be increasing from bin to bin. The value of may be set to a low value such as about 0.1 when coherence may be decreasing from bin to bin. This process may provide a form of spectral envelope that may compensate for poor coherence at a frequency.

The IIR processing may be bidirectional because the smoothing may be applied first across increasing frequency bins and then across decreasing frequency bins to generate an envelope that varies smoothly in a symmetric manner around any one spectral peak. Smoothing may achieve a coherence measure for given formants.

Because speech formants may be narrower at lower frequencies than at higher frequencies the value of may vary with frequency. Because the value of a may be programmed to about 1 for rising coherences may vary across frequency only for falling coherences. To capture the variation in formant width the value of a may be set to a higher value in lower frequencies than at higher frequencies. This may capture the coherence of formants and may allow for sensitive detection of neighboring harmonics around a single higher signal to noise ratio harmonic in noise.

In some systems the coherence in the valleys or dips between harmonics which may contain noise may be overestimated. To correct such overestimates the coherence edge enhancement device may attenuate the frequency smoothed spectral coherence where there are dips detected in the raw coherence. The smoothed coherence may be suppressed when a valley is detected in the raw coherence and may not be suppressed where peaks are found. A low complexity representation of this process may be expressed as Equation 18 

Noise may be coherent depending on how fast the power spectral density and the cross spectral density IIR filters are updated and may depend on the distance between the inputs and their directionality. To account for the long term maximum and long term minimum coherence the coherence tracking device may determine a normalized coherence.

A spectrally smoothed coherence may be normalized by temporally averaging the smoothed coherence using an asymmetric IIR filter or process. The maximum long term coherence may be tracked by an IIR filter given by Equation 19 max max max Equation 19 

In Equation 19 may be programmed to a high value of about 0.1 when coherence is increasing from one frame to another and may be programmed to a low value of about 0.001 when coherence is decreasing from one frame to another. Equation 19 may represent a peak and hold process that may provide an estimate of the best coherence at any one frequency bin.

The minimum coherence may be tracked in time by approximately reversing the value as expressed in Equation 20 min min min Equation 20 

In Equation 20 may be programmed to a high value of about 0.1 when coherence is decreasing from one frame to another and may be programmed to a low value of about 0.001 when coherence is increasing from one frame to another. The estimate may provide an accurate estimate of the coherence of the noise at one or more frequency bins. Due to variation of some inputs and the effects of wind which may be incoherent coherence maximums and minimums lower than about 450 Hz may be increased so that the normalized coherence is more robust.

A normalized coherence may be programmed by subtracting the minimum coherence from the smoothed coherence and dividing by the difference between the maximum and minimum coherence at that particular bin as shown in Equation 21 

The mixing device and the post processing device may enhance a signal that has a good signal to noise ratio and is coherent. Signals may be present that have a good signal to noise ratio but may not have good coherence levels because wind may be affecting one input. Similarly signals may be present that may have poor signal to noise ratios but which may exhibit good coherence levels. The mixing system may enhance a signal having a low signal to noise ratio that nevertheless has good coherence but may not unnecessarily attenuate a signal having a good signal to noise ratio.

The coherence over estimation device or process may account for these conditions. A threshold value corresponding to a good signal to noise ratio may be programmed to a predetermined value for example about 12 dB or about four times the magnitude. The coherence level in bins having a signal to noise ratio above the threshold value may be overestimated to the extent that the signal to noise ratio exceeds four times the magnitude. For example if a harmonic at about 1000 Hz has a signal to noise ratio of about 18 dB 8 the over estimation factor may be given by Equation 22 

The value of the over estimation factor may be clamped to between about 1 and a maximum allowable over estimation factor of about 4 . The smoothed and normalized coherence may be over estimated based on Equation 23 scalednorm Equation 23 where the result may be clamped to between about 0 and about 1. Thus the exemplary coherence of a signal having a signal to noise ratio of about 18 dB may be over estimated by a factor of about 8 4 or about twice its estimated value.

If coherence is very low such as between about 0 and about 0.1 then multiplying by a factor of two 2 may result in a significant attenuation. However if the coherence is about 0.5 then its associated higher signal to noise ratio may prevent excess attenuation. If the signal to noise ratio is very low such as about 6 dB which may represent the edge of the noise a high coherence may leave the value untouched while suppressing the noise around it by about 6 dB which may provide an apparent 12 dB signal to noise ratio to a downstream noise suppressor or noise suppression process. Thus the mixing system may enhance a highly coherent signal that stands above the background of incoherent and coherent noise but that nevertheless may have a low signal to noise ratio.

The coherence based attenuation device may use the scaled smoothed and normalized coherence to apply an attenuation factor. The attenuation factor may be applied to the mixed output M Re and M Im . The attenuation level may be a smooth function of the coherence based on Equation 24 Atten 1 0

In Equations 25 and 26 C max may range from about 0.8 to about 1 for example about 1 C min may range from about 0 to about 0.7 for example about 0.3 and Catten may range from about 0.707 3 dB to about 0.25 12 dB for example about 0.5 or 6 dB .

The attenuation asymptotes at about 1 where coherence has a value equal to about Cmax and may fall off smoothly to a value of Catten when coherence has a value equal to about Cmin. The final attenuation to the complex mixed values may be based on Equations 27 28 Atten Equation 27 Atten Equation 28 

The logic devices circuitry and processing described above may be encoded in a computer readable medium such as a CDROM disk flash memory RAM or ROM an electromagnetic signal or other machine readable medium as instructions for execution by a processor. Alternatively or additionally the logic may be implemented as analog or digital logic using hardware such as one or more integrated circuits including amplifiers adders delays and filters or one or more processors executing amplification adding delaying and or filtering instructions or in software in an application programming interface API or in a Dynamic Link Library DLL functions available in a shared memory or defined as local or remote procedure calls or as a combination of hardware and software.

The logic may be represented in e.g. stored on or in a computer readable medium machine readable medium propagated signal medium and or signal bearing medium. The media may comprise any device that contains stores communicates propagates or transports executable instructions for use by or in connection with an instruction executable system apparatus or device. The machine readable medium may selectively be but is not limited to an electronic magnetic optical electromagnetic or infrared signal or a semiconductor system apparatus device or propagation medium. A non exhaustive list of examples of a machine readable medium includes a magnetic or optical disk a volatile memory such as a Random Access Memory RAM a Read Only Memory ROM an Erasable Programmable Read Only Memory i.e. EPROM or Flash memory or an optical fiber. A machine readable medium may also include a tangible medium upon which executable instructions are printed as the logic may be electronically stored as an image or in another format e.g. through an optical scan then compiled and or interpreted or otherwise processed. The processed medium may then be stored in a computer and or machine memory.

The systems may include additional or different logic. A controller may be implemented as a microprocessor microcontroller application specific integrated circuit ASIC discrete logic or a combination of other types of circuits or logic. Similarly memories may be DRAM SRAM Flash or other types of memory. Parameters e.g. conditions and thresholds and other data structures may be separately stored and managed may be incorporated into a single memory or database or may be logically and physically organized in many different ways. Programs and instruction sets may be parts of a single program separate programs or distributed across several memories and processors. The systems may be included in a wide variety of electronic devices including a cellular phone a headset a hands free set a speakerphone communication interface or an infotainment system.

While various embodiments of the invention have been described it will be apparent to those of ordinary skill in the art that many more embodiments and implementations are possible within the scope of the invention. Accordingly the invention is not to be restricted except in light of the attached claims and their equivalents.

