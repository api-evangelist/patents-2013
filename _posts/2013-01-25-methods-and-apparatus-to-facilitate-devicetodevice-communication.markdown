---

title: Methods and apparatus to facilitate device-to-device communication
abstract: Methods and apparatus to facilitate device-to-device communication with a remote device registered with a communication network are described. One example method may include obtaining an identity information of the second device from an address book, submitting the identity information of the second device to a communication network, estimating device-to-device (D2D) proximity of the second device, generating an indication of the proximity of the second device relative to the first device, and initiating a device-to-device communication session with the second device when the indication is that the second device is proximate.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09094050&OS=09094050&RS=09094050
owner: BlackBerry Limited
number: 09094050
owner_city: Waterloo, Ontario
owner_country: CA
publication_date: 20130125
---
This disclosure relates generally to mobile communications and more particularly to methods and apparatus to facilitate device to device communication.

Device to device D2D communication enables two mobile communication devices to directly connect with one another. The facilitation of device discovery and link establishment in D2D communication systems is important to a functional D2D communication system.

Described herein are example methods apparatus and articles of manufacture to facilitate device to device communication between a first device and a second device. In order for it to be possible to communicate directly two devices must be within a certain distance of each other the distance depending on factors including transmission power antenna gains and carrier frequency. When two devices are able to establish a direct link they will be referred to herein as device to device proximate D2D proximate or in or within D2D proximity of each other. An estimate of the geographic proximity distance between the two devices can be used for example to estimate whether the devices are D2D proximate prior to testing or confirming whether they actually are D2D proximate. Two devices that are either estimated to be D2D proximate or confirmed to be D2D proximate will simply be referred to as proximate herein.

One example method to facilitate device to device communication between a first device and a second device includes obtaining an identity information of the second device from an address book submitting the identity information of the second device to a communication network estimating D2D proximity of the second device generating an indication of the proximity of the second device relative to the first device and initiating a device to device communication session with the second device when the indication is that the second device is proximate.

In one example estimating D2D proximity of the second device is based on received location information of the second device. The location information of the second device may be received from the second device in response to a Geolocation Pull request or received in a Geolocation Push message. The location information of the second device may also be received from a presence server.

Estimating D2D proximity of the second device may include determining a tracking area of the second device or determining a registration status of the second device. The indication of the proximity may be displayed using for example an indication in an address book. The proximity of the second device may be included in presence information of the first device and sent to a presence server.

The method may also include testing a device to device connection prior to initiating the device to device communication session. The method may also include generating a D2D proximity information element based on testing the device to device connection and including the D2D proximity information element in a presence information element of the first device.

The method may also include utilizing an alternate communication technology to communicate with the second device when the second device is not proximate. Additionally the method may include evaluating a link quality of the device to device communication session and modifying the device to device communication session based on the link quality.

In one example described herein a mobile device may be configured to facilitate device to device communication between a first device and a second device. The mobile device may include a processor configured to obtain an identity information of the second device from an address book submit the identity information of the second device to a communication network estimate D2D proximity of the second device generate an indication of the proximity of the second device relative to the first device and initiate a device to device communication session with the second device when the indication is that the second device is proximate.

In one example the processor may be configured to send a Session Initiation SIP INVITE message to the second device. The processor may also be configured to send Session Description Protocol SDP information to the second device containing SDP extensions for a SIP preconditions framework. In one example the SDP extensions include a precondition that a direct link is confirmed.

Also described herein is a tangible computer readable storage medium including instructions that when executed cause a machine to for example obtain an identity information of the second device from an address book submit the identity information of the second device to a communication network estimate D2D proximity of the second device generate an indication of the proximity of the second device relative to the first device and initiate a device to device communication session with the second device when the indication is that the second device is proximate.

The tangible computer readable storage medium may also include instructions that when executed cause a machine to send a Session Initiation SIP INVITE message to the second device and to send Session Description Protocol SDP information to the second device containing SDP extensions for a SIP preconditions framework. In one example the SDP extensions include a precondition that a direct link is confirmed.

Shown in is a block diagram of an example communication system implemented as described herein to facilitate device to device D2D communication. D2D is a direct connection between two mobile devices. According to an illustrated example first and second user equipment UE may communicate with one or more wireless communication networks in addition to the wireless link between the devices. For example the UE may communicate with a first evolved node B eNB and the UE may communication with a second eNB . These connections may be made through a long term evolution LTE network one example of which is shown as Evolved Universal Terrestrial Radio Access Network E UTRAN . Alternatively other access networks may be used such as networks that are not third generation partnership project non 3GPP access networks GSM EDGE Radio Access Networks UTRAN WiFi etc.

As shown in the first eNB is coupled to a first mobility management entity MME which is further coupled to a first serving gateway S GW . The first S GW is coupled to a first packet data network gateway PDN GW . Similarly the second eNB is coupled to a second mobility management entity MME which is further coupled to a second serving gateway S GW . The second S GW is coupled to a second packet data network gateway PDN GW . The first PDN GW is coupled to a policy and charging rules function PCRF . The first and second PDN GWs are coupled to an Internet protocol multimedia subsystem IMS which includes a proxy call state control function P CSCF . The IMS is also coupled to a session initiation protocol SIP application server . The second PDN GW is also coupled to a PCRF .

As shown in one example in the UE includes a visual display a keyboard and perhaps one or more auxiliary user interfaces UI each of which is coupled to a controller . The controller is also coupled to a radio frequency RF transceiver circuitry which is further coupled to an antenna . In one example the controller is implemented using a central processing unit CPU that runs operating system software and other software stored in a memory . The controller will normally control overall operation of UE whereas signal processing operations associated with communication functions are typically performed by the RF transceiver circuitry . The controller interfaces with the display to present received information stored information user inputs and the like.

The example controller includes a D2D facilitator that facilitates device to device communication as described below. For example in addition to other functionality the D2D facilitator may determine proximity of another UE such as the UE and facilitate establishment of a device to device link between the UE and the UE . Example methods and apparatus to implement the D2D facilitator are described below in conjunction with the figures. Additionally the example controller may include enhanced address book EAB functionality in which contact data is enhanced with presence and service capabilities information associated with other devices e.g. the UE . The concept of the EAB is part of the rich communication suite RCS which is a GSM association GSMA effort focused on exploiting a richer set of communication services in addition to voice that can harness the benefits of IMS. These services include Instant Messaging Video and Image Share Video Calling etc. The user interface entry point for these services in the UE is the EAB. Coded instructions to implement the D2D facilitator and the EAB may be stored in the memory . As described herein D2D capabilities are included into the EAB of RCS so that devices can launch D2D Communications from the EAB. Location information can also be enhanced or supplemented with location information from D2D.

The keyboard which may be a telephone type keypad or full alphanumeric keyboard is normally provided for entering data for storage in the UE information for transmission to the network. Such data may include a telephone number to place a telephone call commands to be executed on the UE and possibly other or different user inputs.

The UE sends communication signals to and receives communication signals from the eNB over a wireless link via the antenna . The RF transceiver circuitry performs for example modulation demodulation encoding decoding and encryption decryption. The RF transceiver circuitry is adapted to particular wireless network or networks in which UE may operate.

The UE further includes a battery interface to receive one or more rechargeable batteries not shown that provide power to electrical circuitry in UE . The battery interface provides for a mechanical and electrical connection for the battery. The battery interface is coupled to a regulator that regulates power V to the device. When the UE is operational an RF transmitter of the RF transceiver circuitry is typically keyed or turned on only when it is sending information to the network and is otherwise turned off to conserve resources. Similarly an RF receiver of the RF transceiver circuitry is typically periodically turned off to conserve power until it is needed to receive signals or information if at all during designated time periods.

The UE operates using a Subscriber Identity Module SIM not shown that is connected to or inserted in the UE at a SIM interface . Without the SIM the UE may be referred to as mobile equipment ME . The SIM is one type of a removable memory module or smart card used to identify an end user of UE or subscriber and to personalize the device among other things. Without the SIM the example UE is not fully operational for communication. By inserting the SIM into the UE an end user can have access to any and all of his her subscribed services.

The SIM generally includes a processor and memory for storing information. Because the SIM is coupled to the SIM interface it is coupled to the controller through communication lines . To identify the subscriber the SIM contains some user parameters such as an International Mobile Subscriber Identity IMSI . An advantage of using the SIM is that end users are not necessarily bound by any single physical mobile station because the SIM may be used in any number of different mobile stations. The SIM may store additional user information for the UE as well including datebook or calendar information recent call information and network connection information or EAB information.

The UE may be a single unit such as a data communication device a cellular telephone a multiple function communication device with data e.g. electronic mail internet access personal information management etc. and voice communication capabilities a personal digital assistant PDA enabled for wireless communication or a computer incorporating an internal modem such as a laptop notebook or tablet. Alternatively the DE may be a multiple module unit comprising a plurality of separate components including but in no way limited to a computer or other device connected to a wireless modem. In particular for example in the mobile station block diagram of the RF transceiver circuitry and antenna may be implemented as a radio modem unit that may be inserted into a port on a laptop computer. In this case the laptop computer would include the display keyboard one or more auxiliary UIs and the controller may be the computer s CPU. A computer or other equipment not normally capable of wireless communication may be adapted to connect to and effectively assume control of the RF transceiver circuitry and the antenna of a single unit device such as one of those described above.

The eNB is hardware and software that directly communicates with the UE via a wireless link. In one example the eNB includes functionality to facilitate message exchange with the UE but the eNB is controlled by other elements in the communication network.

The S GW communicates with the eNB to route data packets between the network and the eNB . For example the S GW manages downlink paths and paging and may also store the context e.g. bearer service parameters network internal routing information etc. of the UE .

The PDN GW provides connectivity from the UE to the IMS or any other external packet data networks. The PDN GW functions as the point of exit and entry of traffic for the UE .

The PCRF is a node in an evolved packet core EPC that receives session description protocol SDP information from the IMS and applies policy to allocated bearers. Bearers may be dedicated or default bearers.

The IMS is an architectural framework for delivering Internet protocol IP multimedia services which may include the P CSCF. The IMS offers Internet services using cellular technologies. The IMS framework enables QoS Quality of Service charging and the integration of different services to the UEs . The P CSCF is a session initiation protocol SIP proxy that is the entry point to the core network for all SIP signaling from the UEs in the IMS . SIP is a signaling protocol used to setup IP communication sessions such as video or voice calls.

The SIP application server may include any number of different SIP applications that may be used to perform different functions. In one example the SIP application server may receive SIP messages and obtain SDP information from the SIP messages. The SDP information may then be passed to other components in the network.

In the following examples the processes represented by each communication flow or flowchart may be implemented by one or more programs comprising machine readable instructions for execution by a a processor such as the microprocessor shown in the example computer system discussed below in connection with b a controller such as the controller of and or c any other suitable device. The one or more programs may be embodied in software stored on a tangible medium such as for example a flash memory a CD ROM a floppy disk a hard drive a DVD or a memory associated with the processor but the entire program or programs and or portions thereof could alternatively be executed by a device other than the microprocessor and or embodied in firmware or dedicated hardware e.g. implemented by an application specific integrated circuit ASIC a programmable logic device PLD a field programmable logic device FPLD discrete logic etc. . For example any one some or all of the example mobile communications system components could be implemented by any combination of software hardware and or firmware. Also some or all of the processes represented by the flowcharts may be implemented manually.

Further although the example processes are described with reference to flowcharts many other techniques for implementing the example methods and apparatus described herein may alternatively be used. For example the UE and UE may communicate with a same eNB. For example with reference to the flowcharts the order of execution of the blocks may be changed and or some of the blocks described may be changed eliminated combined and or subdivided into multiple blocks. Any of the described blocks may be implemented as part of an existing system. While the example block diagrams are described as implementing the processes of the flowcharts the apparatus of the block diagrams may implement any process and likewise the processes of the flowcharts may be implemented by any apparatus device system software or combination thereof.

Determining as used herein may be any type of process for identifying a particular result and is not limited to a computational or analysis process. For example determining may involve reading an indicator flag register variable identifier etc. to determine whether a service is supported. In another example determining may involve querying extracting computing calculating etc. to determine a result.

As shown in the UE exchanges location information with capable devices block . The location information may be global navigation satellite system GNSS information such as global positioning system GPS information. In some examples location information may be determined using the secure user plane location SUPL protocol developed by the Open Mobile Alliance OMA . The UE may use SUPL to send assistance and positioning data over traffic channels using a secure IP connection between the UE which is acting as a SUPL enabled terminal SET and a SUPL Location Platform SLP on the network side. In one example SUPL 2.0 supports the trigger of location measurement by the network or the SET based on user location. When a user enters or leaves a target geographic area or a particular network area location area or cell for example a position event can be triggered.

In Rich Communication Suite RCS 5.0 SUPL supports the transfer of geolocation information either as part of Social Presence Information SPI or Geolocation PUSH and Geolocation PULL. Social Presence Information is information that users share with contacts such as status availability geolocation service capabilities etc. Geolocation PUSH and PULL can be supported without a Presence Server. Using Geolocation PUSH a user could push their current location or a meeting place etc. Using Geolocation PUSH the RCS client sends a Session Initiation Protocol SIP INVITE that contains Session Description Protocol SDP parameters indicating an offer to have a Message Session Relay Protocol MSRP session. In RCS MSRP is used for file transfer as well as instant messaging and image share and the purpose of the SIP session in this case is to transfer a file that includes the user location to the other party. Geolocation PULL uses OneAPI which is a set of application programming interfaces supported by the GSM Association. Geolocation PULL relies on SMS.

After location information is exchanged block the UE estimates D2D proximity of a target device e.g. the UE block and determines if the UE is proximate to the UE block . The identity information of the target device may be obtained from an address book stored in and maintained by the UE . Proximity may be estimated using a number of different techniques. Geographical proximity physical distance between two devices and D2D proximity are highly correlated which allows the radio based D2D proximity indication to give users a fairly reliable indication if a contact is physically close to the user. However geographical proximity and D2D proximity are different in that the D2D proximity is an indicator of radio signal detection capability which is affected by the transmitter configuration the receiver configuration and the radio channel between the transmitter and receiver.

When two devices are geographically far apart e.g. two different cities then they are not in D2D proximity. When two devices are geographically close two devices may or may not be in D2D proximity. For example if two users are in two adjacent rooms separated by a thick wall their devices may not be able to detect each other s signal due to the high attenuation of the signal by the wall. For example let the UE be the discovering device i.e. trying to detect the signal of UE and UE be the discoverable device i.e. transmitting radio signals to allow others to detect it . An example process to determine D2D proximity Pwith geographical distance d as input can be summarized as follows 

Here Dis the maximum distance where radio based D2D proximity detection is possible. Dmay vary as a function of factors such as carrier frequency of the radio signal the type of environment the devices are in etc. In one example Dcan be estimated using the minimum signal power level detectable by the UE the maximum transmission power of UE and the assumption of free space propagation. The geolocation information available in the RCS architecture makes it easier to enable D2D service by providing an estimate of d.

The UE may indicate through a user interface information based on location as to whether or not it is likely to be in D2D proximity with another device or an estimate of D2D proximity. For example the estimate might simply be a flag with value of 1 if the estimate is that the devices are in D2D proximity and 0 otherwise. The information can be an estimate prior to testing a D2D link. This estimated D2D proximity may be shown in the EAB and shared as part of presence information. If D2D proximity is subsequently confirmed then this confirmed D2D proximity might be shown in the EAB. The confirmed D2D proximity might also be included in presence information. For example the UE can use the free space propagation model to choose the value of D. In this case the received power level at distance d is 

While the free space propagation model is simple the destimation can be much greater than the realistic maximum distance because the free space model does not account for the myriad degradations from which the realistic channel suffers. Thus the destimation can be improved by using more sophisticated models to provide D. For example path loss exponents of the specific propagation environment the device is in can be used instead of the path loss exponent 2 of the free space model. For instance if the device is obstructed by a building a path loss exponent of between 4 and 6 might be used resulting in a smaller Dvalue.

While the current RCS specification provides geolocation information in two dimensional x y coordinates this information may not be sufficient for D2D proximity estimation purposes since the D2D link is likely to have limited range. For example if the UE is located at the first floor of a building and the UE is at the 10th floor of the same building their x y coordinates may show that they are close to each other on a flat 2 D map but their difference in altitude prevents them from establishing any D2D link. In the future the RCS specification may need to define 3 D geolocation information x y z . Such 3 D geolocation information can be used by the devices to more accurately estimate the distance for the possibility of D2D communication. The description herein makes reference to two dimensional coordinates x y however it is to be understood that this may be expanded to include 3 D geolocation information x y z .

The UE can compare the coordinates of UE with its own coordinates. The comparison gives a distance estimate of UE and UE . The UE can then compare the distance estimate with the D2D link range of UE and generate a likelihood indicator if UE and UE are sufficiently close to establish D2D link. The D2D link range may be different depending on which type of D2D service is being considered for example D2D discovery service is likely to have longer range compared to D2D communication services.

If the UE determines that the UE is proximate block the UE generates and displays a proximity indication block . The UE may provide the proximity indication via a user interface such as for example an indication in the EAB or in any other suitable manner. The indication in the EAB may be based for example on a calculated estimate compared to a threshold as described above. The proximity information may also be included in presence information and exchanged with a presence server.

The UE then initiates a D2D session with the UE block and determines if the D2D link between the UE and the UE was successful block . Further details regarding the initiation of the D2D session are provided below. If the link was successful the UE and the UE continue with a D2D session.

If the UE determines that the UE is not proximate block the UE generates the corresponding proximity information element and displays the proximity indication block in for example the EAB. Alternatively the UE may not display a proximity indication for an unsuccessful D2D session and only successful D2D sessions lead to a proximity indication display. Additionally an alternate communication technology may be used to communicate between the DE and the UE block . For example an alternate communication technology such as cellular technology may be used to facilitate a connection between the UE and the UE rather than a direct link between UE and UE .

As explained below the PCRF monitors the SDP and allocates the appropriate network resources. After resources are allocated the UE and the UE can test a D2D link In one example the DE may transmit a beacon or signature signal that UE can detect. Information about this beacon or signature signal can be included in a new SIP header an existing SIP header with a new parameter the SDP included in the SIP invite or provided by the eNB s at the radio access level.

Resource reservation with D2D may involve the network assigning the physical channel for the UEs to communicate. In the case of LTE it would involve the eNB assigning the resources which might include one or more physical channels or dedicated radio bearers and it may also involve the UEs testing the link to see if communication is successful.

As shown in the SIP messaging shown in and described in detail below goes through the P CSCF which is a SIP proxy that is the entry point into the IMS core network for the IMS messages from the UE . The P CSCF inspects all of the SIP signaling and sends the SDP information that is contained inside the SIP messages to the PCRF . This information is used to set up the dedicated bearer s that are needed for the session. The Quality of Service QoS parameters for a particular bearer are derived from the SDP information since the SDP establishes the codecs used and associated bitrates. The PCRF then sends messaging to the PDN Gateway the PDN Gateway sends messaging to the Serving Gateway the Serving Gateway sends messaging to MME the MME then sends a setup message to the eNB and finally a radio bearer with the appropriate QoS is established with the UE . Then responses go from the UE all the way back to the PCRF . The goal of this messaging is that a radio bearer and EPC bearer with the appropriate QoS are established.

In one example SIP preconditions may be used with the SIP messaging as shown in . The SDP in the SIP messaging includes an indication that a D2D link is to be established between the devices. Therefore different SDP messaging is used to indicate this situation. In an SDP Offer1 from the UE to the UE may take the form shown in . In the SDP Offer1 of three audio codecs are offered . The last two lines of the SDP indicate preconditions. For example as shown in indicates that no D2D link is currently established and indicates a precondition that a D2D link is to be established. The precondition of indicates that no media session can take place until a D2D link is established in both the send and receive direction at the UE . In the example of UE and UE are likely on the same network because they are in D2D range. Accordingly there may be no need for remote and local identifiers. In the case of D2D the messaging sequence in which originates at the PCRF and goes to the UE and all the way back to the PCRF would indicate that a D2D link is to be established. This may result in the fact that no dedicated EPC bearers are established because for D2D only a radio bearer that corresponds to the appropriate QoS is needed in addition to the default bearer.

An SDP Answer1 from the UE to the UE may be as shown in . The SDP Answer1 may be sent in a SIP response Session Progress . The SDP Answer1 includes a list of all offered codecs that are supported by the UE . The SDP Answer1 also includes an indication that currently there is no D2D link established and also includes a response that D2D is mandatory because the UE has agreed to the D2D connection.

An SDP Offer2 from the UE to the UE may be as shown in . The SDP Offer2 may be sent in the acknowledgment of the provisional response or PRACK SIP request. In the SDP Offer2 the UE indicates selection of AMR WB as the codec to be used in the session . Additionally the SDP Offer2 includes an indication that no D2D session is currently operating and that a D2D session is mandatory . The codec for the session is known and therefore the resource reservation process can begin.

When the UE receives the second SDP offer inside the SIP PRACK request the UE knows that AMR WB is to be used for the session. SDP offers and answers are not necessarily coupled with SIP requests and responses. However in the case of D2D both UEs and only need a single send and receive direction for each dedicated bearer instead of one send and receive for UE and a separate send and receive radio bearer for UE . Therefore the PCRF either does not initiate the same messaging for UE as for UE which may be determined by the SIP messaging or the PCRF correlates the two message streams so that there are not independent sets of radio bearers established. Accordingly in SIP responses and D2D preconditions in the SDP messaging from the eNB and possibly may just indicate which physical channel is to be used to send information between the UEs and and not reconfigure the RRC connection for data payload between UE and eNB.

The SDP Answer2 from the UE to the UE may be as shown in . The SDP Answer2 includes the agreed upon codec . The SDP Answer2 also includes an indication that currently there is no D2D link established and also includes a response that D2D is mandatory because the UE has agreed to the D2D connection.

At this point the D2D link can be tested. Resources for a D2D link have been assigned by the eNB and communicated to the UE and the UE . The UE might test the link with UE and vice versa. Once the link has been tested and found to be successful the SIP UPDATE message with SDP Offer3 is sent from the UE . This informs the network of the status of communication. One example of an SDP Offer3 message is shown in . One difference between the SDP Offer3 and the SDP Offer2 is that the UE client indicates that now the current status is that resources have been successfully reserved in the send and receive direction .

When the UE receives the SDP Offer3 the UE replies with an SDP Answer3 in the SIP OK response to the SIP UPDATE request confirming that resources have been established. In one example the SDP Answer3 may be as shown in . As shown in SIP preconditions have now been satisfied. Resources have been successfully reserved in both directions between the UE and the UE and at this point the UE will start ringing .

During the forgoing process it is possible that the D2D link cannot successfully be established or can be established for one media type but not another. A further indication in the SDP might indicate that if any of the media types cannot be established via a D2D link that none of the media types should be conducted over D2D or whether it is OK to allow some via D2D. Also because a D2D link might not be established then there may be an indication in the messaging of to establish EPC bearers until the D2D link is established in case the D2D link fails. If the SDP precondition line indicates optional instead of mandatory then possibly the dedicated EPC bearer can be set up as in . Of course if D2D is mandatory then there is no need to have an EPC bearer because this indicates that the client does not want to establish a non D2D communication session which may include text voice video file transfer etc.

If when testing the D2D link the UE determines that communication quality would not be acceptable the UE could send a SIP Cancel for the outstanding SIP Invite. Likewise the UE could reject the invite with an error message that indicates that the D2D link quality is not acceptable. Both the UE and the UE can monitor the link quality during the call. If the quality is not at a sufficient level either the UE or the UE might issue a SIP re INVITE that proposes continuing the call using a non D2D radio link for example ordinary LTE. All SIP signaling traverses the IMS network and is not sent directly between devices so that resources and QoS can be allocated. Additionally other actions may be taken to modify a device to device communication session based on link quality. For example modifications may include changing the type of application text audio video file that can communicate over the D2D link and or changing the configuration of the D2D communication session and or terminating the D2D session when link quality deteriorates.

In the solution described above the UE does not test the D2D link by for example transmitting a beacon or signature at the physical layer until the UE is ready to initiate a session. The advantage of this approach is that this is more battery friendly than if the UE is constantly sending a beacon signal so that other contacts may discover if the UE is in proximity in the event that they want to establish a D2D connection with the UE . There is also limited messaging and less use of network resources than if all users periodically transmit a beacon signal.

As shown in the UE exchanges location information with capable devices block . As explained above the location information may be GNSS information such as GPS information or any other suitable information. After location information is exchanged block the UE estimates D2D proximity of a target device e.g. the UE block and determines if the UE is proximate the UE block . As explained above the identity information of the target device may be obtained from an address book stored in and maintained by the UE . As explained above D2D proximity may be estimated using a number of different techniques. If the UE determines that the UE is proximate block the UE generates a proximity information element and displays a proximity indication block . The UE may provide the proximity indication via a user interface for example an indication in the EAB or in any other suitable manner.

The UE then tests the D2D link with one or more devices e.g. the UE block . In some examples the UE may test the D2D link by trying to establish a D2D session with the UE without the users of the UEs being aware of such an operation. For example the UE may initiate a D2D session with the UE and once that D2D session is established the UE may suspend to tear down the link but at that point the DE knows that the link to the UE was successfully tested.

If the test of the D2D link was successful block UE can initiate a D2D session with the UE block . This session may be initiated some time after the testing block . Regardless of the timing it is the case that the D2D link is tested prior to the D2D session being initiated for use by the UE .

Alternatively if the test block was not successful block an indication is made in for example the EAB or any other suitable location that an alternate communication channel should be used to communicate with the UE block .

If an estimation indicates that there is a high probability of successfully establishing a D2D link between the UE and the UE for example if the estimate of D2D proximity is a flag and has value 1 additional testing can be carried out to confirm D2D proximity as shown in . The process of can be carried out either automatically or upon request of the user. The D2D proximity status once confirmed and generated can be displayed in the EAB.

As shown in the UE determines a list of D2D capable devices that are proximate. For example assuming the UE has opted to be discoverable the UE device periodically broadcasts its signature radio signal. How the signature is sent is configurable. In one example the transmission power may be configured by the base station such that interference to other users is limited. The transmission power can also vary in a predefined pattern e.g. starting with a low power and gradually increase the power till a predefined maximum is reached. In another example the transmission is configured to be more frequent if the D2D service is manually triggered by the user and configured to be less frequent if the D2D service is running automatically. The transmission frequency can also be configured by the eNB and e.g. less frequent if the cell load is high and more frequent if the cell load is low.

Using 3GPP LTE as an example the process of establishing a D2D link with network assistance is described below. When the UE is in RRC CONNECTED state whether DRX or not the eNB configures how the UE transmits the signature signal including the time frequency resources and signal format. When the UE is in RRC IDLE state NAS signaling configures how the UE transmits the signature signal.

After the list of D2D capable devices is determined block the UE determines the MME of each capable device block . For example the UE may contact the MME with a list of contact IDs such as the list of addresses that are stored in the UE e.g. SIP URI . Accordingly the UE may submit the identity information for one or more target devices to a communication network of which the MME is a part. The MME determines the MME to which each contact is currently connected block . For example the MME may contact a home subscriber service HSS to determine that that UE is connected to the MME . A HSS is a master user database in the 3GPP network that contains subscription related information.

Each contact in the contact list e.g. each contact in the list of capable devices is tested to see if it is in a distinct tracking area from the UE block . If the UE for example is in a distinct tracking area block the UE will be indicated as not proximate block and the next capable device is selected for evaluation block . For example the test may be to determine if the UE is in a non adjacent non overlapping tracking area from that of the UE . As an additional example that test may include determining if the UE and the UE are served by two different MMEs. If this is the case the MME may contact the MME to obtain information regarding the UE connection status tracking area and which eNB the UE is connected to if the UE is in RRC CONNECTED state . If the UE and the UE are served by the same MME then information for the UE does not need to be fetched from another MME.

The process of then determines if each capable device e.g. the UE is in an EMM DEREGISTERED state block . If the UE is in the EMM DEREGISTERED state the UE is considered not in proximity of the UE block .

If the capable device is not in a distinct tracking area block and the capable device is not deregistered block the UE determines if a signal can be received from the UE block . For example if the UE is in an EMM REGISTERED state then if the UE is in RRC IDLE mode the MME is aware of the signature of the UE signal transmission and provides such info to the MME which passes this information to the UE via NAS signaling. The UE scans to see if the radio signal from the UE can be received. If the UE is in RRC CONNECTED state the MME contacts eNB . If the UE and the UE are attached to the same eNB that eNB provides the UE with the signature signal information for UE . The UE scans accordingly to see if the radio signal for UE can be received. If UE and the UE are served by two different eNBs e.g. and and an X2 interface exists between the eNBs the MME notifies eNB to give eNB the signature signal configuration of the UE . After obtaining such information from eNB eNB passes the information to the UE . The UE scans accordingly to see if the radio signal of UE can be received by the UE . If the UE cannot receive signals from the UE block the DE is indicated as not proximate block .

After all the capable devices have been evaluated for proximity as described above a final list of proximate devices is sent to a presence server block . Additionally the DE device generates a proximity information element and displays an in proximity marking on the user interface of the UE for each contact in the final list. Contacts not in the final list are either marked as not in proximity or left unmarked. If the UE becomes dormant DRX then the UE wakes up during DRX on duration to scan if any discoverable contacts are in proximity.

The proximity display does not apply to anonymous fetch from presence server to protect privacy. In other words only authorized users that have been granted the privilege to receive the in proximity information will be notified of such information. An unauthorized user is not able to detect that the UE is in proximity or that the UE and the UE are in proximity of each other.

As shown in when the UE discovers a contact e.g. UE is in proximity e.g. through display of a proximity indication block the UE may receive instruction to send a message to a target device e.g. a particular device in proximity block . The instructions may be provided to the mobile equipment through a user interface on the UE .

The UE sends a SIP invite via IMS core to the target device e.g. the UE to set up a D2D connection and negotiate the parameters for the D2D link block .

The UE evaluates the of D2D link block . If the quality of the D2D link is satisfactory for the service requested block a D2D session is initiated as a result of the negotiation block . The D2D link can be used for example for MSRP RTP transport of messaging video audio or file transfer between the UE and the UE without going through the base station or gateway . If the quality of the D2D link is not satisfactory for the service requested block an alternate communication technology can be selected for communication between the UE and the UE . For example the service packets traverse the base stations and gateways as described above.

If the link attributes change and it is determined that communication quality would not be acceptable actions may be taken to modify a device to device communication session based on link quality. For example modifications may include changing the type of application text audio video file that can be run over the D2D link and or changing the configuration of the D2D communication session and or terminating the D2D session when link quality deteriorates.

The architecture is changed compared to existing architecture. SIP signaling is exchanged via the network to set up the call. The SIP servers make sure that the connection is allowed QoS is satisfied and is properly charged. But actual service packets e.g. message video file transfer are delivered directly between devices.

Once a D2D link is established the service packets are sent from the UE to the UE . When the UE detects that the D2D link is broken then the data connection is routed via eNB so that the service is continued seamlessly to the consumer. Such radio link failure may happen due to mobility of user or link quality deterioration over the D2D link.

As explained herein utilizing D2D communication data is exchanged directly between two UEs or among more than two UEs. One advantage of D2D communication is that the messages transmitted over the D2D link are not stored by the network or distributed to multiple clients. This reduces the network burden while still facilitating communication between UEs. However if resources are assigned by the network for example an eNB then it is possible for the network to listen to D2D communication as a receiver which enables the network to store and forward the messages exchanged over the D2D link to maintain the same multi device experience currently provided by RCS.

According to the RCS specification to handle multiple device environments an incoming message is delivered to all clients of a user that are online and capable of handling the RCS message. If all clients of a user were offline when a message has to be delivered the message will be delivered to the first client that comes online if the message has not expired in the meantime. A client supporting the RCS messaging service will be capable of showing the messages that were sent and received while it was offline. The messages shall remain available to those clients until they are deleted from one of the online clients.

If the same multi device experience needs to be maintained then the eNB needs to listen in on the D2D communication as a receiver. The eNB could then receive and store the messages exchanged over the D2D link for both users involved. The eNB also passes the service packets to the servers so that messages can be delivered to multiple devices of the same user. The eNB might listen to the D2D communication using smart antenna technology knowing the location of the D2D users. Such a service would consume more network resources and therefore might be charged at a higher rate.

The system of the instant example includes a processor such as a general purpose programmable processor an embedded processor a microcontroller etc. The processor includes a local memory and executes coded instructions present in the local memory and or in another memory device. The processor may execute among other things machine readable instructions to implement the processes represented in the drawings described above. The processor may be any type of processing unit such as one or more microprocessors from the Intel Centrino family of microprocessors the Intel Pentium family of microprocessors the Intel Itanium family of microprocessors and or the Intel XScale family of processors one or more microcontrollers from the ARM family of microcontrollers the PIC family of microcontrollers etc. Of course other processors from other families are also appropriate.

The processor is in communication with a main memory including a volatile memory and a non volatile memory via a bus . The volatile memory may be implemented by Static Random Access Memory SRAM Synchronous Dynamic Random Access Memory SDRAM Dynamic Random Access Memory DRAM RAMBUS Dynamic Random Access Memory RDRAM and or any other type of random access memory device. The non volatile memory may be implemented by flash memory and or any other desired type of memory device. Access to the main memory is typically controlled by a memory controller not shown .

The system also includes an interface circuit . The interface circuit may be implemented by any type of interface standard such as an Ethernet interface a universal serial bus USB and or a third generation input output 3GIO interface.

One or more input devices are connected to the interface circuit . The input device s permit a user to enter data and commands into the processor . The input device s can be implemented by for example a keyboard a mouse a touchscreen a track pad a trackball an isopoint and or a voice recognition system.

One or more output devices are also connected to the interface circuit . The output devices can be implemented for example by display devices e.g. a liquid crystal display a cathode ray tube display CRT by a printer and or by speakers. The interface circuit thus typically includes a graphics driver card.

The interface circuit also includes a communication device such as a modem or network interface card to facilitate exchange of data with external computers via a network e.g. an Ethernet connection a digital subscriber line DSL a telephone line coaxial cable a cellular telephone system such as an EGPRS compliant system etc. .

In some examples the system also includes one or more non transitory computer readable mass storage devices for storing software and data. Examples of such mass storage devices include floppy disk drives hard drive disks compact disk drives and digital versatile disk DVD drives.

As an alternative to implementing the methods and or apparatus described herein in a system such as the device of the methods and or apparatus described herein may be embedded in a structure such as a processor and or an ASIC application specific integrated circuit .

The present disclosure may be embodied in other specific forms without departing from its spirit or essential characteristics. The described embodiments are to be considered in all respects only as illustrative and not restrictive. The scope of the disclosure is therefore indicated by the appended claims rather than by the foregoing description. All changes that come within the meaning and range of equivalency of the claims are to be embraced within their scope.

