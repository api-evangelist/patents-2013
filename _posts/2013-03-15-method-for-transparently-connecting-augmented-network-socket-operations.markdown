---

title: Method for transparently connecting augmented network socket operations
abstract: A method at one or more computers having memory and one or more processors includes detecting establishment of a connection between a first process and a second process; determining whether an augmented communications service is available for the connection between the first process and second process; in accordance with a determination that the augmented communications service is available, configuring the connection between the first process and the second process to make use of the augmented communications service with no modification to the executable codes of the first process and the second process; and in accordance with a determination that the augmented communications service is not available, configuring the connection between the first process and the second process to make use of a non-augmented communications service.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09438638&OS=09438638&RS=09438638
owner: SILICON GRAPHICS INTERNATIONAL CORP.
number: 09438638
owner_city: Milpitas
owner_country: US
publication_date: 20130315
---
The use of distributed computing has grown by leaps and bounds. By using multiple connected computers a large amount of computing power can be brought to bear on massive computing tasks.

A bottleneck within a distributed computing system is communications between processes. Typically processes exchange data through the operating system kernel which incurs higher overheads such as locks and protocol processing and thus slow down performance. A way to bypass the operating system kernel is to exchange data through a shared memory space. Use of the shared memory space may be aided by an augmented communications service. The augmented communications service is useful only if the processes that are communicating with each other are using the service and know that the other process is using the service. A process may communicate with many other processes and not all of them use the service. However the processes themselves do not know which process uses the service and which does not. Without awareness of which process uses the service and which doesn t the augment communications service is ineffective.

In accordance with some embodiments a method at one or more computers having memory and one or more processors includes detecting establishment of a connection between a first process and a second process determining whether an augmented communications service is available for the connection between the first process and second process in accordance with a determination that the augmented communications service is available configuring the connection between the first process and the second process to make use of the augmented communications service with no modification to the executable codes of the first process and the second process and in accordance with a determination that the augmented communications service is not available configuring the connection between the first process and the second process to make use of a non augmented communications service.

In accordance with some embodiments a system includes one or more processors memory and one or more programs stored in the memory including instructions executable by the one or more processors to detect establishment of a connection between a first process and a second process determine whether an augmented communications service is available for the connection between the first process and second process in accordance with a determination that the augmented communications service is available configure the connection between the first process and the second process to make use of the augmented communications service with no modification to the executable codes of the first process and the second process and in accordance with a determination that the augmented communications service is not available configure the connection between the first process and the second process to make use of a non augmented communications service.

In accordance with some embodiments a computer readable storage medium storing one or more programs configured for execution by one or more computers with one or more processors and memory the one or more programs comprising instructions to detect establishment of a connection between a first process and a second process determine whether an augmented communications service is available for the connection between the first process and second process in accordance with a determination that the augmented communications service is available configure the connection between the first process and the second process to make use of the augmented communications service with no modification to the executable codes of the first process and the second process and in accordance with a determination that the augmented communications service is not available configure the connection between the first process and the second process to make use of a non augmented communications service.

It will also be understood that although the terms first second etc. may be used herein to describe various elements these elements should not be limited by these terms. These terms are only used to distinguish one element from another. For example a first contact could be termed a second contact and similarly a second contact could be termed a first contact which changing the meaning of the description so long as all occurrences of the first contact are renamed consistently and all occurrences of the second contact are renamed consistently. The first contact and the second contact are both contacts but they are not the same contact.

The terminology used herein is for the purpose of describing particular embodiments only and is not intended to be limiting of the claims. As used in the description of the embodiments and the appended claims the singular forms a an and the are intended to include the plural forms as well unless the context clearly indicates otherwise. It will also be understood that the term and or as used herein refers to and encompasses any and all possible combinations of one or more of the associated listed items. It will be further understood that the terms comprises and or comprising when used in this specification specify the presence of stated features integers steps operations elements and or components but do not preclude the presence or addition of one or more other features integers steps operations elements components and or groups thereof.

As used herein the term if may be construed to mean when or upon or in response to determining or in accordance with a determination or in response to detecting that a stated condition precedent is true depending on the context. Similarly the phrase if it is determined that a stated condition precedent is true or if a stated condition precedent is true or when a stated condition precedent is true may be construed to mean upon determining or in response to determining or in accordance with a determination or upon detecting or in response to detecting that the stated condition precedent is true depending on the context.

Reference will now be made in detail to various embodiments examples of which are illustrated in the accompanying drawings. In the following detailed description numerous specific details are set forth in order to provide a thorough understanding of the invention and the described embodiments. However the invention may be practiced without these specific details. In other instances well known methods procedures components and circuits have not been described in detail so as not to unnecessarily obscure aspects of the embodiments.

In some embodiments distributed computing system operates in a shared memory configuration. The computers in the distributed computer system access a shared memory space . The shared memory space includes physical memory e.g. volatile memory such as random access memory RAM non volatile memory that is physically located at the respective computers the physical memory located at the respective computers are logically grouped together into a shared memory space addressed by the processors at the computers as a single memory space.

Shared memory space is a memory space that is accessible to computers . In some embodiments respective portions not shown of memory in multiple respective computers in the distributed computing system are reserved and logically combined into the shared memory space accessible to the computers in the distributed computing system .

The augmented communications service facilitates augmented e.g. faster inter process communications between processes . In some embodiments the augmented communications service uses the shared memory space to facilitate augmented inter process communications. Inter process communications using the augmented communications service is performed in a user space and thus is faster compared to the same inter process communications done in the kernel space . The augmented communications service is transparent to the applications and processes applications and processes are not modified coded or configured to specifically use the augmented communications service for inter process communication and processes connect with each other using well known methods e.g. socket calls . In other words for a given inter process communication the processes involved do not know if the opposite process is using the augmented communications service and can t determine same. Thus a shim library process acts as an intermediary that sets up the augmented communication service between connecting processes or to fall back to non augmented communications e.g. conventional inter process communications methods such as inter process communications in a kernel space TCP sockets over Ethernet etc. . Other examples of augmented communications include communication over InfiniBand using InfiniBand application programming interfaces.

In some embodiments not all computers in the distributed computing system include the shim library and the augmented communications module . Processes running at computers that do not include the shim library and the augmented communications module are not able to user the augmented communications service. The shim library for a process determines if an opposite process is running at a computer without the augmented communications service and if so sets up a non augmented connection to the process.

Each of the above identified elements may be stored in one or more of the previously mentioned memory devices and corresponds to a set of instructions for performing a function described above. The above identified modules or programs i.e. sets of instructions need not be implemented as separate software programs procedures or modules and thus various subsets of these modules may be combined or otherwise re arranged in various embodiments. In some embodiments memory may store a subset of the modules and data structures identified above. Furthermore memory may store additional modules and data structures not described above.

When process attempts to connect with process and process listens for the connection or vice versa processes of shim libraries and intercept the connection establishment communications between the processes and and mediates the establishment of the connection in order to determine whether the augmented communications service is to be used for the connection. If the augmented communications service is to be used the connection is configured to use the service the inter process communications between process and takes place in the user space e.g. in shared memory space . If the augmented communications service is not to be used the connection is configured to not use the service the inter process communications between process and takes place in the kernel space .

Similarly when process or attempts to connect with process processes of shim libraries or respectively mediate the establishment of the connection in order to determine whether the augmented communications service is to be used for the connection. Processes of shim library or determine that the augmented communications service is not available for process and thus inter process communications between process or and process takes place in the kernel space or by other conventional methods.

The connecting process sends its first data to the listening process which the listening shim library intercepts and forwards to the listening process. The connecting process includes the nonce in the first data if the connecting process had detected and recorded the nonce associated with the connected to port. Otherwise the first data does not include the nonce. If the first data includes the nonce the augmented communications service is used for communications from the connecting process to the listening process. If the first data does not include the nonce conventional inter process communications e.g. communications in kernel space is used for communications from the connecting process to the listening process.

After the listening process receives the first data from the connecting process the listening process sends its first data to the connecting process which the connecting shim library intercepts and forwards to the connecting process. If the first data included the nonce the listening process includes the nonce in the first data . Otherwise the first data does not include the nonce. If the first data includes the nonce the augmented communications service is used for communications from the listening process to the connecting process. If the first data does not include the nonce conventional inter process communications e.g. communications in kernel space is used for communications from the listening process to the connecting process.

In some embodiments if the augmented communications service is not used for either direction of communication connecting process to listening process or listening process to connecting process the augmented communications service is not used for both directions the entire connection becomes a conventional inter process communications connection. For example if the nonce is sent in one direction but not the other the entire connection falls back to being a conventional inter process communications connection.

As illustrated in the connecting process sends its first data and the listening process receives the first data before the listening process sends its first data . If the listening process sends its first data before it receives the connecting process first data the augmented communications service is not used the first data would not include the nonce because the listening process did not receive the nonce from the connecting process in the first data . In some other embodiments the reverse applies the connecting process receives the listening process first data before sending its first data otherwise the augmented communications service is not used .

A process of the shim library enters into an initial Found state when the shim library process detects a socket call e.g. Socket . From the Found state the shim library process intercepts calls from the connecting or listening process. If the shim library process intercepts a connect request from a connecting process the shim library process moves into the Connect state e.g. the connecting shim library process FIG. . If the shim library intercepts a listen call from a listening process for listening for a connection the shim library process moves into the Listen state e.g. the listening shim library process . If the shim library process intercepts a call other than a connect request or a listen call the shim library moves to an Empty state . In the Empty state the augmented communications service is not used and processes proceed conventionally.

From the Connect state if the connecting shim library process intercepts a data send call from the connecting process i.e. the connecting process sends its first data e.g. first data to the listening process the connecting shim library process moves into the Connected Waiting state . As described in above the first data includes the nonce if the connected process detects and records the nonce associated with the connected to port and does not include the nonce if the connected process did not detect the nonce. From the Connect state if the connecting shim library process intercepts a data receive call from the connecting process i.e. the connecting process is receiving the first data e.g. first data from the listening process the connecting shim library process moves into the Empty state the first data does not include the nonce because the listening process has not received the nonce from the connecting process.

From the Connected Waiting state the connecting shim library process intercepts data send calls and data receive calls from the connecting process. If the connecting shim library process intercepts a data send call i.e. the connecting process is sending more data to the listening process after first data the connecting shim library process stays at the Connected Waiting state the additional sent data is held as in flight by the augmented communications service. If the connecting shim library process intercepts a data receive call from the connecting process i.e. the connecting process is receiving data from the listening process and the received data e.g. first data does not include the nonce the connecting shim library process moves into the Connected Drain state where the connecting shim library process configures the connection to use conventional inter process communications and then moves into Empty state the connecting shim library process has determined that the listening process does not use the augmented communications service. Also when in the Connected Drain state any in flight data to the listening process is withdrawn from the augmented communications service and re sent through non augmented communications services e.g. conventional inter process communications methods . If the received data e.g. first data includes the nonce the connecting shim library process moves into the Talking state where the connecting shim library process intercepts data send and receive calls from the connecting process and sends and receives data using the augmented communications service in accordance with the intercepted calls.

From the Listen state when the listening process accepts the connection the listening shim library process moves into Accept state . From the Accept state the listening shim library process moves into different states depending on what the listening shim library process intercepts next. If the listening shim library process intercepts a send call from the listening process the listening shim library process moves into a Receive Waiting state . From the Receive Waiting state if the listening shim library process intercepts further send calls from listening process the listening shim library process remains at the Receive Waiting state . From the Receive Waiting state if the listening shim library process intercepts a data receive call from the listening process the listening shim library process moves to the Empty state .

From the Accept state if the listening shim library process intercepts a data receive call from the listening process i.e. the listening process is receiving the first data from the connecting process and the received data e.g. first data includes the nonce the listening shim library process moves to the Accepted Waiting state . From the Accepted Waiting state if the listening shim library process intercepts further receive calls from the listening process the listening shim library process remains at the Accepted Waiting state . From the Accepted Waiting state if the listening shim library process intercepts a send call from the listening process the listening shim library process moves into the Talking state where the listening shim library process intercepts data send and receive calls from the listening process and sends and receives data using the augmented communications service in accordance with the intercepted calls.

From the Accept state if the received data e.g. first data includes less data than the nonce e.g. the data has less bits than the nonce the listening shim library process moves into the Drain state where the listening shim library process configures the connection to use conventional inter process communications and then moves into Empty state .

From the Accept state if the received data e.g. first data includes more data than or the same amount of data as the nonce e.g. the data has greater than or equal number of bits as the nonce but does not include the nonce the listening shim library process moves to the Empty state .

The computer s detect establishment of a connection between a first process and a second process. For example the connecting and listening shim library processes detect that a connecting and a listening process are establishing a connecting e.g. with connect request and listening call .

The computer s determine whether an augmented communications service is available for the connection between the first process and second process. The connecting and listening shim library processes determine from whether the first data and first data includes the nonce whether the augmented communications service is to be used for the connection.

In accordance with a determination that the augmented communications service is available the computer s configure the connection between the first process and the second process to make use of the augmented communications service with no modification to the executable codes of the first process and the second process. If the determination is that the augmented communications service is to be used for the connection the connection is configured to use the augmented communications service the shim library processes intercept communications from the connecting and listening processes and pass the intercepted communications to the augmented communications module which exchange the communications through the augmented communications service e.g. through shared memory space in user space .

In accordance with a determination that the augmented communications service is not available the computer s configure the connection between the first process and the second process to make use of a non augmented communications service. If the determination is that the augmented communications service is to be used for the connection the connection is configured to use conventional inter process communications e.g. in kernel space .

In some embodiments detecting establishment of a connection between a first process and a second process includes detecting a request from the first process to connect to the second process detecting listening for connection requests by the second process at a port generating the nonce associating the nonce with the port and passing the nonce to the first process. For example the connecting and listening shim library processes detect a connect request from the connecting process and a listening call for connections at a port from the listening process. The listening shim library process generates a nonce and associates the nonce with the port. The nonce is passed to the connecting process after the connect request is accepted.

In some embodiments determining whether an augmented communications service is available for a connection between the first process and second process includes determining whether an initial data sent from the first process to the second process through the connection includes a nonce determining whether an initial data sent from the second process to the first process through the connection includes the nonce in accordance with a determination that the initial data from the first process includes the nonce and a determination that the initial data from the second process includes the nonce determining that the augmented communications service is available and in accordance with a determination that the initial data from the first process does not include the nonce or with a determination that the initial data from the second process does not include the nonce determining that the augmented communications service is not available. For example if both the first data and the first data include the nonce the connection is configured to use the augmented communications service. If either the first data or the first data does not include the nonce the connection is configured to use conventional inter process communications. In some other embodiments if one of the first data or the first data but not the other includes the nonce the connection is configured to use the augmented communications service for the direction of data communication that included the nonce e.g. if first data includes the nonce but first data doesn t then communications from the connecting process to the listening process uses the augmented communications service and communications in the opposite direction uses conventional inter process communications .

In some embodiments the augmented communications service is transparent to the first process and the second process and the non augmented communications service is transparent to the first process and the second process. The connecting process and the listening process when establishing the connection or communicating is unaware whether the augmented communications service is being used or not. The connecting process and the listening process communicate as if conventional inter process communications is being used. The connecting and listening shim library processes intercept the communications and exchange the communications on behalf of the connecting and listening processes through the augmented communications service or conventional inter process communications depending on the determination as described above.

The foregoing description for purpose of explanation has been described with reference to specific embodiments. However the illustrative discussions above are not intended to be exhaustive or to limit the invention to the precise forms disclosed. Many modifications and variations are possible in view of the above teachings. The embodiments were chosen and described in order to best explain the principles of the invention and its practical applications to thereby enable others skilled in the art to best utilize the invention and various embodiments with various modifications as are suited to the particular use contemplated.

