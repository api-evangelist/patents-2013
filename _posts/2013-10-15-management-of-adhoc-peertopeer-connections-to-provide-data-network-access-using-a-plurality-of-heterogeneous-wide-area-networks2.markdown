---

title: Management of ad-hoc peer-to-peer connections to provide data network access using a plurality of heterogeneous wide area networks
abstract: A method includes collecting physical layer and data layer connectivity information from a plurality of wide area networks using a plurality of mobile devices independently of the wide area networks. A server receives the physical layer and data layer connectivity information, relates the connectivity information to specific wide area networks and to a plurality of geographic locations to create a network statistics database. The server also receives mobile device state information including mobile device location information and predicts that connectivity for a specific mobile device will fall below acceptable criteria based on the network statistics database. The server generates a list of candidate donor mobile devices to serve as data connection sources for the specific mobile device based on the network connectivity information and the mobile device state information and selects a donor device from the list of candidate donor devices based on a weighting algorithm.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09538452&OS=09538452&RS=09538452
owner: Google Technology Holdings LLC
number: 09538452
owner_city: Mountain View
owner_country: US
publication_date: 20131015
---
The present patent application claims priority to U.S. Provisional Patent Application No. 61 869 106 filed Aug. 23 2013 entitled MANAGEMENT OF AD HOC PEER TO PEER CONNECTIONS TO PROVIDE DATA NETWORK ACCESS USING A PLURALITY OF HETEROGENEOUS WIDE AREA NETWORKS which is assigned to the same assignee as the present patent application and which is hereby incorporated by reference herein in its entirety.

The present disclosure relates generally to wireless networks and devices and more particularly to wireless ad hoc networks and radio coverage extension.

Numerous routing protocols have been developed for establishing ad hoc networks where a mobile device may obtain extended network coverage to a wide area network by using ad hoc network connections with one or more peer mobile devices. For example various routing schemes have been developed around Quality of Service QoS considerations because different applications have different requirements pertaining to QoS. That is such QoS aware routing schemes attempt to find ad hoc paths based on network throughput pack delivery ratio reliability delay delay jitter packet loss rate bit error rate and path loss. An ad hoc network must exhibit self organization and self maintaining properties including such required activities such as neighbor discovery topology organization and re organization. However such properties often require specific network information that may require access to a specific wide area network statistical information database. Therefore independent ad hoc provisioning of connectivity by individual mobile devices may actually be limited by available information or may be limited to activities within the boundaries of a homogeneous network.

Briefly the disclosed embodiments include a method of operation that includes collecting physical layer and data layer connectivity information from a plurality of wide area networks using a plurality of mobile devices independently of the wide area networks. A server receives the physical layer and data layer connectivity information and relates the connectivity information to specific wide area networks and to a plurality of geographic locations to create a network statistics database. The server also receives mobile device state information from a plurality of mobile devices including mobile device location information and predicts that connectivity for a specific mobile device will fall below acceptable criteria based on the network statistics database. The server generates a list of candidate donor mobile devices to serve as data connection sources for the specific mobile device based on the network connectivity information and the mobile device state information and selects a donor device from the list of candidate donor devices based on a weighting algorithm.

One method of operation in some embodiments includes collecting physical layer and data layer connectivity information from a plurality of wide area networks using a plurality of mobile devices independently of the wide area networks. Physical layer and data layer connectivity information is received at a server and related to specific wide area networks and to a plurality of geographic locations to create a network statistics database. Mobile device state information is also received from the plurality of mobile devices including mobile device location information. A determination may then be made that the physical layer or data layer connectivity in a given geographic location for a specific mobile device is below an acceptable criteria based on the network statistics database. A list of candidate donor mobile devices is generated where the candidate donor mobile devices may serve as data connection sources for the specific mobile device based on the network connectivity information and the mobile device state information. A donor device may then be selected from the list of candidate donor devices based on a weighting algorithm.

In some embodiments the method of operation may also include predicting data usage requirements at a given time and at the given geographic location for the specific mobile device. Additionally the list of candidate donor mobile devices may be generated in response to a request message from the specific mobile device. The list of candidate donor devices may also be provided to the specific mobile device in response to the request message.

Another method of operation in some embodiments includes receiving a request message from a mobile device requesting data network access in response to determining that physical layer or data layer connectivity in a given geographic location for the mobile device is below an acceptable criteria based on a network statistics database. A plurality of bid probes are sent to a plurality of potential donor mobile devices located within peer to peer wireless range of the mobile device. The bid results are received from the plurality of potential donor mobile devices and the data backhaul capabilities for each potential donor mobile device is rated. A donor list is sent to the mobile device that lists the potential donor mobile devices along with a data backhaul capability rating for each potential donor mobile device. In some embodiments the method of operation may also include determining a weighting factor for each potential donor mobile device and including the weighting factor in the donor list. In some embodiments the weighting factor may be based on battery state charging state thermal state and usage state for each potential donor mobile device. A weighting coefficient may be determined in some embodiments for each of battery state thermal state and usage state based on corresponding thresholds.

The disclosed embodiments also provide a server that includes a network transceiver operative to provide a connection to the Internet a network statistics database and at least one processor operatively coupled to the network transceiver and to the network information database. The at least one processor operative to perform operations in accordance with the methods described briefly above.

Turning now to the drawings illustrates various mobile devices and various heterogeneous wide area networks . Each of the various heterogeneous wide area networks is operatively coupled to the Internet via an appropriate backhaul connection and is operative to provide Internet access to subscribed mobile devices. Any one of the plurality of mobile devices may be a subscriber to any one of the heterogeneous wide area networks . The plurality of mobile devices change location dynamically such that they may at times be outside of the radio coverage area of any particular wide area network and therefore may no longer be able to establish a data connection with their subscribed wide area network . Each one of the mobile devices is able to form a radio connection with its respective wide area network via a wireless radio link that uses the technology appropriate for the particular wide area network . Additionally each one of the mobile devices is also capable to establish a peer to peer wireless connection with any other of the mobile devices using a peer to peer wireless link . The peer to peer wireless link may use any suitable technologies such as 802.11 Bluetooth or some other appropriate peer to peer wireless link technology.

In accordance with the embodiments each one of the mobile devices may communicate with a server using the mobile device s subscribed wide area network and by way of the appropriate backhaul connection which provides connectivity to the Internet . The server in accordance with the embodiments may be a cloud based server and may also be a distributed server within the Internet . The server provides a coordination function to coordinate ad hoc network establishment between the mobile devices .

In accordance with the embodiments some of the mobile devices may act as donor devices while others act as receptor devices . A donor device serves as a wireless hotspot to a receptor device when the receptor device is unable to access its subscribed wide area network in order to obtain data access. That is any of the mobile devices may become a receptor device at a particular time or at a particular geographic location that does not provide adequate radio coverage for data access. Accordingly receptor devices may establish peer to peer wireless connections using the aforementioned peer to peer wireless link with an appropriate donor device. These peer to peer wireless connections are managed by a coordination function of the server in accordance with the embodiments. Each of the mobile devices including the receptor devices are subscribed to an ad hoc networking service provided by the server in accordance with the embodiments. Accordingly the server manages creates and promulgates donor lists based on time and geographic locations. The server also uses a weighting algorithm to prioritize donor devices in the promulgated donor lists.

As one example and as shown in each of the mobile devices is a prospective donor device and is assigned a rating for example A B or C or some other type of rating based on weighting factors that establishes the quality of a data link or other criteria related to the prospective donor device. For example an A prospective donor device may be able to provide good wireless link quality and may exhibit good device health such as a high battery level and be relatively stationary at a given point in time. A B rated device may be able to provide only average wireless link quality but has equally good device health to the A rated device. A C rated device may be able to provide average wireless link quality but may exhibit poor device health such as a low battery level . The ratings are specific to a donor list that may be obtained from the server by the receptor devices for a given geographic location nearby the location of the respective receptor device . In other words the rating for any specific prospective donor device may change per location time etc. and may be different even for the same devices with respect to different donor lists. Therefore as shown in the receptor devices may be able to access any of the various devices having A B or C ratings to establish a peer to peer wireless link . A receptor device will thus select a donor device as determined by a weighting algorithm to best serve the receptor device at a particular point in time and at a particular geographic location.

In accordance with the embodiments each of the mobile devices sends either occasional or periodic updates over its respective subscribed wide area network to the server in order to provide information related to the current service being provided by the mobile device s respective wide area network at specific points in time and at a specific geographic locations. Occasional updates may be triggered in some embodiments by changes in radio frequency RF coverage as determined by some RF coverage metric change of location or some other criteria. In other embodiments the updates may be periodic and may occur at predetermined time intervals. Each of the mobile devices includes a client coordination function that determines when the mobile device will obtain data either from the mobile device itself or from its serving wide area network and when the mobile device will send that data to the server . In accordance with the embodiments the server maintains a network information database and a mobile device information database that is used to coordinate the ad hoc peer to peer connection activity of the mobile devices that act as donor devices for receptor devices . Also in accordance with the embodiments the receptor devices may obtain data access from donor devices using a wide area network on which the receptor device is not a subscriber. These methods of operation of the various embodiments may be better understood with respect to the diagrams provided in and . provides example details related to the mobile devices including receptor devices .

In an example mobile device includes an internal communication bus which provides operative coupling between the various components. The mobile device components include but are not limited to a network transceiver a peer to peer transceiver near field communication logic location detection logic a display a user interface at least one processor a memory and a sensor hub . The sensor hub is operatively coupled to a plurality of sensors which may include thermal sensors proximity sensors accelerometers gyroscopic sensors light sensors etc. In accordance with the embodiments the processor is operative to execute a client coordination function . The client coordination function may interact and communicate with a short message service SMS client via APIs application programming interfaces or via other appropriate operative coupling. The client coordination function may also interact and communicate with a device cognition module a data meter and a wireless data assessment engine . The processor is also operative to execute at least one wireless protocol stack and various other applications . Each of the various components of the mobile device that are operatively coupled to the communication bus may accordingly send information to or receive information from the processor .

The device cognition module is operative to communicate with the sensor hub to obtain data from the plurality of sensors . This data may include information about the position of the mobile device such as whether the mobile device is stationary in a docking station placed flatly on a table surface etc. and other information related to the ambient environment surrounding the mobile device . The location detection logic may also be accessed by the device cognition module to obtain location information for the mobile device . The client coordination function may manage the collection of data by the device cognition module and may determine time intervals or locations at which the device cognition module is to obtain data from the sensor hub and the location detection logic .

The data meter is operative to monitor the network transceiver and or the peer to peer transceiver by way of one or more wireless protocol stacks to determine the data throughput or data rate being achieved for the mobile device at a particular point in time at specific locations. The wireless data assessment engine may also assess characteristics of a wireless channel formed by the network transceiver and report those characteristics to the client coordination function . More particularly the wireless data assessment engine is operative to predict poor or sub optimal radio coverage at specific locations either by monitoring internal functions of the mobile device such as those obtained by the sensor hub or by monitoring inputs that may be received from the server as will be discussed in further detail below. The client coordination function receives these predictions and other information from the device cognition module the data meter and wireless data assessment engine and makes appropriate decisions regarding forming ad hoc connections by the mobile device . In situations where the mobile device has lost or suddenly loses radio coverage from its subscribed to wide area network the SMS client may be used by the client coordination function to send a request message to the server to request ad hoc connectivity to either establish a new wireless data connection via a peer to peer wireless link. In accordance with the embodiments the data connection can be obtained through a donor device using any of the wide area networks including those to which the mobile device is not a subscriber. This is achieved in the various embodiments by way of the server which is illustrated in further detail in .

The server includes at least one processor that is operatively coupled to a network transceiver which enables the server to communicate with the various wide area networks over the backhaul connections . The server also maintains a network information database and a mobile device information database which may or may not be integrated onto the server . That is the network information database the mobile device information database or both may be stored on cloud servers remote from the server but that are accessible to the server via network connectivity. In some embodiments the network information database the mobile device information database or both may also be distributed databases that are distributed among multiple cloud servers. In any of these embodiments the processor is operatively coupled to the network information database and to the mobile device information database by using any of various appropriate database interface protocols and network connectivity as needed in embodiments having remotely located or distributed databases. In accordance with the embodiments the processor is operative to execute a master coordination function and a device authentication function . In some embodiments the device authentication function may reside on a different server that is operatively coupled to the server in a manner similar to embodiments using remote or distributed databases. The master coordination function among other things manages the creation of donor lists such as donor list and donor list and manages receptor device requests via receptor request list . The donor lists may be created or managed in accordance with bidding policies which are also stored and managed by the master coordination function in accordance with the embodiments. The bidding policies may limit potential donor devices from responding to bid probes or limit usage of bid probe responses unless certain criteria are met such as but not limited to technical requirements such as being within peer to peer wireless range of the receptor device contractual requirements of the service provided by server or related to one or more of the wide area networks subscription contract requirements or other requirements and policies etc.

The network information database contains information related to all of the heterogeneous wide area networks in accordance with information obtained and collected from the mobile devices such as network statistics for coverage and data connectivity. As was discussed above briefly each of the mobile devices occasionally or periodically sends information to the server related to its connectivity and service level obtained from its subscribed to wide area network . That is each of the mobile devices also includes the client coordination function and other associated components shown in such that each mobile device s client coordination function manages the collection of such data in cooperation with the master coordination function . For example the master coordination function may determine how and when the data is sent by the mobile devices to the server and may provide each of the mobile devices with scheduling information. Data that is specific to the mobile devices is stored in the mobile device information database .

Each one of the mobile devices is subscribed to a service provided by the server in accordance with the embodiments. Upon accessing and subscribing to the service provided by the server each of the mobile devices receives the client coordination function by a download or by a push operation and the client coordination function executable code C is stored in memory of each the mobile device. Thus for example in mobile device the executable code C provides executable instructions that are executable by the processor to execute and run the client coordination function in accordance with the embodiments. Also in accordance with the embodiments the memory of the mobile device may store a donor list which may be dynamically updated from time to time by the master coordination function of the server in conjunction with the client coordination function . Donor list is location specific and is useful only for the mobile device s most current location. In other words as the mobile device moves from geographic location to geographic location as defined by the master coordination function the donor list will be updated for the specific mobile device location. This updating is done in accordance with the information stored in the mobile device information database which includes the master donor list . The master donor list is a listing of all mobile devices which have volunteered to serve as donor devices either at specific points in time or for specific geographic locations or generally according to user settings. For example these user settings may be provided as inputs to a user interface of the client coordination function presented to the user on the display of the mobile device . The settings are then sent to the master coordination function and stored in the mobile device information database for use in creating the master donor list . In other words a mobile device can only be a donor device if it has subscribed to the server networking service has volunteered to be a donor device and is listed as a potential donor device in the mobile device information database .

In some instances the mobile device information database will also store dynamic donor lists such as donor list which correspond to specific geographic locations. In the event that a receptor device requires peer to peer connectivity to establish a data connection the client coordination function on the specific receptor device may send a request message to the master coordination function located on the server . If a donor list currently exists that corresponds to the specific geographic location in which the requesting receptor device is currently located then the master coordination function will send that existing donor list as well as other information related to device authentication to the receptor device . The receptor device may then use that donor list along with the received device authentication information to select an appropriate donor device and to establish a peer to peer connection using a peer to peer wireless link as was described above with respect to .

In some instances a donor list may not be available for the specific geographic location where the receptor device is currently located. In that situation the master coordination function will send out bid probes to the mobile devices and attempt to generate a new donor list for the geographic location. These methods of operation may be further understood with respect to the flowcharts provided in through .

Turning to a method of operation of the server in accordance with an embodiment is illustrated. In operation block the server and thus the master coordination function will obtain a request message requesting data network access from the client coordination function of a receptor device. This request message may be sent via one of the wide area networks or via SMS messages using the SMS client . The master coordination function in decision block will check if information for the location of the requesting receptor device is available in the mobile device information database . If yes then the master coordination function will check to see if a donor list is available as shown in decision block . If a donor list is available for that location the master coordination function will apply a weighting algorithm in operation block and may apply a load balancing algorithm if appropriate in operation block . The load balancing algorithm may be needed in situations where more than one candidate donor device is available and has approximately the same weighting result. If a donor list is not available in decision block the method of operation proceeds to operation block in which the master coordination function will search the database for donor candidates and will generate a new donor list. In this case the method of operation will again proceed to operation block and will apply the weighting algorithm.

The master coordination function will send the donor list to the receptor in operation block and will send information related to the receptor to the candidate donor devices as shown in operation block . This information may be considered a selection information package and includes authentication information such as an explicit SSID reference such that the receptor device and selected donor device may establish a peer to peer wireless connection. The method of operation of the master coordination function then ends as shown.

Returning to decision block if the information for the location of the requested device is not available in the mobile device information database the method of operation proceeds to operation block . In operation block the master coordination function sends bid probes to potential donor devices that are known to be in a location near the requesting device. This is determined by checking the mobile device information database which is updated on an occasional or periodic basis as was described previously above. In operation block the master coordination function receives the bid results and proceeds to rate the data backhaul for the candidate donor devices as shown in operation block . This rating may be performed using any of the information contained in the mobile device information database and the network information database .

In operation block the master coordination function communicates with the device authentication function and creates an authentication profile for each candidate donor device contained in the donor list that will be sent to the receptor device. The method of operation may then continue to operation block and continue as was described above until the method of operation ends. In other words the master coordination function may apply the weighting algorithm to the newly created donor list as shown in operation block and will send the donor list to the receptor devices in operation block etc. Information related to the receptor device will also be sent to candidate donors as shown in operation block . The information provided to the candidate donor devices and receptor device includes security information and authentication information generated by the device authentication function .

In decision block the charging state of the mobile device is checked. If the mobile device is in the charging state then the weight is incremented by five points as shown in operation block or if not charging is decremented by five points as shown in operation block and a score coefficient is generated as shown in operation block . The thermal state of the device is checked in decision block and if less than or equal to a threshold the weighting is incremented by five points as shown in operation block . If the thermal state is not less than or equal to the threshold in decision block then the weighting is decremented by five points in operation block . A score coefficient is determined in operation block . In decision block and usage state is checked to determine whether it is less than or equal to a threshold. If so then the weighting is incremented by five points as shown in operation block if not then the score is decremented by five points in operation block and the final score coefficient is determined in operation block . A final donor score is generated in operation block . This donor score is then added to the donor list which is sent to the receptor devices.

Thus in the various embodiments each mobile device subscribed to the ad hoc networking service acts to collect wide area network physical layer and data layer connectivity information from various different heterogeneous wide area networks . Put another way the mobile devices act as connectivity information collectors for the ad hoc networking service and are used to create the network information database and the mobile device information database and keep them updated as the network topology changes. The server receives the network connectivity information which is related to the specific wide area networks within specific geographic locations. These operations are performed independently and without any involvement of the wide area networks themselves. The master coordination function the mobile device client coordination function or both are operative to use the collected information to determine that data connectivity in a given location is below an acceptable criteria. That is historical information regarding the network connectivity information is stored along with specific mobile device connectivity information which is used to generate network statistics for the various wide area networks . Statistics related to the network may then be stored in the network information database while statistics specific to individual mobile device connectivity may be stored in the mobile device information database . That is the network information database may include a network statistics database. The statistics are determined based on collected information and the calculation and determination of such network statistics may be configured through a user interface to the server and the master coordination function . Likewise the mobile device information database includes a mobile device statistics database for mobile device data connectivity at various locations and times. These statistic determinations and calculations may also be configurable through a user interface to server and the master coordination function similar to the case for the network information database . In other words the views into the collected information may be changed from time to time based on application of various statistical analysis techniques to the collected information. More particularly physical layer and data layer connectivity information collected from the various mobile devices and stored in the network information database is related to the specific wide area networks from which this data is collected and is related to a plurality of geographic locations to create a network statistics database. Thus the network information database is a network statistics database.

The master coordination function generates lists of donor devices to serve as data connection sources based on either the network connectivity information and if appropriate also based on specific mobile device information. A donor device may be selected from the list of donor devices based on a cost metric which may include predicting data requirements at a given time and given location for a specific mobile device i.e. a receptor device . Thus the embodiments provide among other things a virtual umbrella network using heterogeneous wide area wireless networks where the virtual umbrella network is facilitated by using peer to peer wireless connections. The master coordination function thus operates to provide a list of donor devices to at least one receptor device located within a given location either in response to a request message from the receptor device or in response to prediction that the receptor device is about to enter into a geographic location having poor RF coverage for wireless data. The predication may be facilitated by either the master coordination function the client coordination function or both in cooperation. The donor devices therefore serve as gateways that may be connected to broadband or to some non cellular service.

The mobile devices may send information to the server that is related to for example wireless quality wireless cost usage context etc. Therefore based on either a mobile device s location or per a request message i.e. on demand by a receptor device the master coordination function prioritizes a set of donors based on the weighting algorithm such as the example weighting algorithm described with respect to .

Also in some embodiments receptor devices and donor devices may communicate via the peer to peer wireless link which may be for example Bluetooth Wi Fi NFC or some other suitable wireless technology with the communication facilitated by the local client coordination function residing on each mobile device.

For connectivity the selected donors initiate a mobile hotspot with an SSID and use 802.1x port based authentication. The receptor device receives the connectivity information from the master coordination function in advance. In some embodiments the backhaul traffic conditions for specific donor devices may be included in the connectivity information sent to the receptor device or in the SSID broadcast.

In some embodiments the weighting algorithm may take into account radio networking costs and may compute a spectral efficiency metric. For example this may be accomplished using the average CQI reported by the mobile device as per standards. An averaged current drain bits mA metric may also be computed using for example averaged PUSCH Tx Pwr and mapping it against the current drain profile for specific mobile devices based on empirical measurements for some mobile devices and in some embodiments. A radio link quality metric may be computed using the averaged cell signal quality measurements RSRP RSRQ SNR DL BLER CQI UL BLER against pre registered thresholds for each measurement.

All of the above example measurements may be reported to the server by each mobile device where the master coordination function acts to rank possible donors based on their generated metrics in real time. Alternatively in some embodiments these measurements may be bundled along within beacon frames which are broadcasted periodically as part of management frames transmissions in 802.11. Also in some embodiments a modification may be made to the TIM Traffic Indication Map such that donors may broadcast their backhaul capability metric to listening receptor devices.

While various embodiments have been illustrated and described it is to be understood that the invention is not so limited. Numerous modifications changes variations substitutions and equivalents will occur to those skilled in the art without departing from the scope of the present invention as defined by the appended claims.

