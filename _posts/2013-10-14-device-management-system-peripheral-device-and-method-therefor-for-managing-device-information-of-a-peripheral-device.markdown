---

title: Device management system, peripheral device, and method therefor for managing device information of a peripheral device
abstract: The present invention relates to a device management system including a peripheral device, a management server configured to manage device information of the peripheral device, and a terminal communicable with the management server. In the device management system, the management server registers key obtaining information received from the terminal while associating the key obtaining information with device identification information of the peripheral device and an authentication key managed by the management server. The management server determines whether the key obtaining information, from the terminal, that is registered while being associated with the device identification information contained in an obtaining request received from the peripheral device matches the key obtaining information contained in the received obtaining request.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09124843&OS=09124843&RS=09124843
owner: Canon Kabushiki Kaisha
number: 09124843
owner_city: Tokyo
owner_country: JP
publication_date: 20131014
---
There are device management systems that register a peripheral device connected via a network manage the registered peripheral device and manage device information of the registered peripheral device.

Some device management systems are used by a user a service provider that manages peripheral devices to manage devices of a plurality of customers individual people and companies that own the peripheral devices . Such device management systems register and manage for each customer the peripheral devices in a management server. When a device management server and the peripheral devices communicate with each other they use an authentication key.

Japanese Patent Application Laid Open No. 2006 99741 discusses a document management server that associates a group to which an output device belongs with a group to which a document permitted by the output device belongs and stores this information as management information.

Further Japanese Unexamined Patent Application Publication Translation of PCT Application No. 2005 523505 discusses a method by which a trusted party transmits an authentication response message for authentication for a transaction between the account owner and a requesting party in payment by a credit card.

When a peripheral device is to be registered in such a device management service a user has to operate an operation panel to specify a customer of a registration destination with which the peripheral device is to be registered from a plurality of customers managed by the user.

One possible method for specifying the customer of the registration destination is to operate the operation panel of the peripheral device to log in the device management service to select the customer of the registration destination from a customer list. However the customer list may be unable to be displayed due to a lack of the operation panel or limited operability of the operation panel depending on the type of the peripheral device.

Further another possible method is to select the customer of the registration destination with which the peripheral device is to be registered by accessing the peripheral device via a web browser that operates on a personal computer PC . However it may be difficult for the user to bring in a PC and connect the PC to a customer s network in light of security depending on the customer s environment.

The present invention is directed to providing a method for registering a peripheral device according to the type of the peripheral device and a customer s environment in which the peripheral device is installed when a user registers the peripheral device with a management server.

According to an aspect of the present invention a device management system includes a peripheral device a management server configured to manage device information of the peripheral device and a terminal communicable with the management server. The peripheral device includes a first generation unit configured to generate key obtaining information for obtaining from the management server an authentication key for generating signature information to be used in transmission of the device information and a first transmission unit configured to transmit a request for obtaining the authentication key that contains the key obtaining information and device identification information of the peripheral device to the management server. The terminal includes an obtaining unit configured to obtain the key obtaining information from the peripheral device and a second transmission unit configured to transmit the key obtaining information obtained by the obtaining unit to the management server. The management server includes a first reception unit configured to receive the key obtaining information from the terminal a registration unit configured to register the key obtaining information received from the terminal while associating the key obtaining information with the device identification information of the peripheral device and the authentication key managed by the management server a second reception unit configured to receive the obtaining request from the peripheral device a determination unit configured to determine whether the key obtaining information that is registered while being associated with the device identification information contained in the received obtaining request from the terminal matches a key obtaining information contained in the received obtaining request and a response unit configured to if the determination unit determines that they match each other transmit the authentication key associated with the key obtaining information received from the terminal to the peripheral device as a response to the obtaining request.

Further features and aspects of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.

The terminal is for example a smart phone and is connected to the network via a network provided by a mobile phone provider. A firewall may be also provided between the terminal and the network . Further the terminal includes a display such as a touch panel an operation panel and a camera.

The peripheral device is for example a digital multifunction peripheral which has a scan function a print function a copy function an electronic mail function a facsimile function and the like or a printer. For example the peripheral device receives print data from a PC not illustrated via the customer network and prints the data on a sheet using a known print technique such as the electrophotographic technique or the inkjet technique. The customer network will be described below. Because the peripheral device is connected to the network via the firewall communication transmitted from the terminal and the management server connected to the network to the peripheral device is rejected by the firewall . When the peripheral device communicates with the terminal and the management server data should be transmitted from the peripheral device . When the peripheral device transmits its own device information the peripheral device generates signature information in which the device information is encoded with use of an authentication key and transmits the generated signature information to the management server together with the device information. The signature information is information used when the peripheral device proves its own identity and when the management server which received the device information certifies that the device information transmitted from the peripheral device is not fabricated or altered.

The management server is a server that manages various kinds of information of the peripheral device . The peripheral device is managed for each customer that owns the peripheral device . Further the job history of the peripheral device is managed for each peripheral device . The management server is opened on the network and is communicable from the terminal and the peripheral device . Upon reception of the job history from the peripheral device the management server certifies that this job history is received from the peripheral device that the management server itself manages. If the management server certified that the job history is received from the peripheral device that the management server itself manages the management server stores and manages the received job history while associating the job history with a serial number No. which is individual identification information for identifying this peripheral device . The verification method will be described below.

The network is a line for connecting the respective devices to one another and is a network based on a known technique such as the Internet.

The management server includes a web server unit a device management unit a database and a user authentication unit .

The web server unit receives a request from the terminal and the peripheral device and returns a response to the received request thereby providing a web service. The web server unit receives a request from the terminal and the peripheral device with use of a protocol such as HyperText Transfer Protocol HTTP . Further the web server unit is connected to the terminal and the peripheral device via the NIC and the network .

The web server unit includes a web user interface UI unit and a web service unit . The web UI unit receives a request from a web browser of the terminal and returns data written in HyperText Markup Language HTML or the like. The web browser will be described below.

The web service unit receives a request from the peripheral device to the web service and returns a response to the received request. The device management unit manages for each customer the peripheral device and registration information of the peripheral device . More specifically the registration information refers to information such as a customer identification ID with which the peripheral device is registered the serial No. of the peripheral device an authentication key used when the peripheral device communicates with the management server and the like. The customer ID the serial No. and the authentication key will be described below. Further the device management unit collects a history of job s carried out by the peripheral device and manages the collected data as a job history.

A customer management unit manages customer information registered with the management server . The customer information includes information of a customer name a customer ID a device registration code which will be described below and the like. The customer management unit obtains the customer information stored in a customer management table in the database according to a request from another control unit. The database and the customer management table will be described below.

A device managing unit manages for each customer the device information of the peripheral device registered with the management server . The information of the peripheral device is stored in a device management table in the database .

A device registration control unit controls processing for registering the peripheral device with the management server . Further the device registration control unit performs control so as to return an authentication key to the peripheral device when the peripheral device is registered with the management server . The authentication key will be described below.

A device authentication unit generates an authentication key used in authentication at the time of communication with the peripheral device for example when the management server receives the device information such as the job history from the peripheral device and stores the generated authentication key while associating the authentication key with the customer ID and the serial No. The authentication key the customer ID and the serial No. are stored in the device management table in the database . The device management table will be described below. When the job history is received from the peripheral device the device authentication unit verifies signature information received together with this job history and stores for each peripheral device the received job history based on the verification result. More specifically the device authentication unit obtains the serial No. and the signature information added to a header portion of the received job history. The device authentication unit obtains an authentication key associated with the obtained serial No. from the device management table and generates signature information with use of the obtained authentication key.

The device authentication unit verifies whether the generated signature information matches the signature information received together with the job history. If the generated signature information matches the signature information received together with the job history the device authentication unit authenticates the job history as an unaltered job history from the peripheral device managed by the management server . If the generated signature information does not match the signature information received together with the job history the device authentication unit does not authenticate the job history and does not store the job history in the database by determining that the peripheral device that transmitted the job history is not registered with the management server or the job history is an altered job history.

A customer ID may be added to the header portion and the device authentication unit may obtain an authentication key associated with the serial No. and the customer ID. Upon reception of the job history from the peripheral device the device authentication unit verifies the signature information and therefore can prevent the management server from storing information from the peripheral device unregistered with the management server and altered information.

A job history collection unit receives a history of job s carried out by the peripheral device and manages the received data as a job history with use of a job history information table which will be described below a device information reception unit . The job history collection unit receives the job history via the web service unit .

The user authentication unit manages information not illustrated of a user having an authority to access the management server . Further the user authentication unit verifies user authentication information received from the terminal and authenticates that the user has a right to use the web service if the received authentication information matches the information managed by the user authentication unit . The user authentication information refers to for example an ID and a password of a user.

The customer management table is a table for managing a customer registered with the management server . For example the customer management table is a table illustrated in . A customer is managed by being associated with the customer ID the customer name and the device registration code . The customer ID is customer identification information for identifying the customer within the management server . The customer name is the customer s name used when the customer is displayed on a web browser or the like. The device registration code is a value that allows the customer to be uniquely identified. For example information pieces of a customer name AA Inc. and a device registration code 123456 are associated with a customer ID AA123 . The customer registered with the customer management table is registered while being associated with a user. If a user is successfully authenticated by the above described user authentication unit the information of the customer registered while being associated with that user is transmitted to the customer management unit according to a request from the customer management unit .

The device management table is a table for managing the peripheral device registered with the management server . For example the device management table is a table illustrated in . The peripheral device is managed while being associated with a customer ID a serial No. and an authentication key . The customer ID is an ID for identifying a customer and is associated with the customer ID managed in the customer management table . The serial number is individual identification information for identifying the peripheral device . The authentication key is a key for a signature for authenticating the peripheral device managed by the management server . For example the peripheral device having the serial number QWE1234 is registered with the customer having the customer ID AA123 and the authentication key thereof is 1qazxsw2 . When the peripheral device having the serial No. QWE1234 communicates with the management server the authentication key 1qazxsw2 is used.

A device registration control table is a table for temporarily managing an authentication key for returning the authentication key to the peripheral device when the peripheral device is registered with the management server . For example the device registration control table is a table illustrated in . An authentication key obtaining ID is an ID issued by the peripheral device to obtain an authentication key . A serial No. is a serial No. for identifying the peripheral device . A customer ID is an ID for identifying a customer and is associated with the customer ID managed in the customer management table and the customer ID managed in the device management table . The authentication key is a key for a signature for authenticating the peripheral device managed by the management server . An obtainable deadline indicates a deadline until which the authentication key can be obtained with use of the authentication key obtaining ID . For example if the peripheral device having the serial No. QWE1234 is registered with the customer having the customer ID AA123 the authentication key is 1qazxsw2 . Then the device registration control table indicates that the authentication key obtaining ID for obtaining this authentication key is zse45tfc and the authentication key can be obtained with use of the authentication key obtaining ID until the deadline Jul. 1 2012 12 00 .

A job history information table is a table for managing a history of job s carried out by the peripheral device . For example the job history information table is a table illustrated in . A customer ID is an ID for identifying a customer. A serial No. is a serial No. for identifying the peripheral device . A job type is for example printing data from a host computer copying scanning faxing and box printing a document stored in the peripheral device . A start time and an end time are a start time and an end time of a job carried out by the peripheral device corresponding to the serial No. . The number of page s processed by relevant job is recorded in a number of page s . A document name is a document name set by a print application to relevant job.

A job history information table held by a job history management unit of the peripheral device has the table structure illustrated in with the customer ID and the serial No. removed therefrom.

A CPU is a controller that executes a program controls various kinds of processing of the peripheral device and controls respective components connected to a system bus . The CPU loads software stored in a ROM or a hard disk HD which is a mass storage device to a RAM and executes the loaded software. The ROM is a data read only memory and stores a basic control program of the system. The RAM is a data read and write memory and is used for various kinds of calculation processing by the CPU and a temporary data storage. A panel controller PanelC controls an instruction inputting from an operation panel Panel provided to the peripheral device . A display controller DispC controls a display of a display unit Display constituted by for example a liquid crystal display device. A disk controller DKC controls the hard disk HD which is a mass storage device. A network interface card NIC controls communication with another device connected to the network . The HD stores a system program of an operating system and an application program of the peripheral device and is also used as for example a temporary storage area during data processing. If an embedded application is installable in the peripheral device the embedded application is stored in the HD . Further the HDD stores the job history of the peripheral device and the like. A scanner controller SCANC controls an optical scanner provided to the peripheral device to read a paper document. A printer controller PRNC controls a printer provided to the peripheral device to print data on a sheet using a known print technique such as the electrophotographic technique or the inkjet technique.

A key input unit is provided at the peripheral device and can receive a user s operation via hardware keys. A power switch is an ON OFF button and is a power switch of the peripheral device . A start key instructs the peripheral device to start processing provided by the peripheral device such as copying printing scanning fax transmission and the like. A numeric keypad receives a user s input of numerical information. An ID key is used to instruct the peripheral device to input authentication information. A clear key cancels information input via the numeric keypad . A reset key returns a screen displayed on a display screen to an initial screen such as a menu screen . The menu screen will be described below. The display screen has a function of displaying the menu screen . Further if the display screen has a touch panel function not only the display screen has the function of displaying the menu screen but also the display screen can receive an input from a user by detecting whether a displayed area is pressed. A Quick Response QR code registered trademark is generated by a QR code registered trademark generation unit which will be described below and is displayed on the display screen by the UI control unit . An input from a user can be received by displaying the respective elements illustrated in on the Panel or the Display having the touch panel function and detecting whether the respective displayed elements are pressed.

An interface unit is connected to the network and receives a print job from a host computer not illustrated . Further the interface unit communicates with the management server .

The UI control unit controls the Display via the DispC and displays a screen for receiving a user s instruction to copy data and a user s instruction to display information to be registered to the management server . Further the UI control unit controls the Panel via the PanelC and receives a user s instruction to copy data to the peripheral device and a user s instruction to display information to be registered with the management server . Upon reception of the instruction to display information to be registered with the management server the UI control unit notifies a registration control unit of the reception of the registration information display instruction. Further upon reception of the notification the UI control unit displays the QR cord registered trademark generated by the QR code registered trademark generation unit of the registration control unit which has received the notification on the Panel or the Display .

The registration control unit controls registration of the peripheral device with the management server .

An authentication key obtaining ID generation unit generates an authentication key obtaining ID for obtaining the authentication key when the peripheral device is registered with the management server . The authentication key is a signature key for authenticating the peripheral device when the peripheral device communicates with the management server . The authentication key is generated for each peripheral device by the management server and is transmitted to the peripheral device . Once the peripheral device obtains the authentication key after succeeding in registration with the management server the peripheral device generates signature data with use of the authentication key and transmits communication data with the signature data and the serial No. for identifying the peripheral device attached thereto when communicating with the management server thereafter. Upon reception of the communication from the peripheral device the management server generates signature data with use of the authentication key of the corresponding peripheral device and determines that the communication data is successfully authenticated if the generated signature data matches the attached signature data.

A device information management unit manages setting information and configuration information of the peripheral device and returns specified information in response to an information obtaining request from another component. Examples of types of information managed by the device information management unit include the serial No. of the peripheral device and the like.

The QR code registered trademark generation unit generates the QR code registered trademark by encoding 1 the Uniform Resource Locator URL of the management server the address of the management server 2 the authentication key obtaining ID and 3 the serial No. of the peripheral device an image information generation unit . The QR code registered trademark generation unit incorporates the items 2 and 3 as parameters of the URL of the item 1 as added information. Further the QR code registered trademark generation unit outputs the generated image information. The output method is for example displaying the image information on the Display or the Panel via the UI control unit or printing the image information by the printer .

An authentication key obtaining unit an obtaining request transmission unit receives an instruction from the registration control unit and issues and authentication key obtaining request to the management server . The authentication key obtaining unit transmits the authentication key obtaining ID together with the authentication key obtaining request and stores the authentication key returned as a response thereto in an authentication key storage unit .

The authentication key storage unit stores the authentication key obtained by the authentication key obtaining unit authentication key reception .

A job history management unit stores a history of job s carried out by the peripheral device and periodically transmits the job history to the management server via the interface unit a device information transmission unit . When transmitting the job history the job history management unit obtains the authentication key from the authentication key storage unit generates signature information with use of the obtained authentication key a signature information generation unit and adds the generated information to a header together with the customer ID and the serial No. As the method for generating the signature information the job history management unit uses Secure Hash Algorism SHA or another algorism.

A CPU is a controller that executes a program controls various kinds of processing and controls respective components connected to a system bus . The CPU loads software stored in a ROM or an HD to a RAM and executes the loaded software. The ROM is a data read only memory and stores a basic control program of the system. The RAM is a data read and write memory and is used for various kinds of calculation processing by the CPU and a temporary data storage. An input device INPUT is a touch panel a button and or the like and provides an input method to a user. A display unit Display is a display unit constituted by a liquid crystal display device or the like. A network interface card NIC controls communication with another device connected to the network . A camera CAM is a camera that provides a shooting function and has a function of reading a QR code registered trademark . The HD stores a system program of an operating system and the like of the terminal and is also used as for example a temporary storage area during data processing.

The terminal includes the web browser a communication unit a QR code registered trademark reading unit and a QR code registered trademark decoding unit that has a function of decoding a QR code registered trademark .

The web browser specifies a URL transmits an information obtaining request to the communication unit and obtains web page data. The web browser displays a screen on the Display based on the web page data obtained via the communication unit . Further the web browser receives a user s operation applied to a control in the displayed screen via the input device and transmits a request according to the operation content to the communication unit .

The communication unit for example receives a communication request from the web browser communicates with a web server via the peripheral device and the like and the NIC with use of a protocol such as HTTP requests a web page and receives web page data. In the present exemplary embodiment the communication unit communicates with the management server .

The QR code registered trademark reading unit controls the camera to shoot the QR code registered trademark thereby generating image data. Subsequently the QR code registered trademark reading unit instructs the QR code registered trademark decoding unit to analyze the image of the QR code registered trademark shot by the camera to decode the QR code registered trademark thereby obtaining the URL information encoded in the QR code registered trademark . Further the QR code registered trademark reading unit displays the obtained URL information on the Display .

A user selects the URL and instructs the terminal to execute it by which the web browser is activated to access the web server the management server indicated by the obtained URL.

In step S the UI control unit of the peripheral device displays a menu screen on the Display the display screen . To allow a user to select usable functions of the peripheral device such as copying and a display of registration information screen which indicates the registration information of the peripheral device the respective menu buttons therefor are displayed on the menu screen . The UI control unit displays these menu buttons on the display screen and the user selects any of the displayed buttons to thereby instructs the peripheral device to shift to a screen indicated by each button. Upon reception of a selection of any menu button the UI control unit calls up an application corresponding to the selected menu button or the control unit. The menu screen may be displayed on the Panel .

In step S the user selects the menu button of DISPLAY REGISTRATION INFORMATION . The UI control unit calls up the registration control unit in response to the user s selection instruction of the menu button.

In step S the registration control unit obtains the serial No. of the peripheral device from the device information management unit .

In step S the authentication key obtaining ID generation unit receives an instruction from the registration control unit and generates an authentication key obtaining ID.

In step S the registration control unit generates the QR code registered trademark by transmitting a character string formed by combining the URL of the management server the serial No. obtained in step S and the authentication key obtaining ID generated in step S to the QR code registered trademark generation unit .

In step S the registration control unit displays an image of the generated QR code registered trademark on the Display the display screen via the UI control unit . At this time the QR code registered trademark may be displayed on the Panel .

In step S the UI control unit determines whether a predetermined time has elapsed from the display of the QR code registered trademark in step S or whether the clear button is pressed by the user. The predetermined time may be a time determined in advance or may be determined by the user when the QR code registered trademark is generated. If the UI control unit determines that the predetermined time has elapsed or the clear button is pressed YES in step S the processing proceeds to step S and the UI control unit displays the menu screen on the Display again. If the UI control unit determines that the predetermined period of time has not elapsed yet and the clear button is not pressed NO in step S the processing proceeds to step S.

In step S the authentication key obtaining unit transmits an authentication key obtaining request to the management server via the interface unit . At this time as the protocol the authentication key obtaining unit may use HyperText Transfer Protocol Secure HTTPS Simple Object Access Protocol SOAP Representational State Transfer REST or the like. When transmitting the authentication key obtaining request the authentication key obtaining unit specifies the authentication key obtaining ID generated in step S and the serial No. obtained in step S as parameters. Processing performed when the management server receives the authentication key obtaining request will be described below.

In step S the authentication key acquisition unit receives a response to the authentication key obtaining request and determines whether the authentication key is successfully obtained. If the authentication key obtaining unit determines that the authentication key is successfully obtained YES in step S the processing proceeds to step S. If the authentication key acquisition unit determines that the authentication key is not successfully obtained No in step S the processing proceeds to step S again. The authentication key obtaining unit repeats the authentication key obtaining request until the authentication key is returned from the management server or the clear button is pressed by the user.

In step S the authentication key obtaining unit stores the authentication key and the customer ID obtained from the management server in the authentication key storage unit and then the processing ends.

In step S a user causes the QR code registered trademark reading unit of the terminal to shoot the QR code registered trademark displayed on the Display the display screen of the peripheral device by the camera and then generate image data.

In step S the QR code registered trademark reading unit decodes the image data generated in step S by the QR code registered trademark decoding unit to obtain the URL. The URL indicates the URL of the management server and the authentication key obtaining ID generated by the peripheral device and the serial No. of the peripheral device are incorporated in parameters of the URL as additional information.

In step S the web browser transmits via the communication unit a web page obtaining request to the management server indicated by the URL obtained from the QR code registered trademark . Upon reception of the web page obtaining request the web server of the management server generates an authentication screen by the web UI unit and transmits the generated authentication screen to the terminal .

In step S the web browser receives an authentication screen transmitted from the management server and displays the received authentication screen on the Display .

In step S the user inputs from the INPUT user authentication information on the authentication screen displayed in step S. The web browser receives an input instruction from the user and transmits the user authentication information to the management server . For example the input user authentication information refers to an ID and a Password of the user. The user authentication unit of the management server verifies the received user authentication information and authenticates that the user has a right to use the web service if the received user authentication information matches the user information managed by the user authentication unit . If the user is successfully authenticated the customer management unit obtains customer information the customer IDs the customer names and the device registration codes of customers managed by that user from the customer management table . The customer management unit returns the obtained customer information to the web browser via the web UI unit . If the user cannot be successfully authenticated the user inputs user authentication information on the authentication screen again and user authentication is carried out.

In step S the web browser analyses the received customer information and displays a customer selection screen . Customers that own the peripheral devices managed by the user are displayed on the customer selection screen . Information obtainable from the customer management unit can be displayed on the customer selection screen and not only the customer names but also the customer IDs and the device registration codes may be displayed on the customer selection screen .

In step S the user selects the customer name of a customer of a registration destination with which the peripheral device is to be registered from the customers on the customer selection screen displayed in step S.

In step S the web browser transmits a device registration request to the management server via the HTTP communication unit together with the customer information the customer ID of the customer selected in step S and the authentication key obtaining ID an obtaining ID transmission unit and then the processing ends.

In step S the web UI unit of the management server receives the device registration request from the terminal an obtaining ID reception unit . The device registration request contains the customer information of the customer selected by the user on the customer selection screen . The authentication key obtaining ID and the serial No. are held in session information.

In step S upon reception of the device registration request in step S the web UI unit instructs the device authentication unit to generate an authentication key. The device authentication unit generates an authentication key of the device for which the user has issued the registration request in response to the instruction from the web UI unit .

In step S the device authentication unit registers the customer ID and the serial No. contained in the customer information and the authentication key generated in step S in the device management table while associating them. The customer ID and the serial No. may be registered with the management server in advance. If the customer ID and the serial No. are registered with the management server in advance the device authentication unit registers the generated authentication key while associating it with the registered customer ID and serial No.

In step S the device registration control unit registers the authentication key obtaining ID the serial No. the customer ID received in step S the authentication key generated in step S and a deadline until which the authentication key can be obtained with the device registration control table . The deadline until which the authentication key can be obtained is set to a time calculated by adding a predetermined time to a processing time.

In step S the web service unit receives the authentication key obtaining request from the peripheral device an obtaining request reception unit . The web service unit receives the authentication key obtaining ID generated in step S and the serial No. obtained in step S together with the authentication key obtaining request.

In step S the web service unit searches from the device registration control table for the authentication key obtaining ID registered while being associated with the serial No. received in step S.

In step S the device registration control unit determines whether the authentication key obtaining ID searched for and obtained in step S matches the authentication key obtaining ID received in step S. The device registration control unit returns the authentication key to the peripheral device based on the determination result. If the device registration control unit determines that the authentication key obtaining ID searched for and acquired in step S matches the authentication key obtaining ID received in step S YES in step S the processing proceeds to step S. If the device registration control unit determines that there is no corresponding customer NO in step S the processing proceeds to step S.

In step S the device registration control unit determines whether the current time is within the deadline until which the authentication key can be obtained with use of the authentication key obtaining ID the obtainable deadline . If the device registration control unit determines that the current time is within the obtainable deadline YES in step S the processing proceeds to step S. If the device registration control unit determines that the current time is not within the obtainable deadline NO in step S the processing proceeds to step S.

In step S the device registration control unit obtains the corresponding authentication key and customer ID from the device registration control table .

In step S the device registration control unit deletes the authentication key obtaining ID together with the corresponding customer s row from the device registration control table .

In step S the device registration control unit returns the authentication key determined as a match in step S and the customer ID to the peripheral device as a response to the authentication key obtaining request and then the processing ends. The reply is performed via the web UI unit . Processing performed by the peripheral device upon reception of the authentication key and the customer ID corresponds to the process in step S illustrated in . The information returned from the management server to the peripheral device may be only the authentication key.

In step S the device registration control unit returns information indicating an error in obtaining the authentication key to the peripheral device via the web UI unit .

After that when the peripheral device transmits the device information to the management server the authentication key storage unit encodes the device information with use of the authentication key returned from the management server to generate signature information and transmits the signature information the customer ID and the serial No. together with the device information. The information transmitted together with the device information may be the signature information and the serial No.

Upon reception of a communication request the management server receives the signature information and the serial No. together with the communication request. The device authentication unit generates signature information with use of the authentication key stored in the device management table together with the received serial No. If the received signature information matches the signature information generated by the device authentication unit the management server authenticates this peripheral device and manages the received device information while associating it with the serial No.

In this manner according to the first exemplary embodiment when the peripheral device is registered with the management server the user can perform the operation for specifying and registering the customer of registration destination without using the customer s network to which the peripheral device is connected. Further if the peripheral device has limited operability for the Panel and the Display of the peripheral device the user can register the peripheral device from the terminal .

According to the second exemplary embodiment the peripheral device does not include the Panel and the Display and therefore cannot display a two dimensional bar code such as a QR code registered trademark and this peripheral device is registered with the management server . The method therefor will be described now.

From step S to step S the peripheral device performs similar processes to the device registration screen display processing which is processed by the peripheral device according to the first exemplary embodiment.

Upon completion of the process in step S in step S the printer of the peripheral device prints the QR code registered trademark generated in step S. More specifically the QR code registered trademark which is displayed on the display screen according to the first exemplary embodiment is printed on a document sheet.

In step S the UI control unit determines whether a predetermined time has elapsed from the printing of the QR code registered trademark . The predetermined time may be a time determined in advance or may be determined by the user when the QR code registered trademark is printed. If the UI control unit determines that the predetermined time has elapsed YES in step S the processing proceeds to step S and the peripheral device displays the menu screen. If the UI control unit determines that the predetermined time has not elapsed yet NO in step S the processing proceeds to step S. From step S to step S the peripheral device performs similar processes to the processes according to the first exemplary embodiment and then the processing for printing the image information ends. However if the peripheral device fails in obtaining the authentication key in step S NO in step S the processing proceeds to step S and the subsequent steps are performed.

As the device registration processing by the terminal the terminal performs similar processing to the processing according to the first exemplary embodiment illustrated in . However in step S the terminal shoots the QR code registered trademark printed in step S. Further as the device registration processing by the management server the management server also performs similar processing to the processing according to the first exemplary embodiment.

According to the second exemplary embodiment the QR code registered trademark is printed on a document sheet whereby it is possible to realize the device registration processing with use of the terminal in a similar manner to the first exemplary embodiment even if the peripheral device does not include the Panel and the Display for displaying the QR code registered trademark .

As the third exemplary embodiment a method for registering the device with use of the Panel or the Display of the peripheral device will be described.

According to the third exemplary embodiment the device registration processing is performed with use of the device registration code instead of the QR code registered trademark . The device registration code is stored in the customer management table of the database .

In step S the web browser transmits a web page obtaining request to the management server via the communication unit . Upon reception of the web page obtaining request the web server of the management server generates the authentication screen by the web UI unit and returns the generated authentication screen to the terminal .

In step S the user inputs from the INPUT user authentication information on the authentication screen displayed in step S. The web browser receives an input instruction issued by the user and transmits the user authentication information to the management server . When receiving the user authentication information the user authentication unit of the management server performs a similar process to the process in step S illustrated in . If the user is successfully authenticated the customer management unit obtains customer information of customers managed by this user from the customer management table . The customer management unit returns the obtained customer information to the web browser via the web UI unit .

In step S the web browser analyzes the received customer information and displays the customer selection screen . The customer information displayed at this time is the customer names and the device registration codes . Further the customer IDs may be displayed together with the customer names and the device registration codes . After the web browser receives the customer information and displays the customer information including the device registration codes on the DISPLAY the obtaining processing for the device registration code ends.

The user inputs the registration code of the peripheral device that the user wants to register in a device registration code of the device registration code input screen . The user refers to the customer information displayed on the Display in the above described step S for the device registration code to be input in the device registration code . Upon pressing of a device registration button the processing for registering the device is performed. The registration control unit of the peripheral device adds the device registration code input in the device registration code and the serial No. obtained from the device information management unit of the peripheral device to a device registration request and transmits this device registration request to the management server .

In step S the web service unit of the management server receives the device registration request transmitted from the registration control unit of the peripheral device . The device registration request contains the device registration code input by the user and the serial No. of the peripheral device that the user wants to register.

In step S the web service unit makes an inquiry about whether the device registration code is registered with the customer management unit . The customer management unit determines whether the device registration code is registered with the customer management table in the database according to the inquiry from the web service unit .

If the customer management unit determines in step S that the device registration code is registered YES in step S the processing proceeds to step S. If the customer management unit determines that the device registration code is not registered NO in step S the processing proceeds to step S.

In step S the web service unit instructs the device authentication unit to generate an authentication key. The device authentication unit generates an authentication key of the peripheral device indicated by the serial No. received in step S in response to the instruction from the web service unit .

In step S the web service unit registers the customer ID obtained from the customer management unit the serial No. obtained in step S and the authentication key generated in step S with the device management table .

In step S the web service unit returns the customer ID and the authentication key generated in step S to the peripheral device . Upon reception of the customer ID and the authentication key the peripheral device stores them into the authentication key storage unit . The web service unit may return only the authentication key. After that when the peripheral device communicates with the management server the peripheral device uses the authentication key stored in the authentication key storage unit .

According to the third exemplary embodiment it is also possible to realize the device registration processing using the Panel or the Display of the peripheral device . In the third exemplary embodiment the user obtains the device registration code by operating the terminal . However if the user has obtained in advance the device registration code of the peripheral device to be registered the user inputs the device registration code on the peripheral device without performing the obtaining processing for the device registration code by the terminal .

Embodiments of the present invention can also be realized by a computer of a system or apparatus that reads out and executes computer executable instructions recorded on a storage medium e.g. non transitory computer readable storage medium to perform the functions of one or more of the above described embodiment s of the present invention and by a method performed by the computer of the system or apparatus by for example reading out and executing the computer executable instructions from the storage medium to perform the functions of one or more of the above described embodiment s . The computer may comprise one or more of a central processing unit CPU micro processing unit MPU or other circuitry and may include a network of separate computers or separate computer processors. The computer executable instructions may be provided to the computer for example from a network or the storage medium. The storage medium may include for example one or more of a hard disk a random access memory RAM a read only memory ROM a storage of distributed computing systems an optical disk such as a compact disc CD digital versatile disc DVD or Blu ray Disc BD a flash memory device a memory card and the like.

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

This application claims the benefit of Japanese Patent Application No. 2012 229039 filed Oct. 16 2012 which is hereby incorporated by reference herein in its entirety.

