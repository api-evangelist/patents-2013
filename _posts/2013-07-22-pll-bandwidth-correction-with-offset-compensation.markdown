---

title: PLL bandwidth correction with offset compensation
abstract: A method and system for compensating for offsets when measuring parameters of a phase-locked loop (PLL). In one embodiment, a proportional path in the PLL is temporarily shut off, a measurement is made of a real time-to-zero crossing in the PLL to measure a defined parameter of the PLL, the proportional path is switched on, and the defined loop parameter is adjusted based on this measurement. In one embodiment, the real time-to-zero crossing is measured after introducing a phase step into the PLL between a reference signal and an output signal of the PLL. In an embodiment, two phase steps, having opposite polarities, are successively introduced into the PLL, and the time-to-crossing measurements resulting from these two phase steps may be averaged, and this average is used to determine a loop parameter.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08629701&OS=08629701&RS=08629701
owner: International Business Machines Corporation
number: 08629701
owner_city: Armonk
owner_country: US
publication_date: 20130722
---
This application is a continuation of copending U.S. patent application Ser. No. 13 230 371 filed Sep. 12 2011 the entire content and disclosure of which is hereby incorporated herein by reference.

This invention was made with Government support under Contract No. FA8650 090 C 7924 Defense Advanced Research Projects Agency DARPA . The Government has certain rights in this invention.

This invention generally relates to phase locked loop frequency synthesizers and more specifically to measuring parameters of phase locked loop frequency synthesizers.

Phase locked loop frequency synthesizers generally referred to as phase locked loops or PLLs are devices that generates an output signal with a frequency that is a function of a reference input signal. PLLs are used in many systems such as data processing systems communication systems and audio and video processing systems. When a PLL is implemented in a system the frequency of the output signal of the PLL may change many times. For example the frequency of this output signal may change at the start up of the system or when the system changes from one channel to another.

The PLL may include certain components connected in a feedback loop. For example the components in a PLL may include a phase frequency detector PFD a charge pump CP a loop filter and a voltage controlled oscillator VCO . The PLL may additionally include a feedback frequency divider in applications where the VCO frequency is designed to be a multiple of the reference frequency.

In one example the PFD can compare a reference signal provided by a suitable signal generator such as an oscillator to an output signal provided as feedback from the VCO. Based on these signals the PFD can determine differences between the signals and express these differences as up or down pulses to the charge pump. The charge pump can then provide charge to the loop filter which filters the charge pump output to the tuning port of the VCO. Upon receiving a signal from the charge pump via the loop filter the VCO can generate an output signal having a frequency based on the voltage level of the input signal provided by the loop filter. Signals generated by the VCO can be fed back to the PFD to complete the feedback loop between the PFD the charge pump the loop filter and the VCO.

The absolute values of the operating parameters of the components that are part of a PLL often depend upon temperature and supply voltage. Furthermore these values can also vary due to manufacturing tolerances. For instance the time constants and settling behavior of a PLL are dependent on physical elements such as resistors and capacitors that may have a significant variation over process temperature and supply voltage. In addition in variable output frequency synthesizers the natural frequency loop bandwidth and damping factor of the PLL are dependent on the feedback divider modulus as well as the frequency of operation.

Dynamic analysis of a control system is usually performed using the transfer function which is a mathematical representation of the relationship between the input signal and the output signal of the system. The open loop phase domain transfer function of a PLL typically contains two integrators and a stabilizing zero. One of the integrators is a result of the phase relationship between the VCO input and output. The other integrator and the zero are contained in the loop filter.

The relationship between the phase of the input signal to the output signal of a type II PLL can be characterized with parameters wn and N.

In many systems it is desirable to fix the location of the PLL s zeros and poles in order to have a well known relationship between the phases of the input and output signals and to control the PLL close to carrier phase noise. In a practical PLL the locations of the poles and zeros are functions of the gains of the small signal components within the loop K Kand K . The gains of these components can vary significantly across process and operating conditions. For example the VCO s voltage to frequency transfer function is nonlinear such that the small signal gain of the VCO at two frequencies within a few percent of each other can have a ratio of 3 1 or greater. Other loop parameters such as the Charge pump gain and loop filter impedances are also susceptible to random variation. The net result is that the dynamics of an un calibrated PLL exhibit large amounts of variation.

There are two parts to calibration of the PLL dynamics measuring the locations of the poles and zeros and adjusting the positions of the poles and zeros. Adjusting the positions of the poles and zeros in a locked PLL is achieved by adjusting the size of the loop capacitor resistor and charge pump currents. The more challenging task is the measurement of the positions of the poles and zeros in the presences of offsets and nonlinearities which are typically present in a PLL.

The prior art includes techniques for measuring a PLL s bandwidth by adding phase steps to the PLL and measuring the time until the phase of the PLL crosses zero. The phase steps are added to the loop by changing the dividers count value by one for one reference cycle. In the prior art a digital bang bang phase detector is placed in parallel with the PLL s phase detector. This digital phase detector detects which of the rising edges of the two input clocks arrives first. By measuring the time it takes for the output of the digital phase detector to change polarity the time at which the phase of the PLL has crossed zero is measured.

There are several important practical details which will limit the effectiveness of prior art techniques. A practical PLL can have a phase offset at its input due to circuit non idealities charge pump current miss match capacitor leakage etc . A crossover detection circuit e.g. a bang bang phase detector will have additional offsets which are distinct from the PLL s offsets. A small offset can lead to a very large error in the time to crossover measurement limiting the effectiveness of prior art.

The errors caused by offsets will be less significant if the magnitude of the phase step is increased. However if the phase step is large then the PLL non linearities can also cause significant errors e.g. the VCO control voltage moves to a different point on its nonlinear tuning curve or the proportional path saturates .

Embodiments of the invention provide a method and system for compensating for offsets when measuring parameters of a phase locked loop PLL . In one embodiment the method comprises temporarily shutting off a proportional path in the PLL making a measurement of a real time to zero crossing in the PLL to measure a defined parameter of the PLL switching on the proportional path and adjusting the defined loop parameter based on said measurement.

In one embodiment the measurement of the real time to zero crossing is made by introducing a phase step into the PLL between a reference signal and an output signal of the PLL bringing the reference signal and the output signal into phase and making a measurement of the time between when said phase step is introduced and the time when the reference signal and the output signal are brought into phase.

In an embodiment a first phase step is introduced at a first time and second phase step is introduced at a second time and these phase steps have opposite polarities. A first time to zero crossing measurement is made after said first phase step is introduced and a second time to zero crossing measurement is made after said second phase step in introduced.

In one embodiment the proportional path is shut off substantially at the same time that each of the first and second phase steps is introduced and the proportional path is kept off while making the measurements of the first and second time to zero crossings.

In an embodiment the steps of temporarily shutting off the proportional path making a measurement of a real time to zero crossing in the PLL and switching on the proportional path are repeated a number of times. The PLL is adjusted to adjust the real time to crossing measurements until an average of a specified number of said real time crossing measurements is equal to a given target value.

In one embodiment each measurement of a real time to crossing is made after introducing a respective one phase step into the PLL between a reference signal and an output signal of the PLL and successive phase steps have alternating polarities.

In an embodiment the measurement of the real time to crossing may be used to calculate a natural frequency of the PLL.

In one embodiment the invention provides a method and system for measuring one or more parameters of a phase locked loop frequency synthesizer PLL . The PLL comprises a loop filter including a proportional path for applying a filtered signal to a variable oscillator. In an embodiment the method comprises introducing first and second phase steps at first and second times respectively into the PLL between an input signal to the PLL and an output signal of the PLL. Each of these first and second phase steps have opposite polarities. Each time one of the phase steps is introduced into the PLL the proportional path of the loop filter is turned off and a measurement is made of the length of time to eliminate a phase difference between the input and output signal of the PLL after said each phase difference is introduced into the PLL. This length of time measurements is used to determine a value for said one or more parameters.

In an embodiment an average of the length of time measurements is used to determine the value for said one or more parameters.

In one embodiment the proportional path is turned off substantially at the same time that each of the phase steps is introduced into the PLL. In an embodiment the proportional path is turned on after each measurement is made.

In an embodiment the length of time measurements are used to determine the natural frequency of the PLL. In one embodiment in combination with a single length of time measurement is used to calculate intrinsic offsets in the PLL.

In an embodiment the first phase step is introduced into the PLL in a first time period and a first phase difference is produced between the input and output signals of the PLL and the second phase step is introduced into the PLL in a second time period and a second phase difference is produced between the input and output signals of the PLL. In one embodiment in this first time period the proportional path is turned off and a first measurement is made of a time to crossover for said first phase difference to reach zero after said first phase step is introduced. In the second time period the proportional path is turned off and a second measurement is made of a time to crossover for said second phase difference to reach zero after the second phase step in introduced. These first and second measurement of the time to crossover are used to determine the value for said one or more parameters.

In embodiments of the invention a PLL s natural frequency wn and damping coefficient can be accurately measured and controlled even in the presence of PLL phase offsets. In embodiments of the invention phase steps are added to a PLL and the proportional and integral path gains are adjusted in such a way that the phase offset of the PLL can be measured and correct for.

In embodiments of the invention a phase step is injected into a locked PLL while simultaneously temporarily switching off the proportional path current which sets to 0 and the time to crossover is measured. The procedure is done twice with positive and negative phase steps. The average time to crossover in response to opposite polarity phase steps and with 0 is not a function of the phase offset of the PLL and is only a function of the integral path gain. Therefore the integral path gain can be adjusted until a target time to crossover is achieved corresponding to a desired .

Once of the PLL has been calibrated the offset of the PLL can be measured by measuring the time to crossover of the PLL with 0 without averaging the positive and negative phase step results . Once and the offset are known the time to crossover with the proportional path turned on and with the known offset is measured. The gain of the proportional path is adjusted unit the time to crossover reaches the required value for a given .

In one example PFD can compare a reference signal provided by the signal generator to an output signal provided as feedback from VCO . Based on these signals PFD can determine differences in phase and or frequency between the signals and express this difference as pump up or pump down pulses to charge pump . Charge pump can then provide charge to the loop filter which filters the charge pump output to the turning port of VCO . By way of specific example PFD can generate a digital output signal comprised of high and or low pulses of varying lengths. Charge pump can receive this signal and produce an output corresponding to the pump up and or pump down signals from PFD . The charge pump output can subsequently be filtered by loop filter to provide a stable voltage level to VCO .

Upon receiving a signal from charge pump via loop filter VCO can generate an output signal having a frequency based on the voltage level of the input signal provided by loop filter . As PLL further illustrates signals generated by VCO can be fed back to PFD to complete the feedback loop between PFD charge pump loop filter and VCO . In one example signals generated by VCO can be compared to the reference signal to facilitate continuous adjustment of the output signal of PLL in relation to the reference signal.

The loop filter may include a proportional loop gain block and an integral loop gain block . Blocks and may have a common input and may be combined together via a summing point . The proportional loop gain block may have a gain of a that represents the amount of attenuation applied to the phase error prior to affecting the VCO frequency. Viewed in the frequency domain a controls the fraction of the phase difference detected at the input of the PFD that is produced at an input to the DCO.

Dividers or counters can further be employed within PLL to cause the PLL to generate an output signal having a frequency that is a specified multiple of the frequency of the reference signal provided by oscillator and or another suitable reference signal source. By utilizing dividers signals of multiple frequencies can be generated by a PLL based on a single reference signal. In one example an N divider can be applied to an output signal from VCO prior to feeding the signal back to PFD for comparison. In such an example N divider can be configured to generate a signal having a frequency equal to the frequency of the output signal of VCO divided by an integer parameter N. By doing so PLL can be configured to generate a signal having a frequency equal to the reference frequency multiplied by N.

As mentioned above the absolute values of the operating parameters of the components that are part of a PLL often depend upon temperature and supply voltage. Furthermore these values can also vary due to manufacturing tolerances. For instance the time constants and settling behavior of a PLL are dependent on physical elements such as resistors and capacitors that may have a significant variation over process temperature and supply voltage. In addition in variable output frequency synthesizers the natural frequency loop bandwidth and damping factor of the PLL are dependent on the feedback divider modulus as well as the frequency of operation.

Dynamic analysis of a control system is usually performed using the transfer function which is a mathematical representation of the relationship between the input signal and the output signal of the system.

There are two parts to calibration of the PLL dynamics measuring the locations of the poles and zeros and adjusting the positions of the poles and zeros. Adjusting the positions of the poles and zeros in a locked PLL is achieved by adjusting the size of the loop capacitor resistor and charge pump currents. The more challenging task is the measurement of the positions of the poles and zeros in the presences of offsets and nonlinearities which are typically present in a PLL.

The prior art includes techniques for measuring a PLL s bandwidth by adding phase steps to the PLL and measuring the time until the phase of the PLL crosses zero. There are several important practical details which will limit the effectiveness of prior art techniques. A practical PLL can have a phase offset at its input due to circuit non idealities charge pump current miss match capacitor leakage etc . A crossover detection circuit e.g. a bang bang phase detector will have additional offsets which are distinct from the PLL s offsets. shows the phase at the PLL s input after a phase step as part of time to crossover measurement . A small offset 30 ps in can lead to a very large error in the time to crossover measurement limiting the effectiveness of prior art.

The errors caused by offsets will be less significant if the magnitude of the phase step is increased. However if the phase step is large then the PLL non linearities can also cause significant errors e.g. the VCO control voltage moves to a different point on its non linear tuning curve or the proportional path saturates . and show the simulated effects on crossover time if the PLL s non linearity is modeled and there are both non linearity and offsets. On the z axis is the magnitude of the phase step added normalized to the output period. On y axis is the time in references period for the PLL to re cross zero after a phase step is added. The dotted line corresponds to the time to crossover in the ideal linear offset free measurement. If there are non linearities in the system then the measurement is corrupted for large phase steps if there are offsets then the measurements are corrupted for small steps.

Embodiments of the invention provide a method and system in which a PLL s natural frequency wn and damping coefficient . cam be accurately measured and controlled even in the presence of PLL phase offsets.

In embodiments of the invention a phase step is injected into a locked PLL while simultaneously temporarily switching off the proportional path current which sets to 0 and the time to crossover is measured. The procedure is done twice with positive and negative phase steps. The average time to crossover in response to opposite polarity phase steps and with 0 is not a function of the phase offset of the PLL and is only a function of the integral path gain. Therefore the integral path gain can be adjusted until a target time to crossover is achieved corresponding to a desired .

Once and the offset are known the time to crossover with the proportional path turned on and with the known offset is measured. The gain of the proportional path is adjusted unit the time to crossover reaches the required value for a given . In embodiments of the invention phase steps are added to a PLL and the proportional and integral path gains are adjusted in such a way that the phase offset of the PLL can be measured and correct for.

From 3 the time to crossover is a function of and . In addition if the PLL has an offset then equation 3 is no longer valid.

Where refers to the time to crossover with a positive negative phase step. Swapping the polarity of the phase step is equivalent to swapping the polarity of the offset. When 

Thus the average time to crossover measurement with opposite polarity pulses and with 0 is only a function of .

For a stable PLL is typically set to be greater than 1. If the is close to zero then the PLL is on the edge of instability. This is not a desirable state to be in in a practical application. However can be temporarily set to zero by turning off the proportional path. Provided that the proportional path is turned off for less than the natural period of the PLL 2 then the PLL will not oscillate.

Step 1 The PLL is allowed to lock with the integral path and proportional path gains set to a default value.

Step 2 A phase step is introduced into the PLL by changing the count value within the programmable divider. Simultaneous to this the proportional path is turned off equivalent to setting 0 . The time to crossover is measured.

Step 3 The proportional path is turned on and the PLL is allowed to lock. The same procedure as in Step 2 is performed however with the phase step having the opposite polarity.

Step 4 The average time until crossover is calculated. Results from Step 2 3 . The average time to crossover is compared too a target value and the integral path gain is increased decreased if the average time to crossover is to large small. Steps 2 through 4 are repeated until the target value is achieved. From equation 5 the correct value of the has been achieved. Also with known the size of the offset can be calculated from equation 4 .

Step 5 the proportional path is turned on and the time to crossover is measured again. With and the offset known the only parameter left to fix is the proportional path gain which will set . For a known and offset a target time to crossover number is calculated for a given . The gain of the proportional path is incremented decremented if the result of the time to crossover measurement is too slow fast. This step is repeated until the time to crossover reaches a target value.

Improved results achieved by using embodiments of the invention can be seen by comparing and . shows in band phase noise of the PLL without use of this invention and illustrates in band phase noise of the PLL with use of an embodiment of the invention.

While it is apparent that the invention herein disclosed is well calculated to achieve the features discussed above it will be appreciated that numerous modifications and embodiments may be devised by those skilled in the art and it is intended that the appended claims cover all such modifications and embodiments as fall within the true spirit and scope of the present invention.

