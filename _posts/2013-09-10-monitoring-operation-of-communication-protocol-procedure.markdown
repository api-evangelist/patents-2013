---

title: Monitoring operation of communication protocol procedure
abstract: This document discloses a method, apparatus, and computer program for automatically detecting unallowed continuation of a communication protocol procedure in a communication device. The method comprises in a test tool: marking an invalid input applied to the communication device in a sequence of operations of the communication protocol procedure; marking, with a sequence marker, a location that should not be reached in the sequence of operations of the communication protocol procedure as a result of the invalid input; and upon detecting that the communication protocol procedure has reached the location marked with the sequence marker, outputting an indication that the communication device operates in an unallowed manner.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09110876&OS=09110876&RS=09110876
owner: Codenomicon Oy
number: 09110876
owner_city: Oulu
owner_country: FI
publication_date: 20130910
---
The invention relates to the field of communication protocols and particularly to monitoring operation of a communication protocol procedure carried out in a communication device.

Execution of a communication protocol in a communication device may be controlled by a computer program carried out by at least one processor of the communication device. The execution of the communication protocol comprises reception of inputs from a counterpart device communicating with the communication device according to the communication protocol. The inputs may comprise authentication data configuration data other protocol control data or application payload data transferred over the communication protocol. The communication device processes the inputs and provides a response to the input according to a program code of the computer program. The response to the inputs should comply with the specifications of the communication protocol security parameters etc. For example reception of false authentication data as the input should not result in successful authentication.

According to an aspect of the present invention there is provided a method for automatically detecting unallowed continuation of a communication protocol procedure in a communication device the method comprising in a test tool marking an invalid input applied to the communication device in a sequence of operations of the communication protocol procedure marking with a sequence marker a location that should not be reached in the sequence of operations of the communication protocol procedure as a result of the invalid input and upon detecting that the communication protocol procedure has reached the location marked with the sequence marker outputting an indication that the communication device operates in an unallowed manner.

According to another aspect of the present invention there is provided an apparatus for automatically detecting unallowed continuation of a communication protocol procedure in a communication device the apparatus comprising at least one processor and at least one memory including a computer program code. The at least one memory and the computer program code are configured with the at least one processor to cause the apparatus to mark an invalid input applied to the communication device in a sequence of operations of the communication protocol procedure mark with a sequence marker a location that should not be reached in the sequence of operations of the communication protocol procedure as a result of the invalid input and upon detecting that the communication protocol procedure has reached the location marked with the sequence marker output an indication that the communication device operates in an unallowed manner.

According to yet another aspect of the present invention there is provided a computer program product embodied on a non transitory distribution medium readable by a computer and comprising program instructions which when loaded into the computer execute a computer process for automatically detecting unallowed continuation of a communication protocol procedure in a communication device the process comprising marking an invalid input applied to the communication device in a sequence of operations of the communication protocol procedure marking with a sequence marker a location that should not be reached in the sequence of operations of the communication protocol procedure as a result of the invalid input and upon detecting that the communication protocol procedure has reached the location marked with the sequence marker outputting an indication that the communication device operates in an unallowed manner.

The following embodiments are exemplary. Although the specification may refer to an one or some embodiment s in several locations this does not necessarily mean that each such reference is to the same embodiment s or that the feature only applies to a single embodiment. Single features of different embodiments may also be combined to provide other embodiments. Furthermore words comprising and including should be understood as not limiting the described embodiments to consist of only those features that have been mentioned and such embodiments may contain also features structures that have not been specifically mentioned.

In an embodiment the test tool and the communication device are provided in physically separate devices and the communication interface may comprise a physical transmission medium external to both devices e.g. a wired transmission medium in the form of a cable a wireless link or even one or more computer networks may be provided between the test tool and the communication device. In another embodiment the test tool is provided in the communication device and the communication interface may in such an embodiment be a software interface e.g. an application programming interface API simulating the physical transmission medium.

In yet another embodiment the test engine is provided in the communication device while the communication unit is external to the communication device . In such an embodiment the test engine may be configured to monitor the operation of the communication device passively e.g. by reading and analysing contents of registers and records of the communication device examining contents of protocol messages transmitted and received by the communication unit and so on. It should be appreciated that there are various testing arrangements that may be used to test the operation of the communication device and the principles of the present invention are applicable also to other testing arrangements than those described herein.

An embodiment of the invention relates to automatically detecting unallowed continuation of a communication protocol procedure in the communication device . The automated detection may be realized by the test tool comprising at least the test engine according to a procedure illustrated in . Referring to the test tool detects an invalid input applied to the communication device in a sequence of operations of the communication protocol procedure block . In response to the detection of the invalid input the test tool marks with a sequence marker a location in the sequence of operations of the communication protocol procedure that should not be reached as a result of the invalid input block . The sequence marker thus indicates a location where it a decision can be made that the communication device operates in an unallowed manner provided that the location indicated by the sequence marker is actually reached in the communication protocol procedure. Embodiments of determining the location of the sequence marker are described below. Upon detecting that the communication protocol procedure has reached the location marked with the sequence marker block the test tool may determine that the communication protocol is continuing the operation when it should not and the test tool may output an indication that the communication device operates in an unallowed manner. The outputting may comprise creating a record comprising the invalid input and the location of the sequence marker to show which unallowed operation s the communication device carried out as a result of the invalid input.

The identification of the invalid input and determining the location for the sequence marker accordingly enables automated detection of unallowed operation of the communication device when it carries out a communication protocol procedure. Specifically the location of the sequence marker may indicate that the communication device is continuing the communication protocol procedure in the unallowed manner. The location marked with the sequence marker may be determined from the type location and or contents of the invalid input. It is known beforehand from the specification of the communication protocol specification of the communication device etc. how the communication device should operate in response to the invalid input e.g. the operational sequence should proceed according to a determined sequence of operations. The sequence marker may be arranged to mark a location in the operational sequence of the communication device that does not belong to this allowed sequence of operations but branches from the allowed sequence. Accordingly if the test tool detects that the location of the sequence marker has been reached the test tool is able to make a reliable decision that the operational sequence of the communication device has diverted from the allowed operational sequence and thus the communication device operates erroneously.

Above the execution of the communication control procedure is described as a sequence of operations carried out by the test tool and or the communication device . The communication control procedure executed by the test tool the communication device or they both may equally be considered as a state machine. The sequence marker may specify a certain state of the state machine that should not be reached. This certain state itself may not terminate the communication control procedure and or it may have outputs only to another state or states that neither terminates the communication control procedure. As a consequence this certain state may be considered as indicative of the continuation of the procedure and the sequence marker inserted to that state may specify that the continuation is not according to the intended design of the communication control protocol.

In an embodiment the invalid input is false authentication data and the sequence marker is inserted to a location which is at or following a successful completion of authentication. In this case the test tool knows beforehand that the false authentication data e.g. erroneous encryption key user name or password should not result in successful authentication. Accordingly the sequence marker may be inserted to a location where the test tool detects that the authentication has been successfully completed or to a location after the successful completion of the authentication. The location of the sequence marker after the successful completion of the authentication may depend on the communication protocol and the test case. For example if the test sequence comprises establishing a connection with the communication unit over the communication protocol carrying out the authentication and transferring data after the successful authentication the sequence marker may indicate a location where the data is being transferred. In general the sequence marker may mark any location in the operational sequence where it can be reliably determined that the communication device has diverted from the allowed operational sequence.

The communication protocol may be basically any communication protocol in the art. The embodiments of the invention are applicable to communication protocols on several protocol layers including the physical layer link layer network layer transport layer and application layer. Examples of the communication protocols that may be tested with the present invention include Internet protocol IP transport control protocol TCP user datagram protocol UDP stream control transmission protocol SCTP signalling system no. 7 SS7 secure sockets layer SSL hypertext transfer protocol HTTP physical and link layer protocols of Ethernet or any other wired communication protocol physical and link layer protocols IEEE 802.11 or any other wireless communication protocol etc.

In the testing arrangement shown in the invalid input may be comprised in a communication protocol message transmitted from the test tool to the communication device through the communication unit and using the communication protocol being tested. illustrates an embodiment of communication between the test tool and the communication device and automatically determining the erroneous operation of the communication device in response to the invalid input. Referring to the communication unit of the test tool and the communication device initialize a connection according to the specifications of the communication protocol being tested in block . Block may also or alternatively comprise other type of initialization in the test tool and or in the communication device e.g. the test tool retrieving a test case from a memory unit and launching the test case.

In block the test tool inserts invalid contents to a protocol message and creates an error location marker. The error location marker may specify the communication protocol message comprising the invalid contents and or the invalid contents in the communication protocol message. The error location marker may also indicate a location of the invalid communication protocol message in the operational sequence of the test case. As a consequence the error location marker may mark a location where the test tool has made an intentional error in order to test the response of the communication device to the erroneous operation of the test tool . The invalid contents may be the invalid authentication data as described above. In another embodiment the invalid contents do not comply with the communication protocol e.g. an invalid field format of the message or invalid contents in the field s . In some communication protocols a certain portion of the protocol message is specified to have a fixed value and the test tool may change this fixed value to another invalid value. In this case the sequence marker may mark a location where the communication protocol procedure proceeds without reception of any error message etc. from the communication device. In some communication protocols the use of weak security keys is prohibited in the communication and the invalid contents may specify an attempt to use such a weak security key. In this case the sequence marker may mark a location where the test tool detects that the communication device has accepted the use of such a weak security key.

Block may also comprise inserting the sequence marker to mark the location in the upcoming operational sequence that should not be reached as a result of the invalid contents of the protocol message. In this case let us assume that the invalid contents should terminate the operation of the communication protocol procedure or to result in reception of an error message from the communication device. As a consequence the sequence marker may be inserted to a location in a branch of the operational sequence where the communication control procedure continues without reception of any error message from the communication device . In another embodiment the sequence marker is initially present in the computer program code defining the test setup.

In block the communication unit of the test tool transmits the protocol message and the communication device receives the protocol message in block . In block the communication device processes the received protocol message and carries out the communication protocol procedure in an unallowed manner. The erroneous operation may be caused by errors in programming the communication device for example. In block the communication device transmits a protocol message to the communication unit of the test tool. This protocol message may be for example a response to the protocol message of blocks or another message that indicates the unallowed progress of the procedure. The sequence marker may indicate a location of analysing the contents of this protocol message received from the communication device in block . If the contents of the protocol message indicate the unallowed continuation of the procedure this may trigger the creation of an error report about the unallowed operation of the communication device block . On the other hand if the received protocol message comprises an error message or otherwise indicates allowed operation of the communication device the test tool may determine that the communication device responds correctly to the invalid input.

The error location marker and the sequence marker s may be linked to each other. The link may be provided at least through the fact that they are both comprised in the same test case. In another embodiment both the error location marker and the sequence marker s have the same identifier s within a computer program code defining the test case. For example the error location marker marking the location of the invalid input may be defined within a computer program code as 

where Verdict serves as an identifier Error may define that the marker is the location of the invalid input and Payload Auth data specifies that the error is in authentication data used as the invalid. The corresponding sequence marker may be defined within the computer program code as 

The sequence marker shares the same identifier Verdict with the corresponding error location marker and Check Auth may be used as an element specifying that the sequence marker relates to the authentication procedure. If the computer program executing the test case detects the sequence marker in the execution of the operational sequence authentication may be interpreted to have been successfully completed indicating that the communication device continues its operation in the unallowed manner and the creation of the error report may be triggered. The error report may comprise the invalid input that caused the creation of the error report. The invalid input may be highlighted in the error report. The test tool may use at least one element in the error location marker and or in the sequence marker to include in the error report the procedure that operates in the unallowed manner. For example the test tool may use the element Check Auth and or the element Payload Auth data to indicate in the error report that the unallowed operation happens in the authentication procedure. Thus the provision of the same identifier or use of other means to link the location of the invalid input and the sequence marker enables both the detection of the unallowed operation of the communication device and creation of effective error reports where the invalid input and the result of the invalid input are shown.

In an embodiment the above described error location marker and the sequence marker are just notifications of a determined state in the operational sequence for the test tool . The test tool may be configured to execute the computer program code defining the test case and upon detecting the error location marker or the sequence marker within the computer program code the test tool may call a determined function related to the corresponding marker e.g. the detection of the sequence marker may trigger the termination of the test case and or creation of the error report.

In another embodiment the sequence marker is simply a mark in the operation sequence or in a sequence of functions carried out by the test tool or the communication device depending on the embodiment. In this case the sequence marker is not necessarily a function but a character symbol or a character string within the computer program code that informs the test tool that the operational sequence has reached a certain phase. The appearance of the sequence marker thus serves as the verification that the communication device has allowed the procedure to continue in an undesired manner regardless of the invalid input.

In another embodiment the invalid input the error location marker and the sequence marker are added to a machine readable protocol specification which is read and executed by the test tool . The machine readable protocol specification may define the operations of the authentication procedure according to the specified protocol in a machine language e.g. a computer program code.

The test tool may execute any one of the above described testing processes as a part of a series of test cases. illustrates an embodiment where the test tool tests the operation of the communication device by carrying out multiple test cases. The test tool may employ the above mentioned fuzz testing or black box testing and automatically create numerous test cases wherein each test case may comprise at least one invalid input to test the unallowed continuation of the communication protocol procedure. In an embodiment the number of automatically created test cases is over one hundred. In another embodiment the number of automatically created test cases is over one thousand.

Referring to the test tool selects in block the test cases to be carried out. The selection of the test cases and the selection of the invalid input data to be used may be selected by the test tool automatically or at least some of the test cases and or the invalid input data to be used may be selected manually by an operator of the test tool . The automated manual selection may depend on the communication protocol to be tested. If the communication protocol is specified in such detail that the location of the error location marker and associated sequence marker may be determined beforehand e.g. Internet Key Exchange IKE or IKEv2 the test tool may select the test case for such a protocol the invalid data and the locations of the error location marker and the sequence marker autonomously without user interaction. On the other hand if the communication protocol does not provide any strict protocol specification e.g. authentication for a HTTP cookie the operator may input the markers for the location of the authentication token in a HTTP payload data and for the sequence marker.

In block the test tool carries out the test procedure of or any one of its embodiments described herein for each test case selected in block . In block the test tool compiles a test report or a plurality of test reports showing in a highlighted manner the invalid inputs that have caused unallowed operation of the communication device .

The embodiments described above provide an indication that the test cases comprise testing the response of the communication device to a situation where one type of data is invalid e.g. the authentication data. It should be appreciated that in some test cases the test tool may test the response of the communication device to a situation where the input data is invalid in multiple ways. For example the protocol message may comprise invalid authentication data and the protocol message may be arranged to be incompatible with the communication protocol specification. There may be situations where the communication device is capable of operating correctly when one only type of input is invalid at a time but a combination of two or more invalid inputs may cause erratic behavior in the operation of the communication device . The embodiments of the invention covers also simultaneous testing with multiple types of invalid input data.

Referring to the apparatus comprises the communication unit operating according to at least one communication protocol tested with the test tool. The apparatus may further comprise an input output I O circuitry providing a physical connection to the communication device . The I O circuitry may comprise physical components needed for realizing a wired or wireless connection with the communication device . Additionally the I O circuitry may realize any communication protocols below the communication protocol s supported by the communication unit in a protocol stack in order to provide the connection with the communication device .

The apparatus may further comprise a memory comprising a test case database and at least one computer program specifying the operation of the test tool in connection with carrying out the testing and selecting the test cases. The test case database may store information on the invalid inputs to be used in the testing associated error location markers specifying where the invalid inputs should be inserted and associated sequence markers specifying a location which should not be reached in the test case if the communication device operates in an intended manner with respect to the invalid input.

The apparatus may further comprise a user interface comprising an input device for enabling user to input commands and or data into the apparatus and an output device for outputting information e.g. the test report to the user. The output device may comprise a display screen.

The apparatus may further comprise the test engine realized by at least one processor or processing circuitry of the apparatus and the computer program . The test engine may comprise as sub circuitries or sub routines a test case generator configured to select the test cases to be carried out. The test case generator may retrieve at least some of the test cases from the test case database . The test case generator may also retrieve the associated markers and output the selected test cases to a test case engine controlling the execution of each test case. The test case engine may be configured to derive from the error location marker a location to which insert the invalid input and to control the communication unit to transmit the protocol message with the invalid input to the communication device in the appropriate instance in the operational sequence of the communication protocol and the test case. The test case engine may also output a corresponding sequence marker to a sequence progress monitor circuitry configured to monitor the progress of the test case. The sequence progress monitor circuitry may be configured to monitor the operation of the communication unit and the progress of the communication protocol procedure. The communication unit may be configured to output to the sequence progress monitor circuitry information on messages it transmits to and receives from the communication device . As a consequence the sequence progress monitor circuitry is constantly aware of the progress of the test case and the communication protocol procedure. When the sequence progress monitor circuitry detects that the progress has reached a location indicated by the sequence marker received from the test case engine the sequence progress monitor circuitry may output a notification to the test case engine . The test case engine may then call an error report generator to record an error report. The test case engine may provide the error report generator with information on the invalid input used in the test case and information on the location of the sequence marker to specify the result of the invalid input. The error report generator may then store the report in the memory .

In embodiments where the test tool is comprised in the communication device the apparatus may be a computer a server a portable computer a palm device a measurement device etc. capable of communicating with other devices according to at least one communication protocol. The test tool may then be realized as the computer program and utilize a processor or processors and a memory or memories of the communication device in the execution of the testing. The operation of the test tool may still follow the principles described herein.

As used in this application the term circuitry refers to all of the following a hardware only circuit implementations such as implementations in only analog and or digital circuitry b combinations of circuits and software and or firmware such as as applicable i a combination of processor s or processor cores or ii portions of processor s software including digital signal processor s software and at least one memory that work together to cause an apparatus to perform specific functions and c circuits such as a microprocessor s or a portion of a microprocessor s that require software or firmware for operation even if the software or firmware is not physically present.

This definition of circuitry applies to all uses of this term in this application. As a further example as used in this application the term circuitry would also cover an implementation of merely a processor or multiple processors or portion of a processor e.g. one core of a multi core processor and its or their accompanying software and or firmware. The term circuitry would also cover for example and if applicable to the particular element a baseband integrated circuit an application specific integrated circuit ASIC and or a field programmable grid array FPGA circuit for the apparatus according to an embodiment of the invention.

The processes or methods described in may also be carried out in the form of a computer process defined by a computer program. The computer program may be in source code form object code form or in some intermediate form and it may be stored in some sort of carrier which may be any entity or device capable of carrying the program. Such carriers include transitory and or non transitory computer media e.g. a record medium computer memory read only memory electrical carrier signal telecommunications signal and software distribution package. Depending on the processing power needed the computer program may be executed in a single electronic digital processing unit or it may be distributed amongst a number of processing units.

The present invention is applicable to test tools and communication protocols defined above but also to other scenarios. The communication protocols and test methods may develop over time and such development may require extra changes to the described embodiments. Therefore all words and expressions should be interpreted broadly and they are intended to illustrate not to restrict the embodiments. It will be obvious to a person skilled in the art that as technology advances the inventive concept can be implemented in various ways. The invention and its embodiments are not limited to the examples described above but may vary within the scope of the claims.

