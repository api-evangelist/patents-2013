---

title: Data storage based on content popularity
abstract: Methods, systems, and software for operating a data storage system of a content delivery node are provided herein. In one example, a method of operating a data storage system of a content delivery node is presented. The method includes receiving content data into a storage system, storing the content data in a first storage space, determining popular content data within the content data based on at least user requests for the content data, and storing the popular content data in a second storage space.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09491253&OS=09491253&RS=09491253
owner: Fastly, Inc.
number: 09491253
owner_city: San Francisco
owner_country: US
publication_date: 20131127
---
This application hereby claims the benefit of and priority to U.S. Provisional Patent Application 61 730 419 titled DATA STORAGE BASED ON CONTENT POPULARITY filed Nov. 27 2012 and which is hereby incorporated by reference in its entirety.

Network provided content such as Internet web pages or media content such as video pictures music and the like are typically served to end users via networked computer systems. End user requests for the network content are processed and the content is responsively provided over various network links. These networked computer systems can include origin hosting servers which originally host network content of content creators or originators such as web servers for hosting a news website. However these computer systems of individual content creators can become overloaded and slow due to frequent requests of content by end users.

Content delivery systems have been developed which add a layer of caching between the origin servers of the content providers and the end users. The content delivery systems typically have one or more content delivery nodes distributed across a large geographic region to provide faster and lower latency access to the content for the end users. When end users request content such as a web page which is handled through a content delivery node the content delivery node is configured to respond to the end user requests instead of the origin servers. In this manner a content delivery node can act as a proxy for the origin servers.

Content of the origin servers can be cached into the content delivery nodes and can be requested via the content delivery nodes from the origin servers of the content originators when the content has not yet been cached. Content delivery nodes usually cache only a portion of the original source content rather than caching all content or data associated with an original content source. The content delivery nodes can thus maintain only recently accessed and most popular content as cached from the original content sources. Thus content delivery nodes exchange data with the original content sources when the end users request new or un cached information or if something has changed in the original content source data.

Methods systems and software for operating a data storage system of a content delivery node are provided herein. In one example a method of operating a data storage system of a content delivery node is presented. The method includes receiving content data into a storage system storing the content data in a first storage space determining popular content data within the content data based on at least user requests for the content data and storing the popular content data in a second storage space.

Network content such as web page content typically includes content such as text hypertext markup language HTML pages pictures video audio code scripts or other content viewable by an end user in a browser or other application. This various network content can be stored and served by origin servers and equipment. The network content includes example website content referenced in such as www.gamma.gov www.alpha.com and www.beta.net among others. In some examples origin servers can serve the content to end user devices. However when a content delivery system is employed the content delivery system can act as a proxy to cache content delivery between origin servers and the end user devices.

Content delivery systems can add a layer of caching between origin servers of the content providers and the end users. The content delivery systems typically have one or more content delivery nodes distributed across a large geographic region to provide faster and lower latency local access to the content for the end users. When end users request content such as a web page a locally proximate content delivery node will respond to the content request instead of the associated origin server. Various techniques can be employed to ensure the content delivery node responds to content requests instead of the origin servers such as associating web content of the origin servers with network addresses of the content delivery nodes instead of network addresses of the origin servers using domain name system DNS registration and lookup procedures.

As a first example employing a content delivery system is presented. is a system diagram illustrating communication system . Communication system includes content delivery system end user devices origin servers and management system . Content delivery system includes one or more content delivery nodes CDN . Each of CDN can include one or more data storage systems such as that illustrated for CDN as data storage system . End user devices are representative of a plurality of end user devices that can request and receive network content and any number of end user devices can be associated with each of content delivery nodes . CDN and ones of end users communicate over associated network links . Content delivery system and origin servers communicate over associated network links . Content delivery system and management system communicate over link . Although not shown in for clarity each of CDN can also communicate with each other over network links.

To further illustrate a brief description of the operation of communication system is included. In operation end user devices request network content such as content associated with origin servers . Instead of these requests being handled by the individual origin servers individual content delivery nodes of content delivery system receive the content requests over ones of links and processes the content requests for delivery of the content to the associated end user devices . Requested network content that is already stored in ones of CDN can be provided quickly to the end user devices while network content that is not already stored in ones of CDN can be responsively requested by an associated one of CDN from an appropriate origin server for delivery by the CDN and possible caching by the CDN. In this manner each of CDN can act as intermediary proxy nodes to provide local and fast access for end user devices to network content of origin servers without burdening origin servers . shows cached content included in data storage system of CDN as comprised of content and thus content is currently shown as cached by CDN . Other configurations are possible including subsets of content being cached in individual ones of CDN .

Although shows content of origin servers being cached by data storage system other content can be handled by CDN . For example dynamic content generated by activities of end user devices need not originally reside on origin servers and can be generated due to scripting or code included in web page content delivered by CDN . This dynamic content can also be cached by ones of CDN and can be specific to a particular end user device during a communication session.

Management system handles configuration changes and status information collection and delivery for system operators and for the origin server operators or managers. For example operator device can transfer configuration for delivery to management system where configuration can alter the handling of network content requests by CDN among other operations. Also management system can monitor status information for the operation of CDN such as operational statistics and provide this status information as to operator device . Furthermore operator device can transfer content for delivery to origin servers to include in content . Although one operator device is shown in it should be understood that this is merely representative and communication system can include many operator devices for receiving status information providing configuration information or transferring content to origin servers.

In data storage system will receive content data due to a cache triggering event . A cache triggering even can include an end user device request for the content an indication of updated origin content to replace existing cached content dynamic end user content or the caching algorithms employed by CDN such as predictive caching among other operations. Such content can include text hypertext markup language HTML pages pictures video audio code scripts or other content viewable by an end user in a browser or other application. The data storage system caches the received content in a first storage space . In one example the first storage space can comprise a volatile random access memory such as dynamic random access memory DRAM .

Thereafter requests for the cached content by end users will be monitored to determine a popularity of the cached content . The popularity of the content can be determined by establishing a popularity threshold for the content. The popularity threshold can be determined based on a quantity of end user requests for the content or a portion thereof over a period of time. This period of time can be over the duration from when the content is cached until the next downtime or idle time for the data storage system can be until a certain time of day such as night time or can be over any other period of time. In some examples the popularity can be determined by the number of requests by the end users for the cached content compared to a threshold quantity of requests. In other examples the popularity can be determined by the percentage of requests by the end users related to a total amount of requests for other content for the cached content compared to a threshold popularity percentage. In still other examples the popularity can be determined using any statistical measure of the requests for the cached content. Management system can be used in some examples to define the requirements necessary for content to be considered popular.

If the cached content is determined to be popular such as by being requested enough times by the end users or exceeding a popularity threshold the system will transfer the cached content into a second storage space . Alternatively if the cached content is not popular such as by not being requested enough times by the end users or not exceeding the popularity threshold the storage system will not store the cached content in the second storage space . The second storage space can consist of hard drives solid state drives or any other similar form of nonvolatile memory.

In one example the content transferred to the second storage space may be removed or deleted from the first storage space. In another example the content transferred to the second storage space may remain in the first storage space.

In one example the content not transferred to the second storage space may be removed or deleted from the first storage space. In another example the content not transferred to the second storage space may remain in the first storage space.

The caching capacity of CDN bounded by the combined capacity of its first and second storage spaces. This caching capacity is effectively diminished when the same cached content is duplicated in both storage spaces. Reduced caching capacity may cause more cache misses and so increase the load on the origin server and increase response latency. Caching capacity can be preserved by evicting from a full storage space some cached content that resides in both storage spaces. One way to minimize duplication is to reduce the popularity score of content that simultaneously resides in both storage spaces thereby making evicting from the first storage space more likely for content that already resides in the second storage space. For example content duplicated in both storage spaces may always be deemed unpopular when selecting content to evict from the first storage space regardless of counted requests.

A poorly chosen popularity threshold may degrade the performance of CDN . If the threshold is too low too much cached content is transferred to the second storage space. Excessive transferring overwhelms the second storage space which succumbs to churn. If the threshold is too high the second storage space may be underutilized either by filling incompletely or by retaining content no longer needed.

Caching relies on repeated requests for the same content. Caching works best when these requests are clustered in time. Requests for some content may be repeated but not clustered in time. Caching such content faces two hurdles. Because the requests are not clustered in time the content may be scored as unpopular most of the time. Even if the content is recognized as popular and transferred to the second storage space the content may soon be evicted from both storage spaces for lack of popularity. For example it may be optimal to cache an online cookbook all day even though its recipes only score as popular before meals. This scenario can be accommodated in two ways. The time interval over which CDN measures popularity can be increased such that intermittent requests for the same content are counted in the same interval thereby increasing the measured popularity of the content. A more sophisticated implementation may in addition to increasing the popularity measurement interval weight the requests according to recentness such that a recent request increases the popularity score more than does an older request in the same time interval.

To further describe the operation of any CDN in is provided which illustrates content delivery node CDN . It should be understood that CDN can each use other configurations and CDN is merely one example. CDN includes communication interface processing system random access memory RAM and storage . Example contents of RAM are further detailed in RAM space and example contents of storage are further detailed in storage system .

In operation processing system is operatively linked to communication interface RAM and storage . Processing system is capable of executing software stored in RAM or storage . When executing the software processing system drives CDN to operate as described herein. CDN can also include other elements such as user interfaces computer systems databases distributed storage and processing elements and the like.

Processing system can be implemented within a single processing device but can also be distributed across multiple processing devices or sub systems that cooperate in executing program instructions. Examples of processing system include general purpose central processing units microprocessors application specific processors and logic devices as well as any other type of processing device.

Communication interface includes one or more network interfaces for communicating over communication networks such as packet networks the Internet and the like. The network interfaces can include one or more local or wide area network communication interfaces that can communicate over Ethernet or Internet protocol IP links. Examples of communication interface include network interface card equipment transceivers modems and other communication circuitry.

RAM and storage together can comprise a data storage system such as that illustrated in data storage system in although variations are possible. RAM and storage can each comprise any storage media readable by processing system and capable of storing software. RAM can include volatile and nonvolatile removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. Storage can include non volatile storage media such as hard drives solid state storage media flash memory or as illustrated by drive storage system in this example. RAM and storage can each be implemented as a single storage device but can also be implemented across multiple storage devices or sub systems. RAM and storage can each comprise additional elements such as controllers capable of communicating with processing system . In some implementations the storage media can be a non transitory storage media. In some implementations at least a portion of the storage media can be transitory. It should be understood that in no case are the storage media propagated signals.

Software stored on or in RAM or storage can comprise computer program instructions firmware or some other form of machine readable processing instructions having processes that when executed by processing system direct CDN to operate as described herein. For example software drives CDN to receive requests for content determine if the content is stored in CDN retrieve content from origin servers transfer content to end user devices manage data storage systems for handling and storing the content among other operations. The software can also include user software applications. The software can be implemented as a single application or as multiple applications. In general the software can when loaded into processing system and executed transform processing system from a general purpose device into a special purpose device customized as described herein.

RAM space illustrates a detailed view of an example configuration of RAM . It should be understood that different configurations are possible. RAM space includes applications operating system OS and content RAM cache . Content RAM cache includes RAM space for temporary storage of content received over content interface such as dynamic random access memory DRAM . In at least one example content RAM cache can correspond to the first data space from .

Applications include content interface configuration interface statistics interface and content caching application . Content caching application handles caching of content and management of storage spaces such as content RAM cache and storage space as well as exchanges content data and instructions via content interface configuration interface and statistics interface . Content caching application can comprise a custom application Varnish caching software hypertext transfer protocol HTTP accelerator software or other content caching and storage applications including variation modifications and improvements thereof. Applications and OS can reside in RAM space during execution and operation of CDN and can reside in system software storage space on drive storage system during a powered off state among other locations and states. Applications and OS can be loaded into RAM space during a startup or boot procedure as described for computer operating systems and applications.

Content interface configuration interface and statistics interface each allows a user to interact with and exchange data with content caching application . In some examples each of content interface configuration interface and statistics interface comprise an application programming interface API . Content interface allows for exchanging content for caching in CDN by content caching application and can also receive instructions to purge or erase data from CDN . Configuration interface allows for altering the configuration of various operational features of content caching application . In some examples configuration interface comprises a scripting language interface such as Varnish Configuration Language VCL Perl PHP Javascript or other scripting or interpreted language based interfaces. Statistics interface allows for exchange of statistical information related to the operation of CDN such as the popularity of content items in content RAM cache cache hits misses cache fullness information cache performance statistics timing statistics history metrics among other statistical information. Content interface configuration interface and statistics interface each can communicate with external systems via communication interface over any associated network links.

Drive storage system illustrates a detailed view of an example configuration of storage and in some examples storage space comprises the second storage space as described in . Storage system can comprise flash memory such as NAND flash or NOR flash memory hard drives among similar data storage technologies. As shown in drive storage system includes software as well as content stored in storage space . As described above system software can be a non volatile storage space for applications and OS during a powered down state of CDN among other operating software. Content includes cached content such as the web content examples in which can include text data pictures video audio web pages scripting code dynamic content or other network content.

It should be understood that content delivery node is generally intended to represent a computing system with which at least software and are deployed and executed in order to render or otherwise implement the operations described herein. However content delivery node can also represent any computing system on which at least software and can be staged and from where software and can be distributed transported downloaded or otherwise provided to yet another computing system for deployment and execution or yet additional distribution.

The method begins at time T by storing requested content in content RAM storage upon a cache triggering event. A cache triggering event can include an end user device request for the content an indication of updated origin content to replace existing cached content dynamic end user content or the caching algorithms employed by CDN such as predictive caching among other operations.

Next at time T additional content can be stored in content RAM storage upon one or more other cache triggering events. Although three content items are included in the present example it should be understood that any number of content items could be stored.

As content is saved in content RAM storage the number of requests for content can be tracked to determine the popularity of the content. This tracking for popularity can be over a set period of time can be until a downtime in the system can be until a specific time predetermined time or any other period of time. Popularity of the content can be determined from the number of requests made for the content the ratio of requests made for the content in comparison to the total requests for all content or any other measure of popularity for the content. These popularity numbers can then be compared to a threshold value request number ratio number percentage etc. to classify the content as popular or unpopular.

After content has been tracked over the specified period of time and has been classified as popular or unpopular the popular content is then stored in drive storage at time T. In the present example content and content were considered popular however any number of content can be considered popular.

In some examples the data cached to drive storage may be removed or deleted from content RAM storage . In other examples the data cached to drive storage may remain in content RAM storage .

In some examples the data not cached to drive storage may be removed or deleted from content RAM storage . In other examples the data cached to drive storage may remain in content RAM storage .

Cache node includes content caching software DRAM and flash drive . Cache node is an example that customizes CDN of for efficient handling of repeated end user requests for the same dynamically generated content. shows cache node taking content requests sent from tablets of customers browsing a website hosted on apparel shop server . The apparel website lets customers search for products by keyword. Apparel shop server dynamically generates search results for each product keyword search that it receives. Customers use tablets or other Internet devices to browse the apparel website and enter product keyword searches. In this example users of customer tablets enter product searches for the keyword hats. 

Cache node is included to prevent apparel shop server from being overwhelmed by product keyword searches. Cache node accomplishes this by handling repeated product search requests having the same keywords without involving apparel shop server . illustrates this by showing multiple search requests and by customers for the keyword hats but only search request of those is actually sent to apparel shop server . Although shows three search requests sent to cache node two thirds of these are handled without involving apparel shop server .

All product keyword searches are intercepted by cache node and examined by content caching software which corresponds to content caching application in . For each search request content caching software checks whether matching search results are cached in DRAM which corresponds to content RAM cache of . Search request shows how cache node performs when DRAM is empty. This causes cache miss for which cache node delegates the product keyword search to apparel shop server acting as origin server. Apparel shop server spends two seconds performing the product search and then returns search results to cache node which caches the search results in DRAM . Cache node relays a copy as search results back to inquiring customer . DRAM is no longer an empty cache. Cache node is ready to offload from apparel shop server the remaining product keyword searches and .

Eventually some other customer enters the same product keyword search for hats. Since DRAM already has the corresponding search results content caching software handles search request differently than search request was handled. Cache node reacts to DRAM cache hit by sending cached search results back to this other user. Cache node also notices that the keyword hats has now been searched twice. In this example the popularity threshold is end user request. Having crossed the popularity threshold cached search results is written to durable storage shown as flash drive which corresponds to drive storage system in . Flash drive may be any internal or external solid state drive. A removable drive such as a USB flash drive allows for replacement of a failed drive by hot swapping in a spare drive. As such an implementation of cache node may avoid downtime when its drive needs replacement.

Despite the cache having some contents a cache miss may still occur as when a customer enters a unique keyword search that is unlikely to already be cached such as extra large striped hats. Hence apparel shop server might always receive a small subset of search requests. In this example a search results already residing in flash drive may eventually be evicted from DRAM while remaining in flash drive shown as DRAM eviction . Cache node handles this without any additional load on apparel shop as shown by product keyword search request . Although DRAM lacks results for search request DRAM receives cached search results as retrieved from flash drive . Cache node relays a copy as cached search results back to a customer .

Referring back to CDN origin servers and management system can each include communication interfaces network interfaces processing systems computer systems microprocessors storage systems storage media or some other processing devices or software systems and can be distributed among multiple devices. Examples of CDN origin servers and management system can each include software such as an operating system logs databases utilities drivers caching software networking software and other software stored on a computer readable medium. Content delivery system in addition to including CDN can include equipment and links to route communications between CDN and any of end user devices origin servers and management system among other operations.

End user devices can each be a user device subscriber equipment customer equipment access terminal smartphone personal digital assistant PDA computer tablet computing device e book Internet appliance media player game console or some other user communication apparatus including combinations thereof.

Communication links each use metal glass optical air space or some other material as the transport media. Communication links can each use various communication protocols such as Time Division Multiplex TDM asynchronous transfer mode ATM Internet Protocol IP Ethernet synchronous optical networking SONET hybrid fiber coax HFC circuit switched communication signaling wireless communications or some other communication format including combinations improvements or variations thereof. Communication links can each be a direct link or can include intermediate networks systems or devices and can include a logical network link transported over multiple physical links. Although one main link for each of links is shown in it should be understood that links are merely illustrative to show communication modes or access pathways. In other examples further links can be shown with portions of the further links shared and used for different communication sessions or different content types among other configurations. Communication links can each include many different signals sharing the same associated link as represented by the associated lines in comprising resource blocks access channels paging channels notification channels forward links reverse links user communications communication sessions overhead communications carrier frequencies other channels timeslots spreading codes transportation ports logical transportation links network sockets packets or communication directions.

The included descriptions and figures depict specific embodiments to teach those skilled in the art how to make and use the best mode. For the purpose of teaching inventive principles some conventional aspects have been simplified or omitted. Those skilled in the art will appreciate variations from these embodiments that fall within the scope of the invention. Those skilled in the art will also appreciate that the features described above can be combined in various ways to form multiple embodiments. As a result the invention is not limited to the specific embodiments described above but only by the claims and their equivalents.

