---

title: Generating an avatar from real time image data
abstract: Technology is disclosed for automatically generating a facial avatar resembling a user in a defined art style. One or more processors generate a user 3D head model for the user based on captured 3D image data from a communicatively coupled 3D image capture device. A set of user transferable head features from the user 3D head model are automatically represented by the one or more processors in the facial avatar in accordance with rules governing transferable user 3D head features. In some embodiments, a base or reference head model of the avatar is remapped to include the set of user head features. In other embodiments, an avatar head shape model is selected based on the user 3D head model, and the transferable user 3D head features are represented in the avatar head shape model.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09508197&OS=09508197&RS=09508197
owner: MICROSOFT TECHNOLOGY LICENSING, LLC
number: 09508197
owner_city: Redmond
owner_country: US
publication_date: 20131101
---
Controlling an avatar in a computer game or multimedia application enhances the reality of an unreal virtual environment for a user and enhances the user s engagement in the action. An avatar typically has skills which the user does not have in reality as part of the game or multimedia experience. Additionally a user may be able to select clothing hair style and an eye color of the avatar which may or may not resemble the actual user. However no matter how different is the character selected to be the user s avatar the user typically desires to see himself or herself in the avatar.

The technology provides one or more embodiments for automatically generating a facial avatar resembling a user in a defined art style from real time image data tracking a user s face.

An embodiment of a method for automatically generating a facial avatar resembling a user in a defined art style comprises capturing three dimensional 3D image data of user head features including facial features by a 3D capture device and generating a user 3D head model for the user based on the captured 3D image data by one or more processors communicatively coupled to the 3D capture device. A set of transferable user head features is identified by the one or more processors from the user 3D head model which can be represented in the facial avatar based on stored transferable head feature rules for the defined art style. A set of avatar character head features for representing the set of transferable user head features are identified as well by the one or more processors based on the transferable head features rules for the defined art style. The facial avatar is generated in the defined art style including the set of avatar character head features. The facial avatar is displayed by a display communicatively coupled to the one or more processors.

In another embodiment one or more processor readable storage devices have encoded thereon instructions for causing one or more processors to perform an embodiment of a method for automatically generating a facial avatar resembling a user in a defined art style. The embodiment of the method comprises generating a user 3D head model for the user based on captured 3D image data by one or more processors communicatively coupled to a 3D capture device. A set of transferable user head features is identified by the one or more processors from the user 3D head model which set can be represented in the facial avatar based on stored transferable head feature rules for the defined art style. A set of avatar character head features for representing the set of transferable user head features are identified as well by the one or more processors based on the transferable head features rules for the defined art style. The facial avatar is generated in the defined art style including the set of avatar character head features and is displayed by a display communicatively coupled to the one or more processors. Additionally the one or more processors update a facial expression of the facial avatar responsive to changes detected in user facial features and update the displayed facial avatar with the updated facial expression.

An embodiment of a system for automatically generating a facial avatar resembling a user in a defined art style comprises one or more 3D image capture devices including one or more depth sensors one or more displays and one or more memories for storing measurement metrics for user 3D head data and rules identifying a set of transferable user head features which can be represented by the facial avatar. The system embodiment further comprises one or more processors having access to the one or more memories and being communicatively coupled to the one or more 3D image capture devices for receiving 3D image data including a depth value for user head features including facial features and being communicatively coupled to the one or more displays. The one or more processors generate a user 3D head model for the user based on the 3D image data and perform measurements of the user 3D head model in accordance with the measurement metrics for user 3D head data. The one or more processors automatically represent at least a subset of user head features from the user 3D head model in the facial avatar of the defined art style based on the rules identifying a set of transferable user head features and the measurements of the user 3D head model and cause the one or more displays to display the facial avatar resembling the user in the defined art style.

This Summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This Summary is not intended to identify key features or essential features of the claimed subject matter nor is it intended to be used as an aid in determining the scope of the claimed subject matter.

Technology is described for automatically generating a facial avatar in a defined art style which resembles a user based on image data captured of the user and a predetermined set of transferable head including facial features associated with the defined art style. In embodiments discussed below human facial features can be represented in one or more shape units associated with a head model. As described further below depth and image data of a user s head features including facial features can be captured. Typically a point cloud of points having 3D Cartesian or polar coordinates with respect to an origin of a coordinate system can be used to represent the head and facial features by facial modelling software. A mesh e.g. a triangular or polygon mesh may be used to connect or fit the points of the point cloud.

Differences between the points or vertices in the mesh and a reference human head model can be identified and stored as coefficients of 3D space vectors. In some examples the coefficients values may be between 0 and 1 where a 1 means an exact correspondence between a vertex in the fitted mesh and the corresponding vertex in the human head reference model. A shape unit is a collection of these 3D vertices which represents a head feature or an aspect of a head feature. If not just the boundary points of a shape unit but also the points on the interior of the shape unit only differ in scale from the human head reference model then a scalar coefficient value between 0 and 1 may be applied to all the points in the shape unit at the same time simplifying transformation operations for generating a 3D head model of the user s head and face. The more varied and detailed the collection of human head reference models stored the more likely scalar coefficient operations on a shape unit may be performed.

A few examples of shape units are illustrated in the figures below but embodiments of the technology may use numbers of space units like 50 80 or even 300. Some examples of shape units are face center depth nose height jaw size nose size mouth size eyes depth mouth height nose depth eye size face roundness mouth width eyes angle nose pinch eye width face heart face square eye height jaw height face flat cheek bones width nose width jaw curve cheek bone size forehead roundness lip lower depth forehead flat section nose flesh fullness lips thinness nose bridge depth jaw angle cheeks sink brow depth nostrils width jaw line depth nose bridge slope cheeks definition jaw corner width lip lower size chin width nose roundness eyelids lower height chin depth forehead definition eyelids smoothness jaw definition cheek fat mouth side fat jaw line forehead line and skull wideness. The shape units may incorporate measurements or provide a basis for making measurements which relate facial features for example in terms of distance angular position relationship and proportional size relationships. Position and proportion relationships help maintain a facial resemblance to a user despite differences in facial feature shapes distinctive to the avatar art style.

The art style defined for an avatar directs which user facial features are transferable to the avatar via a set of transferable head feature rules. For example an avatar of an alien with in an art style dictating diamond shaped heads may indicate a jawline or jaw shape is not transferable however proportions and angular relations between the eyes nose and mouth as well as forehead height and chin height may be transferable. Some examples of transferable facial features which this diamond head shaped alien art style may allow are a distance between eye corners of the different eyes lip shape eye shape and the distance between a nose tip and an upper lip in proportion to a face area. Another example is a distance from an eye corner to a tip of a nose in proportion to the face area. In some examples one or more user head features are represented by one or more symbol features in the defined art style. For example facial or head furniture like a hat style may be substituted for the head shape. A person with a round head wears a rounded woolen hat while a person with a square head wears a bucket style hat.

Two different approaches are described in the discussion of the figures below for automatically representing at least a subset of user head features in a facial avatar of a defined art style.

Other system embodiments may use other types of computer systems such as desktop computers and mobile devices like laptops smartphones and tablets including or communicatively coupled with depth sensitive cameras for capturing the user s head features and a display for showing a resulting personalized avatar. In any event whatever type or types of computer systems are used for generating the facial personalized avatar one or more processors generating the facial avatar will most likely include at least one graphics processing unit GPU .

Suitable examples of a system and components thereof are found in the following co pending patent applications which also provide more information about identifying users all of which are hereby specifically incorporated by reference U.S. patent application Ser. No. 12 475 094 entitled Environment And Or Target Segmentation filed May 29 2009 U.S. patent application Ser. No. 12 511 850 entitled Auto Generating a Visual Representation filed Jul. 29 2009 U.S. patent application Ser. No. 12 474 655 entitled Gesture Tool filed May 29 2009 U.S. patent application Ser. No. 12 603 437 entitled Pose Tracking Pipeline filed Oct. 21 2009 U.S. patent application Ser. No. 12 475 308 entitled Device for Identifying and Tracking Multiple Humans Over Time filed May 29 2009 U.S. patent application Ser. No. 12 575 388 entitled Human Tracking System filed Oct. 7 2009 U.S. patent application Ser. No. 12 422 661 entitled Gesture Recognizer System Architecture filed Apr. 13 2009 U.S. patent application Ser. No. 12 391 150 entitled Standard Gestures filed Feb. 23 2009 and U.S. patent application Ser. No. 12 474 655 entitled Gesture Tool filed May 29 2009 and U.S. patent application Ser. No. 12 696 282 entitled Visual Based Identity Tracking filed Jan. 29 2010.

Before proceeding to discuss in more detail hardware and software components for a system for generating a facial avatar resembling a user in a defined art style illustrates a flowchart of an overview of a method embodiment for automatically generating a facial avatar resembling a user in a defined art style. In step a 3D image capture device e.g. captures 3D image data of head features including facial features of a user and in step one or more software controlled processors of one or more computer systems communicatively coupled to the capture device generate a user 3D head model for the user based on the 3D image data. In step the one or more processors identify a set of transferable user head features from the user 3D head model which can be represented in a facial avatar of a defined art style based on transferable head feature rules for the defined art style and in step the one or more processors identify a set of avatar character head features to represent the set of user head features based on rules for the defined art style. In step the one or more processors generate a facial avatar in the defined art style including the set of avatar character head features and cause a communicatively coupled display to display the facial avatar in step . Additionally a facial expression of the facial avatar may be updated and displayed responsive to changes detected in user facial features.

As shown in this exemplary capture device may include an image and depth camera component which captures a depth image by a pixelated sensor array . A depth value may be associated with each captured pixel. Some examples of a depth value are a length or distance in for example centimeters millimeters or the like of an object in the captured scene from the camera. Sensor array pixel is a representative example of a pixel with subpixel sensors sensitive to RGB visible light plus an IR sensor for determining a depth value for pixel . Other arrangements of depth sensitive and visible light sensors may be used. An infrared IR illumination component emits an infrared light onto the scene and the IR sensors detect the backscattered light from the surface of one or more targets and objects in the scene in the field of view of the sensor array from which a depth map of the scene can be created. In some examples time of flight analysis based on intensity or phase of IR light received at the sensors may be used for making depth determinations.

According to another embodiment the capture device may include two or more physically separated cameras that may view a scene from different angles to obtain visual stereo data that may be resolved to generate depth information.

The capture device may further include a microphone to receive audio signals provided by the user to control applications that may be executing in the computer system as part of the natural user interface.

In the example embodiment the capture device may include a processor in communication with the image and depth camera component and having access to a memory component that may store instructions for execution by the processor as well as images or frames of images captured and perhaps processed by the 3D camera. The memory component may include random access memory RAM read only memory ROM cache Flash memory a hard disk or any other suitable storage component. The processor may also perform image processing including some object recognition steps and formatting of the captured image data.

As shown in the example of the capture device is communicatively coupled with the computer system via a communication link which may be wired or a wireless connection. Additionally the capture device may also include a network interface and optionally be communicatively coupled over one or more communication networks to a remote computer system for sending the 3D image data to the remote computer system . In some embodiments a processor of the computer system or the remote computer system may provide a clock to the capture device that may be used to determine when to capture for example a scene.

In the illustrated example computer system includes a variety of software applications data sources and interfaces. In other examples the software may be executing across a plurality of computer systems one or more of which may be remote. Additionally the applications data and interfaces may also be executed and stored remotely by a remote computer system with which either the capture device or the computer system communicates. Additionally data for use by the applications such as rules and definitions discussed in more detail with respect to may be stored locally be accessible via remotely stored data or a combination of both.

In addition to one or more processors and accessible memory typically found in computer systems computer system comprises an operating system a network interface for communicating with other computer systems a display interface for communicating data instructions or both to a display like display of display device and a camera interface for coordinating exchange of depth image data and instructions with 3D capture device . An image and audio processing engine comprises natural user interface software which may include software like gesture recognition and sound recognition software for identifying actions of a user s body or vocal cues which are commands or advance the action of a multimedia application. Additionally 3D object recognition engine detects boundaries using techniques such as edge detection and compares the boundaries with stored shape data for identifying types of objects. Color image data may also be used in object recognition. A type of object which can be identified is a human body including body parts like a human head. A scene mapping engine tracks a location of one or more objects in the field of view of the 3D capture device. Additionally object locations and movements may be tracked over time with respect to a camera independent coordinate system.

The 3D facial recognition and reconstruction engine may identify head features including facial features from image data of the head location identified by the object recognition engine. The face is part of the head so the shape of one s nose is a facial feature and a head feature. Other features like ear position with respect to a user s eye and top of the skull shape are not on a user s face but are parts of the head typically viewed when looking at a user s face. The 3D facial recognition and reconstruction engine generates a user 3D head model for the user based on the captured depth image data or 3D image data. Embodiments of ways of generating the user 3D head model are discussed in the figures below. The avatar characterization engine automatically represents at least a subset of user head features from the user 3D head model in a facial avatar of a defined style. Embodiments of how the avatar characterization engine may implement the avatar representation are discussed in reference to the figures below. Data sources are available for storing data locally for use by the software of the image and audio processing engine .

An application programming interface API provides an interface for one or more multimedia applications to register avatar characters and data definitions and rules for them associated with the applications. Data sources may store these avatar data definitions and rules. Besides user specific data like personal identifying information including personally identifying image data user profile data may also store data or data references to stored locations of a user 3D head model generated for the user and avatars including their facial aspects generated for the user.

Three dimensional rigs are used in computer graphics for animating character facial expressions. The modeled bones may be in a hierarchical set of bones. Each bone has a 3D transformation which includes a position of the bone scale of the bone and orientation of the bone and optionally a parent bone. In the case of bone hierarchy the full transform of a child bone node is the product of a transformation of its parent and its own transformation.

A head model is displayed next to an exemplary shape unit representing a face center shape unit which includes depth data as a mesh of 3D vertices. In the example of exemplary shape unit represents the points of a shape unit representing a nose. From each of these shape units additional measurements may be made by the 3D facial recognition and reconstruction engine and stored. In the case of for example a nose height can be measured.

In order to generate shape units for a user 3D head model the 3D facial engine may generate point cloud data representing the head and facial features identified from the captured 3D image data also referred to as depth image data track a mask which is referred to as a tracking mask for example in a mesh form to the features. Facial features like a brow a chin a nose and eyes are identified in the tracking mask. In one embodiment a reference human head model may be selected based on gender age overall head size and head shape of the user. The reference human head mode has its head features defined in terms of space units. Shape unit coefficients are derived based on the tracking mask so that a mask including shape units realistically represents the user s face and head as in the image data. Corresponding points or vertices in the tracking mask and the head reference model are identified. Some examples of such feature points are for example corners of the eyes nose tip and lip corners. In one embodiment coefficient data of vertices of the head reference model are determined as starting positions with respect to an origin of the model and coefficient data of vertices for ending positions with respect to the same origin are determined based on the tracking mask data. In some embodiments one or more morph target animation techniques may be used which deform or distort one or more vertices at their starting positions in a mesh to their determined ending positions or morph targets. A matching or close fit criteria may be used for identifying when the ending positions have been reached. The resulting deformed or morphed mesh of vertices is stored in the user 3D head model data . For example coefficient data is stored for each shape unit identifying a 3D shape difference between the morphed mesh of vertices and the head reference mesh model.

In some embodiments the user 3D facial recognition and reconstruction engine determines and stores e.g. in a set of measurements identifying head features directly from the tracking mask generated from the image data. For example the measurements may be 3D measurements relating head features by distance angle and proportion. The measurements may be represented by vertices in space units like and e.g. a mesh of vertices related to a same frame of reference. In other embodiments the shape units determined using a head reference model as described above can be used as the measurements and as a basis for even more detailed measurements. In some examples which measurements are to be performed may be identified by the avatar characterization engine based on rules e.g. identifying transferable features for the defined art style of an avatar.

The 3D capture device is continuously capturing depth image data of the user for example at a rate of 30 frames a second. From this data facial expression changes of the user can be tracked. The 3D facial recognition and reconstruction engine can determine changes in measurements of a set of facial features periodically in accordance with user 3D facial expression metrics for tracking facial changes. Facial action criteria for determined whether the 3D action measurements indicate a change in a user facial feature may be stored in the user 3D facial expression metrics . These changes in measurements in some examples may be stored as action unit coefficients for action unit meshes or sub meshes which may be blended into one or more shape units for representing expression changes of a user s face. For transferable expressions the action unit coefficients for the sub meshes are mapped to corresponding action units for sub meshes of corresponding shape units of an avatar character model. As described below in some examples an avatar in a defined art style may have rules like avatar character s facial expression definitions and rules which indicate a set of expressions an avatar can make and for which of those expressions are user expression data transferable. For example the 3D facial recognition and reconstruction engine can include pattern recognition software which recognizes facial expressions such as a smile or a sigh based on audiovisual capture of the user as well as structures like teeth and a mouth. Details of how a user smiles may include closed lip smile or open mouth smile and may be represented in data as action unit coefficients. In some embodiments rules for an avatar defined art style like avatar character s facial expression definitions and rules may identify facial features of an avatar rather than expressions which facial features move like the facial features for resembling the user s expressions more faithfully. As part of an initialization process a user may be prompted for expressions an avatar in a defined art style can make to capture reference image data.

As discussed more below different approaches for automatically representing at least a subset of user facial features in an avatar face are described. The avatar characterization engine has access to the user 3D head model data as well as access to avatar character s head feature datasets and avatar character s head feature rules which may have been registered by one or more applications . An avatar character head feature dataset may include stylized features for head features in accordance with an art style defined for the avatar. Besides things like nose shape and head shape other options for features like ear shape and size skin color hair style and facial furniture like glasses and facial hair may also be defined in a dataset for a type of avatar. Additionally the avatar character head feature rules can identify avatar features which are displayed independently of user head features and also which user head features are transferable to an avatar in the defined art style. For example a distinctive eye shape may be maintained for the avatar independently of the eye shape of the user. However eye separation distance eye depth and eye width and height are user features which can be represented by the avatar. Such features are referred to as transferable user facial features.

Accessible avatar character facial expression definitions and rules may also be accessed for identifying expressions which the avatar character can make in general and those in which the avatar mimicks from a user e.g. user transferable expressions. Data for example action unit coefficients may be stored for representing the expression by one or more shape units in an avatar head model. There may be rules governing some expressions an avatar does not make such as smiling or how long an expression lasts. Some examples of expressions which may be represented by action unit coefficients include puckered lips puckered lips with ballooned cheeks left mount corner down closed mouth smile an open mouthed smile wide open mouth blinking of an eye brow squeeze raised left brow and raised right brow.

The avatar characterization engine also has access to avatar character s head models . An avatar head shape may be selected based on a head shape of the user. As mentioned previously two different approaches are described in the discussion of the figures below for automatically representing at least a subset of user head features from user 3D head model data in a facial avatar of a defined art style.

In one approach the avatar characterization engine begins with an otherwise featureless 3D head model having the selected avatar head shape. A set of transferable user facial features are represented in the avatar head shape model based on the 3D measurements relating head features by distance angle and proportion and based on the avatar character s head feature rules . Avatar facial features specific to the defined art style are also added as well as adding stylistic elements to the represented user facial features. In some examples the set of transferable facial features the other avatar facial features and the stylistic elements are added onto the featureless 3D avatar head model rather than using morphing techniques. Standard blending techniques may be used to automatically blend the avatar facial features and the additional stylistic elements into the 3D head model which may be stored as the user s personalized avatar character in his or her user profile data or other data source e.g. .

In another approach the avatar character head models are reference head models with features defined in space units for the particular art style defined for a particular avatar character head model. The user facial features transferable to the avatar as represented by their shape unit coefficients computed for the user 3D head model can serve as morph targets. A set of remapping rules like avatar remapping rules can apply a remapping function defined for each shape unit based on its shape. Each remapping rule operates on a single input shape unit and maps to a single output shape unit.

For illustrative purposes the method embodiments below are described in the context of the system and apparatus embodiments described above. However the method embodiments are not limited to operating in the system embodiments described above and may be implemented in other system embodiments.

In step the set of transferable user head features are represented in a 3D model for the selected avatar head shape and are enhanced in step with stylistic elements associated with the avatar. Again in some instances a user transferable feature is not directly represented in the avatar but may be represented by a symbol or feature of a symbol like a hat shape. Additionally a user feature may not be represented to the same degree as in the examples of discussed below. Avatar specific head features outside the set of transferable user head features also referred to as user independent features are added in step . In the embodiment of avatar character head features stored in datastore are a source for data defining avatar features and associated stylistic elements. In step standard blending techniques may be used to automatically blend the head features and the stylistic elements into the 3D model for the selected avatar head shape which 3D model may then be stored in step as a facial avatar associated with the user and which resembles the user. Blending criteria may be stored in the avatar datasets or avatar rules .

In some examples a selected avatar head shape can be represented as point cloud data. The user transferable head features the user independent head features and the stylistic elements can also be represented as point cloud data. A user s facial avatar can then be generated as a 3D rig head mesh connecting the point cloud date of these features and stylistic elements. In other examples a 3D avatar head model selected for the user based on the user head shape model can use morph target techniques to represent the set of transferable user head features and additive techniques used to add on and blend user independent avatar character head features and the stylistic elements.

In many examples the facial and head features of the base avatar head mesh are stored with the stylistic elements of the art style already included. In some examples a single base head mesh for a type of avatar character as may be stored in the avatar character head models suffices as a basis for the deformations to be performed. In other examples an avatar base head mesh may be selected from a group of available base mesh models for the character which vary in head shape and size.

In step coefficient data identifying a 3D shape difference between the user 3D head model for each shape unit N in the set of transferable user head features and the respective shape unit N in the base avatar head mesh is determined. The coefficients for the shape units of the user 3D head model were previously determined via iterations and stored e.g. steps and in . In step the shape units of the base avatar head mesh are remapped using a morph target animation technique using the determined coefficient data and a remapping function identified for each shape unit in avatar remapping rules associated with the avatar selection.

In step the remapped base avatar head mesh is stored as a facial avatar associated with and resembling the user. Additionally blending of the shape units of the remapped base avatar head mesh may be performed for satisfying stored blending criteria for example as stored in either or both of the avatar character head feature datasets or rules . An example of blending criteria may be limits on a distance change between adjacent vertices in any of the 3D dimensions. Texture and color are added as well to the remapped base avatar head mesh personalized for the user based on rules associated with head features in the defined art style of the avatar.

Responsive to the 3D action measurements indicating a change in a user facial feature satisfying facial action criteria shape units of the user 3D head model effected by the facial changes are identified in step and action unit coefficients are determined in step for action unit sub meshes for the effected shape units. In step a facial expression of the facial avatar is updated to mimick the change in the user facial feature in accordance with the 3D action measurements. For example in order to mimick the change the 3D action coefficients for the action sub meshes also effect an underlying 3D rig model for the user s facial avatar head mesh model.

Computer system may also contain communication module s including one or more network interfaces and transceivers that allow the device to communicate with other computer systems. Computer system may also have input device s such as keyboard mouse pen voice input device touch input device etc. Output device s such as a display speakers printer etc. may also be included.

The example computer systems illustrated in the figures include examples of computer readable storage devices. A computer readable storage device is also a processor readable storage device. Such devices may include volatile and nonvolatile removable and non removable memory devices for storage of information such as computer readable instructions data structures program modules or other data. Some examples of processor or computer readable storage devices are RAM ROM EEPROM cache flash memory or other memory technology CD ROM digital versatile disks DVD or other optical disk storage memory sticks or cards magnetic cassettes magnetic tape a media drive a hard disk magnetic disk storage or other magnetic storage devices.

The foregoing detailed description of the inventive system has been presented for purposes of illustration and description. It is not intended to be exhaustive or to limit the inventive system to the precise form disclosed. Many modifications and variations are possible in light of the above teaching. The described embodiments were chosen in order to best explain the principles of the inventive system and its practical application to thereby enable others skilled in the art to best utilize the inventive system in various embodiments and with various modifications as are suited to the particular use contemplated. It is intended that the scope of the inventive system be defined by the claims appended hereto.

